\documentclass[11pt,letterpaper]{report}
\usepackage[margin=1in]{geometry}
\usepackage[latin1]{inputenc}
\usepackage{url}
\usepackage{hyperref}
\usepackage{doi}
\usepackage{breakurl}
\urlstyle{same} 			% Use same font type and size for url as the text.

\usepackage{natbib}
\usepackage{fancyhdr}
\pagestyle{fancy}
\usepackage[hang]{footmisc}
\usepackage[textfont={bf}]{caption}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage[version=3]{mhchem}
\usepackage[table,dvipsnames,svgnames,x11names]{xcolor}
\usepackage{color}
\usepackage{dcolumn}
\usepackage{booktabs}
\usepackage{pdflscape}
\usepackage{textcomp}
\usepackage{float}
\usepackage{subfig}
\usepackage{chngcntr}
\usepackage{needspace}
\counterwithout{figure}{chapter}
%\usepackage[usenames,dvipsnames,svgnames]{xcolor}
\definecolor{darkerGreen}{rgb}{0.702,0.800,0.510}
\definecolor{darkGreen}{rgb}{0.839,0.890,0.737}
\definecolor{liteGreen}{rgb}{0.918,0.945,0.867}
\definecolor{lightgray}{gray}{0.9}
\definecolor{lightblue}{rgb}{0.93,0.95,1.0}
\definecolor{URLBlue}{rgb}{0,0,0.5} % Define new color for hyperlinks
\hypersetup{
	colorlinks   = true,
	citecolor    = URLBlue,
	linkcolor    = URLBlue,
	urlcolor     = URLBlue
}

\definecolor{TableBorder}{rgb}{0.325,0.557,0.835}
%\definecolor{TableEven}{rgb}{0.8000,0.9216,0.9490}
\definecolor{TableEven}{rgb}{0.773,0.851,0.945}
\definecolor{TableOdd}{rgb}{1,1,1}

%\usepackage{pstricks,pst-node,pst-tree}

\usepackage{pgfplots}
\usetikzlibrary{matrix}
\usepgfplotslibrary{groupplots}

\pgfplotsset{compat=newest}
\pgfplotsset{every axis/.append style={line width=0.75pt},
   axis x line*=bottom, axis y line*=left}
\pgfsetplotmarksize{0pt}

\usetikzlibrary{shapes,arrows}
% Define block styles
\tikzstyle{decision} = [diamond, draw, fill=blue!20,
   text width=5.0em, text badly centered, node distance=3cm, inner sep=0pt]
\tikzstyle{block} = [rectangle, draw, fill=blue!20,
   minimum width=5cm, minimum height=2.0cm, text centered, text width=5cm,
   rounded corners, minimum height=4em]
\tikzstyle{smallblock} = [rectangle, draw, fill=blue!20,
   minimum width=2.5cm, minimum height=2.0cm, text centered, text width=2.5cm,
   rounded corners, minimum height=4em]
\tikzstyle{line} = [draw, -latex']
\tikzstyle{cloud} = [draw, ellipse,fill=red!20, node distance=5cm, minimum height=1.5cm]
\usepackage{tikzpagenodes}
\usetikzlibrary{calc}
\definecolor{GTAPBlue}{RGB}{27,66,115}
\definecolor{GTAPOrange}{RGB}{243,143,34}

\usepackage{forest}
\usetikzlibrary{shadows}
% RGB scale relative to 255
\definecolor{TableBorder}{rgb}{0.325,0.557,0.835}
%\definecolor{TableEven}{rgb}{0.8000,0.9216,0.9490}
\definecolor{TableEven}{rgb}{0.773,0.851,0.945}
\definecolor{TableOdd}{rgb}{1,1,1}
\newcommand\VRule[1][\arrayrulewidth]{\vrule width #1}
\definecolor{dkBlue}{rgb}{0.6157 0.7647 0.9020}
\definecolor{mdBlue}{rgb}{0.7412 0.8431 0.9333}
\definecolor{ltBlue}{rgb}{0.8706 0.9216 0.9686}

\usepackage{listings}
\input{../../../Word/Latex/gams}
\usepackage{extdash}
\newif\ifCESDetail
\CESDetailfalse

\begin{document}

\newcommand{\COT}{\ce{CO2}}
\newcommand{\localtextbulletone}
   {\textcolor{gray}{\raisebox{.45ex}{\rule{.7ex}{.7ex}}}}
\renewcommand{\labelitemi}{\localtextbulletone}
\newcommand{\overbar}[1]
   {\mkern 1.0mu\overline{\mkern-1.0mu#1\mkern-1.0mu}\mkern 1.0mu}
\lhead{}

% ---------- FIRST PAGE cover page with GTAP colors and logo

\pagestyle{empty}
\begin{tikzpicture}[overlay,remember picture]

    % Fill top rectangle with shaded orange

    \fill[GTAPOrange!20]
       ([yshift=2.0cm]current page.north west) rectangle ([yshift=-8.5cm]current page.north east);

    %  Make blue bar on extreme left
    %  Make orange bar to the right of the blue bar

    \fill[GTAPBlue]
      ([yshift=2.0cm]current page.north west) rectangle ([xshift=0.4cm]current page.south west);

    \fill[GTAPOrange,left color=GTAPOrange, right color=GTAPOrange!50]
       ([xshift=0.5cm,yshift=2.0cm]current page.north west) rectangle ([xshift=1.0cm]current page.south west);

    %  Insert main title and WP number

    \draw[GTAPOrange,thick] (13cm,-3cm)
       node[GTAPBlue,above left] {\Huge \textbf{\textsf{GTAP Technical Paper}}} --+ (0,3)
       % >>>> INSERT TP NUMBER HERE <<<<
       node[GTAPBlue,below right] {\LARGE \textbf{\textsf{TP/25/xx}}};

    %  Insert WP title and author(s)

    \node[yshift=-9cm,GTAPBlue] at (8.5cm,0cm) {\scalebox{1.5}
       {\textbf{The \underline{Env}ironmental \underline{I}mpact and
          \underline{S}ustainability \underline{A}pplied } } } ;
    \node[yshift=-10cm,GTAPBlue] at (8.5cm,0cm) {\scalebox{1.5}
       {\textbf{\underline{G}eneral
          \underline{E}quilibrium ({ENVISAGE}) Model, Version 11.0} } } ;
    \node[yshift=-12cm,GTAPBlue] at (8.5cm,0cm) {\scalebox{1}
       {\textbf{by Dominique van der Mensbrugghe}}};

    %  Insert Center's name and logo

    %  Insert Center's name and logo

    \node[yshift=-18cm,GTAPBlue] at (8.5cm,0cm)
       {\scalebox{0.45}{\includegraphics{GTAP_logo_CGTA_words.eps}}};

\end{tikzpicture}

\normalsize
\clearpage

% ---------- SECOND PAGE with copyright, edition(s), reference, etc.

\pagestyle{empty}

\vspace*{2cm}
\footnotesize
\noindent \textcopyright \, 2025 Center for Global Trade Analysis, Purdue University \\
All rights reserved.

\vspace{3cm}
%\noindent First edition: van der Mensbrugghe, Dominique, 2019. \\
%\hspace*{0.5cm} The Standard GTAP Model in Gams, Version 7 \\
%\hspace*{0.5cm} \emph{Journal of Global Economic Analysis}, 3(1): 1--83. \\
\noindent First edition: June 2019 \\
\noindent Second edition: March 2020 \\
\noindent Third edition: November 2021 \\
\noindent Third edition: April 2025 \\

\vspace{4cm}
\noindent \emph{Please cite using the following reference:} \\
\hspace*{0.25cm} van der Mensbrugghe, Dominique, 2025. \\
\hspace*{0.5cm} The Environmental Impact and Sustainability Applied \\
\hspace*{0.5cm} General Equilibrium (ENVISAGE) Model, Version 11.0 \\
\hspace*{0.5cm} GTAP Technical Paper, TP/25/xx \\
\hspace*{0.5cm} Center for Global Trade Analysis, Purdue University \\
\hspace*{0.5cm} West Lafayette, IN \\
\hspace*{0.5cm} \url{https://www...} \\

\vspace{2cm}
\noindent Center for Global Trade Analysis \\
Department of Agricultural Economics \\
Purdue University \\
West Lafayette, IN 47907 \\
\url{https://www.gtap.agecon.purdue.edu} \\
\clearpage

% ---------- THIRD PAGE internal cover page with title, author(s), abstract, etc.
\pagestyle{empty}

\vspace*{1cm}

\begin{center}

\Large \textbf{{The \underline{Env}ironmental \underline{I}mpact and
   \underline{S}ustainability \underline{A}pplied \underline{G}eneral
   \underline{E}quilibrium ({ENVISAGE}) Model, Version 11.0}} \\[2cm]

\large{Dominique van der Mensbrugghe\footnote{The Center for Global Trade Analysis,
   Purdue University, 403 Mitch Daniels Boulevard, West Lafayette, IN 47906.
   Corresponding e-mail: vandermd@purdue.edu.}
} \\ [1cm]

\today \\ [2cm]

\normalsize
\begin{minipage}{0.85\linewidth}
\textbf{Abstract: }
{This document's main purpose is to provide a full description
of the \textsc{Envisage} Model. \textsc{Envisage} is a global recursive dynamic
computable general equilibrium model developed originally at the {World Bank}.
\textsc{Envisage} has been developed to
assess the interactions between economies and the global environment as affected
by human-based emissions of greenhouse gases. At its core, \textsc{Envisage} is
a relatively standard recursive dynamic multi-sector multi-region CGE model. It
is complemented with an emissions and climate module that links
directly economic activities to changes in global mean temperature. And it
incorporates a feedback loop that links changes in temperature to impacts on
economic variables such as agricultural yields or damages created by sea level
rise [tbd]. One of the overall objectives of the development of
\textsc{Envisage} has been to provide a greater focus on the economics of
climate change for a more detailed set of developing countries as well as
greater attention to the potential economic damages. The model remains a work in
progress as there are several key features of the economics of climate change
that are planned to be incorporated.}
\end{minipage}
\end{center}

\vspace{2cm}
\begin{tabbing}
\hspace*{0.5cm} \textbf{JEL Codes:} \= {>>>> INSERT JEL CODES HERE <<<<} \\
\hspace*{0.5cm} \textbf{Keywords:}  \> {>>>> INSERT KEYWORDS HERE <<<<}\\
\end{tabbing}
\newpage

% ----------- NEXT PAGES include table of contents, list of table, list of figures

% Start page numbering with '2', title page should fit on one page, set
% page numbering to roman
\pagestyle{plain}
\pagenumbering{roman}
\setcounter{page}{2}

\tableofcontents
\newpage

\listoftables
\newpage

\listoffigures
\newpage

\setcounter{page}{1}
\pagenumbering{arabic}
\pagestyle{plain}
\renewcommand*{\thefootnote}{\arabic{footnote}}
\setcounter{footnote}{0}

\chapter{Introduction}
\renewcommand{\thepage}{\arabic{page}}% Arabic numerals for page counter
\setcounter{page}{1}

The purpose of this document is to provide a complete specification of the
equations of the \textsc{\underline{Env}ironmental} \textsc{\underline{I}mpact}
\textsc{and} \textsc{\underline{S}ustainability} \textsc{\underline{A}pplied}
\textsc{\underline{G}eneral} \textsc{\underline{E}quilibrium}
(\textsc{\textsc{ENVISAGE}}) \textsc{Model}. The \textsc{Envisage} Model is
designed to analyze a variety of issues related to the economics of climate
change:

\begin{itemize}
   \item Baseline emissions of \COT{} and other greenhouse gases
   \item Impacts of climate change on the economy
   \item Adaptation by economic agents to climate change
   \item Greenhouse gas mitigation policies---taxes, caps and trade
   \item The role of land use in future emissions and mitigation
   \item The distributional consequences of climate change impacts, adaptation
         and mitigation---at both the national and household level.
   \item Assessing projections of nutritional indicators and policies
   that impact nutrition pathways.
\end{itemize}

\textsc{Envisage} is intended to be flexible in terms of its dimensions. The
core database---that includes energy volumes and \COT{} emissions---is the GTAP
database, currently version 11B with a 2017 base year (see
\cite{AguiaretalJGEA2023}). The latter divides the world into 160
regions, of which 141 are individual countries and the other are region-based
aggregations.\footnote{The countries defined in GTAP cover well over 90 percent
of global GDP and population.} The database divides global production into 65
sectors---with extensive details for agriculture and food and energy (coal
mining, crude oil production, natural gas production, refined oil, electricity,
and distributed natural gas). Appendix~\ref{chap:GTAPDim} provides more detail.
Due to numerical and algorithmic constraints, a typical model is limited to some
20-30 sectors and 20-30 regions.

This document describes the current version of \textsc{Envisage}, which is still
in a developmental stage. This current version includes the following:

\begin{itemize}
   \item Capital vintage production technology that permits analysis of the
         flexibility of economies.
   \item {Two-level decomposition of domestic absorption into demand for domestic
         production and bilateral imports. This ranges from a simple version
         with a national agent optimizing each stage, to a full MRIO version
         with bilateral sourcing at the agent level. [Added 31-Oct-2020] The
         three specifications can co-exist, i.e. the model allows for any
         one of the three specifications to operate simultaneously and the choice can
         be both region- and sector-specific.}
   \item A detailed specification of energy demand in each economy.
   \item {[Added 31-OCT-2020]. The energy bundles---both in production and final demand---have been adjusted to allow for the traditional specification using a standard nested CES structure as well as the so-called additive version of the CES. The latter, which represents a different formulation of the logit specification, implies both volume and value additivity. It is more fully described in Appendix~\ref{chap:CESAppendix} and in \cite{DvdMPetersGTWP2020}. The Armington trade structure and
   the CET allocation of domestic supply have also been adapted to allow for the additive version of the CES and CET, respectively.}
   \item A resource depletion module for coal, oil and natural gas.
   \item The ability to introduce future alternative energy (or backstop)
         technologies [tbd]
   \item \COT{} emissions that are fuel and demand specific.
   \item Incorporation of the main Kyoto greenhouse gases (methane, nitrous
         oxide and the fluoridated gases) as well as a set of additional
         emissions (such as particulates, black carbon, etc.).
   \item A flexible system for incorporating any combination of carbon taxes,
         emission caps and tradable permits.
   \item {[Added 31-Oct-2020] A simplified climate module that links greenhouse gas emissions to
         atmospheric concentrations combined with a carbon cycle that leads to
         radiative forcing and temperature changes.}
   \item A water module that incorporates water use for irrigation by crop, and
         aggregate water demand in other parts of the economy.
   \item {[Added 21-Apr-2018] Government to government transfers have been
   incorporated. As more small developing countries are being included in the
   GTAP database and models, a more detailed accounting of the balance of
   payments is important to reflect macro balances.}
   \item {[Added 01-Dec-2018] The trade module now includes the \emph{ad valorem} equivalent (AVE) of non-tariff measures (NTMs). Unlike tariff revenues, the revenues generated by the NTMs can be allocated to private households and government---either domestic or foreign.}
   \item {[Added 01-Dec-2018] The make module has a new technology parameter that can be used to capture changes in post-harvest (or production) losses.}
   \item {[Added 01-Dec-2018] Household demand includes a new waste module, with the possibility of taxing
   household waste.}
   \item {[Added 20-Jan-2019] A research and development (R\&D) module has been added. R\&D expenditures add to the knowledge stock, however with a distributed lag structure. The knowledge stock influences an endogenous component of labor productivity growth.}
   \item {[Added 20-Jan-2019] A global social welfare function has been introduced. This is
   still provisional.}
   \item {[Added 01-Apr-2020] A resource depletion module has been added for coal, oil and natural gas resources.}
   \item {[Added 01-Apr-2020] The carbon mitigation regimes have been modified to deal with multiple regimes within
   a same country/region---for example Europe's Emission Trading Scheme (ETS)}. The model also includes the
   possibility of inter-regional transfers to equate burden sharing among coalition countries (measured by
   equivalent variation).
   \item {[Added 1-Sep-2021] Cap and trade regimes are now defined
   over GHG emission bundles---that may include one or more GHGs.}
   \item {[01-Nov-2021] Process emissions have been added to the database and
   the model. Process emissions are linked to the top-level GHG bundle
   in production. Work is ongoing to calibrate the GHG bundles
   to external MAC curve estimates.}
   \item {[Added 01-Apr-2020]} Fiscal closure has been modified to allow for different re-cycling schemes for carbon revenues.
   \item {[Added 01-Apr-2020]} 'Phantom' taxes have been added to shape changes in preferences in the power bundle and household demand.
   \item {[Added 01-Apr-2020]} A savings equation has been added that links the domestic private saving rate to changes
   in the rate-of-return to capital.
   \item {[Added 01-Apr-2020]} Labor market closure now has three specifications: (1) Fixed employment and equilibrium
   wages; (2) An endogenous minimum (or) reservation wage that moves with the rate of unemployment and allows for
   endogenous regime shifts between full and un-employment; (3) [New] Short-term deviations in employment from long-run trends similar to the wage formulation in Monash-style models (\cite{DixonRimmer2002}).
   \item {[Added 01-Apr-2020]} Two new productivity parameters have been introduced. One ($\mathit{TFP}$) applies
   to all inputs---materials and value added. The second ($\mathit{FTFP}$) applies only to value added.
   \item{[01-Nov-2021] The natural resource bundle in production has two
   possible locations---bundled with capital at the bottom of the production
   nest or as a share of output (net of GHG) at the top of the nest.}
   \item{[20-Apr-2022] The model allows for multiple land types and can
   be coupled to GTAP's land-use database that has agricultural and forestry
   land-use classified by 18 agro-ecological zones (AEZ). See \cite{BaldosCorongGTPRM362020}.}
   \item {[08-Aug-2023] The model was coupled to the GTAP nutrition database
   see \cite{Chepeliev2022}.}
\end{itemize}

The current work program includes the following tasks:

\begin{itemize}
	\item The climate change damage module
\end{itemize}

The \textsc{Envisage} Model is a descendant of a family of models that
originated at the OECD in the late 1980s and early 1990s, WALRAS, RUNS and
GREEN.\footnote{\cite{WALRAS1990}, \cite{Burniaux1987}, \cite{BDvdM1994},
\cite{Burniauxetal1992}, and \cite{GREENDvdM1994}. Note that WALRAS and RUNS
were initially developed at Stanford University and the Universit{\'e} Libre
de Bruxelles, respectively.} \textsc{Envisage} was initially developed at the
World Bank in 2007 and was a re-coded version of the World Bank's
\textsc{Linkage} model (\cite{LINKDvdM2011}), which had a trade focus. It is
designed specifically to analyze climate change issues and thus incorporates a
more developed energy sector, a climate module (that makes integrated assessment
an option), and climate change impact feedbacks. \textsc{Envisage} is coded
using the GAMS/MCP package.

The current (draft) version is a complete re-coding of the original
\textsc{Envisage} Model largely undertaken at the behest of the OECD's
Environment Directorate, whose ENV-Linkages model also descended from the
above-mentioned OECD models. [The current version has yet to incorporate all of
the features of the original \textsc{Envisage} Model, but work is ongoing to
complete the task.] This version, developed and residing at the Center for
Global Trade Analysis (GTAP), thus shares a core code with the OECD ENV-Linkages
model, though further development of the individual models will diverge some
over time due to differing priorities and preferences. The version developed for
the OECD, ENV-Linkages, is a relatively faithful translation of their original
specification (\cite{ChateauetalOECD2014}), but with a clean interface,
streamlined code and improvements in its numerical properties. The water module
was developed specifically for the OECD. Note that the ENV-Linkages team at the
OECD was a core contributor to the quantification of the Shared Socio-Economic
Pathways that will frame the analysis of the economics of climate change for at
least the next decade (\cite{DellinketalGEC2017}).

The following items have been added to this version of the model compared to the
previous:
\begin{itemize}
   \item A new capital flow module has been implemented, but is still undergoing
         testing and should be used with appropriate caution. It is inspired by
         the domestic capital allocation specification of the USAGE Model
         (\cite{DixonRimmer2005}).
   \item Preference shifters have been added to the power bundles.
   \item The model interface has been revamped to couple with the new GTAP
         database format. The latter is described in more detail in
         \cite{CorongetalJGEA2017}. The standard GTAP model has undergone its
         first major facelift in over a decade and this has entailed a number of
         changes to the database---though mostly in terms of naming conventions
         as opposed to changes in functionality. The two most important changes
         include the introduction of a 'make' matrix, i.e. the explicit
         differentiation  of activities from commodities; and the conversion of
         all taxes to be measured relative to base prices---in other words,
         all taxes are positive and subsidies negative. This affects output and
         export taxes.
   \item To hone more closely to the new GTAP standard model, two sets of taxes
         have been modified. The first relates to output taxes. These are now
         identified by two indices---source activity and supplied commodity. The
         current database, in the absence of additional tax information, assumes
         these are uniform across source activities, though need not be after
         aggregation. The second refers to taxes on factor income. These are now
         identified by source activity as well as by receiving factor. Thus
         taxes on capital (or any other factor) can differ depending on the
         activity where the factor is used.
\item {[31-Dec-2019] The entire model has been re-coded such that all (or almost all)
variables have been normalized in the base year, i.e. are set to the value 1.
A key purpose for implementing the model in normalized levels is that it should
help in dealing with scaling problems. It also simplifies many expressions,
notably the CES/CET expressions as the share parameters can mostly be dropped.
The CES/CET dual price expressions are expressed in terms of the base year
value shares.\footnote{This comes close to the GEMPACK implementation of
CGE models, albeit the interpretations of the share parameters differ as in
the case of the model in levels, the share parameters are fixed at base
year levels, whereas in the GEMPACK models, the share parameters reflect
the contemporaneous value shares.} The description of the model herein
is based on a version of the model calibrated in levels, thus the normalization
is implicit. In the code, all formulas adhere to the normalized levels of
the variables that are scaled when needed, such as for accounting relations.}
\item{[31-Mar-2025] The front-end of the model, i.e., the preparation
of the database, has been extensively modified and the former workflow,
which was a complex Windows-based command file\footnote{Also available as
a MacOS shell script.} has been converted to a workflow written as
a GAMS file. The latter increases transparency and also makes the workflow
independent of the operating system.}
\end{itemize}

The next section provides a brief summary of the main model features. This is
followed by a much longer section with a full-blown description of the
\textsc{Envisage} Model.

\chapter{The \textsc{Envisage} Model in a nutshell}

The \textsc{Envisage} Model at its core is a recursive dynamic and global
computable general equilibrium model (CGE). It follows the circular flow of an
economy paradigm. Firms purchase input factors (for example labor and capital)
to produce goods and services. Households receive the factor income and in turn
demand the goods and services produced by firms. And equality of supply and
demand determine equilibrium prices for factors, goods and services. The model
is solved as a sequence of comparative static equilibria where the factors of
production are exogenous for each time period and linked between time periods
with accumulation expressions.

Production is implemented as a series of nested
constant-elasticity-of-substitution (CES) functions the aim of which is to
capture the substitutability across all inputs. Three production archetypes are
implemented. The first is for crops that reflects intensification of inputs
versus land extensification. The second is for livestock that reflects
range-fed versus ranch-fed production. The final, also referred to as the
default, revolves largely around capital/labor substitutability. Some production
activities highlight specific inputs (for example agricultural chemicals in
crops and feed in livestock) and all activities include energy and its
components as part of the cost minimization paradigm. Production is also
identified by vintage---divided into \emph{Old} and \emph{New}---with typically
lower substitution possibilities associated with \emph{Old} capital.

Each production activity is allowed to produce more than one commodity---for
example the ethanol sector can produce ethanol and distiller's dried grains with
solubles (DDGS). And commodities can be formed by the output of one or more
activities (for example electricity). \textsc{Envisage} therefore uses a
different classification of activities and commodities.\footnote{Production
activities are indexed with $a$ and commodities are indexed with $i$.} One of
the features of the model is that it integrates the GTAP power data base
that disaggregates GTAP's electricity sector ('ely') into 11 different power
sources plus electricity transmission and distribution. Though the database has
both the supply and demand side for all 11 power sources, the aggregation
facility permits the aggregation of electricity demand into a single commodity
and the 'make' matrix specification combines the output from the different power
activities into a single electricity commodity.

Income accrues from payments to factors of production and is allocated to
households (after taxes). The government sector accrues all net tax payments and
purchases goods and services. The model incorporates multiple utility functions
for determining household demand. There is a set of three household demand
functions linked to the ubiquitous linear expenditure system (LES): the standard
LES, the extended LES (ELES) that incorporates household saving into the utility
function, and 'an implicitly directly additive demand system' (AIDADS), that
allows for non-linear Engel curves in the LES framework.\footnote{Users can also
specify implementing a Cobb-Douglas (CD) utility function, which can be
considered part of the LES framework.}  The fourth option uses the constant
differences in elasticity (CDE) utility function that is used in the core
GTAP model (\cite{Hertel1997} and \cite{CorongetalJGEA2017}). The ELES
incorporates the decision to save in a top level utility function. The other
demand systems assume savings is a proportion of disposable income in
the default closure. The consumer utility function determines consumer demand
bundles that are subsequently converted to produced goods using a consumer
demand 'make' or transition matrix. Investment is savings driven and equal to
domestic saving adjusted by net capital flows.

Trade is modeled using the so-called Armington specification that posits that
demand for goods are differentiated by region of origin. The model allows for
domestic/import sourcing at the aggregate level (after aggregating domestic
absorption across all agents), or at the agent-level. In the standard
specification, a second Armington nest allocates aggregate import demand across
all exporting regions using a representative agent specification. Note that a
newer, though minimally tested version, allows for sourcing imports by
agent---also known as the MRIO specification. Exports are modeled in an
analogous fashion using a nested constant-elasticity-of-transformation (CET)
specification. The domestic supply of each commodity is supplied to the domestic
market and an aggregate export bundle using a top-level CET function. The latter
is allocated across regions of destination using a second-level CET
function.\footnote{The model allows for perfect transformation, which is the
standard specification in the GTAP model.} Each bilateral trade node is
associated with four prices: 1) the producer price; 2) the export border price,
also referred to as the free-on-board (FOB) price; 3) the import border price,
also referred to as the cost, insurance and freight (CIF) price; and 4) the
end-user price that includes all applicable trade taxes (but before domestic
sales or VAT taxes). The wedge between the
producer price and the FOB price is represented by the export tax (or subsidy if
negative) and the wedge between the CIF and end-user prices represents the
import tariff (and perhaps other import related distortions). The wedge between
the CIF and FOB prices represents the international trade and transport margins.
These margins represent the use of real resources that are supplied by each
region. The global international trade and transport sector purchases these
services from each region so as to minimize the aggregate cost.

The model has two fundamental markets for goods and services. Domestically
produced goods sold on the domestic market, and domestically produced goods sold
by region of destination. All other goods and services are composite bundles of
these goods. Two market equilibrium conditions are needed to clear these two
markets.\footnote{If there are $N$ commodities and $R$ regions, there will be
$R \times N$ market clearing conditions for domestic goods and $R \times N
\times R$ market clearing conditions for bilateral trade.}

The model incorporates five types of production factors: 1) labor (of which
there can be up to 5 types); 2) capital; 3) land (of which there
can be multiple types); 4) a sector specific natural
resource (such as fossil fuel energy reserves); and 5) water. The labor market
is allowed to be segmented (though not required). The model allows for regime
switching between full and partial wage flexibility. Capital is allocated across
sectors so as to equalize rates of returns. If all sectors are expanding,
\emph{Old} capital is assumed to receive the economy-wide rate of return. In
contracting sectors, \emph{Old} capital is sold on secondary markets using an
upward sloping supply curve. This implies that capital is only partially mobile
across sectors. Aggregate land (by type) and water supply are specified using supply
curves. Though there are several options, the preferred supply curve is a
logistic function that has an upper bound. Water demand also includes exogenous
components for environmental uses and groundwater recharge. Land and water are
allocated across activities using a nested CET specification.\footnote{Land is
only implemented for agricultural activities. Water demand by activity is only
present in irrigated crop sectors. Other water demand is based on aggregate
demand functions with market clearing, but is not part of the cost structure.}
Natural resources are supplied to each sector using an iso-elastic supply
function with the possibility differentiated elasticities depending on market
conditions.

\textsc{Envisage} incorporates the main greenhouse gases---carbon, methane,
nitrous oxides and fluorinated gases, as well as an additional set of
10 emissions, such as particulate matter and black carbon.
Emissions are generated by consumption of
commodities (such as fuels), factor use (for example land in rice production and
herds in livestock production) and there are also processed base emissions such
as methane from landfills.\footnote{The current version of the model does not
include carbon emissions from deforestation---an important source of global
carbon emissions.} A number of carbon control regimes are available in the
model. Carbon taxes can be imposed exogenously---potentially differentiated
across regions. The incidence of the carbon tax allows for partial or full
exemption by commodity and end-user. For example households can be exempted from
the carbon tax on natural gas consumption. The model allows for emission caps in
a flexible manner---where regions can be segmented into coalitions on a
multi-regional or global basis. The model allows for
countries/regions to be in multiple trading systems simultaneously---such
as Europe's Emission Trading System (ETS). In addition to the standard cap system, a cap
and trade system can be defined where each region within a coalition is assigned
an initial emission quota.

Dynamics involves three elements. Labor supply (by skill level) grows at an
exogenously determined rate. The aggregate capital supply evolves according to
the standard stock/flow motion equation, i.e. the capital stock at the beginning
of each period is equal to the previous period's capital stock, less
depreciation, plus the previous period's level of investment. The third element
is technological change. The standard version of the model assumes labor
augmenting technical change---calibrated to given assumptions about GDP growth
and inter-sectoral productivity differences. A portion of labor productivity
growth can be linked to R\&D expenditures. In policy simulations, technology
is typically assumed to be fixed at the calibrated levels, though can be
influenced by changes in R\&D expenditures.

\chapter{Model specification}

The next section describes the key model dimensions. Subsequent sections
describe the various blocks or modules of the model using the traditional
circular flow scheme of economics, i.e. starting with production and factor
incomes, income distribution, demand, trade, and macro closure. At the end,
there is a discussion on the model dynamics.

\begin{center}
\fbox{
\begin{minipage}{0.85\textwidth}
\textbf{A note on normalization}. As noted above, the new version
of the model is fully normalized. Normalization is in part intended to
improve the numeric scale of the model. It also simplifies many formulas,
such as the CES or iso-elastic supply and demand functions. In general, these
formulas no longer require calibration. In the case of the CES
price expression, the calibrated share parameters are replaced with
the base year cost or budget shares.

In its most generic formulation, the CES expressions can be reduced to:
\[
X_i = \alpha_i \left( \lambda_i \right)^{\sigma-1} V \left(\frac{C}{P_i}\right)^\sigma
\]
\noindent and
\[
C = \left[\sum_i{\alpha_i\left(\frac{P_i}{\lambda_i}\right)^{1-\sigma}}\right]^{1/(1-\sigma)}
\]
\noindent where $X_i$ are the components of the CES composite, $V$, with prices $P_i$, and with an aggregate cost of $C$. The $\alpha_i$ are the (dual) cost share parameters that can be calibrated to an arbitrary initialization of all the variables and $\lambda_i$ are shift parameters (e.g. technology or preferences). The normalized expressions (see Appendix~\ref{chap:CESAppendix}) are:

\[
X_i^n = \left( \lambda_i \right)^{\sigma-1} V^n \left(\frac{C^n}{P_i^n}\right)^\sigma
\]
\noindent and
\[
C^n = \left[\sum_i{s_i\left(\frac{P^n_i}{\lambda_i}\right)^{1-\sigma}}\right]^{1/(1-\sigma)}
\]
\noindent where $s_i$ is the base year cost share and the superscripted variables are the normalized values. Consistent accounting is expressed by:

\[
\left(C_0 V_0\right) C^n  V^n= \sum_i{\left(P_{i,0} X_{i,0}\right) P^n_i  X^n_i}
\iff C^n  V^n= \sum_i{s_i P^n_i  X^n_i}
\]
\noindent where the '0' subscript represents the base year level.

The model as described below is based on level expressions, i.e. not the normalized
version of the model. Note as well, that in principle the CES dual share parameters
can be dropped from the CES expressions (and are replaced by the base year cost
shares in the case of the price expression). However, in some
cases the dual share parameters may be retained as they
could be modified during the course of a simulation, for
example recalibration of '\emph{Old}' technology in production, or
preference shifters. However, these parameters, if retained, are
not calibrated using base year data and instead are initialized to
1.
\end{minipage}
}
\end{center}

\section{Model dimensions}

The model specification in GAMS is mostly as general as possible, i.e. virtually
all variables and equations are specified using set-based indices that are
defined at run-time when the data is read in. The model can thus be configured
for any number of regions (up to 141 with the latest GTAP release) and any
number of sectors (up to 65 with the standard GTAP database and 84 with the
power/water database).

Table~\ref{tab:TabDim} lists the main indices used by the model. On the demand
side the key dimension is the number of Armington agents (indexed by
$\mathit{aa}$). The Armington agents include all production activities
(indexed by $a$), and final demand agents (indexed by $\mathit{fd}$). The latter
are split into households ($h$), government ($\mathit{gov}$) and investment
($\mathit{gov}$). Activities, i.e. production sectors, are separated from
commodities. The former are indexed by $a$ and the latter by $i$ (with a
possible alias of $j$). Thus intermediate demand, $\mathit{XA}_{i,a}$ represents
the demand for commodity $i$ by activity $a$.\footnote{In the 'classic' GTAP
database there is a one-to-one mapping between activities and commodities. The
new 'standard' GTAP database differentiates activities and commodities.} The
\textsc{Envisage} model allows for a non-diagonal make matrix that is
user-determined at the time of aggregating the GTAP database. This has proven
useful, for example, for the power sector. The new power database has 11 power
generating technologies with a complementary transmission and distribution
activity. These can be aggregated to a single electricity commodity using the
make matrix (with a nested CES specification).

The model incorporates three different production structures---crops, livestock
and other. These will be indexed by $\mathit{acr}$, $\mathit{alv}$ and
$\mathit{ax}$, respectively---all subsets of $a$. Activities are also
sub-divided into two 'geographic' zones---rural and urban. Typically,
agricultural activities are assigned to the rural zone and all other activities
to the urban zone. The model allows for segmented labor markets by geographic
zone with a Harris-Todaro-type migration function (\cite{HarrisTodaro1970}).
Most of the other indices are relatively self-explanatory and will be further
elaborated on in the model description.

Three key indices are not part of the table---an index for power
($\mathit{pb}$), land ($\mathit{lb}$) and water bundles ($\mathit{wbnd}$).
These indices are user-defined and are used to aggregate power supply in
the power module, allocate land across sectors in the land supply module and
allocate water across uses in the water supply module. They will be further
described in their respective sections.

\begin{table}[H]
\caption{Sets used in model definition}
\label{tab:TabDim}
\begin{center}
\rowcolors{2}{TableOdd}{TableEven}
\rowcolors{1}{}{lightblue}
\begin{tabular}{l l}
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
\textbf{Set} & \textbf{Description} \\
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
\scriptsize $\mathit{aa}$   & \scriptsize Armington agents \\
\scriptsize $\mathit{a}$    & \scriptsize Activities (a subset of $\mathit{aa}$) \\
\scriptsize $\mathit{acr}$  & \scriptsize Crop activities (a subset of $\mathit{a}$) \\
\scriptsize $\mathit{alv}$  & \scriptsize Livestock activities (a subset of $\mathit{a}$) \\
\scriptsize $\mathit{ax}$   & \scriptsize All other activities (a subset of $\mathit{a}$) \\
\scriptsize $\mathit{elya}$ & \scriptsize Power activities (a subset of $\mathit{a}$) \\
\scriptsize $\mathit{z}$    & \scriptsize Set of zones---just rural (\texttt{rur}) and urban (\texttt{urb}) \\
\scriptsize $\mathit{i}$    & \scriptsize Produced (or supplied) goods \\
\scriptsize $\mathit{inum}$ & \scriptsize Set of manufacturing sectors (subset of $i$, used in definition of num{\'e}raire) \\
\scriptsize $\mathit{fp}$   & \scriptsize Factors of production \\
\scriptsize $\mathit{l}$    & \scriptsize Labor categories (subset of $\mathit{fp}$) \\
\scriptsize $\mathit{ul}$   & \scriptsize Unskilled labor categories (subset of $\mathit{l}$) \\
\scriptsize $\mathit{sl}$   & \scriptsize Skilled labor categories (subset of $\mathit{l}$) \\
\scriptsize $\mathit{cap}$  & \scriptsize Capital account (subset of $\mathit{fp}$) \\
\scriptsize $\mathit{lnd}$  & \scriptsize Land account(s) (subset of $\mathit{fp})$ \\
\scriptsize $\mathit{nrs}$  & \scriptsize Natural resource account (subset of $\mathit{fp}$) \\
\scriptsize $\mathit{wat}$  & \scriptsize Water account (subset of $\mathit{fp})$ \\
\scriptsize $\mathit{k}$    & \scriptsize Consumed commodities \\
\scriptsize $\mathit{nrg(k)}$ & \scriptsize The energy bundle in consumed commodities \\
\scriptsize $\mathit{fd}$   & \scriptsize Final demand (subset of $\mathit{aa}$) \\
\scriptsize $\mathit{fdc}$  & \scriptsize Final demand excluding households (subset of $\mathit{fd}$) \\
\scriptsize $\mathit{h}$    & \scriptsize Households (subset of $\mathit{fd}$) \\
\scriptsize $\mathit{gov}$  & \scriptsize Government account (subset of $\mathit{fd}$) \\
\scriptsize $\mathit{inv}$  & \scriptsize Investment account (subset of $\mathit{fd}$) \\
\scriptsize $\mathit{gy}$   & \scriptsize Government revenue accounts \\
\scriptsize $\mathit{itax}$ & \scriptsize Indirect taxes (subset of $\mathit{gy}$) \\
\scriptsize $\mathit{ptax}$ & \scriptsize Production tax account (subset of $\mathit{gy}$) \\
\scriptsize $\mathit{mtax}$ & \scriptsize Import tariff account (subset of $\mathit{gy}$) \\
\scriptsize $\mathit{etax}$ & \scriptsize Export tax account (subset of $\mathit{gy}$) \\
\scriptsize $\mathit{vtax}$ & \scriptsize Tax on factors of production account (subset of $\mathit{gy}$) \\
\scriptsize $\mathit{ptax}$ & \scriptsize Production tax account (subset of $\mathit{gy}$) \\
\scriptsize $\mathit{ctax}$ & \scriptsize Carbon tax (subset of $\mathit{gy}$) \\
\scriptsize $\mathit{dtax}$ & \scriptsize Direct taxes (subset of $\mathit{gy}$) \\
\scriptsize $\mathit{r}$    &  \scriptsize Regions \\
\scriptsize $\mathit{s,d}$  & \scriptsize Aliases with $r$ (for \emph{source} and \emph{destination} regions) \\
\scriptsize $\mathit{rnum}$ & \scriptsize Set of regions used in definition of num{\'e}raire (subset of $r$) \\
\scriptsize $\mathit{rres}$ & \scriptsize Residual region (subset of $r$, must be of single dimension) \\
\scriptsize $\mathit{em}$   & \scriptsize Emission types \\
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
\end{tabular}
\end{center}
\end{table}

\section{Production block}
\renewcommand{\theequation}{{P-}\arabic{equation}}
\setcounter{equation}{0}

Production is implemented using a nested CES structure---rather standard in many
applied general equilibrium models.\footnote{The main alternative is to
implement some form of a single-level flexible functional form such as the
translog (see for example \cite{Jorgensonetal2013}).} Three production structure
prototypes are introduced---crops, livestock and all other (the default
production structure). Figures~{\ref{fig:CRPNest}}, {\ref{fig:LVSNest}} and
{\ref{fig:ProdNest}} depict the production structures for each of the three
prototypes. These figures are supplemented by the nesting for the so-called
$\mathit{KEF}$ and energy bundles in respectively figures~{\ref{fig:KEFNest}}
and~{\ref{fig:NRGNest}}. This section will provide a full description of all the
nests starting from the top nest. At the end of each of the terminal nodes will
be the derived demand for the basic components (i.e. inputs) of
production---intermediate goods and factors of production.

Each nest is re-produced for each of the possible vintages. In the comparative
static version of the model there is usually only a single vintage. The default
in the dynamic version of the model is to have two vintages---so-called
$\mathit{Old}$ vintage (or installed capital), and $\mathit{New}$ that
represents the most recent supply of capital. The former is meant to be only
partially mobile across sectors, whereas the latter is fully mobile---detailed
further below.

Production for each vintage is thus associated with a unit (or marginal) cost of
production, represented by $\mathit{uc}$. The post tax unit cost of production,
$\mathit{PXv}$, is equal to the tax-adjusted pre-tax unit cost of production,
equation~(\ref{eq:pxv}), where $\tau^{\mathit{uc}}$ is the tax on the cost of
production. The aggregate unit cost of production across vintages,
$\mathit{PX}$, is given in equation~(\ref{eq:px}) and is the weighted sum of the
vintage-specific costs of production, with weights given by the production
volume shares where $\mathit{XPv}$ and $XP$ represent respectively output by
vintage and aggregate output.\footnote{An earlier version of the model had an
output price that was equal to the unit cost of production plus a (fixed) markup
and adjusted by a production tax. The output tax has been moved to the supply
side, see below, and is now both activity- and commodity specific. The markup
has been eliminated for the moment.}

\begin{equation}
\label{eq:px}
\mathit{PX}_{r,a} \mathit{XP}_{r,a} =
   \sum_v {
      \mathit{PXv}_{r,a,v} \mathit{XPv}_{r,a,v}
   }
\end{equation}

\begin{equation}
\label{eq:pxv}
\mathit{PXv}_{r,a,v} =
   \mathit{UC}_{r,a,v} \left( 1+\tau^{\mathit{uc}}_{r,a,v} \right)
\end{equation}

The remainder of this section describes the various CES nests that represent the
production structure by vintage. The purpose of these CES nests is to replicate
the substitution and complementarity relations across all of the inputs. The top
level CES nest represents the combination of output, $\mathit{XPX}$, with a
bundle of non-CO$_2$ greenhouse gas (GHG) emissions, $\mathit{XGHG}$. The latter
is a special bundle that is used to simulate the marginal cost of abating
non-CO$_2$ greenhouse gases. As the price of this bundle increases (e.g. from a
tax on emissions), producers substitute away from this relatively more costly
input.\footnote{The reference GTAP Data Base does not have any
revenues related to process emissions---and thus calibration of the
share parameters is a challenge in the absence of prices. One
way of resolving this is to modify the database, for example with
the use of Altertax, to introduce a small price on GHG
emissions associated with the GHG bundle. This is explained
in section \ref{sec:pcarb0} of the User Guide.}

Equations~(\ref{eq:xpx}) and~(\ref{eq:xghg}) represent the derived demands for
the output and GHG bundles respectively. These are the standard CES demand
functions where $\mathit{PXP}$ and $\mathit{PXGHG}$ represent the price of the
component bundles and $\mathit{UC}$ is the price of the composite (or aggregate
bundle). In this case, $\mathit{UC}$, is the unit cost of production, including
the price associated with the GHG emissions. The parameters
$\alpha^{\mathit{xp}}$ and $\alpha^{\mathit{ghg}}$ represent the standard
CES share parameters, $A^{\mathit{xpv}}$ is a tech-neutral shift in the
production nest and $\sigma^{\mathit{xp}}$ is the elasticity of substitution
between production and the emissions of GHGs. The production nest also allows
for input specific technological change as represented by the parameters
$\lambda^{\mathit{xp}}$ and $\lambda^{\mathit{ghg}}$. These are typically
exogenous. Equation~(\ref{eq:uc}) defines the component price of the CES bundle,
$\mathit{UC}$. The expression uses the CES dual price formula and could be
replaced by the zero-profit condition.\footnote{The zero profit condition
(without indices) is $\mathit{UC}.\mathit{XPv}=\mathit{PXP.XPX} +
\mathit{PXGHG}.\mathit{XGHG}$.}

\begin{equation}
\label{eq:xpx}
\mathit{XPX}_{r,a,v} =
   \alpha^{\mathit{xp}}_{\mathit{r,a,v}}
   \left( A^{\mathit{xpv}}_{\mathit{r,a,v}}
         \lambda^{\mathit{xp}}_{\mathit{r,a,v}}
   \right)^{\sigma^{\mathit{xp}}_{\mathit{r,a,v}}-1}
   \left( \frac {\mathit{UC}_{r,a,v}} {\mathit{PXP}_{r,a,v} }
   \right)^{\sigma^{\mathit{xp}}_{\mathit{r,a,v}}}
   \mathit{XPv}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:xghg}
\mathit{XGHG}_{r,a,v} =
   \alpha^{\mathit{ghg}}_{\mathit{r,a,v}}
   \left( A^{\mathit{xpv}}_{\mathit{r,a,v}}
      \lambda^{\mathit{ghg}}_{\mathit{r,a,v}}
   \right)^{\sigma^{\mathit{xp}}_{\mathit{r,a,v}}-1}
   \left( \frac{\mathit{UC}_{r,a,v}} {\mathit{PXGHG}_{r,a,v} }
   \right)^{\sigma^{\mathit{xp}}_{\mathit{r,a,v}}}
   \mathit{XPv}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:uc}
\mathit{UC}_{r,a,v} =
   \frac {1} {A^{\mathit{xpv}}_{\mathit{r,a,v}}}
   \left[
      \alpha^{\mathit{xp}}_{\mathit{r,a,v}}
      \left( \frac {\mathit{PXP}_{r,a,v}}
         {\lambda^{\mathit{xp}}_{\mathit{r,a,v}}}
      \right)^{1 - \sigma^{\mathit{xp}}_{\mathit{r,a,v}}}
   +  \alpha^{\mathit{ghg}}_{\mathit{r,a,v}}
      \left( \frac {\mathit{PXGHG}_{r,a,v}}
         {\lambda^{\mathit{ghg}}_{\mathit{r,a,v}}}
      \right)^{1 - \sigma^{\mathit{xp}}_{\mathit{r,a,v}}}
   \right]^{\frac {1} {1 - \sigma^{\mathit{xp}}_{\mathit{r,a,v}}}}
\end{equation}

The second level nest decomposes aggregate production net of the GHG bundle into
two bundles, $\mathit{ND^1}$ and $\mathit{VA}$. The first bundle includes all
intermediate goods with the exception of energy goods and other intermediate
goods that are treated specially in a given activity. In the default
configuration of the model, activity-specific intermediate goods include
fertilizers for crop activities and feed for livestock
activities.\footnote{The standard GTAP database does not include fertilizers.
These are associated with the 'chm' good, i.e. or the chemical sector.
The standard feed goods are wheat, coarse grains, oil seeds, and other
processed foods respectively
'wht', 'gro', 'osd' and 'ofd' in the GTAP database.} The $\mathit{VA}$ contains all
factors of production, the energy goods and activity-specific goods where
applicable. Equation~(\ref{eq:nd1}) determines the demand for the top level
intermediate demand bundle, $\mathit{ND^1}$. Equation~(\ref{eq:va}) determines
the demand for the $\mathit{VA}$ bundle. The bundle prices are respectively
$\mathit{PND}^1$ and $\mathit{PVA}$ and the substitution elasticity is given by
$\sigma^{\mathit{p}}$. It is worth noting that the equation for $\mathit{ND}^1$
is summed over all vintages. This is because the further decomposition of the
$\mathit{ND}^1$ bundle is assumed to be independent of the vintage, whereas the
decomposition of the $\mathit{VA}$ is vintage specific as the substitution
elasticities further down the nest are allowed to vary by vintage.
Equation~(\ref{eq:pxp}) determines the price of $\mathit{XPX}$, $\mathit{PXP}$.

[17-MAR-2020] The total factor productivity $\mathit{TFP}$ parameter was added.

\begin{equation}
\label{eq:nd1}
\mathit{ND}^1_{r,a} =
   \sum_v{
      \alpha^{\mathit{nd1}}_{\mathit{r,a,v}}
      \left( \mathit{TFP}_{\mathit{r,a,v}}
%        \lambda^{\mathit{nd1}}_{\mathit{r,a,v}}
      \right)^{\sigma^{\mathit{p}}_{\mathit{r,a,v}}-1}
      \left( \frac {\mathit{PXP}_{r,a,v}} {\mathit{PND}^1_{r,a}}
      \right)^{\sigma^{\mathit{p}}_{\mathit{r,a,v}}}
      \mathit{XPX}_{r,a,v}
   }
\end{equation}

\begin{equation}
\label{eq:va}
\mathit{VA}_{r,a,v} =
   \alpha^{\mathit{va}}_{\mathit{r,a,v}}
   \left( \mathit{TFP}_{\mathit{r,a,v}}
%     \lambda^{\mathit{ghg}}_{\mathit{r,a,v}}
   \right)^{\sigma^{\mathit{xp}}_{\mathit{r,a,v}}-1}
   \left( \frac{\mathit{PXP}_{r,a,v}} {\mathit{PVA}_{r,a,v}}
   \right)^{\sigma^{\mathit{p}}_{\mathit{r,a,v}}}
   \mathit{XPX}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:pxp}
\mathit{PXP}_{r,a,v} = \frac{1}{\mathit{TFP}_{\mathit{r,a,v}}}
   \left[
      \alpha^{\mathit{nd1}}_{\mathit{r,a,v}}
      \left( \mathit{PND}^1_{r,a}
      \right)^{1 - \sigma^{\mathit{p}}_{\mathit{r,a,v}}}
   +  \alpha^{\mathit{va}}_{\mathit{r,a,v}}
      \left( \mathit{PVA}_{r,a,v}
      \right)^{1 - \sigma^{\mathit{p}}_{\mathit{r,a,v}}}
   \right]^{\frac {1} {1 - \sigma^{\mathit{p}}_{\mathit{r,a,v}}}}
\end{equation}

[15-APR-2021] The GHG bundle is formed of all GHG process emissions, i.e.
emissions not linked to the combustion of fossil fuels. They are measured
in common units of \COT{}e. A CES specification is used to combine
the distinct GHG emissions into a single GHG bundle. This
is captured in equation~(\ref{eq:procEmi}) where $\mathit{prEmi}$
represents the process emission linked to GHG $\mathit{ghg}$, that
is linked to the price $\mathit{PprEmi}$. The elasticity of
substitution is given by $\sigma^{\mathit{prEmi}}$.
Equation~(\ref{eq:pxghg}) determines the price of the aggregate
GHG bundle. The price of process emissions is given by
$\mathit{PprEmi} = \mathit{PCarb} + \mathit{prEmiTax}$,
where $\mathit{PCarb}$ is an exogenous carbon price, typically
set to a small value in the reference year, and $\mathit{prEmiTax}$
is a price markup used for mitigating greenhouse gas emissions.
It could be exogenous, or endogenously determined subject to
one or more emission constraints.\footnote{$\mathit{PCarb}$ is
multiplied by the model num\'eraire to ensure price homogeneity.}

\begin{equation}
\label{eq:procEmi}
\mathit{prEmi}_{r,\mathit{ghg},a} = \sum_v{
   \alpha^{\mathit{prEmi}}_{r,\mathit{ghg},a,v}
   \left(\lambda^{\mathit{prEmi}}_{r,\mathit{ghg},a,v}
   \right)^{\sigma^{\mathit{prEmi}}_{\mathit{r,a,v}}-1}
   \left( \frac{\mathit{PXGHG}_{r,a,v}} {\mathit{PprEmi}_{r,\mathit{ghg},a}}
   \right)^{\sigma^{\mathit{prEmi}}_{\mathit{r,a,v}}}
   \mathit{XGHG}_{r,a,v}
}
\end{equation}

\begin{equation}
\label{eq:pxghg}
\mathit{PXGHG}_{r,a,v} =
   \left[\sum_{\mathit{ghg}}{
      \alpha^{\mathit{prEmi}}_{r,\mathit{ghg},a,v}
      \left( \mathit{PprEmi}_{r,\mathit{ghg},a}
      \right)^{1 - \sigma^{\mathit{prEmi}}_{\mathit{r,a,v}}}}
   \right]^{\frac {1} {1 - \sigma^{\mathit{\mathit{prEmi}}}_{\mathit{r,a,v}}}}
\end{equation}


The middle CES nests are activity specific and reflect the three production
structure prototypes described above---crops, livestock and all other
activities. The crop production structure is designed to capture production
characterized by the choice between intensification versus extensification,
i.e. where land is abundant and cheap, production will tend to expand using more
land, and vice versa if land is scarce and expensive. Livestock production is
characterized by feed versus land substitution. In the default production
structure, the main characteristic of production is the standard capital and
labor substitution.

\begin{figure}[H]
\center
\begin{forest}
for tree={
   minimum height=1cm,
   font=\scriptsize,
%  font=\sffamily,
   anchor=north,
   align=center,
   child anchor=north,
   s sep=1em,
   l sep=0.75cm
},
%where n children=0{tier=word}{}
[{Crop output\\by vintage ($\mathit{XPv}$)}, draw, drop shadow, fill=dkBlue, rounded corners=2pt, name=XPV
   [{Output by vintage\\excl. GHG ($\mathit{XPX}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XPX
      [{Intermediate demand bundle\\excl. $\mathit{FERT}$ and $\mathit{NRG}$ ($\mathit{ND1}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=ND1
         [][{Armington\\demand ($\mathit{XA_i}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
      ]
      [{Value added\\bundle ($\mathit{VA}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=VA
         [{Type 1 labor \\bundle ($\mathit{LAB1}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=LAB1
            [][{Type 1 labor\\demand ($\mathit{XF}_\mathit{l}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
         ]
         [{Value added bundle excl.\\Type 1 labor ($\mathit{VA1}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=VA1
            [{Value added bundle excl.\\$\mathit{LAB1}$ and $\mathit{FERT}$ ($\mathit{VA2}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=VA2
               [{Value added bundle incl. capital, \\ Type 2 labor and $\mathit{NRG}$ ($\mathit{KEF}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=KEF
                  [{See Figure {\ref{fig:KEFNest}}}, draw, ellipse,fill=lightgray]
               ]
               [{Land demand\\ bundle ($\mathit{Land}^d$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=LAND
               [][{Land demand by \\ type ($\mathit{XF}_{\mathit{lnd}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt)][]]
            ]
            [{$\mathit{FERT}$\\bundle ($\mathit{ND2}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=ND2
               [][{Armington\\demand ($\mathit{XA_i}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
            ]
         ]
      ]
   ]
   [{Process emissions \\ GHG bundle ($\mathit{XGHG}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XGHG
   	[][{$\mathit{ProcEmi}_{\mathit{ghg}}$}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
   ]
]
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]XPV.south) {\scriptsize $\sigma^\mathit{xp}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]XPX.south) {\scriptsize $\sigma^\mathit{p}$};
\node[anchor=west,align=left]
  at ([yshift=-0.45cm,xshift=-0.10cm]XGHG.south) {\scriptsize $\sigma^\mathit{prEmi}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]VA.south) {\scriptsize $\sigma^\mathit{v}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.1cm]ND1.south) {\scriptsize $\sigma^\mathit{n1}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.1cm]LAB1.south) {\scriptsize $\sigma^\mathit{l1}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]VA1.south) {\scriptsize $\sigma^\mathit{v1}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]VA2.south) {\scriptsize $\sigma^\mathit{v2}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.1cm]ND2.south) {\scriptsize $\sigma^\mathit{n2}$};
\end{forest}
\caption{{Crop production nest}}
\label{fig:CRPNest}
\end{figure}

These different structures will be captured by a set of intermediate bundles,
represented by $\mathit{VA}^1$ and $\mathit{VA}^2$ that represent different
composition of factors and activity-specific intermediate goods where
appropriate. The top of the nest is represented by the bundle $\mathit{VA^1}$.
The bottom of this set of nests are the bundles $\mathit{LAB^1}$,
$\mathit{XF}_{\mathit{lnd}}$, $\mathit{KEF}$ and $\mathit{ND^2}$, where
appropriate. The bundle $\mathit{LAB^1}$ represents the demand for the Type 1
labor bundle.\footnote{The user determines what labor types are considered
Type 1 labor. The user can decide to have all labor types in this bundle,
in which case the Type 2 labor bundle, $\mathit{LAB^2}$, will be empty.} The
variable $\mathit{XF}_{\mathit{lnd}}$ represents the activity's demand for the
land factor(s), and will be derived from the demand
for the land bundle, $\mathit{Land}^d$. The bundle $\mathit{KEF}$ represents the nested combination of
capital, Type 2 labor, energy and the natural resource factor, where
appropriate. The bundle $\mathit{ND^2}$ represents the activity-specific demand
for intermediates---fertilizers in the case of crops and feed in the case of
livestock activities. The decomposition of these three
bundles is the same for
all activities and described below. Table~\ref{tab:TabCESNests} summarily
describes the composition of these middle nests for the three production
prototypes.

Figures~\ref{fig:CRPNest}, \ref{fig:LVSNest} and~\ref{fig:ProdNest} provide an
illustrative description of the production nests.

\begin{table}[H]
\caption{Intermediate CES nests in production}
\label{tab:TabCESNests}
\begin{center}
\rowcolors{2}{TableOdd}{TableEven}
\rowcolors{1}{}{lightblue}
\begin{tabular} {c l}
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
\textbf{Activity} & \textbf{Bundle composition} \\
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
%\multicolumn{1}{l}
\scriptsize {\textbf {Crops}}  & {} \\
\scriptsize {$\mathit{VA}$}    & \scriptsize {$\mathit{CES}\left(\mathit{LAB}^1, \mathit{VA}^1 \right)$} \\
\scriptsize {$\mathit{VA}^1$}  & \scriptsize {$\mathit{CES}\left(\mathit{ND}^2, \mathit{VA}^2 \right)$} \\
\scriptsize {$\mathit{VA}^2$}  & \scriptsize {$\mathit{CES}\left(\mathit{Land}^d, \mathit{KEF} \right)$} \\
{} & {} \\
%\multicolumn{1}{l}
\scriptsize {\textbf {Livestock}} & {} \\
\scriptsize {$\mathit{VA}$}       & \scriptsize {$\mathit{CES}\left(\mathit{VA}^1, \mathit{VA}^2 \right)$} \\
\scriptsize {$\mathit{VA}^1$}     & \scriptsize {$\mathit{CES}\left(\mathit{LAB}^1, \mathit{KEF} \right)$} \\
\scriptsize {$\mathit{VA}^2$}     & \scriptsize {$\mathit{CES}\left(\mathit{Land}^d, \mathit{ND}^2 \right)$} \\
{} & {} \\
%\multicolumn{1}{l}
\scriptsize {\textbf {Default}} & {} \\
\scriptsize {$\mathit{VA}$}     & \scriptsize {$\mathit{CES}\left(\mathit{LAB}^1, \mathit{VA}^1 \right)$} \\
\scriptsize {$\mathit{VA}^1$}   & \scriptsize {$\mathit{CES}\left(\mathit{Land}^d, \mathit{KEF} \right)$} \\
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
\end{tabular}
\end{center}
\end{table}

The equations for the intermediate nests will be described according to the
demand for the individual component bundles, with the price equations described
subsequently. The first set of equations determines the bundles $\mathit{VA}^1$
and $\mathit{VA}^2$. The former is a share of $\mathit{VA}$ for all activities.
The latter is a share of $\mathit{VA}^1$ in the case of crops and of
$\mathit{VA}$  in the case of livestock. The default production structure does
not require the $\mathit{VA}^2$ bundle.

[17-MAR-2020] Added a total factor productivity factor, $\mathit{FTFP}$ to
the $\mathit{VA}$ bundle. Note that this will affect demand for any intermediate good in either the energy or $\mathit{ND2}$ bundle.

\begin{figure}[H]
\center
\begin{forest}
for tree={
   minimum height=1cm,
   font=\scriptsize,
%  font=\sffamily,
   anchor=north,
   align=center,
   child anchor=north,
   s sep=1em,
   l sep=0.75cm
},
%where n children=0{tier=word}{}
[{Livestock output\\by vintage ($\mathit{XPv}$)}, draw, drop shadow, fill=dkBlue, rounded corners=2pt, name=XPV
   [{Output by vintage\\excl. GHG ($\mathit{XPX}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XPX
      [{Intermediate demand bundle\\excl. $\mathit{FEED}$ and $\mathit{NRG}$ ($\mathit{ND1}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=ND1
         [][{Armington\\demand ($\mathit{XA_i}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
      ]
      [{Value added\\bundle ($\mathit{VA}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=VA
         [{Value added bundle incl.\\$\mathit{LAB1}$ and $\mathit{KEF}$ ($\mathit{VA1}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=VA1
            [{Type 1 labor\\bundle ($\mathit{LAB1}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=LAB1
            	[][{Type 1 labor\\demand ($\mathit{XF}_\mathit{l}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
            ]
            [{Value added bundle incl. capital, \\Type 2 labor and $\mathit{NRG}$ ($\mathit{KEF}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=KEF
               [{See Figure {\ref{fig:KEFNest}}}, draw, ellipse,fill=lightgray]
            ]
         ]
         [{Value added bundle incl.\\$\mathit{Land}$ and $\mathit{FEED}$ ($\mathit{VA2}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=VA2
            [{$\mathit{FEED}$\\bundle ($\mathit{ND2}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=ND2
               [][{Armington\\demand ($\mathit{XA_i}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
            ]
            [{Land demand\\ bundle ($\mathit{Land}^d$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=LAND
            [][{Land demand by \\ type ($\mathit{XF}_{\mathit{lnd}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt)][]]
         ]
      ]
   ]
   [{Process emissions \\ GHG bundle ($\mathit{XGHG}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XGHG
   	[][{$\mathit{ProcEmi}_{\mathit{ghg}}$}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
   ]
]
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]XPV.south) {\scriptsize $\sigma^\mathit{xp}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]XPX.south) {\scriptsize $\sigma^\mathit{p}$};
\node[anchor=west,align=left]
  at ([yshift=-0.45cm,xshift=-0.10cm]XGHG.south) {\scriptsize $\sigma^\mathit{prEmi}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]VA.south) {\scriptsize $\sigma^\mathit{v}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.1cm]ND1.south) {\scriptsize $\sigma^\mathit{n1}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.1cm]LAB1.south) {\scriptsize $\sigma^\mathit{l1}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]VA1.south) {\scriptsize $\sigma^\mathit{v1}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]VA2.south) {\scriptsize $\sigma^\mathit{v2}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.1cm]ND2.south) {\scriptsize $\sigma^\mathit{n2}$};
\end{forest}
\caption{{Livestock production nest}}
\label{fig:LVSNest}
\end{figure}

\begin{equation}
\label{eq:va1}
\mathit{VA}^1_{r,a,v} =
   \displaystyle \alpha^{\mathit{va1}}_{r,a,v}
   \left(\mathit{FTFP}_{r,a,v} \right)^{\sigma^{v}_{r,a,v}-1}
   \left( \frac {\mathit{PVA}_{r,a,v}} {\mathit{PVA}^1_{r,a,v}}
   \right)^{\sigma^{v}_{r,a,v}}
   \mathit{VA}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:va2}
\mathit{VA}^2_{r,a,v} =
\begin{cases}
   \displaystyle \alpha^{\mathit{va2}}_{r,a,v}
      \left( \frac{\mathit{PVA}^1_{r,a,v}} {\mathit{PVA}^2_{r,a,v}}
      \right)^{\sigma^{v1}_{r,a,v}}
      \mathit{VA}^1_{r,a,v}
   & \textrm{if } a \in \left\{ \mathit{Crops} \right\} \\
   \displaystyle \alpha^{\mathit{va2}}_{r,a,v}
      \left(\mathit{FTFP}_{r,a,v} \right)^{\sigma^{v}_{r,a,v}-1}
      \left( \frac{\mathit{PVA}_{r,a,v}} {\mathit{PVA}^2_{r,a,v}}
      \right)^{\sigma^{v}_{r,a,v}}
      \mathit{VA}_{r,a,v}
   & \textrm{if } a \in \left\{ \mathit{Livestock} \right\} \\
\end{cases}
\end{equation}

The next set of equations determine the bundles $\mathit{LAB}^1$, $\mathit{KEF}$
and $\mathit{ND}^2$. The subsequent decomposition of these three bundles will be
identical for all activities. The $\mathit{LAB}^1$ bundle is a share of
$\mathit{VA}^1$ for $\mathit{Livestock}$ and $\mathit{VA}$ for all other
activities. The $\mathit{KEF}$ bundle is a share of $\mathit{VA}^2$ for
$\mathit{Crops}$ and $\mathit{VA}^1$ for all other activities. The
$\mathit{ND}^2$ bundle is a share of $\mathit{VA}^1$ for $\mathit{Crops}$ and
$\mathit{VA}^2$ for $\mathit{Livestock}$. The $\mathit{ND}^2$ bundle is not used
in the $\mathit{Default}$ production structure.

\begin{equation}
\label{eq:lab1}
\mathit{LAB}^1_{r,a} =
\begin{cases}
   \displaystyle \sum_v{
         \alpha^{\mathit{l1}}_{r,a,v}
         \left(\mathit{FTFP}_{r,a,v} \right)^{\sigma^{v}_{r,a,v}-1}
         \left( \frac{\mathit{PVA}_{r,a,v}} {\mathit{PLAB}^1_{r,a}}
         \right)^{\sigma^{v}_{r,a,v}}
         \mathit{VA}_{r,a,v}
      }
   & \textrm{if } a \in \left\{ \mathit{Default} \right\} \\
   \displaystyle \sum_v{
         \alpha^{\mathit{l1}}_{r,a,v}
         \left( \frac{\mathit{PVA}^1_{r,a,v}} {\mathit{PLAB}^1_{r,a}}
         \right)^{\sigma^{v1}_{r,a,v}}
         \mathit{VA}^1_{r,a,v}
      }
   & \textrm{if } a \in \left\{ \mathit{Livestock} \right\} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:kef}
\mathit{KEF}_{r,a,v} =
\begin{cases}
   \displaystyle
      \alpha^{\mathit{kef}}_{r,a,v}
      \left( \frac{\mathit{PVA}^2_{r,a,v}} {\mathit{PKEF}_{r,a,v}}
      \right)^{\sigma^{v2}_{r,a,v}}
      \mathit{VA}^2_{r,a,v}
   & \textrm{if } a \in \left\{ \mathit{Crops} \right\} \\
   \displaystyle
      \alpha^{\mathit{kef}}_{r,a,v}
      \left( \frac{\mathit{PVA}^1_{r,a,v}} {\mathit{PKEF}_{r,a,v}}
      \right)^{\sigma^{v1}_{r,a,v}}
      \mathit{VA}^1_{r,a,v}
   & \textrm{if } a \in \left\{ \mathit{Default} \right\} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:nd2}
\mathit{ND}^2_{r,a} =
\begin{cases}
   \displaystyle \sum_v{
         \alpha^{\mathit{nd2}}_{r,a,v}
         \left( \frac {\mathit{PVA}^1_{r,a,v}} {\mathit{PND}^2_{r,a}}
         \right)^{\sigma^{v1}_{r,a,v}}
         \mathit{VA}^1_{r,a,v}
      }
   & \textrm{if } a \in \left\{ \mathit{Crops} \right\} \\
   \displaystyle \sum_v{
         \alpha^{\mathit{nd2}}_{r,a,v}
         \left( \frac {\mathit{PVA}^2_{r,a,v}} {\mathit{PND}^2_{r,a}}
         \right)^{\sigma^{v2}_{r,a,v}}
         \mathit{VA}^2_{r,a,v}
      }
   & \textrm{if } a \in \left\{ \mathit{Livestock} \right\} \\
\end{cases}
\end{equation}

[Modified 20-APR-2022]
The final demand equation in this set of intermediate nests determines the
demand for the land bundle, $\mathit{Land}^{d}$.\footnote{The code was modified
to allow for multiple land types, for example agro-ecological zones (AEZ). An
additional CES nest is specified. The former nest assumed
a single land-type (per activity). The new nest, has a top-level
land bundle, $\mathit{Land}^{d}$, which is further disaggregated across land-types (see
for example \cite{HerteletalChap62009}).} It is a share of
$\mathit{VA}^2$ for $\mathit{Crops}$ and $\mathit{Livestock}$ and a share of
$\mathit{VA}^1$ for the $\mathit{Default}$ activities.

\begin{equation}
\label{eq:landd}
\mathit{Land}^d_{r,a} =
\begin{cases}
   \displaystyle \sum_v {
         \alpha^{\mathit{land}}_{r,a,v}
         \left( \frac {\mathit{PVA}^2_{r,a,v}}
            {\mathit{PLand}^d_{r,a}}
         \right)^{\sigma^{v2}_{r,a,v}}
          {\mathit{VA}^2_{r,a,v}}}
   & \textrm{if } a \in \left\{ \mathit{Crops} \right\} \\
   \displaystyle \sum_v {
         \alpha^{\mathit{land}}_{r,a,v}
         \left( \frac {\mathit{PVA}^2_{r,a,v}}
            {\mathit{PLand}^d_{r,a}} \right)^{\sigma^{v2}_{r,a,v}}
          {\mathit{VA}^2_{r,a,v}}}
   & \textrm{if } a \in \left\{ \mathit{Livestock} \right\} \\
   \displaystyle \sum_v {
         \alpha^{\mathit{land}}_{r,a,v}
         \left( \frac {\mathit{PVA}^1_{r,a,v}}
            {\mathit{PLand}^d_{r,a}}
         \right)^{\sigma^{v1}_{r,a,v}}
         {\mathit{VA}^1_{r,a,v}}}
   & \textrm{if } a \in \left\{ \mathit{Default} \right\} \\
\end{cases}
\end{equation}

The aggregate land bundle for activity $a$ is disaggregated into demand for
land by type, $\mathit{XF}_{\mathit{r,lnd,a}}$.
The relevant price of land is $\mathit{PF}^p_{\mathit{r,lnd,a}}$ that represents the
user (or agent) price of land. It is equal to the market price of land adjusted
for an activity-specific tax or subsidy. The specification
allows for either the standard CES, or the additive version (ACES).
Equation~(\ref{eq:plandc}) determines the composite price of the land bundle.
The average price of the land bundle is determined by the
explicit specification of the zero-profit condition, equation~(\ref{eq:plandd}).

\begin{equation}
\label{eq:lnd}
\mathit{XF}_{r,\mathit{lnd},a} =
\begin{cases}
   \displaystyle {
         \alpha^{\mathit{lnd}}_{r,\mathit{lnd},a}
         \left( \frac {\lambda^f_{r,\mathit{lnd},a} \mathit{PLand}^c_{r,a}}
            {\mathit{PF}^p_{r,\mathit{lnd},a}}
         \right)^{\sigma^{\mathit{lnd}}_{r,a}}
         \frac {\mathit{Land}^d_{r,a}} {\lambda^f_{r,\mathit{lnd},a}}
      }
   & \textnormal{if } \mathit{ifLandCET} \\
   \displaystyle {
         \alpha^{\mathit{lnd}}_{r,\mathit{lnd},a}
         \left( \frac {\mathit{PLand}^c_{r,a}}
            {\lambda^f_{r,\mathit{lnd},a} \mathit{PF}^p_{r,\mathit{lnd},a}} \right)^{\sigma^{\mathit{lnd}}_{r,a}}
         {\mathit{Land}^d_{r,a}}
      }
   & \textnormal{if } \neg \mathit{ifLandCET} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:plandc}
\mathit{PLand}^c_{r,a} =
\begin{cases}
   \displaystyle {
   		\left[ \sum_{\mathit{lnd}}{\alpha^{\mathit{lnd}}_{r,\mathit{lnd},a}
   		\left( \frac{\mathit{PF}^p_{r,\mathit{lnd},a}}{\lambda^f_{r,\mathit{lnd},a}}
   		\right)^{1-\sigma^{\mathit{lnd}}_{r,a}}}\right]^{1/(1-\sigma^{\mathit{lnd}}_{r,a})}
      }
   & \textnormal{if } \mathit{ifLandCET} \\
   \displaystyle {
   		\left[ \sum_{\mathit{lnd}}{\alpha^{\mathit{lnd}}_{r,\mathit{lnd},a}
   		\left( {\mathit{PF}^p_{r,\mathit{lnd},a}}{\lambda^f_{r,\mathit{lnd},a}}
   		\right)^{-\sigma^{\mathit{lnd}}_{r,a}}}\right]^{-1/\sigma^{\mathit{lnd}}_{r,a}}
      }
   & \textnormal{if } \neg \mathit{ifLandCET} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:plandd}
\displaystyle
\mathit{PLand}^d_{r,a} = \left[\sum_{\mathit{lnd}}{\mathit{PF}^p_{r,\mathit{lnd},a} \mathit{PF}_{r,\mathit{lnd},a}}\right] / {\mathit{Land}^d_{r,a}}
\end{equation}

The description of the intermediate nests is finished with the determination of
the prices of the intermediate bundles $\mathit{VA}$, $\mathit{VA}^1$ and
$\mathit{VA}^2$. Equation~(\ref{eq:pva}) determines the price of the
$\mathit{VA}$ bundle, $\mathit{PVA}$. Equation~(\ref{eq:pva1}) determines the
price of the $\mathit{VA}^1$ bundle, $\mathit{PVA}^1$. Equation~(\ref{eq:pva1})
determines the price of the $\mathit{VA}^2$ bundle, $\mathit{PVA}^2$.

\begin{equation}
\label{eq:pva}
\mathit{PVA}_{r,a,v} =
\begin{cases}
   \displaystyle \frac{1}{\mathit{FTFP_{r,a,v}}} \biggl[ \alpha^{\mathit{l1}}_{\mathit{r,a,v}}
      \left( \mathit{PLAB}^1_{\mathit{r,a}}
      \right)^{1 - \sigma^{\mathit{v}}_{\mathit{r,a,v}}} \\
      \qquad + \; \alpha^{\mathit{va1}}_{\mathit{r,a,v}}
      \left( \mathit{PVA}^1_{\mathit{r,a,v}}
      \right)^{1 - \sigma^{\mathit{v}}_{\mathit{r,a,v}}}
   \biggr]^{\frac{1}{1 - \sigma^{\mathit{v}}_{\mathit{r,a,v}}}}
   & \textrm{if } a \in \left\{ \mathit{Default} \right\} \\
   \displaystyle \frac{1}{\mathit{FTFP_{r,a,v}}} \biggl[ \alpha^{\mathit{va1}}_{\mathit{r,a,v}}
      \left( \mathit{PVA}^1_{\mathit{r,a,v}}
      \right)^{1 - \sigma^{\mathit{v}}_{\mathit{r,a,v}}} \\
      \qquad + \; \alpha^{\mathit{va2}}_{\mathit{r,a,v}}
      \left( \mathit{PVA}^2_{\mathit{r,a,v}}
      \right)^{1 - \sigma^{\mathit{v}}_{\mathit{r,a,v}}}
   \biggr]^{\frac{1}{1 - \sigma^{\mathit{v}}_{\mathit{r,a,v}}}}
   & \textrm{if } \; a \in \left\{ \mathit{Livestock} \right\} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pva1}
\mathit{PVA}^1_{r,a,v} =
   \begin{cases}
      \biggl[ \alpha^{\mathit{nd2}}_{\mathit{r,a,v}}
         \left( \mathit{PND}^2_{\mathit{r,a}}
         \right)^{1 - \sigma^{\mathit{v1}}_{\mathit{r,a,v}}} \\
         \qquad + \; \alpha^{\mathit{va2}}_{\mathit{r,a,v}}
         \left( \mathit{PVA}^2_{\mathit{r,a,v}}
         \right)^{1 - \sigma^{\mathit{v1}}_{\mathit{r,a,v}}}
      \biggr]^{\frac{1}{1 - \sigma^{\mathit{v1}}_{\mathit{r,a,v}}}}
      & \textrm{if } a \in \left\{ \mathit{Crops} \right\} \\
      \biggl[ \alpha^{\mathit{l1}}_{\mathit{r,a,v}}
         \left( \mathit{PLAB}^1_{\mathit{r,a}}
         \right)^{1 - \sigma^{\mathit{v1}}_{\mathit{r,a,v}}} \\
         \qquad + \; \alpha^{\mathit{kef}}_{\mathit{r,a,v}}
         \left( \mathit{PKEF}_{\mathit{r,a,v}}
         \right)^{1 - \sigma^{\mathit{v1}}_{\mathit{r,a,v}}}
      \biggr]^{\frac{1}{1 - \sigma^{\mathit{v1}}_{\mathit{r,a,v}}}}
      & \textrm{if } a \in \left\{ \mathit{Livestock} \right\} \\
      \biggl[ \alpha^{\mathit{land}}_{\mathit{r,a,v}}
         \left( {\mathit{PLand}^d_{r,a}}
         \right)^{1 - \sigma^{\mathit{v1}}_{\mathit{r,a,v}}} \\
         \qquad + \; \alpha^{\mathit{kef}}_{\mathit{r,a,v}}
         \left( \mathit{PKEF}_{\mathit{r,a,v}}
         \right)^{1 - \sigma^{\mathit{v1}}_{\mathit{r,a,v}}}
      \biggr]^{\frac{1}{1 - \sigma^{\mathit{v1}}_{\mathit{r,a,v}}}}
      & \textrm{if } a \in \left\{ \mathit{Default} \right\} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pva2}
\mathit{PVA^2_{r,a,v}} =
   \begin{cases}
      \biggl[ \alpha^{\mathit{land}}_{\mathit{r,a,v}}
      \left( {\mathit{PLand}^d_{r,a}}
      \right)^{1 - \sigma^{\mathit{v2}}_{\mathit{r,a,v}}} \\
      \qquad + \; \alpha^{\mathit{kef}}_{\mathit{r,a,v}}
      \left( \mathit{PKEF}_{\mathit{r,a,v}}
      \right)^{1 - \sigma^{\mathit{v2}}_{\mathit{r,a,v}}}
   \biggr]^{\frac{1}{1 - \sigma^{\mathit{v2}}_{\mathit{r,a,v}}}}
   & \textrm{if } a \in \left\{ \mathit{Crops} \right\} \\
   \biggl[ \alpha^{\mathit{land}}_{\mathit{r,a,v}}
      \left({\mathit{PLand}^d_{r,a}}
      \right)^{1 - \sigma^{\mathit{v2}}_{\mathit{r,a,v}}} \\
   \qquad + \; \alpha^{\mathit{nd2}}_{\mathit{r,a,v}}
   \left( \mathit{PND}^2_{\mathit{r,a}}
   \right)^{1 - \sigma^{\mathit{v2}}_{\mathit{r,a,v}}}
   \biggr]^{\frac{1}{1 - \sigma^{\mathit{v2}}_{\mathit{r,a,v}}}}
   & \textrm{if } a \in \left\{ \mathit{Livestock} \right\} \\
\end{cases}
\end{equation}

\begin{figure}[H]
\center
\begin{forest}
for tree={
  minimum height=1cm,
  font=\scriptsize,
%  font=\sffamily,
  anchor=north,
  align=center,
  child anchor=north,
  s sep=1em,
  l sep=0.75cm
},
%where n children=0{tier=word}{}
[{Output\\by vintage ($\mathit{XPv}$)}, draw, drop shadow, fill=dkBlue, rounded corners=2pt, name=XPV
   [{Output by vintage\\excl. GHG ($\mathit{XPX}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XPX
      [{Intermediate demand\\bundle excl. $\mathit{NRG}$ ($\mathit{ND1}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=ND1
         [][{Armington\\demand ($\mathit{XA_i}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
      ]
      [{Value added\\bundle ($\mathit{VA}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=VA
         [{Type 1 labor\\bundle ($\mathit{LAB1}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=LAB1
            [][{Type 1 labor\\demand ($\mathit{XF}_{\mathit{l}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
         ]
         [{Value added bundle excl.\\Type 1 labor ($\mathit{VA1}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=VA1
            [{Value added bundle incl. capital, \\Type 2 labor and $\mathit{NRG}$ ($\mathit{KEF}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=KEF
               [{See Figure {\ref{fig:KEFNest}}}, draw, ellipse,fill=lightgray]
            ]
            [{Land demand\\ bundle ($\mathit{Land}^d$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=LAND
            [][{Land demand by \\ type ($\mathit{XF}_{\mathit{lnd}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt)][]]
         ]
      ]
   ]
   [{Process emissions \\ GHG bundle ($\mathit{XGHG}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XGHG
   	[][{$\mathit{ProcEmi}_{\mathit{ghg}}$}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
   ]
]
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]XPV.south) {\scriptsize $\sigma^\mathit{xp}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]XPX.south) {\scriptsize $\sigma^\mathit{p}$};
\node[anchor=west,align=left]
  at ([yshift=-0.45cm,xshift=-0.10cm]XGHG.south) {\scriptsize $\sigma^\mathit{prEmi}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]VA.south) {\scriptsize $\sigma^\mathit{v}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.1cm]ND1.south) {\scriptsize $\sigma^\mathit{n1}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.1cm]LAB1.south) {\scriptsize $\sigma^\mathit{l1}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]VA1.south) {\scriptsize $\sigma^\mathit{v1}$};
\end{forest}
\caption{{Default production nest}}
\label{fig:ProdNest}
\end{figure}

The subsequent production nests are identical for all three production
prototypes. The $\mathit{KEF}$ bundle is composed of the $\mathit{KF}$ bundle, a
composition of capital, Type 2 labor, water and natural resources, and the
energy bundle, $\mathit{XNRG}$. Equations~(\ref{eq:kf}) and~(\ref{eq:xnrg})
represent the derived demands for the $\mathit{KF}$ and $\mathit{XNRG}$ bundles
respectively, with the bundle prices represented by $\mathit{PKF}$ and
$\mathit{PNRG}$. The main substitution elasticity is $\sigma^{\mathit{kef}}$.
The parameter $\lambda^{p,\mathit{nrg}}$ represents energy efficiency, normalized
to 1 in the reference year. It is applied uniformly across all energy carriers
but is activity and vintage specific.
Equation~(\ref{eq:pkef}) represents the CES dual price expression for the
price of the $\mathit{KEF}$ bundle, $\mathit{PKEF}$.

\begin{figure}[H]
\center
\begin{forest}
for tree={
  minimum height=1cm,
  font=\scriptsize,
%  font=\sffamily,
  anchor=north,
  align=center,
  child anchor=north,
  s sep=1em,
  l sep=0.75cm
},
%where n children=0{tier=word}{}
[{Capital, Type 2 labor, water \\ and $\mathit{NRG}$ bundle ($\mathit{KEF}$)}, draw, drop shadow, fill=dkBlue, rounded corners=2pt, name=KEF
   [{Demand for\\energy bundle ($\mathit{XNRG}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XNRG
      [{See Figure {\ref{fig:NRGNest}}}, draw, ellipse,fill=lightgray]
   ]
   [{Capital, Type 2 labor, \\ water and $\mathit{NRS}$ bundle ($\mathit{KF}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=KF
      [{Capital, Type 2 labor \\ and water bundle ($\mathit{KSW}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=KSW
         [{Capital and \\ Type 2 labor bundle  ($\mathit{KS}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=KS
            [{Type 2 labor\\bundle ($\mathit{LAB2}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=LAB2
               [][{Type 2 labor\\demand ($\mathit{XF}_{\mathit{l}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
            ]
            [{Capital demand\\by vintage ($\mathit{Kv}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt, name=Kv]
         ]
         [{Water bundle  \\ ($\mathit{XWAT}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XWAT
            [][{Armington\\demand ($\mathit{XA_i}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
            [{Water factor\\demand ($\mathit{XF}_{\mathit{wat}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt]
         ]
      ]
      [{Demand for\\natural resource ($\mathit{XF}_{\mathit{nrs}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt, name=XNRS]
   ]
]
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]KEF.south) {\scriptsize $\sigma^\mathit{kef}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]KF.south) {\scriptsize $\sigma^\mathit{kf}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]KSW.south) {\scriptsize $\sigma^\mathit{kw}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]KS.south) {\scriptsize $\sigma^\mathit{k}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.1cm]LAB2.south) {\scriptsize $\sigma^\mathit{l2}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.4cm]XWAT.south) {\scriptsize $\sigma^\mathit{wat}$};
\end{forest}
\caption{{KEF bundle nest}}
\label{fig:KEFNest}
\end{figure}

\begin{equation}
\label{eq:kf}
\mathit{KF}_{r,a,v} =
   \alpha^{\mathit{kf}}_{\mathit{r,a,v}}
   \left( \frac {\mathit{PKEF}_{r,a,v}} {\mathit{PKF}_{r,a,v}}
   \right)^{\sigma^{\mathit{kef}}_{\mathit{r,a,v}}}
   \mathit{KEF}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:xnrg}
\mathit{XNRG}_{r,a,v} =
   \alpha^{\mathit{e}}_{\mathit{r,a,v}}
   \left({\lambda^{p,\mathit{nrg}}_{r,a,v}}\right)^{\sigma^{\mathit{kef}} - 1}
   \left( \frac {\mathit{PKEF}_{r,a,v}} {\mathit{PNRG}_{r,a,v}}
   \right)^{\sigma^{\mathit{kef}}_{\mathit{r,a,v}}}
   \mathit{KEF}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:pkef}
\mathit{PKEF}_{r,a,v} =
   \left[
      \alpha^{\mathit{kf}}_{\mathit{r,a,v}}
      \left( \mathit{PKF}_{r,a,v}
      \right)^{1 - \sigma^{\mathit{kef}}_{\mathit{r,a,v}}}
   +  \alpha^{\mathit{e}}_{\mathit{r,a,v}}
      \left( \frac{\mathit{PNRG}_{r,a,v}}{\lambda^{p,\mathit{nrg}}_{r,a,v}}
      \right)^{1 - \sigma^{\mathit{kef}}_{\mathit{r,a,v}}}
   \right]^{\frac{1} {1 - \sigma^{\mathit{kef}}_{\mathit{r,a,v}}}}
\end{equation}

The $\mathit{KF}$ bundle is composed of the $\mathit{KSW}$ bundle, a composition
of capital, Type 2 labor and water and the sector-specific natural resource,
$\mathit{XF}_{\mathit{nrs}}$. Equations~(\ref{eq:ksw}) and~(\ref{eq:xnrs})
represent the derived demands for the $\mathit{KSW}$ bundle and the
sector-specific natural resource, $\mathit{XF}_{\mathit{nrs}}$ (when present),
respectively, with the respective prices represented by $\mathit{PKSW}$ and
$\mathit{PF}^p_{\mathit{nrs}}$. The main substitution elasticity is
$\sigma^{\mathit{kf}}$. The natural resource factor has an efficiency factor,
$\lambda^f_{\mathit{nrs}}$, that is typically exogenous. Equation~(\ref{eq:pkf})
represents the CES dual price expression for the price of the $\mathit{KF}$
bundle, $\mathit{PKF}$.

\begin{equation}
\label{eq:ksw}
\mathit{KSW}_{r,a,v} =
   \alpha^{\mathit{ksw}}_{\mathit{r,a,v}}
   \left( \frac {\mathit{PKF}_{r,a,v}} {\mathit{PKSW}_{r,a,v}}
   \right)^{\sigma^{\mathit{kf}}_{\mathit{r,a,v}}}
   \mathit{KF}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:xnrs}
\mathit{XF}_{\mathit{r,nrs,a}} =
   \sum_v{
      \alpha^{\mathit{nrs}}_{\mathit{r,a,v}}
      \left( \frac {\lambda^f_{r,\mathit{nrs},a} \mathit{PKF}_{r,a,v}}
         {\mathit{PF}^p_{r,\mathit{nrs},a}}
      \right)^{\sigma^{\mathit{kf}}_{\mathit{r,a,v}}}
      \frac {\mathit{KF}_{r,a,v}} {\lambda^f_{r,\mathit{nrs},a}}
   }
\end{equation}

\begin{equation}
\label{eq:pkf}
\mathit{PKF}_{r,a,v} =
   \left[
      \alpha^{\mathit{ksw}}_{\mathit{r,a,v}}
      \left( \mathit{PKSW}_{r,a,v}
      \right)^{1 - \sigma^{\mathit{kf}}_{\mathit{r,a,v}}}
   +  \alpha^{\mathit{nrs}}_{\mathit{r,a,v}}
      \left( \frac {\mathit{PF}^p_{r,\mathit{nrs},a}}
         {\lambda^f_{r,\mathit{nrs},a}}
      \right)^{1 - \sigma^{\mathit{kf}}_{\mathit{r,a,v}}}
   \right]^{\frac{1} {1 - \sigma^{\mathit{kf}}_{\mathit{r,a,v}}}}
\end{equation}

The $\mathit{KSW}$ bundle is composed of the $\mathit{KS}$ bundle, a composition
of capital and Type 2 labor and the water bundle, $\mathit{XWAT}$.
Equations~(\ref{eq:ks}) and~(\ref{eq:xwat}) represent the derived demands for
the $\mathit{KS}$ bundle and the water bundle, respectively, with the respective
prices represented by $\mathit{PKS}$ and $\mathit{PWAT}$. The main substitution
elasticity is $\sigma^{\mathit{kw}}$. Equation~(\ref{eq:pksw}) represents the
CES dual price expression for the price of the $\mathit{KSW}$ bundle,
$\mathit{PKSW}$.

\begin{equation}
\label{eq:ks}
\mathit{KS}_{r,a,v} =
   \alpha^{\mathit{ks}}_{\mathit{r,a,v}}
   \left( \frac {\mathit{PKSW}_{r,a,v}} {\mathit{PKS}_{r,a,v}}
   \right)^{\sigma^{\mathit{kw}}_{\mathit{r,a,v}}}
   \mathit{KSW}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:xwat}
\mathit{XWAT}_{r,a} =
   \sum_v{
      \alpha^{\mathit{wat}}_{\mathit{r,a,v}}
      \left( \frac {\mathit{PKSW}_{r,a,v}} {\mathit{PWAT}_{r,a}}
      \right)^{\sigma^{\mathit{kw}}_{\mathit{r,a,v}}}
      \mathit{KSW}_{r,a,v}
   }
\end{equation}

\begin{equation}
\label{eq:pksw}
\mathit{PKSW}_{r,a,v} =
   \left[
      \alpha^{\mathit{ks}}_{\mathit{r,a,v}}
      \left( \mathit{PKS}_{r,a,v}
      \right)^{1 - \sigma^{\mathit{kw}}_{\mathit{r,a,v}}}
   +  \alpha^{\mathit{wat}}_{\mathit{r,a,v}}
      \left( {\mathit{PWAT}_{r,a}}
      \right)^{1 - \sigma^{\mathit{kw}}_{\mathit{r,a,v}}}
   \right]^{\frac{1} {1 - \sigma^{\mathit{kw}}_{\mathit{r,a,v}}}}
\end{equation}

The $\mathit{KS}$ bundle is composed of capital (by vintage), $\mathit{K}^v$,
and the Type 2 labor bundle $\mathit{LAB}^2$. Equations~(\ref{eq:kv})
and~(\ref{eq:lab2}) represent the derived demands for capital and the Type 2
labor bundle, respectively, with the respective prices represented by
$\mathit{PK}^p$ and $\mathit{PLAB}^2$. The main substitution elasticity is
$\sigma^{\mathit{k}}$. The capital factor has an efficiency factor,
$\lambda^{\mathit{f}}_{\mathit{cap}}$, that is typically exogenous.
Equation~(\ref{eq:pks}) represents the CES dual price expression for
the price of the $\mathit{KS}$ bundle, $\mathit{PKS}$.

\begin{equation}
\label{eq:kv}
\mathit{K}^v_{r,a,v} =
   \alpha^{\mathit{k}}_{\mathit{r,a,v}}
   \left( \frac {\lambda^{\mathit{f}}_{r,\mathit{cap},a} \mathit{PKS}_{r,a,v}}
      {\mathit{PK}^p_{r,a,v}}
   \right)^{\sigma^{\mathit{k}}_{\mathit{r,a,v}}}
   \frac {\mathit{KS}_{r,a,v}} {\lambda^{\mathit{f}}_{r,\mathit{cap},a}}
\end{equation}

\begin{equation}
\label{eq:lab2}
\mathit{LAB}^2_{r,a} =
   \sum_v{
      \alpha^{\mathit{l2}}_{\mathit{r,a,v}}
      \left( \frac {\mathit{PKS}_{r,a,v}} {\mathit{PLAB}^2_{r,a}}
      \right)^{\sigma^{\mathit{k}}_{\mathit{r,a,v}}}
      \mathit{KS}_{r,a,v}
   }
\end{equation}

\begin{equation}
\label{eq:pks}
\mathit{PKS}_{r,a,v} =
   \left[
      \alpha^{\mathit{k}}_{\mathit{r,a,v}}
      \left( \frac {\mathit{PK}^p_{r,a,v}}
         {\lambda^{\mathit{f}}_{r,\mathit{cap},a}}
      \right)^{1 - \sigma^{\mathit{k}}_{\mathit{r,a,v}}}
   +  \alpha^{\mathit{l2}}_{\mathit{r,a,v}}
      \left( \mathit{PLAB}^2_{r,a}
      \right)^{1 - \sigma^{\mathit{k}}_{\mathit{r,a,v}}}
   \right]^{\frac{1} {1 - \sigma^{\mathit{k}}_{\mathit{r,a,v}}}}
\end{equation}

The next set of CES nests decomposes the two labor bundles, Type 1 and
Type 2 labor, respectively given by $\mathit{LAB^1}$ and
$\mathit{LAB^2}$.\footnote{[NEW 01-May-2019] The labor demand
decomposition has been reformulated.}
The model specification allows for considerable user
flexibility. There are intermediate labor bundles between $\mathit{LAB1}$
and $\mathit{LAB2}$ and the final labor demand, indexed by $\mathit{wb}$.
These bundles are user
defined. In the standard configuration where all labor types are bundled
together, there is only need for a single intermediate labor demand bundle
that will be mapped to $\mathit{LAB1}$, and all labor categories will be mapped to it.
There are alternative configurations. One could define two intermediate labor
demand bundles, for example unskilled ('nsk') and skilled ('skl') and map
GTAP's three unskilled labor types to the 'nsk' bundle and GTAP's two
skilled labor types to the 'skl' bundle. The user can then choose whether
to map both bundles to $\mathit{LAB^1}$, or to map the 'skl' bundle to $\mathit{LAB^2}$.
Beyond this added flexibility, this configuration can be used to assess the
impacts of additional labor characteristics, such as gender or region of origin.

Equation~(\ref{eq:labb}) provides the demand equations for the intermediate
labor demand bundles. The equations depend on the user-based mapping defined
by $\mathit{wb}$. The intermediate bundles are either mapped to $\mathit{LAB^1}$ or $\mathit{LAB^2}$, and we allow for differentiated elasticities given
be $\sigma^{\mathit{l1}}$ and $\sigma^{\mathit{l2}}$, respectively.
Equations~(\ref{eq:plab1}) and~(\ref{eq:plab2}) provide respectively
the prices of the $\mathit{LAB^1}$ and $\mathit{LAB^2}$ bundles.

\begin{equation}
\label{eq:labb}
\mathit{LABB}_{r,\mathit{wb},a} =
\begin{cases}
   \displaystyle \alpha^{\mathit{lbb}}_{r,\mathit{wb},a}
      \left( \frac {\mathit{PLAB}^1_{r,a}}
         {\mathit{PLABB}_{r,\mathit{wb},a}}
      \right)^{\sigma^{\mathit{l1}}_{r,a}}
      {\mathit{LAB}^1_{r,a}}
   & \textrm{if } \mathit{wb} \in \left\{ \mathit{LAB1} \right\} \\
   \displaystyle \alpha^{\mathit{lbb}}_{r,\mathit{wb},a}
      \left( \frac {\mathit{PLAB}^2_{r,a}}
         {\mathit{PLABB}_{r,\mathit{wb},a}}
      \right)^{\sigma^{\mathit{l2}}_{r,a}}
    {\mathit{LAB}^2_{r,a}}
   & \textrm{if } \mathit{wb} \in \left\{ \mathit{LAB2} \right\} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:plab1}
\mathit{PLAB}^1_{r,a} =
   \left[
      \sum_{\mathit{wb} \in \left\{ \mathit{LAB1} \right\}} {
         \alpha^{\mathit{lbb}}_{r,\mathit{wb},a}
         \left(  {\mathit{PLABB}_{r,\mathit{wb},a}}
         \right)^{1 - \sigma^{\mathit{l1}}_{\mathit{r,a}}}
      }
   \right]^{\frac{1} {1 - \sigma^{\mathit{l1}}_{\mathit{r,a}}}}
\end{equation}

\begin{equation}
\label{eq:plab2}
\mathit{PLAB}^2_{r,a} =
   \left[
      \sum_{\mathit{wb} \in \left\{ \mathit{LAB2} \right\}} {
         \alpha^{\mathit{lbb}}_{r,\mathit{wb},a}
         \left(  {\mathit{PLABB}_{r,\mathit{wb},a}}
         \right)^{1 - \sigma^{\mathit{l2}}_{\mathit{r,a}}}
      }
   \right]^{\frac{1} {1 - \sigma^{\mathit{l2}}_{\mathit{r,a}}}}
\end{equation}

The next stage determines the demand for labor type $l$, the fundamental labor type---normally up to 5 in the standard GTAP database. These
labor types are mapped to one, and only one intermediate demand bundle. Equation~(\ref{eq:labd}) provides the decomposition of the bundles where the key
substitution elasticity is given by $\sigma^{\mathit{l}}$ and is
specific to each intermediate bundle. The producer cost of labor is given by $\mathit{PF}^p_l$, and $\lambda^f_l$
represents labor efficiency. Equation~(\ref{eq:plabb}) determines the price of
the of the intermediate demand labor bundles, $\mathit{PLABB}$.

\begin{equation}
\label{eq:labd}
\mathit{XF}_{r,l,a} =
   \displaystyle \alpha^{\mathit{f}}_{r,l,a}
      \left( \frac {\lambda^f_{r,l,a} \mathit{PLABB}_{r,\mathit{wb},a}}
         {\mathit{PF}^p_{r,l,a}}
      \right)^{\sigma^{\mathit{l}}_{r,\mathit{wb},a}}
      \frac {\mathit{LABB}_{r,\mathit{wb},a}} {\lambda^f_{r,l,a}}
   \qquad \textrm{if } l \in \left\{ \mathit{wb} \right\}
\end{equation}

\begin{equation}
\label{eq:plabb}
\mathit{PLABB}_{r,\mathit{wb},a} =
   \left[
      \sum_{l \in \left\{ \mathit{wb} \right\}}{
         \alpha^{\mathit{f}}_{r,\mathit{l},a}
         \left( \frac {\mathit{PF}^p_{r,\mathit{l},a}}
            {\lambda^{\mathit{f}}_{\mathit{r,\mathit{l},a}}}
         \right)^{1 - \sigma^{l}_{{r,\mathit{wb},a}}}
      }
   \right]^{\frac{1} {1 - \sigma^{l}_{{r,\mathit{wb},a}}}}
\end{equation}

Similar to the labor bundles, the next set of CES nests decomposes the three
intermediate demand bundles, $\mathit{ND}^1$, $\mathit{ND}^2$ and
$\mathit{XWAT}$. Recall that $\mathit{ND}^2$ contains activity-specific inputs
such as fertilizers in crops and feed in livestock. The $\mathit{ND}^1$ bundle
contains all of the other intermediate goods---with the exception of water and
energy goods. The $\mathit{XWAT}$ bundle contains all designated water
commodities from intermediate demand as well as the water factor in some
sectors---such as irrigated agriculture. Equation~(\ref{eq:xap}) provides the
decomposition of the bundles where the key substitution elasticities are
$\sigma^{\mathit{nd1}}$, $\sigma^{\mathit{nd2}}$ and $\sigma^{\mathit{wat}}$,
the producer cost of intermediate goods is given by $\mathit{PA}^a$,
and $\lambda^{\mathit{io}}$ represents an efficiency factor for the use of
intermediate goods. Equation~(\ref{eq:pnd1}) determines the price of the
$\mathit{ND}^1$ bundle, $\mathit{PND}^1$ bundle, and equation~(\ref{eq:pnd2})
determines the price of the $\mathit{ND}^2$ bundle, $\mathit{PND}^2$. The user
determines the composition of the intermediate demand bundles by mapping the
specific intermediate commodities to one of the two bundles.\footnote{In the
{GAMS} code the two mappings are driven by the sets \texttt{mapi1} and
\texttt{mapi2}.}

\begin{equation}
\label{eq:xap}
\mathit{XA}_{r,i,a} =
\begin{cases}
   \displaystyle \alpha^{\mathit{io}}_{r,i,a}
      \left( \frac {\lambda^{\mathit{io}}_{r,i,a} \mathit{PND}^1_{r,a}}
         {\mathit{PA}^a_{r,i,a}}
      \right)^{\sigma^{\mathit{nd1}}_{r,a}}
      \frac {\mathit{ND}^1_{r,a}} {\lambda^{\mathit{io}}_{r,i,a}}
      & \textrm{if } i \in \left\{ \mathit{ND1} \right\} \\
   \displaystyle \alpha^{\mathit{io}}_{r,i,a}
      \left( \frac {\lambda^{\mathit{io}}_{r,i,a} \mathit{PND}^2_{r,a}}
         {\mathit{PA}^a_{r,i,a}}
      \right)^{\sigma^{\mathit{nd2}}_{r,a}}
      \frac {\mathit{ND}^2_{r,a}} {\lambda^{\mathit{io}}_{r,i,a}}
   & \textrm{if } i \in \left\{ \mathit{ND2} \right\} \\
   \displaystyle \alpha^{\mathit{io}}_{r,i,a}
   \left( \frac {\lambda^{\mathit{io}}_{r,i,a} \mathit{PWAT}_{r,a}}
      {\mathit{PA}^a_{r,i,a}}
   \right)^{\sigma^{\mathit{wat}}_{r,a}}
   \frac {\mathit{XWAT}_{r,a}} {\lambda^{\mathit{io}}_{r,i,a}}
   & \textrm{if } i \in \left\{ \mathit{iw} \right\} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pnd1}
\mathit{PND}^1_{r,a} =
   \left[
      \sum_{i \in \left\{ \mathit{ND1} \right\}} {
         \alpha^{\mathit{io}}_{r,i,a}
         \left( \frac {\mathit{PA}^a_{r,i,a}} {\lambda^{\mathit{io}}_{r,i,a}}
         \right)^{1 - \sigma^{\mathit{nd1}}_{\mathit{r,a}}}
      }
   \right]^{\frac{1} {1 - \sigma^{\mathit{nd1}}_{\mathit{r,a}}}}
\end{equation}

\begin{equation}
\label{eq:pnd2}
\mathit{PND}^2_{r,a} =
   \left[
      \sum_{i \in \left\{ \mathit{ND2} \right\}} {
         \alpha^{\mathit{io}}_{r,i,a}
         \left( \frac {\mathit{PA}^a_{r,i,a}} {\lambda^{\mathit{io}}_{r,i,a}}
         \right)^{1 - \sigma^{\mathit{nd2}}_{\mathit{r,a}}}
      }
   \right]^{\frac{1} {1 - \sigma^{\mathit{nd2}}_{\mathit{r,a}}}}
\end{equation}

Equation~(\ref{eq:h2oD}) determines the demand for the water
factor.\footnote{At the moment, only irrigated crops have any water demand.}
Equation~(\ref{eq:pwat}) determines the price of the $\mathit{XWAT}$ bundle,
where the subset $\mathit{iw}$ spans the set of water
commodities.\footnote{In a standard aggregation of the GTAP database, the
subset $\mathit{iw}$ would be composed of the GTAP commodity labeled
\texttt{wtr}.}

\begin{equation}
\label{eq:h2oD}
\mathit{XF}_{r,\mathit{wat},a} =
   \alpha^{\mathit{f}}_{r,\mathit{wat},a}
   \left( \frac {\lambda^{f}_{r,\mathit{wat},a} \mathit{PWAT}_{r,a}}
      {\mathit{PF}^p_{r,\mathit{wat},a}}
   \right)^{\sigma^{\mathit{wat}}_{r,a}}
   \frac {\mathit{XWAT}_{r,a}} {\lambda^{f}_{\mathit{r,\mathit{wat},a}}}
\end{equation}

\begin{equation}
\label{eq:pwat}
\mathit{PWAT}_{r,a} =
   \left[
      \sum_{i \in \left\{ \mathit{iw} \right\}} {
         \alpha^{\mathit{io}}_{r,i,a}
         \left( \frac {\mathit{PA}^a_{r,i,a}} {\lambda^{\mathit{io}}_{r,i,a}}
         \right)^{1 - \sigma^{\mathit{wat}}_{\mathit{r,a}}}
      }
   +  \alpha^{\mathit{f}}_{r,\mathit{wat},a}
      \left( \frac {\mathit{PF}^p_{r,\mathit{wat},a}}
         {\lambda^{\mathit{f}}_{r,\mathit{wat},a}}
      \right)^{1 - \sigma^{\mathit{wat}}_{\mathit{r,a}}}
   \right]^{\frac{1} {1 - \sigma^{\mathit{wat}}_{\mathit{r,a}}}}
\end{equation}

The final set of nests in production concern the energy bundle, $\mathit{XNRG}$.
It will be decomposed into demand for the energy commodities,
figure~\ref{fig:NRGNest}. The energy bundle is first decomposed into electric
and non-electric bundles. The latter is then decomposed into a coal bundle and a
non-coal bundle (or the oil \& gas bundle). The oil \& gas bundle is then split
into a gas bundle and an oil bundle. The four remaining bundles---electric,
coal, oil and gas---represent a combination of existing or future energy
sources. In the case of the original GTAP database, the electric bundle would
hold the 'ely' commodity, the coal bundle would hold the 'coa' commodity, the
oil bundle would hold the 'oil' and 'p\_c' commodities and the gas bundle would
hold the 'gas' and 'gdt' commodities. Non-GTAP commodities would be mapped to
one of the existing bundles. For example, 'p\_c' could be split into gasoline
and diesel, and/or could include ethanol or bio-diesel.

[NEW 31-OCT-2020]. The energy bundle has been modified to allow for
the so-called additive version of the CES (ACES). The ACES preserves
both volume and value additivity and replicates the logit specification
of energy demand, which is used in a number of models including
GCAM.\footnote{GCAM derived from an earlier model developed
by Edmonds and Reilly (\cite{EdmondsReilly1985}).} While the standard CES
requires two equations---demand and the zero profit condition---the ACES
requires three equations---demand, the composite price index and the
zero profit condition.\footnote{It is easy to show that for the standard
CES, the composite price expression and the zero profit equation are
identical. This is not the case for the ACES.} In the expressions below,
the description will include all three equations for both the standard
and additive CES. In the model code, the zero profit condition
is dropped for the standard CES.\footnote{While the zero profit
condition is needed for the ACES/ACET it will normally be implemented
using the relation that links the average bundle price with the
composite price index. See equations~(\ref{eq:CESAllocPa})
and (\ref{eq:CETAllocPa}) in Annex~\ref{chap:CESAppendix}. The standard
zero-profit condition can lead to numeric difficulties in some
situations.}

\begin{figure}[H]
\center
\begin{forest}
for tree={
   minimum height=1cm,
   font=\scriptsize,
%  font=\sffamily,
   anchor=north,
   align=center,
   child anchor=north,
   s sep=1em,
   l sep=0.75cm,
},
%where n children=0{tier=word}{}
[{Energy\\bundle ($\mathit{NRG}$)}, draw, drop shadow, fill=dkBlue, rounded corners=2pt, name=NRG
   [{{Electricity} \\ {bundle ($\mathit{ELY}$)}}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=ELY, l*=4.28
%   [{{Electricity} \\ {bundle ($\mathit{ELY}$)}}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=ELY
      [][{Armington\\demand ($\mathit{XA_{ely}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
   ]
   [{Non-electric\\bundle ($\mathit{NELY}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=NELY
      [{{Oil \& Gas}\\bundle ($\mathit{OLG}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=OLG
         [{Gas\\bundle ($\mathit{GAS}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=GAS
            [][{Armington\\demand ($\mathit{XA_{gas}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
         ]
         [{Oil\\bundle ($\mathit{OIL}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=OIL
            [][{Armington\\demand ($\mathit{XA_{oil}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
         ]
      ]
      [{Coal\\bundle ($\mathit{COA}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=COA, l*=2.64
%      [{Coal\\bundle ($\mathit{COA}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=COA
         [][{Armington\\demand ($\mathit{XA_{coa}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
      ]
   ]
]
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.15cm]NRG.south) {\scriptsize $\sigma^e$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.45cm]NELY.south) {\scriptsize $\sigma^{nely}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.25cm]OLG.south) {\scriptsize $\sigma^{olg}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]ELY.south) {\scriptsize $\sigma^{ely}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]GAS.south) {\scriptsize $\sigma^{gas}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]OIL.south) {\scriptsize $\sigma^{oil}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]COA.south) {\scriptsize $\sigma^{coa}$};
%{\draw[white,dotted] (!1) -| coordinate(p) () ;
%\path ()--(p) node[pos=0.1,left,inner sep=1pt]{\scriptsize $\sigma^p$};}
\end{forest}
\caption{{Energy bundle nest}}
\label{fig:NRGNest}
\end{figure}

Equation~(\ref{eq:xely}) determines the demand for the electric bundle,
$\mathit{XA^{\mathit{ely}}}$.\footnote{In the GAMS code, the demand for the four
energy bundles ('ely', 'gas', 'oil' and 'coa') are represented by the variable
\texttt{xaNRG} that has an additional dimension representing the four main
energy carriers. This simplifies the decomposition of these bundles that only
requires one set of equations rather than four. In principle, it also makes it
somewhat easier to increase the number of energy bundles.}
Equation~(\ref{eq:xnely}) determines the demand for the non-electric bundle,
$\mathit{XNELY}$. In both equations, the key substitution elasticity is given by
$\sigma^{\mathit{e}}$. As stated above, the demand equations rely
on the composite price index, which has a different specification
for the standard and additive versions of the CES. Equation~(\ref{eq:pnrgc})
describes the aggregate composite price index of energy, $\mathit{PNRG}^c$, as
a function of the \texttt{IFNRGACES} flag. The latter is
true for the additive CES and false otherwise. Equation~(\ref{eq:pnrg})
describes the zero profit condition and determines the average price of the
energy bundle. In the case of the standard CES, the zero-profit condition
is substituted out of the model code as it is identical to the composite
price index.

\begin{equation}
\label{eq:xely}
\mathit{XA}^{\mathit{ely}}_{r,a,v} =
   \alpha^{\mathit{ely}}_{\mathit{r,a,v}}
   \left( \frac {\mathit{PNRG}^c_{r,a,v}} {\mathit{PA}^{\mathit{ely}}_{r,a,v}}
   \right)^{\sigma^{\mathit{e}}_{\mathit{r,a,v}}}
   \mathit{XNRG}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:xnely}
\mathit{XNELY}_{r,a,v} =
   \alpha^{\mathit{nely}}_{\mathit{r,a,v}}
   \left( \frac {\mathit{PNRG}^c_{r,a,v}} {\mathit{PNELY}_{r,a,v}}
   \right)^{\sigma^{\mathit{e}}_{\mathit{r,a,v}}}
   \mathit{XNRG}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:pnrgc}
\mathit{PNRG}^c_{r,a,v} =
\begin{array}{l c l}
   \left[
      \alpha^{\mathit{ely}}_{\mathit{r,a,v}}
      \left( \mathit{PA}^{\mathit{ely}}_{r,a,v}
      \right)^{1 - \sigma^{\mathit{e}}_{\mathit{r,a,v}}}
   +  \alpha^{\mathit{nely}}_{\mathit{r,a,v}}
      \left( \mathit{PNELY}_{r,a,v}
      \right)^{1 - \sigma^{\mathit{e}}_{\mathit{r,a,v}}}
   \right]^{\frac{1} {1 - \sigma^{\mathit{e}}_{\mathit{r,a,v}}}} &
	\textrm{if } \lnot \texttt{IFNRGACES} \\
   \left[
      \alpha^{\mathit{ely}}_{\mathit{r,a,v}}
      \left( \mathit{PA}^{\mathit{ely}}_{r,a,v}
      \right)^{-\sigma^{\mathit{e}}_{\mathit{r,a,v}}}
   +  \alpha^{\mathit{nely}}_{\mathit{r,a,v}}
      \left( \mathit{PNELY}_{r,a,v}
      \right)^{-\sigma^{\mathit{e}}_{\mathit{r,a,v}}}
   \right]^{-\frac{1} {\sigma^{\mathit{e}}_{\mathit{r,a,v}}}} &
	\textrm{if } \texttt{IFNRGACES} \\
\end{array}
\end{equation}

\begin{equation}
\label{eq:pnrg}
\mathit{PNRG}_{r,a,v} = \left[\mathit{PA}^{\mathit{ely}}_{r,a,v} \mathit{XA}^{\mathit{ely}}_{r,a,v}
+ \mathit{PNELY}_{r,a,v}  \mathit{XNELY}_{r,a,v} \right] \bigg / \mathit{XNRG}_{r,a,v}
\end{equation}

Equation~(\ref{eq:xcoa}) determines the demand for the coal bundle,
$\mathit{XA^{\mathit{coa}}}$. Equation~(\ref{eq:xolg}) determines the demand for
the oil \& gas bundle, $\mathit{XOLG}$. In both equations, the key substitution
elasticity is given by $\sigma^{\mathit{nely}}$. Equation~(\ref{eq:pnelyc})
defines the composite price index of the non-electric bundle, $\mathit{PNELY}^c$
and equation~(\ref{eq:pnely}) describes the aggregate price of the non-electric bundle, $\mathit{PNELY}$.

\begin{equation}
\label{eq:xcoa}
\mathit{XA}^{\mathit{coa}}_{r,a,v} =
   \alpha^{\mathit{coa}}_{\mathit{r,a,v}}
   \left( \frac {\mathit{PNELY}^c_{r,a,v}} {\mathit{PA}^{\mathit{coa}}_{r,a,v}}
   \right)^{\sigma^{\mathit{nely}}_{\mathit{r,a,v}}}
   \mathit{XNELY}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:xolg}
\mathit{XOLG}_{r,a,v} =
   \alpha^{\mathit{olg}}_{\mathit{r,a,v}}
   \left( \frac {\mathit{PNELY}^c_{r,a,v}} {\mathit{POLG}_{r,a,v}}
   \right)^{\sigma^{\mathit{nely}}_{\mathit{r,a,v}}}
   \mathit{XNELY}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:pnelyc}
\mathit{PNELY}^c_{r,a,v} =
\begin{array}{l c l}
   \left[
      \alpha^{\mathit{coa}}_{\mathit{r,a,v}}
      \left( \mathit{PA}^{\mathit{coa}}_{r,a,v}
      \right)^{1 - \sigma^{\mathit{nely}}_{\mathit{r,a,v}}}
   +  \alpha^{\mathit{olg}}_{\mathit{r,a,v}}
      \left( \mathit{POLG}_{r,a,v}
      \right)^{1 - \sigma^{\mathit{nely}}_{\mathit{r,a,v}}}
   \right]^{\frac{1} {1 - \sigma^{\mathit{nely}}_{\mathit{r,a,v}}}} &
	\textrm{if } \lnot \texttt{IFNRGACES} \\
   \left[
      \alpha^{\mathit{coa}}_{\mathit{r,a,v}}
            \left( \mathit{PA}^{\mathit{coa}}_{r,a,v}
            \right)^{- \sigma^{\mathit{nely}}_{\mathit{r,a,v}}}
         +  \alpha^{\mathit{olg}}_{\mathit{r,a,v}}
            \left( \mathit{POLG}_{r,a,v}
            \right)^{- \sigma^{\mathit{nely}}_{\mathit{r,a,v}}}
         \right]^{-\frac{1} {\sigma^{\mathit{nely}}_{\mathit{r,a,v}}}} &
	\textrm{if } \texttt{IFNRGACES} \\
\end{array}
\end{equation}

\begin{equation}
\label{eq:pnely}
\mathit{PNELY}_{r,a,v} = \left[\mathit{PA}^{\mathit{coa}}_{r,a,v} \mathit{XA}^{\mathit{coa}}_{r,a,v}
+ \mathit{POLG}_{r,a,v}  \mathit{XOLG}_{r,a,v} \right] \bigg / \mathit{XNELY}_{r,a,v}
\end{equation}

The remaining two energy bundles are oil and gas and emanate from the
$\mathit{XOLG}$ bundle. Equation~(\ref{eq:xoil}) determines the demand for the
oil bundle, $\mathit{XA}^{\mathit{oil}}$. Equation~(\ref{eq:xgas}) determines
the demand for the gas bundle, $\mathit{XA}^{\mathit{gas}}$. In both equations,
the key substitution elasticity is given by $\sigma^{\mathit{OLG}}$.
Equation~(\ref{eq:polgc}) describes the composite price index of the oil \& gas
bundle, $\mathit{POLG}^c$. Equation~(\ref{eq:polg}) describes the aggregate
price of the oil \& gas bundle, $\mathit{POLG}$.

\begin{equation}
\label{eq:xoil}
\mathit{XA}^{\mathit{oil}}_{r,a,v} =
   \alpha^{\mathit{oil}}_{\mathit{r,a,v}}
   \left( \frac {\mathit{POLG}^c_{r,a,v}} {\mathit{PA}^{\mathit{oil}}_{r,a,v}}
   \right)^{\sigma^{\mathit{olg}}_{\mathit{r,a,v}}}
   \mathit{XOLG_{r,a,v}}
\end{equation}

\begin{equation}
\label{eq:xgas}
\mathit{XA}^{\mathit{gas}}_{r,a,v} =
   \alpha^{\mathit{gas}}_{\mathit{r,a,v}}
   \left( \frac {\mathit{POLG}^c_{r,a,v}} {\mathit{PA}^{\mathit{gas}}_{r,a,v}}
   \right)^{\sigma^{\mathit{olg}}_{\mathit{r,a,v}}}
   \mathit{XOLG}_{r,a,v}
\end{equation}

\begin{equation}
\label{eq:polgc}
\mathit{POLG}^c_{r,a,v} =
\begin{array}{l c l}
   \left[
      \alpha^{\mathit{oil}}_{\mathit{r,a,v}}
      \left( \mathit{PA}^{\mathit{oil}}_{r,a,v}
      \right)^{1 - \sigma^{\mathit{olg}}_{\mathit{r,a,v}}}
   +  \alpha^{\mathit{gas}}_{\mathit{r,a,v}}
      \left( \mathit{PA}^{\mathit{gas}}_{r,a,v}
      \right)^{1 - \sigma^{\mathit{olg}}_{\mathit{r,a,v}}}
   \right]^{\frac{1} {1 - \sigma^{\mathit{olg}}_{\mathit{r,a,v}}}} &
	\textrm{if } \lnot \texttt{IFNRGACES} \\
   \left[
      \alpha^{\mathit{oil}}_{\mathit{r,a,v}}
            \left( \mathit{PA}^{\mathit{oil}}_{r,a,v}
            \right)^{- \sigma^{\mathit{olg}}_{\mathit{r,a,v}}}
         +  \alpha^{\mathit{gas}}_{\mathit{r,a,v}}
            \left( \mathit{PA}^{\mathit{gas}}_{r,a,v}
            \right)^{- \sigma^{\mathit{olg}}_{\mathit{r,a,v}}}
         \right]^{-\frac{1} {\sigma^{\mathit{olg}}_{\mathit{r,a,v}}}} &
	\textrm{if } \texttt{IFNRGACES} \\
\end{array}
\end{equation}

\begin{equation}
\label{eq:polg}
\mathit{POLG}_{r,a,v} = \left[\mathit{PA}^{\mathit{oil}}_{r,a,v} \mathit{XA}^{\mathit{oil}}_{r,a,v}
+ \mathit{PA}^{\mathit{gas}}_{r,a,v} \mathit{XA}^{\mathit{gas}}_{r,a,v} \right] \bigg / \mathit{XOLG}_{r,a,v}
\end{equation}

The final nest in the energy bundle is to decompose the four aggregate energy
bundles into their constituent parts that represent the Armington demand for the
energy commodities. Equation~(\ref{eq:xanrg}) reflects the Armington demand for
energy commodity $e$, $\mathit{XA}$, where the cost to producers is given by
$\mathit{PA}^a$. The key substitution elasticity for each energy bundle is given
by $\sigma^{\mathit{NRG}}$. Equation~(\ref{eq:panrg}) represents the composite price
index of the aggregate energy bundles, $\mathit{PA}^{c,\mathit{NRG}}$.
Equation~(\ref{eq:panrg}) represents the price of
the aggregate energy bundles, $\mathit{PA}^{\mathit{NRG}}$. Note that the
parameter $\lambda$ has a different role in the two versions. Under the
standard CES, $\lambda$ is used to change the efficiency of energy use
(by carrier, activity and vintage). In the case of the additive CES, $\lambda$
is a preference shifter. For the moment, the core shift in energy efficience
is embedded in the demand for the energy bundle, equation~(\ref{eq:xnrg}),
which is activity and vintage specific, but not carrier specific.

\begin{equation}
\label{eq:xanrg}
\mathit{XA}_{r,e,a} =
\begin{array}{*{20}{l}}
   \displaystyle \sum_v{
      \alpha^{\mathit{eio}}_{r,e,a,v}
      \left( \frac {\lambda^{\mathit{e}}_{r,e,a,v}
         \mathit{PA}^{c,\mathit{NRG}}_{r,a,v}} {\mathit{PA}^a_{r,e,a}}
      \right)^{\sigma^{\mathit{NRG}}_{r,a,v}}
      \frac {\mathit{XA}^{\mathit{NRG}}_{r,a,v}}
         {\lambda^{\mathit{e}}_{r,e,a,v}}
   }
   & \textrm{if } e \in \left\{ \mathit{NRG} \right\} \& \textrm{if } \lnot \texttt{IFNRGACES} \\
      \displaystyle \sum_v{
         \alpha^{\mathit{eio}}_{r,e,a,v}
         \left( \frac {\mathit{PA}^{c,\mathit{NRG}}_{r,a,v}} {\lambda^{\mathit{e}}_{r,e,a,v} \mathit{PA}^a_{r,e,a}}
         \right)^{\sigma^{\mathit{NRG}}_{r,a,v}}
         {\mathit{XA}^{\mathit{NRG}}_{r,a,v}}
      }
      & \textrm{if } e \in \left\{ \mathit{NRG} \right\} \& \textrm{if } \texttt{IFNRGACES} \\
\end{array}
\end{equation}

\begin{equation}
\label{eq:panrgc}
\mathit{PA}^{c,\mathit{NRG}}_{r,a,v} =
\begin{array}{l c l}
   \left[
      \displaystyle
            \sum_{e \in \left\{ \mathit{NRG} \right\}} {
               \alpha^{\mathit{eio}}_{r,e,a,v}
               \left( \frac {\mathit{PA}^a_{r,e,a}} {\lambda^{\mathit{e}}_{r,e,a,v}}
               \right)^{1 - \sigma^{\mathit{NRG}}_{\mathit{r,a,v}}}
            }
         \right]^{\frac{1} {1 - \sigma^{\mathit{NRG}}_{\mathit{r,a,v}}}} &
	\textrm{if } \lnot \texttt{IFNRGACES} \\
   \left[\displaystyle
         \sum_{e \in \left\{ \mathit{NRG} \right\}} {
            \alpha^{\mathit{eio}}_{r,e,a,v}
            \left( {\lambda^{\mathit{e}}_{r,e,a,v}} {\mathit{PA}^a_{r,e,a}}
            \right)^{- \sigma^{\mathit{NRG}}_{\mathit{r,a,v}}}
         }
      \right]^{-\frac{1} {\sigma^{\mathit{NRG}}_{\mathit{r,a,v}}}} &
	\textrm{if } \texttt{IFNRGACES} \\
\end{array}
\end{equation}

\begin{equation}
\label{eq:panrg}
\mathit{PA}^{\mathit{NRG}}_{r,a,v} =
   \displaystyle \sum_{e \in \left\{ \mathit{NRG} \right\}} { \mathit{PA}^a_{r,e,a} \mathit{XA}_{r,e,a}}
   \bigg / \mathit{XA}^{\mathit{NRG}}_{r,a,v}
\end{equation}

\subsection{Alternative nesting for the natural resource factor}

[01-Aug-2020] The model allows for the user to change the
nesting for the natural resource factor. Figure~\ref{fig:SimpleProdNest}, shows a simplified version
of the standard nesting. In the standard nesting the natural resource
factor enters as a factor bundled with capital. In the alternative
nesting, the demand for the natural resource is at the top of the nest
(but after the output/GHG nest), where the variable $\mathit{XPN}$
represents the output net of GHG and $\mathit{XPX}$ is equal to
$\mathit{XPN}$ in the standard case, but is output net of the natural
resource in the case of the alternate nesting---see Figure~\ref{fig:AltSimpleProdNest}.

\begin{figure}[H]
\center
\begin{forest}
for tree={
  minimum height=1cm,
  font=\scriptsize,
%  font=\sffamily,
  anchor=north,
  align=center,
  child anchor=north,
  s sep=1em,
  l sep=0.75cm
},
%where n children=0{tier=word}{}
[{Output \\ $\mathit{XPN}$ = $\mathit{XPX}$}, draw, drop shadow, fill=dkBlue, rounded corners=2pt, name=XPN
   [{Intermediate \\ demand bundle ($\mathit{ND}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=ND
   ]
   [{Value added \\ bundle ($\mathit{VA}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=VA
      [{Labor \\ bundle ($\mathit{LAB}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=LAB]
      [{Capital + \\ NRS bundle ($\mathit{KNR}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=KNR
         [{Capital \\ demand ($\mathit{K}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt, name=K]
         [{Natural resource \\ demand ($\mathit{NRS}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt, name=NRS]
      ]
   ]
]
\end{forest}
\caption{{Simplified standard nest}}
\label{fig:SimpleProdNest}
\end{figure}

\begin{figure}[H]
\center
\begin{forest}
for tree={
  minimum height=1cm,
  font=\scriptsize,
%  font=\sffamily,
  anchor=north,
  align=center,
  child anchor=north,
  s sep=1em,
  l sep=0.75cm
},
%where n children=0{tier=word}{}
[{Output \\ $\mathit{XPN}$}, draw, drop shadow, fill=dkBlue, rounded corners=2pt, name=XPN
   [{Natural resource \\ demand ($\mathit{NRS}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt, name=NRS]
   [{Output net \\ of NRS ($\mathit{XPX}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XPX
      [{Intermediate \\ demand bundle ($\mathit{ND}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=ND
      ]
      [{Value added \\ bundle ($\mathit{VA}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=VA
         [{Labor \\ bundle ($\mathit{LAB}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=LAB]
         [{Capital \\ demand ($\mathit{K}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt, name=K]
      ]
   ]
]
\end{forest}
\caption{{Simplified alternative nest}}
\label{fig:AltSimpleProdNest}
\end{figure}

The nesting is a user-specified option governed by the
parameter \texttt{ifNRSTop}. If its value is set to 1, the
alternative nesting is used, else the model uses the
standard nesting. The modified nesting introduces a new
substitution elasticity, $\sigma^{\mathit{nrs}}$. Default
values are given, but it is up to the user to verify and
modify the value if needed.\footnote{The standard nesting
uses the CES elasticity $\sigma^{\mathit{kf}}$ to deduce
the demand for the natural resource factor.}

\section{Commodity supply}
\renewcommand{\theequation}{{S-}\arabic{equation}}
\setcounter{equation}{0}

The model allows for each activity $a$ to produce one or more commodities
(indexed by $i$). For example, the ethanol industry could produce both ethanol
as well as distiller's dried grain with solubles (or DDGS). Similarly, a single
commodity can be produced by one or more activities. For example, the
electricity commodity can be produced by multiple generation
activities---thermal, nuclear, hydro, renewables, etc. Joint production is
captured by a CET transformation function, with the possibility of perfect
transformation. The aggregation of output from multiple activities is captured
with a CES preference function, again with the possibility of commodity
homogeneity, in which case the law-of-one-price holds.\footnote{In the standard
GTAP database, there is a one-to-one correspondence between activities and
commodities, i.e. the make matrix is diagonal. The aggregation facility for the
\textsc{Envisage} model allows the user to determine the mapping from activities
to commodities. For example, it is possible to have a single agricultural
production function that produces a number of agricultural commodities.
Similarly, it is possible to have a number of agricultural production activities
that produce a single agricultural commodity.}

As an option to the standard model, power generation can be treated in a special
fashion compared to other goods and services. The aggregation of production
across activities is normally determined using a single CES nest. For the power
activities, aggregation to the single electricity commodity uses a nested CES
structure that is explained in the subsequent section.

The latest version of \textsc{Envisage} hones to the new GTAP standard model,
see \cite{CorongGEA2017}, that applies the output tax to the 'make' commodities,
i.e. the output tax is now both activity- and commodity-specific. This
introduces a wedge between the basic price of commodity $X$, $P$, and the
tax-inclusive price, $\mathit{PP}$.\footnote{Note that the variable
$\mathit{PP}$ is substituted out of all equations in the model specification.}

\subsection{Non-electric goods}

This section describes the make matrix for all commodities with the exception of
electricity that is described subsequently. The equations thus hold for all
commodities indexed by $i$ except for the electricity commodity. The allocation
of output, $\mathit{XP_{r,a}}$, from activity $a$, to supply one or more
commodity $i$, is described in equation~(\ref{eq:x}) that is the standard CET
supply allocation expression. The variable $X$ represents the supply of
commodity $i$ by activity $a$. The transformation elasticity is given by
$\omega^{\mathit{s}}$. The model allows for perfect transformation, in which
case the law-of-one-price holds. Equation~(\ref{eq:xp}) is in essence an
equilibrium condition that determines the aggregate output of activity $a$,
$\mathit{XP}$. In the case of perfect transformation, it simply aggregates the
individual supplies. The CET expression incorporates an efficiency parameter,
$\lambda^s$ that allows for changes between the quantity produced and the
quantity to reach the market.\footnote{[NEW: 4-OCT-2018]} This can be used, for example, to reduce
post-harvest losses.

\begin{equation}
\label{eq:x}
\begin{cases}
   \mathit{X}_{r,a,i} =
      \displaystyle
         \gamma^{\mathit{p}}_{r,a,i}
         \left(\frac{1}{\lambda^s_{r,a,i}}\right)^{1+\omega^s_{r,a}}
         \left( \frac {\mathit{P}_{r,a,i}} {\mathit{PX}_{r,a}}
         \right)^{\omega^{\mathit{s}}_{r,a}}
         \mathit{XP}_{r,a}
      & \textrm{if } \omega^{\mathit{s}}_{r,a} \ne \infty \\
      \mathit{P}_{r,a,i} = \lambda^s_{r,a,i} \mathit{PX}_{r,a}
      & \textrm{if } \omega^{\mathit{s}}_{r,a} = \infty \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:xp}
\mathit{PX}_{r,a} \mathit{XP}_{r,a} =
   \sum_i{
      \mathit{P}_{r,a,i} \mathit{X}_{r,a,i}
   }
\end{equation}

The output tax, $\tau^p$, is applied to price $P$ and generates the supply price
of commodity $i$ produced by activity $a$, equation~(\ref{eq:pp}). The supply of
commodity $i$ is the (CES) aggregation of output of one or more activities $a$.
A CES preference function is used for the aggregation. Equation~(\ref{eq:p})
determines the 'demand' for output $a$ to compose commodity $i$,
$X$.\footnote{Equation~(\ref{eq:x}) determines supply and equation~(\ref{eq:p})
determines demand. The supply/demand equilibrium condition is substituted out.}
The substitution elasticity is given by $\sigma^{\mathit{s}}$. The model allows
for perfect substitution, in which case the law-of-one-price holds.
Equation~(\ref{eq:ps}) determines the (market) price of commodity $i$,
$\mathit{PS}$.

\begin{equation}
\label{eq:pp}
\mathit{PP}_{r,a,i} =
   \left( 1 + \tau^p_{r,a,i} \right) \mathit{P}_{r,a,i}
\end{equation}

\begin{equation}
\label{eq:p}
\begin{cases}
   \mathit{X}_{r,a,i} =
      \displaystyle
         \alpha^{\mathit{s}}_{r,a,i}
         \left( \frac {\mathit{PS}_{r,i}} {\mathit{PP}_{r,a,i}}
         \right)^{\sigma^{\mathit{s}}_{r,i}}
         \mathit{XS}_{r,i}
   & \textrm{if } \sigma^{\mathit{s}}_{r,i} \ne \infty \\
   \mathit{PP}_{r,a,i} = \mathit{PS}_{r,i}
   & \textrm{if } \sigma^{\mathit{s}}_{r,i} = \infty \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:ps}
\mathit{PS}_{r,i} \mathit{XS}_{r,i} =
   \sum_a{
      \mathit{PP}_{r,a,i} \mathit{X}_{r,a,i}
   }
\end{equation}

\subsection{Domestic supply of electricity}

The bundling of electricity uses a nested CES structure instead of a single
nest, see figure~\ref{fig:PowNest}. The top nest combines aggregate power supply
with distribution and transmission services to form aggregate domestic electric
supply. The power nest combines a number of different (and user-determined)
power bundles. Subsequently, each of these power bundles are formed by the
different power activities that are segmented into the different power bundles
(under user-mapping). For example, the power bundles may be composed of coal-,
oil- and gas-generation, nuclear, and all other. Using the GTAP power database,
base load coal could be mapped to the coal power bundle, base and peak load oil
could be mapped to the oil power bundle, base and peak load gas could be mapped
to the gas power bundle, base load nuclear would be mapped to the nuclear power
bundle, and all other power activities (wind, solar, hydro and other) could be
mapped to the other power bundle. The strategy for future technologies would be
to bundle them in power bundles. For example coal capture and storage could be
in the coal power bundle, and advanced nuclear could be incorporated in the
nuclear power bundle.

\begin{figure}[ht]
\center{}
\begin{forest}
for tree={
   minimum height=1cm,
   font=\scriptsize,
%  font=\sffamily,
   anchor=north,
   align=center,
   child anchor=north,
   s sep=1em,
   l sep=0.75cm,
},
%where n children=0{tier=word}{}
[{Electricity \\ supply ($\mathit{XS}$)}, draw, drop shadow, fill=dkBlue, rounded corners=2pt, name=XS
   [{Demand for distribution \\ and transmission services ($\mathit{X}_{\mathit{etd}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt, name=XETD]
   [{Demand for aggregate \\ power bundle ($\mathit{X}^{\mathit{pow}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XSPOW
      [{Demand for power \\ bundle(1) ($\mathit{XPOW}^{\mathit{1}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XS1
         [][{Demand for power \\ by activity ($\mathit{X}_{\mathit{e1}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt, name=XSE1][]
      ]
      [{Demand for power \\ bundle(2) ($\mathit{XPOW}^{\mathit{2}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XS2
         [][{Demand for power \\ by activity ($\mathit{X}_{\mathit{e2}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt, name=XSE2][]
      ]
      [{Demand for power \\ bundle(n) ($\mathit{XPOW}^{\mathit{n}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XSn
         [][{Demand for power \\ by activity ($\mathit{X}_{\mathit{en}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt, name=XSEn][]
      ]
   ]
]
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.45cm]XS.south) {\scriptsize $\sigma^{\mathit{el}}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.05cm]XSPOW.south) {\scriptsize $\sigma^{\mathit{pow}}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.05cm]XS1.south) {\scriptsize $\sigma^{\mathit{pb1}}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.05cm]XS2.south) {\scriptsize $\sigma^{\mathit{pb2}}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.05cm]XSn.south) {\scriptsize $\sigma^{\mathit{pbn}}$};
%{\draw[white,dotted] (!1) -| coordinate(p) () ;
%\path ()--(p) node[pos=0.1,left,inner sep=1pt]{\scriptsize $\sigma^p$};}
\end{forest}
\caption{{CES nest for power bundle}}
\label{fig:PowNest}
\end{figure}

Equation~(\ref{eq:XETD}) determines the demand for electricity
services---indexed by activities $\mathit{etd}$---used to produce one or more
electric commodities---indexed by $\mathit{ely}$.\footnote{Typically there is a
single transmission and distribution activity and a single electricity
commodity.} It is linked to the total supply of power,
$\mathit{XS}^{\mathit{pow}}$, in a CES bundle. The normal specification assumes
a Leontief technology, i.e. a substitution elasticity of zero.
Equation~(\ref{eq:XPOW}) determines the demand for the power bundle, it is a
bundle of all electricity generation, and excludes the transmission and
distribution services. Equation~(\ref{eq:PSELY}) determines the supply price of
aggregate electricity.

\begin{equation}
\label{eq:XETD}
\mathit{X}_{r,\mathit{etd},\mathit{ely}} =
   \alpha^{\mathit{s}}_{r,\mathit{etd},\mathit{ely}}
   \left( \frac {\mathit{PS}_{r,\mathit{ely}}}
      {\mathit{PP}_{r,\mathit{etd}, \mathit{ely}}}
   \right)^{\sigma^{\mathit{el}}_{r,\mathit{ely}}}
   \mathit{XS}_{r,\mathit{ely}}
\end{equation}

\begin{equation}
\label{eq:XPOW}
\mathit{XPOW}_{r,\mathit{ely}} =
   \alpha^{\mathit{pow}}_{r,\mathit{ely}}
   \left( \frac {\mathit{PS}_{r,\mathit{ely}}} {\mathit{PPOW}_{r,\mathit{ely}}}
   \right)^{\sigma^{\mathit{el}}_{r,\mathit{ely}}}
   \mathit{XS}_{r,\mathit{ely}}
\end{equation}

\begin{equation}
\label{eq:PSELY}
\mathit{PS}_{r,\mathit{ely}} =
   \left[
      \alpha^{\mathit{s}}_{r,\mathit{etd},\mathit{ely}}
      \left( \mathit{PP}_{r,\mathit{etd}, \mathit{ely}}
      \right)^{1-\sigma^{\mathit{el}}_{r,\mathit{ely}}}
   +  \alpha^{\mathit{pow}}_{r,\mathit{ely}}
      \left( \mathit{PPOW}_{r,\mathit{ely}}
      \right)^{1-\sigma^{\mathit{el}}_{r,\mathit{ely}}}
   \right]^{1/(1-\sigma^{\mathit{el}}_{r,\mathit{ely}})}
\end{equation}

The following stage decomposes aggregate demand for power into a user-determined
number of power bundles---indexed by $\mathit{pb}$. Equation~(\ref{eq:XPB})
determines the demand for the power bundles. Notice that the aggregate price
used in the expression is $\mathit{PPOWN}$ and not $\mathit{PPOW}$. The latter
is the aggregate, or average price of the power bundle. The former is a price
index that is defined in equation~(\ref{eq:PPOWNDX}). In the standard CES, the
two price concepts are identical. The power decomposition uses the so-called
adjusted CES, which preserves the additivity of the CES components (see
Appendix~\ref{chap:CESAppendix}). The demand expressions in both versions of the
CES are similar. However, the expresssion for the aggregate price index differs
and the price index is not equal to the average price (as calculated using the
zero profit condition). Thus, equation~(\ref{eq:PPOW}) is added that evaluates
the average price, $\mathit{PPOW}$.

[17-MAR-2020] Control of targeted power bundles has been added
using so-called \emph{phantom} taxes. See Section \ref{sec:SpcMod}
for a description of this model feature.

\begin{equation}
\label{eq:XPB}
\mathit{XPB}_{r,\mathit{pb},\mathit{ely}} =
   \alpha^{\mathit{pb}}_{r,\mathit{pb},\mathit{ely}}
   \left( \lambda^{\mathit{pow}}_{r,\mathit{pb},\mathit{ely}}
   \right)^{-\sigma^{\mathit{pow}}_{r,\mathit{ely}}}
   \left( \frac {\mathit{PPOWN}_{r,\mathit{ely}}}
      {\mathit{PPB}_{r,\mathit{pb},\mathit{ely}}}
   \right)^{\sigma^{\mathit{pow}}_{r,\mathit{ely}}}
   \mathit{XPOW}_{r,\mathit{ely}}
\end{equation}

\begin{equation}
\label{eq:PPOWNDX}
\mathit{PPOWN}_{r,\mathit{ely}} =
   \left[
      \sum_{\mathit{pb}}{
         \alpha^{\mathit{pb}}_{r,\mathit{pb},\mathit{ely}}
         \left( {{\lambda^{\mathit{pow}}_{r,\mathit{pb},\mathit{ely}}}
            \mathit{PPB}_{r,\mathit{pb},\mathit{ely}}}
         \right)^{-\sigma^{\mathit{pow}}_{r,\mathit{ely}}}
      }
   \right]^{-1/\sigma^{\mathit{pow}}_{r,\mathit{ely}}}
\end{equation}

\begin{equation}
\label{eq:PPOW}
\mathit{PPOW}_{r,\mathit{ely}} \mathit{XPOW}_{r,\mathit{ely}} =
   \sum_{\mathit{pb}}{
      \mathit{PPB}_{r,\mathit{pb},\mathit{ely}}
      \mathit{XPB}_{r,\mathit{pb},\mathit{ely}}
   }
\end{equation}

The subsequent nest decomposes the various power bundles into component
power activities. Each power activity is mapped to one of the aggregate power
bundles. Equation~(\ref{eq:XELY}) determines the demand for power generated by
power activity $\mathit{elya}$ that is mapped to power bundle $\mathit{pb}$.
Equations~(\ref{eq:PPBN}) and~(\ref{eq:PPB}) determine respectively the price
index for the power bundle $\mathit{pb}$, as derived from the adjusted CES price
index expression, and the average price of the power bundle $\mathit{pb}$ using
the zero profit condition.

\begin{equation}
\label{eq:XELY}
\begin{array}{*{20}{l}}
   \mathit{X}_{r,\mathit{elya},\mathit{ely}} =
      \displaystyle \alpha^s_{r,\mathit{elya},\mathit{ely}}
      \left( \frac {\mathit{PPBN}_{r,\mathit{pb},\mathit{ely}}}
         {\lambda^{\mathit{pb}}_{r,\mathit{elya},\mathit{ely}}
            \mathit{PP}_{r,\mathit{elya},\mathit{ely}}}
      \right)^{\sigma^{\mathit{pb}}_{r,\mathit{pb},\mathit{ely}}}
      \mathit{XPB}_{r,\mathit{pb},\mathit{ely}}
   & \textrm{if } \mathit{elya} \in \mathit{pb}
\end{array}
\end{equation}

\begin{equation}
\label{eq:PPBN}
\mathit{PPBN}_{r,\mathit{pb},\mathit{ely}} =
   \left[ \sum_{\mathit{elya} \in \mathit{pb}} {
      \alpha^s_{r,\mathit{elya},\mathit{ely}}
      \left( \lambda^{\mathit{pb}}_{r,\mathit{elya},\mathit{ely}}
         \mathit{PP}_{r,\mathit{elya},\mathit{ely}}
      \right)^{-\sigma^{\mathit{pb}}_{r,\mathit{pb},\mathit{ely}}}}
   \right]^{-1/\sigma^{\mathit{pb}}_{r,\mathit{pb},\mathit{ely}}}
\end{equation}

\begin{equation}
\label{eq:PPB}
\mathit{PPB}_{r,\mathit{pb},\mathit{ely}}
      \mathit{XPB}_{r,\mathit{pb},\mathit{ely}} =
   \sum_{\mathit{elya} \in \mathit{pb}} {
      \mathit{PP}_{r,\mathit{elya},\mathit{ely}}
         \mathit{X}_{r,\mathit{elya},\mathit{ely}}
   }
\end{equation}

\section{Income block}
\renewcommand{\theequation}{{Y-}\arabic{equation}}
\setcounter{equation}{0}
\label{sec:income}

There are three domestic final demand agents---households ($h$), an aggregate
government sector ($\mathit{gov}$) and an aggregate investment sector
($\mathit{inv}$). All factor income, net of taxes, accrues to the private
household, government revenues are generated by the various indirect taxes in
the economy as well as direct taxes, and investment income is equated to the sum
of domestic and foreign savings. A portion of capital income flows to a 'global'
holder of equity that then portions out profits from the global fund.
Remittances are also incorporated and are fully bilateral.

\subsection{Region-wide accounts}

The depreciation allowance is calculated as the replacement cost of the
estimated depreciation, equation~\ref{eq:depry}. The parameter $\delta^f$ is
allowed to differ from the physical rate of depreciation, $\delta$, though in
most cases it will be identical. The variable $\mathit{PFD_{inv}}$ is the unit
cost of investment and $\mathit{K^s}$ is the non-normalized level of the
aggregate capital stock. The normalized level of the capital stock, further
described below, is scaled to the initial aggregate remuneration of capital,
i.e. it's price in the base year is 1. The non-normalized level is needed for
calculating the depreciation allowance and in the dynamic equation for updating
the aggregate capital stock.

\begin{equation}
\label{eq:depry}
\mathit{DeprY_r} = \delta^f_r \mathit{PFD}_{r,inv} \mathit{K}^s_r
\end{equation}

The income variable $\mathit{ntmY}$ represents the total income
generated by the \emph{ad valorem} equivalent (AVE) of non-tariff measures (NTMs).
The latter is measured by the trade instrument $\tau^{\mathit{ntm}}$, which
is an additive component to the standard bilateral tariff. Equation~\ref{eq:ntmY}
defines the total NTM income---that can be distributed to both domestic
and foreign agents.\footnote{[NEW: 4-OCT-2018] The MRIO version of the model has not
yet been modified to handle NTMs.} The standard GTAP database does not
incorporate NTMs. These have been introduced using a version of Altertax (\cite{MalcolmGTAPTP12}) using
AVE estimates from \cite{Keeetal2009EconJ}.

\begin{equation}
\label{eq:ntmY}
\mathit{ntmY}_r =
\begin{cases}
   \sum_\mathit{s} {\sum_i{
      \tau^{\mathit{ntm}}_{s,i,r}  \mathit{PWM}_{s,i,r}
         \lambda^w_{s,i,r} \lambda^x_{s,i,r}\mathit{XW}_{s,i,r}
   }}
   & \textrm{if default specification} \\
   \sum_\mathit{s} {\sum_i{ \sum_{\mathit{aa}} {
      \tau^{\mathit{ntma}}_{s,i,r,\mathit{aa}} \mathit{PWM}_{s,i,r}
         \mathit{XW}^a_{s,i,r,\mathit{aa}}
   }}}
   & \textrm{if MRIO specification} \\
\end{cases}
\end{equation}

The model incorporates some level of international income flow from profits. A
portion of each region's profits (net of taxes) flows to a global equity fund
that disburses its aggregate income across regions. Equation~\ref{eq:yqtf}
represents the flow of a region's profits net of taxes, $\mathit{YQTF}$, to the
global equity fund. Total income for the global equity fund, $\mathit{TrustY}$,
is provided by equation~\ref{eq:trustY}. Foreign profit inflows,
$\mathit{YQHT}$, are represented by equation~\ref{eq:yqht}.
Equation~\ref{eq:remit} determines remittances from country $r$ to country $s$
for labor of skill $l$.\footnote{In the GMig model, remittances are linked to
the labor income of migrants by region of origin, i.e. $s$. Herein, the
remittances are linked to the entire wage bill (by skill), not the wage bill of
migrants from region $s$.} Remittances are calculated relative to after tax
labor income.

\begin{equation}
\label{eq:yqtf}
\mathit{YQTF}_r =
   \chi^f_r  \sum_a {
      \left( 1 - \kappa^f_{r,\mathit{cap},a} \right)
      \mathit{PF}_{r,\mathit{cap},a} \mathit{XF}_{r,\mathit{cap},a}
   }
\end{equation}

\begin{equation}
\label{eq:trustY}
\mathit{TrustY} = \sum_r {\mathit{YQTF}_r}
\end{equation}

\begin{equation}
\label{eq:yqht}
\mathit{YQHT}_r = \chi^h_r \mathit{TrustY}
\end{equation}

\begin{equation}
\label{eq:remit}
\mathit{Remit}_{s,l,r} =
   \chi^r_{s,l,r} \sum_a{
      \left( 1 - \kappa^f_{r,l,a} \right) \mathit{PF}_{r,l,a}
         \mathit{XF}_{r,l,a}
   }
\end{equation}

The model incorporates government to government transfers.\footnote{This
feature was added 21-Apr-2018.} These
have been labeled as Official Development Assistance (ODA), but in
fact cover a fairly broad range of inter-government transfers.
Equation~(\ref{eq:ODAOut}) determines outward ODA. The basic
assumption is that outward ODA grows at the same rate as GDP,
where the parameter $\chi^{OO}$ represents the initial outward ODA to GDP ratio.
The equation allows for the ratio to increase with the growth in per capita
income, where $\eta^{\mathit{ODA}}$ represents the elasticity of ODA relative to GDP
with respect to per capita income growth.\footnote{The default value is 0.}
Equation~(\ref{eq:ODAGbl}) represents aggregate ODA, i.e. the sum of ODA
across all regions. Global ODA is allocated in fixed proportions
across all regions, i.e. Equation~(\ref{eq:ODAIn}) determines inward ODA.

\begin{equation}
\label{eq:ODAOut}
\mathit{ODAOut}_r =
   \chi^{OO}_r \mathit{GDPMP}_r \left(\frac{\mathit{RGDPpc}_r}{\mathit{RGDPpc}_{r,0}}\right)^{\eta^{\mathit{ODA}}}
\end{equation}

\begin{equation}
\label{eq:ODAGbl}
\mathit{ODAGbl} = \sum_r {\mathit{ODAOut}_r}
\end{equation}

\begin{equation}
\label{eq:ODAIn}
\mathit{ODAIn}_r = \chi^{OI}_r \mathit{ODAGbl}
\end{equation}

\subsection{Household income and savings}

Equation~(\ref{eq:yh}) describes household income, $\mathit{YH}$. It is the sum
across all activities of factor income, at market prices and net of taxes and
depreciation. Household income also includes net foreign capital income, net
remittances and some portion of NTM-related income from all modeled
regions.\footnote{[NEW: 4-OCT-2018] The relevant revenue
shares related to NTM income must add to 1.} Factor returns at the price producers pay have a superscript $p$,
which is absent from the factor returns at market prices. Equation~(\ref{eq:yd})
describes disposable income, $\mathit{YD}$, where $\kappa^h$ is the marginal
(and average) rate of tax on household income. Macro closure is discussed below.

\begin{equation}
\label{eq:yh}
\begin{array}{*{20}{l}}
\mathit{YH_{r}} & = &
   \displaystyle \sum_f {\sum_a{
      \left(1 - \kappa^f_{r,f,a}\right) \mathit{PF}_{r,f,a} \mathit{XF}_{r,f,a}
   }}
     + \mathit{YQHT}_r - \mathit{YQTF}_r \\
{} & + & \displaystyle
         \sum_d{\sum_l{\mathit{Remit}_{r,l,d}}}
     -   \sum_s{\sum_l{\mathit{Remit}_{s,l,r}}}  - \mathit{DeprY_r}
     + \sum_s{\chi^{\mathit{hNTM}}_{s,r}\mathit{ntmY_s}} \\
\end{array}
\end{equation}

\begin{equation}
\label{eq:yd}
\mathit{YD_{r}} = \left( 1 - \kappa^h_r \right) \mathit{YH_{r}}
\end{equation}

Household savings is treated differently across the demand systems. In the case
of the ELES, savings is incorporated in the utility function. In the case of the
other demand systems, a separate assumption is made about the savings propensity
and savings is subtracted from disposable income with the residual allocated to
consumer goods.

Equation~(\ref{eq:savh}) determines savings for all utility function with the
exception of the ELES. Savings is simply a proportion of household disposable
income.

[17-MAR-2020] Equation~(\ref{eq:aps}) determines the savings rate, $\mathit{aps}$.
It is equal to a shifter, $\chi^s$, which is set to 1 initially
and can also reflect changes in the rate of return. By default,
the savings rate elasticity is equal to zero.
Depending on closure, the variable $\chi^s$ can be endogenous to target some other objective,
for example, the level of investment relative to GDP. In other closures, it
could be exogenous, in which case investment is savings driven.
The equation is not active in the case of
the ELES, since savings is determined simultaneously with
consumption. In the case of the ELES, equation~(\ref{eq:savhELES}) determines
household savings as the difference between disposable income and total
expenditures on goods and services.\footnote{To target investment, in the case
of the ELES it is possible to target a given level of investment (as a share of
GDP for example) and to endogenize the $\beta^c$ parameter that in effect will
find a level of savings consistent with targeted investment.} In the case of the
other demand systems, the equation is dropped.

\begin{equation}
\label{eq:savh}
S^h_{r,h} = \mathit{aps}_r \mathit{YD}_{r}
\end{equation}

\begin{equation}
\label{eq:aps}
\mathit{aps}_r = \chi^s_r \left(
\frac{\mathit{TR}_{r,t} / \mathit{TR}_{r,t-1}} {\mathit{PGDP}_r}
\right)^{\eta^s_r}
\end{equation}

\begin{equation}
\label{eq:savhELES}
S^h_{r,h} = \mathit{YD}_r - \sum_k{ \mathit{PC}_{r,k,h} \mathit{XC}_{r,k,h} }
\end{equation}

[17-Mar-2020] Finally, equation~(\ref{eq:yc}) determines household expenditures on
goods and services, i.e. disposable income net of savings.

\begin{equation}
\label{eq:yc}
\mathit{YC}_{r,h} = \mathit{YD}_{r} - S^h_{r,h}
\end{equation}

\subsection{Government revenues}

The next set of equations describe government revenues, contained in the
variable $\mathit{YGOV}$, which has an additional index for the different
revenue streams ($\mathit{gy}$). Equation~(\ref{eq:ygovptx}) describes revenues
from production and cost taxes. The production tax is applied on commodity $i$
produced by activity $a$.The revenue index is given by $\mathit{ptx}$.
Equation~(\ref{eq:ygovvtx}) describes revenues generated on the factors of
production---labor, capital, land and natural resources.\footnote{[17-Mar-2020] In the model code, $\tau^v$, can
be an endogenous variable used to implement alternative fiscal closures.
For example, an additive (or multiplicative) shifter can be endogenous
in order to recycle carbon tax revenues. The shifter is both
activity and factor specific.} The relevant factor
prices are the market prices, i.e. prices received by the factors themselves.
The revenue index is given by $\mathit{vtx}$.

\begin{equation}
\label{eq:ygovptx}
\mathit{YGOV}_{r,ptx} =
   \sum_a{
      \left[
         \sum_i{
            \tau^p_{r,a,i}\mathit{P}_{r,a,i} \mathit{X_{r,a,i}}
         }
      +  \sum_v{
            \tau^\mathit{uc}_{r,a,v} \mathit{UC_{r,a,v}} \mathit{XPv_{r,a,v}}
         }
      \right]
   }
\end{equation}

\begin{equation}
\label{eq:ygovvtx}
\mathit{YGOV}_{r,vtx} =
   \sum_a{
      \sum_f{
         \tau^v_{r,f,a} \mathit{PF}_{r,f,a} \mathit{XF}_{r,f,a}
      }
   }
\end{equation}

Equation~(\ref{eq:ygovitx}) describes revenues generated by consumption of
goods, essentially a sales tax. The sum is over all domestic agents (indexed by
$\mathit{aa}$). The relevant price is the market price of good~$i$. The equation
incorporates the two different Armington options. In the first case, the
sourcing of goods is made at the national (aggregate) level and thus all users
face a common Armington price, $\mathit{PAT}$, that is then adjusted by the
end-user sales tax.\footnote{Goods at this level are assumed to be additive
though allowances are made for different prices captured by the $\gamma^e$
coefficients.} The second option assumes a top level Armington sourcing by agent
in which case the domestic sales tax is differentiated by source. Sales taxes on
import consumption is based on agents' prices of imports, which is the
tariff-inclusive price of imports given by the variable $\mathit{PM}^a$. If
bilateral imports are determined at the national level, the standard model
assumption, agents' prices are uniform and represented by the variable
$\mathit{PMT}_i$, which represents the average tariff-inclusive price of
imports. In the MRIO version of the model, agents' import prices are
agent-specific and represent potentially differences in both the preference
structure and tariffs. The revenue index is given by $\mathit{itx}$.

\begin{equation}
\label{eq:ygovitx}
\mathit{YGOV}_{r,itx} =
   \left\{
      \begin{array}{*{20}{l}}
         \displaystyle \sum_\mathit{aa} {\sum_i{
            \tau^a_{r,i,aa} \gamma^{\mathit{eda}}_{r,i,\mathit{aa}}
               \mathit{PAT}_{r,i} \mathit{XA}_{r,i,aa}
         }}
         & \textrm{if } \mathit{ArmFlag} = 0 \\
         \displaystyle \sum_\mathit{aa} {\sum_i{
            \tau^{\mathit{ad}}_{r,i,aa} \gamma^{\mathit{edd}}_{r,i,\mathit{aa}}
               \mathit{PDT}_{r,i} \mathit{XD}_{r,i,aa}
         }} \\
         \displaystyle \qquad + {{
            \tau^{\mathit{am}}_{r,i,aa} \gamma^{\mathit{edm}}_{r,i,\mathit{aa}}
               \mathit{PM}^a_{r,i,aa} \mathit{XM}_{r,i,aa}
         }}
         & \textrm{if } \mathit{ArmFlag} \ne 0 \\
      \end{array}
   \right.
\end{equation}

Equation~(\ref{eq:ygovmtx}) describes revenues generated by import tariffs. This
equation has two versions depending on whether or not the MRIO version is
implemented. In the standard specification, tariffs are uniform across all
agents and the tax collection is done at the border relative to the aggregate
level of bilateral tariffs and summed across all source countries ($s$), where
the first regional index is always the exporting region and the second regional
index is always the destination (or importing) region. The tariffs are applied
to the border (or CIF) price of imports, $\mathit{PWM}$.\footnote{The model
allows for iceberg trade costs using the parameters $\lambda^x$ and $\lambda^w_{s,i,r}$.
The former is applied to exports and the latter to imports.
These parameters generate a
wedge between the volume exported and the volume imported. The import volume is
given by $\mathit{XW}^d$ and the export volume by $\mathit{XW}^s$. At
equilibrium, the following expression holds: $\mathit{XW}^d = \lambda^w \lambda^x
\mathit{XW}^s$ and this expression is used to substitute out $\mathit{XW}^d$.
Thus in the model implementation, the import tax revenue expression also
contains the iceberg parameters as the model only carries the variable
$\mathit{XW}$ without a superscript and it represents pre-border export supply.} In the
MRIO version, tariffs are agent specific, $\tau^\mathit{ma}$, and applied on the
variable $\mathit{XW^a}$, which represents the volume of imports by agent
$\mathit{aa}$ sourced in region $s$. It is assumed that all agents pay the same
CIF price for their imports. The revenue index is given by $\mathit{mtx}$.

\begin{equation}
\label{eq:ygovmtx}
\mathit{YGOV}_{r,mtx} =
\begin{cases}
   \sum_\mathit{s} {\sum_i{
      \tau^m_{s,i,r} \mathit{PWM}_{s,i,r}
         \lambda^w_{s,i,r} \lambda^x_{s,i,r} \mathit{XW}^d_{s,i,r}
   }}
   & \textrm{if default specification} \\
   \sum_\mathit{s} {\sum_i{ \sum_{\mathit{aa}} {
      \tau^\mathit{ma}_{s,i,r,\mathit{aa}} \mathit{PWM}_{s,i,r}
         \mathit{XW}^a_{s,i,r,\mathit{aa}}
   }}}
   & \textrm{if MRIO specification} \\
\end{cases}
\end{equation}

Equation~(\ref{eq:ygovetx}) describes revenues generated by export taxes and
subsidies. These are summed over all destination countries ($d$). They are
applied to the producer price of exports, $\mathit{PE}$. The revenue index is
given by $\mathit{etx}$.

\begin{equation}
\label{eq:ygovetx}
\mathit{YGOV}_{r,etx} =
   \sum_\mathit{d} {\sum_i{
      \tau^e_{r,i,d} \mathit{PE}_{r,i,d} \mathit{XW}^s_{r,i,d}
   }}
\end{equation}

Equation~(\ref{eq:ygovwtx}) describes revenues generated by a tax on
waste generated by household consumption.\footnote{[NEW 4-OCT-2018] The
model also includes the possibility of an excise tax on waste as
well as the \emph{ad valorem} tax.} The tax instrument is $\tau^w$ and
$\mathit{XA}^w$ represents the level of household waste. The revenue index is
given by $\mathit{wtx}$.

\begin{equation}
\label{eq:ygovwtx}
\mathit{YGOV}_{r,wtx} =
   \sum_\mathit{h} {\sum_i{
      \tau^w_{r,i,h} \mathit{PA}_{r,i,h} \mathit{XA}^w_{r,i,h}
   }}
\end{equation}

Equation~(\ref{eq:ygovctx}) describes revenues generated by carbon taxes. This
equation holds for either Armington specification. Details on the carbon tax are
described further below. The revenue index is given by $\mathit{ctx}$. Section~\ref{sec:ctaxrecycle}
describes alternatives to the standard fiscal closure that allows for targeted recycling
of carbon tax revenues.

\begin{equation}
\label{eq:ygovctx}
\mathit{YGOV}_{r,ctx} =
\left\{
   \begin{array}{*{20}{l}}
      \displaystyle \sum_{\mathit{em}} { \sum_{i} {\sum_{\mathit{aa}} {
         \chi^{\mathit{Emi}}_{\mathit{em}}
         \rho^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
         \phi^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
            \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}} \mathit{XA}_{r,i,aa}
      }}}
      & \textrm{if } \mathit{ArmFlag} = 0 \\
      \displaystyle \sum_{\mathit{em}} { \sum_{i} {\sum_{\mathit{aa}} {
         \chi^{\mathit{Emi}}_{\mathit{em}}
         \rho^{\mathit{Emi,d}}_{r,\mathit{em},i,\mathit{aa}}
         \phi^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
         \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}}
            \mathit{XD}_{r,i,aa} }}} \\
      \qquad \displaystyle
      +  {\chi^{\mathit{Emi}}_{\mathit{em}}
            \rho^{\mathit{Emi,m}}_{r,\mathit{em},i,\mathit{aa}}
            \phi^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
            \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}}\mathit{XM}_{r,i,aa}
         }
      & \textrm{if } \mathit{ArmFlag} \ne 0 \\
\end{array}
\right.
\end{equation}

Finally, direct taxes are described in equation~(\ref{eq:ygovdtx}), where the
revenue index is given by $\mathit{dtx}$. Direct taxes are imposed on specific
factor incomes and there is a net direct tax (that can be negative) on total
household income after factor taxes that balances the government account (for a
given deficit level).

\begin{equation}
\label{eq:ygovdtx}
\mathit{YGOV}_{r,dtx} =
   \sum_f {  \sum_a{
      \kappa^f_{r,f,a} \mathit{PF}_{r,f,a} \mathit{XF}_{r,f,a}
   }}
   + \kappa^h_r \mathit{YH}_r
\end{equation}

\subsection{Investment/savings balance}

Equation~(\ref{eq:yfdinv}) describes the financing of gross investment. The
variable $\mathit{YFD}$ represents final demand expenditures, in value terms,
for the final demand agents, indexed by $\mathit{fd}$ that takes on values of
$\mathit{h}$, $\mathit{gov}$ and $\mathit{inv}$ respectively for households,
government and investment.\footnote{With the introduction of the R \& D module, it will also include $r\_d$ for R \& D expenditures.} Gross investment is equated to the sum of all
savings, domestic from households ($\mathit{S^h}$) and government
($\mathit{S^g}$), and foreign ($\mathit{S^f}$), where the latter is evaluated
using a global price index, $\mathit{PW^{sav}}$, and the depreciation allowance.
Macro closure defines what variable this equation determines. In the default
closure, investment is savings driven and therefore this equation determines the
nominal level of investment. If investment is fixed, then this equation could
determine either household or public savings. Macro closure is further discussed
below. This equation is defined for all regions, but one should be
dropped due to Walras' Law. In fact, the equation includes an
additive shifter labeled $\mathit{Walras}$, that is added to
the equation for a residual region. It should evaluate to
zero.\footnote{In the model implementation, the residual region is a
subset of $r$ and is designated as \texttt{rres}.}

\begin{equation}
\label{eq:yfdinv}
\mathit{YFD}_{r,inv} = S^h_r + S^g_r
   + \mathit{PW}^{\mathit{sav}} S^f_r + \mathit{DeprY_r}
\end{equation}

\section{Final demand}
\renewcommand{\theequation}{{D-}\arabic{equation}}
\setcounter{equation}{0}

\subsection{Household demand}

The commodity space for household demand has a different classification than the
product commodity space (indexed by $i$). Household demand for commodities is
indexed by $k$. A transition matrix approach is used to convert the household
commodities into the produced commodities.\footnote{The consumer demand
transition matrix approach was utilized in the OECD GREEN model, see
\cite{Burniauxetal1992} and \cite{GREENDvdM1994}. See also
\cite{Cardeneteetal2012}, section 5.3, for a more recent description of the
approach in GE modeling.} In value terms, the transition matrix is an
$i \times k$ matrix. The sum across the columns equals the value of consumption
for commodity $i$ and must line up with the values from the consumer demand
vector of the SAM. The sum down the columns equals the value of consumption of
commodity $k$. Table~\ref{tab:TransMat} provides and example from the GREEN
database.\footnote{The data is from the GREEN model database and represents the
transition matrix for the USA in \$1985 million at the Armington level of
aggregation.}

\begin{table}[H]
\caption{Example of a consumer transition matrix}
\label{tab:TransMat}
\begin{center}
\rowcolors{2}{TableOdd}{TableEven}
\rowcolors{1}{}{lightblue}
\footnotesize
\begin{tabular} {l D..{5.1} D..{5.1} D..{5.1} D..{5.1} D..{5.1}}
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
{} & \multicolumn{1} { c }{Food\&Bev}  & \multicolumn{1} { c }{Energy} & \multicolumn{1}{ c }{Trp\&Comm}
& \multicolumn{1} { c }{Other}	& \multicolumn{1}{ c }{Total} \\
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
Agric & 15.9 & 0.1 & 0.0 & 5.2 & 21.3 \\
Coal & 0.0 & 0.3 & 0.0 & 0.0 & 0.3 \\
Oil & 0.0 & 0.0 & 0.0 & 0.0 & 0.0 \\
Gas & 0.0 & 12.8 & 0.0 & 0.0 & 12.8 \\
Energy int manu & 0.0 & 0.0 & 0.1 & 50.8 & 50.9 \\
Refined oil & 0.0 & 17.5 & 50.0 & 0.0 & 67.5 \\
Electricity & 0.0 & 73.1 & 0.0 & 22.9 & 96.0 \\
Other & 347.9 & 0.1 & 366.2 & 1,644.0 & 2,358.3 \\
Total & 363.9 & 103.8 & 416.3 & 1,723.0 & 2,607.0 \\
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
\end{tabular}
\end{center}
\end{table}

There are several advantages to the transition matrix approach.

\begin{enumerate}
   \item Potentially, it provides a more accurate picture of consumer demand.
         For example, it is possible to connect different energy bundles with
         different sources of demand. The demand for transport is likely to
         be dominated by liquid fuels, whereas the demand for energy in
         households is likely to be a mix of electricity, gas and coal.
   \item It is likely to provide a better link with household surveys.
   \item It may be easier to generate more plausible demand behavior. For
         example, in the standard LES demand system, a rise in the price of
         energy (due to a carbon tax for example) will normally lead to a rise
         in demand for automobiles. If fuel and cars are bundled in a transport
         bundle, the carbon tax will lead to a drop in the demand for the
         transport bundle and thus also a drop in the demand for cars.
\end{enumerate}

With the original GTAP database, the transition matrix approach is largely
limited to mapping specific supplied commodities to consumer commodities. At a
minimum there would be a one-to-one mapping of all non-energy commodities, i.e.
a diagonal transition matrix for the non-energy commodities, and all energy
commodities mapped to a single energy consumer good.\footnote{The user provides
the relevant mappings between the GTAP goods (after aggregation) and the
user-defined consumer goods. This mapping is part of the bridge file used by the
aggregation facility.} However, with appropriate mapping it is possible to limit
the number of consumer goods. For example, the user can map the GTAP commodities
\texttt{tex}, \texttt{wap} and \texttt{lea} to a single 'clothing' consumer good
and yet retain the production of all three commodities individually. In a
similar vein, certain agriculture and food products can be aggregated together
for the purposes of the top level consumer utility function, yet continue to be
produced individually. The consumer demand nesting is then used to decompose the
aggregate demand, for example for food or clothing, into their components.

The consumer demand system is thus implemented as a nested structure that starts
with disposable income, see figure~\ref{fig:ConsNest}. A top nest allocates
disposable income between savings and consumer commodities (indexed by $k$).
Each commodity $k$ is decomposed into demand for the various product commodities
(indexed by $i$) using a series of nested CES functions. The top CES nest
decomposes demand for commodity $k$ into a non-energy aggregate bundle and an
energy bundle. The former is decomposed into demand for non-energy Armington
goods with a single nest (and added across all consumer goods $k$). The latter
is decomposed using the same energy nesting as in production with energy demand
similarly aggregated across all consumer goods $k$ to generate total energy
demand by carrier by households.

\begin{figure}[H]
\center
\begin{forest}
for tree={
   minimum height=1cm,
   font=\scriptsize,
%  font=\sffamily,
   anchor=north,
   align=center,
   child anchor=north,
   s sep=1em,
   l sep=0.75cm
},
%where n children=0{tier=word}{}
[{Disposable income ($\mathit{YD}$)}, draw, drop shadow, fill=dkBlue, rounded corners=2pt, name=YD
   [{Private savings ($\mathit{S^h}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt, name=SAVH]
   [][{Demand for consumer goods ($\mathit{XC_k}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XC
        [{Demand for aggregate \\ non-energy bundle ($\mathit{XC}^{\mathit{nnrg}}_{k}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XCNNRG
           [][{Household demand for \\non-energy Armington goods ($\mathit{XA}_{i,h}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt][]
        ]
        [{Demand for aggregate \\ energy bundle ($\mathit{XC}^{\mathit{nrg}}_{k}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XCNRG
           [{See Figure {\ref{fig:XCNRGNest}}}, draw, ellipse,fill=lightgray]
        ]
     ][]
   []
]
\node[anchor=west,align=left]
  at ([yshift=-0.30cm,xshift=-1.20cm]YD.south) {\tiny {(E)LES/CDE}};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.15cm]XC.south) {\scriptsize $\nu^\mathit{c}$};
\node[anchor=west,align=left]
  at ([yshift=-0.30cm,xshift=-0.05cm]XCNNRG.south) {\scriptsize $\nu^\mathit{nnrg}$};
\end{forest}
\caption{{Consumer demand nest}}
\label{fig:ConsNest}
\end{figure}

The latest version of the \textsc{Envisage} Model has four possible top-level
consumer demand utility functions. Each can determine household demand for goods
and services (at the level of consumer goods, i.e. indexed by $k$). Three are in
a class of models linked to the oft-used linear expenditure system (LES)---one
of which, the ELES, integrates the savings decision in the utility function. The
fourth utility function is the \emph{constant differences in elasticity} (CDE)
utility function---widely popularized in the {GTAP} model and its
variants.\footnote{See \cite{Hertel1997} and \cite{CorongetalJGEA2017}.}

\subsubsection{The Linear Expenditure System and its offshoots}

This section describes use of the linear expenditure system (LES) and two of its
offshoots. The first offshoot is the extended linear expenditure system (ELES)
developed by \cite{Lluch1973} and \cite{Howe1975}. The ELES integrates the
savings decision into top level utility, i.e. the savings decision is handled
with demand for the other goods and services. The second offshoot is the
so-called "An Implicitly Direct Additive Demand System", or AIDADS, that leaves
the possibility of non-linear Engel curves, unlike the
LES---see \cite{RimmerPowell1992B} and \cite{RimmerPowell1996}. All three demand
systems share the same underlying specification with some deviations.

Under the LES-type demand system, household demand is the sum of two
components---the so-called subsistence minimum, or floor consumption, and a
marginal share of supernumerary income. The latter is equal to income less
expenditures on the subsistence minima. Equation~(\ref{eq:supy}) defines
supernumerary income on a per capita basis,
$\mathit{Y^{sup}}$.\footnote{The consumer demand system is written to allow for
multiple households. However, at the moment, disposable income and population
are only provided at an aggregate level. To convert the model to multiple
households would require the development of a more complete income distribution
specification.} The first term is per capita income. In the case of the
ELES, it is disposable income. In the case of the LES and AIDADS, it is
disposable income less savings. The second term is the total amount spent on the
subsistence minima where $\gamma$ represents the per capita subsistence minimum
and expenditures are evaluated at consumer prices, all taxes included,
$\mathit{PC}$. Equation~(\ref{eq:xcELES}) determines consumer demand for good
$k$, where $\mu^c$ represents the marginal budget share. Utility and parameters
of the LES are defined in per capita terms. Hence, per capita demand is
multiplied by population to get aggregate household demand.
Equation~(\ref{eq:uELES}) defines the utility level for the LES-type demand
specification. In the case of the ELES, the variable $P^{\mathit{sav}}$
represents the perceived 'price' of savings. Given the overall myopic
expectations, it is equated to the consumer price index as it represents future
claims on consumption. The parameter $\mu^s$ represents the marginal propensity
to save out of disposable income.

\begin{equation}
\label{eq:supy}
\mathit{Y}^{\mathit{sup}}_{r,h} =
\left\{
   \begin{array}{l l}
      \displaystyle \frac{\mathit{YD}_r} {\mathit{Pop}_r}
         - \sum_k {\mathit{PC}_{r,k,h} \gamma_{r,k,h}}
   & \textrm{if ELES} \\
      \displaystyle \frac{\mathit{YC}_r}
         {\mathit{Pop}_r} - \sum_k{\mathit{PC}_{r,k,h} \gamma_{r,k,h}}
   &  \textrm{if LES or AIDADS} \\
   \end{array}
\right.
\end{equation}

\begin{equation}
\label{eq:xcELES}
\mathit{XC}_{r,k,h} =
   \mathit{Pop}_r \left(
      \gamma_{r,k,h} + \frac{\beta^c_{r,h} \mu^c_{r,k,h}}
         {\mathit{PC}_{r,k,h}} \mathit{Y}^{sup}_{r,h}
   \right)
\end{equation}

\begin{equation}
\label{eq:uELES}
u_{r,h} =
   \left\{
      \begin{array}{l l}
         \frac {\displaystyle \mathit{Y}^{\mathit{sup}}_{r,h}}
            {\displaystyle{ \left(\frac{P^{\mathit{sav}}_{r,h}}{\mu^s_{r,h}}
               \right)^{\mu^s_{r,h}}}
               \prod_k{
                  \left(
                     \frac{\mathit{PC}_{r,k,h}} {\beta^c_{r,h}\mu^c_{r,k}}
                  \right)^{\beta^c_{r,h}\mu^c_{r,k}
               }
            }}
         & \textrm{if ELES} \\
         \displaystyle -1 - \ln{\left(\mathit{A}^{\mathit{ad}}_{r,h}\right)}
            +  \sum_k{ \mu^c_{r,k,h}
            \ln{\left[\frac{\mathit{XC}_{r,k,h}}{\mathit{Pop}_r}
            - \gamma_{r,k,h}\right]}}
         &  \textrm{if LES or AIDADS} \\
      \end{array}
   \right.
\end{equation}

The key difference between AIDADS and the standard LES is that the marginal
budget share parameter, $\mu^c$, is a function of utility in the case of AIDADS,
but is constant in the case of the LES. This allows for non-linear Engel curves
as income expands. Equation~(\ref{eq:mucAIDADS}) defines the marginal budget
share specification. With $\alpha^{\mathit{ad}}$ equal to $\beta^{\mathit{ad}}$,
the function reverts back to the LES with constant marginal budget shares.

\begin{equation}
\label{eq:mucAIDADS}
\mu^c_{r,k,h} =
   \frac {\alpha^{\mathit{ad}}_{r,k,h}
            + \beta^{\mathit{ad}}_{r,k,h} e^{{u_{r,h}}}}
         {1 + e^{{u_{r,h}}}}
\end{equation}

\subsubsection{The Constant Differences in Elasticity demand system}

The CDE demand system is composed of four equations. The first equation,
(\ref{eq:zcCDE}), evaluates an auxiliary variable, $\mathit{ZC}$, that is used in
subsequent formulas and allows for some simplification in implementation of the
CDE. The $e^h$ parameters are referred to as the
expansion parameters and are closely linked to the income elasticies (see
Appendix~\ref{chap:DemandAppendix}). The $b^h$ parameters are referred to as the
substitution parameters and are linked to the price elasticities. The variable
$u$ is the utility level and is required for the CDE demand system. The
$\alpha^h$ parameters are calibrated shifters. Equation~(\ref{eq:xcCDE})
determines the budget shares for the CDE. Equation~(\ref{eq:uCDE}) implicitly
determines utility that is required to calculate the budget shares. And
equation~(\ref{eq:sh}) is used to back out consumption levels using the budget
shares. Note that equation~(\ref{eq:sh}) is also used in the LES-type demand
systems to calculate the budget shares---though these are not strictly
needed.\footnote{Note that the budget shares reflect the shares net of savings.
In the case of the ELES, the shares needed for calibration are relative to
disposable income, i.e. inclusive of savings.}

\begin{equation}
\label{eq:zcCDE}
\mathit{ZC}_{r,k,h} =
   \alpha^h_{r,k,h} b^h_{r,k,h} u_{r,h}^{e^h_{r,k,h} b^h_{r,k,h}}
   {\left(
      \frac{\mathit{PC}_{r,k,h}} {\mathit{YC}_{r}/\mathit{Pop}_r}
    \right)}^{b^h_{r,k,h}
   }
\end{equation}

\begin{equation}
\label{eq:xcCDE}
s^h_{r,k,h} =
   \frac{\mathit{ZC}_{r,k,h}} {\displaystyle \sum_{k'}{\mathit{ZC}_{r,k',h}}}
\end{equation}

\begin{equation}
\label{eq:uCDE}
\sum_{k} {\frac {\mathit{ZC}_{r,k,h}}{b^h_{r,k,h}}} \equiv 1
\end{equation}

\begin{equation}
\label{eq:sh}
s^h_{r,k,h} =
   \frac{\mathit{PC}_{r,k,h} \mathit{XC}_{r,k,h}} {\mathit{YC_{r}}}
\end{equation}

\subsubsection{Conversion of consumer goods to producer goods}

The subsequent nests decompose consumer demand $\mathit{XC}$ into Armington
demand and the latter are summed across all consumer categories $k$. The first
nest allocates $\mathit{XC}$ between a non-energy bundle and an energy bundle.
Equations~(\ref{eq:xcnnrg}) and~(\ref{eq:xcnrg}) describe respectively the
demand for the aggregate non-energy and energy bundles,
$\mathit{XC}^{\mathit{nnrg}}$ and $\mathit{XC}^{\mathit{nng}}$, with a
substitution elasticity given by $\nu^c$. Energy demand
can be impacted by changes in energy efficiency captured
by the parameter $\lambda^{c,\mathit{nrg}}$. Equation~(\ref{eq:pc}) represents the
price of the consumer good defined by index $k$, $\mathit{PC}$.

\begin{equation}
\label{eq:xcnnrg}
\mathit{XC}^{\mathit{nnrg}}_{r,k,h} =
   \alpha^{\mathit{cnnrg}}_{r,k,h}
   \left(
      \frac{ \mathit{PC}_{r,k,h}} {\mathit{PC}^{\mathit{nnrg}}_{r,k,h}}
   \right)^{\nu^c_{r,k,h}}
   \mathit{XC}_{r,k,h}
\end{equation}

\begin{equation}
\label{eq:xcnrg}
\mathit{XC}^{\mathit{nrg}}_{r,k,h} =
   \alpha^{\mathit{cnrg}}_{r,k,h}
   \left(\lambda^{c,\mathit{nrg}}_{r,k,h} \right)^{\nu^c_{r,k,h}-1}
   \left(
      \frac{\mathit{PC}_{r,k,h}} {\mathit{PC}^{\mathit{nrg}}_{r,k,h}}
   \right)^{\nu^c_{r,k,h}}
   \mathit{XC}_{r,k,h}
\end{equation}

\begin{equation}
\label{eq:pc}
\mathit{PC}_{r,k,h} =
   \left[
      \alpha^{\mathit{cnnrg}}_{r,k,h}
      \left( {\mathit{PC}^{\mathit{nnrg}}_{r,k,h}}
      \right)^{1-\nu^c_{r,k,h}}
   +  \alpha^{\mathit{cnrg}}_{r,k,h}
      \left( \displaystyle \frac{\mathit{PC}^{\mathit{nrg}}_{r,k,h}} {\lambda^{c,\mathit{nrg}}_{r,k,h}}
      \right)^{1-\nu^c_{r,k,h}}
   \right]^{1/(1-\nu^c_{r,k,h})}
\end{equation}

Aggregate non-energy demand is decomposed next into Armington demand and summed
across all consumer goods. Equation~(\ref{eq:xacnnrg}) represents demand for
non-energy Armington goods by private households, where the across-goods
substitution is given by $\nu^{\mathit{nnrg}}$.\footnote{The index $\mathit{in}$
covers the non-energy commodities and is a subset of $i$.} The price of the
non-energy demand bundle is given by equation~(\ref{eq:pcnnrg}).\footnote{[NEW: 4-OCT-2018] Consumer prices are now represented by the variable $\mathit{PA}^h$
instead of $\mathit{PA}^a$. The difference between the two prices reflects the
introduction of a waste tax.}

\begin{equation}
\label{eq:xacnnrg}
\mathit{XA}_{r,\mathit{in},h} =
   \sum_k{
      \left[
         \alpha^{\mathit{c}}_{r,\mathit{in},k,h}
         \left( \frac {\mathit{PC}^{\mathit{nnrg}}_{r,k,h}}
            {\mathit{PA}^{h}_{r,\mathit{in},h}}
         \right)^{\nu^{\mathit{nnrg}}_{r,k,h}}
         \mathit{XC}^{\mathit{nnrg}}_{r,k,h}
      \right]
   }
\end{equation}

\begin{equation}
\label{eq:pcnnrg}
\mathit{PC}^{\mathit{nnrg}}_{r,k,h} =
   \left[
      \sum_{\mathit{in}}{
         \alpha^{\mathit{c}}_{r,\mathit{in},k,h}
         \left( {\mathit{PA}^{h}_{r,\mathit{in},h}}
         \right)^{1-\nu^{\mathit{nnrg}}_{r,k,h}}
      }
   \right]^{1/(1-\nu^{\mathit{nnrg}}_{r,k,h})}
\end{equation}

The decomposition of the energy bundle is similar to the energy nest in
production, see figure~\ref{fig:XCNRGNest}. The energy bundle is first
decomposed into electric and non-electric bundles. The latter is then decomposed
into a coal bundle and a non-coal bundle (or the oil \& gas bundle).
The oil \& gas bundle is then split into a gas bundle and an oil bundle. The
four remaining bundles---electric, coal, oil and gas---represent a combination
of existing or future energy sources. In the case of the original GTAP database,
the electric bundle would hold the 'ely' commodity, the coal bundle would hold
the 'coa' commodity, the oil bundle would hold the 'oil' and 'p\_c' commodities
and the gas bundle would hold the 'gas' and 'gdt' commodities. Non-GTAP
commodities would be mapped to one of the existing bundles. For example, 'p\_c'
could be split into gasoline and diesel, and/or could include ethanol or
bio-diesel. Similar to the energy nesting in production, the decomposition
of energy demand has two possible specifications: the normal CES and the
additive version of the CES. In the case of the latter, the model specification
requires both the composite price index as well as the average price.

\begin{figure}[H]
\center
\begin{forest}
for tree={
   minimum height=1cm,
   font=\tiny,
%  font=\sffamily,
   anchor=north,
   align=center,
   child anchor=north,
   s sep=1em,
   l sep=0.75cm,
},
%where n children=0{tier=word}{}
[{Energy\\bundle ($\mathit{XC}^{\mathit{nrg}}$)}, draw, drop shadow, fill=dkBlue, rounded corners=2pt, name=NRG
   [{{Electricity} \\ {bundle ($\mathit{ELY}$)}}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=ELY, l*=4.28
%   [{{Electricity} \\ {bundle ($\mathit{ELY}$)}}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=ELY
      [][{Armington\\demand ($\mathit{XA_{ely}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
   ]
   [{Non-electric\\bundle ($\mathit{NELY}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=NELY
      [{{Oil \& Gas}\\bundle ($\mathit{OLG}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=OLG
         [{Gas\\bundle ($\mathit{GAS}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=GAS
            [][{Armington\\demand ($\mathit{XA_{gas}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
         ]
         [{Oil\\bundle ($\mathit{OIL}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=OIL
            [][{Armington\\demand ($\mathit{XA_{oil}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
         ]
      ]
      [{Coal\\bundle ($\mathit{COA}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=COA, l*=2.64
%      [{Coal\\bundle ($\mathit{COA}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=COA
         [][{Armington\\demand ($\mathit{XA_{coa}}$)}, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
      ]
   ]
]
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.15cm]NRG.south) {\scriptsize $\nu^e$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.45cm]NELY.south) {\scriptsize $\nu^{nely}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.25cm]OLG.south) {\scriptsize $\nu^{olg}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]ELY.south) {\scriptsize $\nu^{ely}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]GAS.south) {\scriptsize $\nu^{gas}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]OIL.south) {\scriptsize $\nu^{oil}$};
\node[anchor=west,align=left]
  at ([yshift=-0.25cm,xshift=-0.05cm]COA.south) {\scriptsize $\nu^{coa}$};
\end{forest}
\caption{{Energy bundle nest in household demand}}
\label{fig:XCNRGNest}
\end{figure}

Equation~(\ref{eq:xcely}) determines the demand for the electric bundle,
$\mathit{XC}^{\mathit{ely}}$.\footnote{In the GAMS code, the demand for the four
energy bundles ('ely', 'gas', 'oil' and 'coa') are represented by the variable
\texttt{xacNRG} that has an additional dimension representing the four main
energy carriers. This simplifies the decomposition of these bundles that only
requires one set of equations rather than four. In principle, it also makes it
somewhat easier to increase the number of energy bundles.}
Equation~(\ref{eq:xcnely}) determines the demand for the non-electric bundle,
$\mathit{XC}^{\mathit{nely}}$. In both equations, the key substitution
elasticity is given by $\nu^{\mathit{e}}$.
Equation~(\ref{eq:pcnrgc}) describes the composite price index of energy,
$\mathit{PC}^{c, \mathit{nrg}}$.
Equation~(\ref{eq:pcnrg}) then
describes the aggregate price of energy, $\mathit{PC}^{\mathit{nrg}}$.

\begin{equation}
\label{eq:xcely}
\mathit{XC}^{\mathit{ely}}_{r,k,h} =
   \alpha^{\mathit{cely}}_{\mathit{r,k,h}}
   \left( \frac {\mathit{PC}^{c,\mathit{nrg}}_{r,k,h}}
      {\mathit{PC}^{\mathit{ely}}_{r,k,h}}
   \right)^{\nu^{\mathit{e}}_{\mathit{r,k,h}}}
   \mathit{XC}^{\mathit{nrg}}_{r,k,h}
\end{equation}

\begin{equation}
\label{eq:xcnely}
\mathit{XC}^{\mathit{nely}}_{r,k,h} =
   \alpha^{\mathit{cnely}}_{\mathit{r,k,h}}
   \left( \frac {\mathit{PC}^{c,\mathit{nrg}}_{r,k,h}}
      {\mathit{PC}^{\mathit{nely}}_{r,k,h}}
   \right)^{\nu^{\mathit{e}}_{\mathit{r,k,h}}}
   \mathit{XC}^{\mathit{nrg}}_{r,k,h}
\end{equation}

\begin{equation}
\label{eq:pcnrgc}
\mathit{PC}^{c,\mathit{nrg}}_{r,k,h} =
\begin{cases}
   \left[
      \alpha^{\mathit{cely}}_{\mathit{r,k,h}}
      \left( \mathit{PC}^{\mathit{ely}}_{r,k,h}
      \right)^{1 - \nu^{\mathit{e}}_{\mathit{r,k,h}}}
   +  \alpha^{\mathit{cnely}}_{\mathit{r,k,h}}
      \left( \mathit{PC}^{\mathit{nely}}_{r,k,h}
      \right)^{1 - \nu^{\mathit{e}}_{\mathit{r,k,h}}}
   \right]^{\frac{1} {1 - \nu^{\mathit{e}}_{\mathit{r,k,h}}}} &
   \textrm{if } \lnot \texttt{IFNRGACES} \\
   \left[
      \alpha^{\mathit{cely}}_{\mathit{r,k,h}}
      \left( \mathit{PC}^{\mathit{ely}}_{r,k,h}
      \right)^{- \nu^{\mathit{e}}_{\mathit{r,k,h}}}
   +  \alpha^{\mathit{cnely}}_{\mathit{r,k,h}}
      \left( \mathit{PC}^{\mathit{nely}}_{r,k,h}
      \right)^{- \nu^{\mathit{e}}_{\mathit{r,k,h}}}
   \right]^{-\frac{1} {\nu^{\mathit{e}}_{\mathit{r,k,h}}}} &
   \textrm{if } \texttt{IFNRGACES} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pcnrg}
\mathit{PC}^{\mathit{nrg}}_{r,k,h} =
\left[
\mathit{PC}^{\mathit{ely}}_{r,k,h} \mathit{XC}^{\mathit{ely}}_{r,k,h}
+ \mathit{PC}^{\mathit{nely}}_{r,k,h} \mathit{XC}^{\mathit{nely}}_{r,k,h}
\right]
\bigg / \mathit{XC}^{\mathit{nrg}}_{r,k,h}
\end{equation}

Equation~(\ref{eq:xccoa}) determines the demand for the coal bundle,
$\mathit{XC}^{\mathit{coa}}$. Equation~(\ref{eq:xcolg}) determines the demand
for the oil \& gas bundle, $\mathit{XC}^{\mathit{olg}}$. In both equations, the
key substitution elasticity is given by $\nu^{\mathit{nely}}$.
Equation~(\ref{eq:pcnelyc}) describes the composite price index of the
non-electric bundle, $\mathit{PC}^{\mathit{c,nely}}$.
Equation~(\ref{eq:pcnely}) then describes the aggregate price of the
non-electric bundle, $\mathit{PC}^{\mathit{nely}}$.

\begin{equation}
\label{eq:xccoa}
\mathit{XC}^{\mathit{coa}}_{r,k,h} =
   \alpha^{\mathit{ccoa}}_{\mathit{r,k,h}}
   \left( \frac {\mathit{PC}^{\mathit{c,nely}}_{r,k,h}}
      {\mathit{PC}^{\mathit{coa}}_{r,k,h}}
   \right)^{\nu^{\mathit{nely}}_{\mathit{r,k,h}}}
   \mathit{XC}^{\mathit{nely}}_{r,k,h}
\end{equation}

\begin{equation}
\label{eq:xcolg}
\mathit{XC}^{\mathit{olg}}_{r,k,h} =
   \alpha^{\mathit{colg}}_{\mathit{r,k,h}}
   \left( \frac {\mathit{PC}^{c,\mathit{nely}}_{r,k,h}}
      {\mathit{PC}^{\mathit{olg}}_{r,k,h}}
   \right)^{\nu^{\mathit{nely}}_{\mathit{r,k,h}}}
   \mathit{XC}^{\mathit{nely}}_{r,k,h}
\end{equation}

\begin{equation}
\label{eq:pcnelyc}
\mathit{PC}^{c,\mathit{nely}}_{r,k,h} =
\begin{cases}
   \left[
      \alpha^{\mathit{ccoa}}_{\mathit{r,k,h}}
      \left( \mathit{PC}^{\mathit{coa}}_{r,k,h}
      \right)^{1 - \nu^{\mathit{nely}}_{\mathit{r,k,h}}}
   +  \alpha^{\mathit{colg}}_{\mathit{r,k,h}}
      \left( \mathit{PC}^{\mathit{olg}}_{r,k,h}
      \right)^{1 - \nu^{\mathit{nely}}_{\mathit{r,k,h}}}
   \right]^{\frac{1} {1 - \nu^{\mathit{nely}}_{\mathit{r,k,h}}}} &
   \textrm{if } \lnot \texttt{IFNRGACES} \\
   \left[
      \alpha^{\mathit{ccoa}}_{\mathit{r,k,h}}
      \left( \mathit{PC}^{\mathit{coa}}_{r,k,h}
      \right)^{- \nu^{\mathit{nely}}_{\mathit{r,k,h}}}
   +  \alpha^{\mathit{colg}}_{\mathit{r,k,h}}
      \left( \mathit{PC}^{\mathit{olg}}_{r,k,h}
      \right)^{- \nu^{\mathit{nely}}_{\mathit{r,k,h}}}
   \right]^{-\frac{1} {\nu^{\mathit{nely}}_{\mathit{r,k,h}}}} &
   \textrm{if } \texttt{IFNRGACES} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pcnely}
\mathit{PC}^{\mathit{nely}}_{r,k,h} =
\left[
\mathit{PC}^{\mathit{coa}}_{r,k,h} \mathit{XC}^{\mathit{coa}}_{r,k,h}
+ \mathit{PC}^{\mathit{olg}}_{r,k,h} \mathit{XC}^{\mathit{olg}}_{r,k,h}
\right]
\bigg / \mathit{XC}^{\mathit{nely}}_{r,k,h}
\end{equation}

The remaining two energy bundles are oil and gas and emanate from the
$\mathit{XC}^{\mathit{olg}}$ bundle. Equation~(\ref{eq:xcoil}) determines the
demand for the oil bundle, $\mathit{XC}^{\mathit{oil}}$.
Equation~(\ref{eq:xcgas}) determines the demand for the gas bundle,
$\mathit{XC}^{\mathit{gas}}$. In both equations, the key substitution elasticity
is given by $\nu^{\mathit{olg}}$.
Equation~(\ref{eq:pcolgc}) then describes the
aggregate price of the oil \& gas bundle, $\mathit{PC}^{c,\mathit{olg}}$.
Equation~(\ref{eq:pcolg}) then describes the
aggregate price of the oil \& gas bundle, $\mathit{PC}^{\mathit{olg}}$.

\begin{equation}
\label{eq:xcoil}
\mathit{XC}^{\mathit{oil}}_{r,k,h} =
   \alpha^{\mathit{coil}}_{\mathit{r,k,h}}
   \left( \frac {\mathit{PC}^{c,\mathit{olg}}_{r,k,h}}
      {\mathit{PC}^{\mathit{oil}}_{r,k,h}}
   \right)^{\nu^{\mathit{olg}}_{\mathit{r,k,h}}}
   \mathit{XC}^{\mathit{olg}}_{r,k,h}
\end{equation}

\begin{equation}
\label{eq:xcgas}
\mathit{XC}^{\mathit{gas}}_{r,k,h} =
   \alpha^{\mathit{cgas}}_{\mathit{r,k,h}}
   \left( \frac {\mathit{PC}^{c,\mathit{olg}}_{r,k,h}}
      {\mathit{PC}^{\mathit{gas}}_{r,k,h}}
   \right)^{\nu^{\mathit{olg}}_{\mathit{r,k,h}}}
   \mathit{XC}^{\mathit{olg}}_{r,k,h}
\end{equation}

\begin{equation}
\label{eq:pcolgc}
\mathit{PC}^{c,\mathit{olg}}_{r,k,h} =
\begin{cases}
  \left[
        \alpha^{\mathit{coil}}_{\mathit{r,k,h}}
        \left( \mathit{PC}^{\mathit{oil}}_{r,k,h}
        \right)^{1 - \nu^{\mathit{olg}}_{\mathit{r,k,h}}}
     +  \alpha^{\mathit{cgas}}_{\mathit{r,k,h}}
        \left( \mathit{PC}^{\mathit{gas}}_{r,k,h}
        \right)^{1 - \nu^{\mathit{olg}}_{\mathit{r,k,h}}}
     \right]^{\frac{1} {1 - \nu^{\mathit{olg}}_{\mathit{r,k,h}}}} &
   \textrm{if } \lnot \texttt{IFNRGACES} \\
   \left[
         \alpha^{\mathit{coil}}_{\mathit{r,k,h}}
         \left( \mathit{PC}^{\mathit{oil}}_{r,k,h}
         \right)^{- \nu^{\mathit{olg}}_{\mathit{r,k,h}}}
      +  \alpha^{\mathit{cgas}}_{\mathit{r,k,h}}
         \left( \mathit{PC}^{\mathit{gas}}_{r,k,h}
         \right)^{- \nu^{\mathit{olg}}_{\mathit{r,k,h}}}
      \right]^{-\frac{1} {\nu^{\mathit{olg}}_{\mathit{r,k,h}}}} &
   \textrm{if } \texttt{IFNRGACES} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pcolg}
\mathit{PC}^{\mathit{olg}}_{r,k,h} =
\left[
\mathit{PC}^{\mathit{oil}}_{r,k,h} \mathit{XC}^{\mathit{oil}}_{r,k,h}
+ \mathit{PC}^{\mathit{gas}}_{r,k,h} \mathit{XC}^{\mathit{gas}}_{r,k,h}
\right]
\bigg / \mathit{XC}^{\mathit{olg}}_{r,k,h}
\end{equation}

The final nest in the energy bundle is to decompose the four aggregate energy
bundles into their constituent parts that represent the Armington demand for the
energy commodities for each commodity $k$ and are then summed across all
consumer commodities. Equation~(\ref{eq:xacnrg}) reflects the Armington demand
for energy commodity $e$, $\mathit{XA}_h$, where the cost to consumers is given
by $\mathit{PA^h}$.\footnote{[NEW: 4-OCT-2018] Consumer prices are
given by $\mathit{PA}^h$ instead of $\mathit{PA}^a$ to reflect the introduction of the
tax on waste.} The key substitution elasticity for each energy bundle is
given by $\nu^{\mathit{NRG}}$.
The parameter $\lambda^{\mathit{ce}}$ plays a different role in the two
variants. In the case of the standard CES, it is an energy efficiency
parameter that is specif to the energy carrier and consumer bundle ($k$).
In the case of the additive CES, it is a preference shifter.
Equation~(\ref{eq:pacnrgc}) represents the composite price
index of the aggregate energy bundles, $\mathit{PC^{c,\mathit{NRG}}}$.
Equation~(\ref{eq:pacnrg}) represents the price
of the aggregate energy bundles, $\mathit{PC^{\mathit{NRG}}}$.

\begin{equation}
\label{eq:xacnrg}
\mathit{XA_{r,e,h}} =
\begin{cases}
   \displaystyle \sum_k{
      \alpha^{\mathit{c}}_{r,e,k,h}
      \left( \frac {\lambda^{\mathit{ce}}_{r,e,k,h}
         \mathit{PC}^{c,\mathit{NRG}}_{r,k,h}} {\mathit{PA}^h_{r,e,h}}
      \right)^{\nu^{\mathit{NRG}}_{r,k,h}}
      \frac {\mathit{XC}^{\mathit{NRG}}_{r,k,h}}
         {\lambda^{\mathit{ce}}_{r,e,k,h}}
   }
   & \textrm{if } e \in \left\{ \mathit{NRG} \right\} \& \textrm{ if } \lnot \texttt{IFNRGACES} \\
   \displaystyle \sum_k{
         \alpha^{\mathit{c}}_{r,e,k,h}
         \left( \frac {\mathit{PC}^{c,\mathit{NRG}}_{r,k,h}}
         {\lambda^{\mathit{ce}}_{r,e,k,h} \mathit{PA}^h_{r,e,h}}
         \right)^{\nu^{\mathit{NRG}}_{r,k,h}}
         {\mathit{XC}^{\mathit{NRG}}_{r,k,h}}
      }
      & \textrm{if } e \in \left\{ \mathit{NRG} \right\} \& \textrm{ if } \texttt{IFNRGACES} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pacnrgc}
\mathit{PC}^{c,\mathit{NRG}}_{r,k,h} =
\begin{cases}
  \left[\displaystyle
        \sum_{e \in \left\{ \mathit{NRG} \right\}} {
           \alpha^{\mathit{c}}_{r,e,k,h}
           \left( \frac {\mathit{PA}^h_{r,e,h}} {\lambda^{\mathit{ce}}_{r,e,k,h}}
           \right)^{1 - \nu^{\mathit{NRG}}_{\mathit{r,k,h}}}
        }
     \right]^{\frac{1} {1 - \nu^{\mathit{NRG}}_{\mathit{r,k,h}}}} &
   \textrm{if } \lnot \texttt{IFNRGACES} \\
   \left[\displaystyle
         \sum_{e \in \left\{ \mathit{NRG} \right\}} {
            \alpha^{\mathit{c}}_{r,e,k,h}
            \left({\lambda^{\mathit{ce}}_{r,e,k,h} \mathit{PA}^h_{r,e,h}}
            \right)^{-\nu^{\mathit{NRG}}_{\mathit{r,k,h}}}
         }
      \right]^{-\frac{1} {- \nu^{\mathit{NRG}}_{\mathit{r,k,h}}}} &
   \textrm{if } \texttt{IFNRGACES} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pacnrg}
\mathit{PC}^{\mathit{NRG}}_{r,k,h} =
\left[\sum_{e \in \left\{ \mathit{NRG} \right\}}
{ \mathit{PA}^h_{r,e,h} \mathit{XA}_{r,e,h} }
\right]
\bigg / \mathit{XC}^{\mathit{NRG}}_{r,k,h}
\end{equation}

\subsubsection{Consumer waste module}

[4-OCT-2018: This section is provisional and is being tested.] Total household consumption of commodity $i$, $\mathit{XA}_{r,i,h}$, is split into actual
consumption, $\mathit{XA}^c_{r,i,h}$, and waste, $\mathit{XA}^w_{r,i,h}$, using the additive form
of the CES function (ACES). Equations~(\ref{eq:xaac}) and~(\ref{eq:xaaw})
determine the respective demand for actual consumption and waste, where the substitution
elasticity is given by $\sigma^{\mathit{ac}}$.
The demand functions allow for preference
shifters given by the $\lambda$ parameters.
Equation~(\ref{eq:pacc}) determines the composite price, which
represents the price of utility.

\begin{equation}
\label{eq:xaac}
\mathit{XA}^{c}_{r,i,h} =
\alpha^{\mathit{ac}}_{r,i,h} \mathit{XA}_{r,i,h}
\left(
\frac{\mathit{PACC}_{r,i,h}}{\lambda^{\mathit{ac}}_{r,i,h} \mathit{PA}^{c}_{r,i,h}}
\right)^{\sigma^{\mathit{ac}}_{r,i,h}}
\end{equation}

\begin{equation}
\label{eq:xaaw}
\mathit{XA}^{w}_{r,i,h} =
\alpha^{\mathit{aw}}_{r,i,h} \mathit{XA}_{r,i,h}
\left(
\frac{\mathit{PACC}_{r,i,h}}{\lambda^{\mathit{aw}}_{r,i,h} \mathit{PA}^{w}_{r,i,h}}
\right)^{\sigma^{\mathit{ac}}_{r,i,h}}
\end{equation}

\begin{equation}
\label{eq:pacc}
\mathit{PACC}_{r,i,h} = \left[
\alpha^{\mathit{ac}}_{r,i,h} \left(
\lambda^{\mathit{ac}}_{r,i,h} \mathit{PA}^{c}_{r,i,h}
\right)^{-\sigma^{\mathit{ac}}_{r,i,h}}
+ \alpha^{\mathit{aw}}_{r,i,h} \left(
\lambda^{\mathit{aw}}_{r,i,h} \mathit{PA}^{w}_{r,i,h}
\right)^{-\sigma^{\mathit{ac}}_{r,i,h}}
\right]^{-1/\sigma^{\mathit{ac}}_{r,i,h}}
\end{equation}

It is assumed that both actual consumption and
waste are both priced at the market price, $\mathit{PA}_{r,i,h}$. However, the price of waste
is allowed to deviate using a 'waste' tax.\footnote{The model also allows for an excise
	tax on waste instead of the \emph{ad valorem}
	tax.} The government revenue equation has
been modified to incorporate the waste tax.
The final equation defines the final consumer
price of total consumption, $\mathit{PA}^h_{r,i,h}$. In the absence
of a waste tax, it is equal to the market price
of consumption.

\begin{equation}
\label{eq:pac}
\mathit{PA}^{c}_{r,i,h} = \mathit{PA}_{r,i,h}
\end{equation}

\begin{equation}
\label{eq:paw}
\mathit{PA}^{w}_{r,i,h} = \mathit{PA}_{r,i,h}\left(1+\tau^w_{r,i,h}\right)
\end{equation}

\begin{equation}
\label{eq:pah}
\mathit{PA}^{h}_{r,i,h} \mathit{XA}_{r,i,h} =
\mathit{PA}^{c}_{r,i,h}\mathit{XA}^{c}_{r,i,h} +
\mathit{PA}^{w}_{r,i,h}\mathit{XA}^{w}_{r,i,h}
\end{equation}

[17-MAR-2020] \emph{Phantom} taxes have been added to
the consumer demand module at the level of the $i$ commodities,
not the $k$ commodities. It currently only works for the normal
demand system, without the waste module. See section~\ref{sec:SpcMod}
for its implementation.

\subsection{Other final demand}

In the standard model there are two other domestic agents---government and
investment. The model allows for a number of other domestic final
demand agents, though this typically requires supplemental information
as the standard database only has public and investment expenditures.
One option, for example, is to include expenditures on research
and development. The same expenditure function is assumed, albeit
with a different cost structure and substitution elasticity.
The demand for goods and services for each is governed by a CES
expenditure function. Equation~(\ref{eq:xafd}) represents the demand, therefore,
for the remaining final demand agents, indexed by $\mathit{fdc}$. The
substitution elasticity across goods is given by $\sigma^{\mathit{fd}}$ and will
typically be either 0 or 1, i.e. either constant volume shares or constant value
shares. Equation~(\ref{eq:pfdf}) determines the other final demand aggregate
price deflator, $\mathit{PFD_{fdc}}$, using the ubiquitous CES dual price
expression.

\begin{equation}
\label{eq:xafd}
\mathit{XA}_{r,i,\mathit{fdc}} =
   \alpha^{\mathit{fd}}_{r,i,\mathit{fdc}}
   \left( \frac {\mathit{PFD}_{r,\mathit{fdc}}}
      {\mathit{PA}^a_{r,i,\mathit{fdc}}}
   \right)^{\sigma^{\mathit{fd}}_{r,\mathit{fdc}}}
   \mathit{XFD}_{r,\mathit{fdc}}
\end{equation}

\begin{equation}
\label{eq:pfdf}
\mathit{PFD_{r,\mathit{fdc}}} =
   \left[
      \sum_i{
         \alpha^{\mathit{fd}}_{r,i,\mathit{fdc}}
         \left( \mathit{PA}^a_{r,i,\mathit{fdc}}
         \right)^{1-\sigma^{\mathit{fd}}_{r,\mathit{fdc}}}
      }
   \right]^{1/(1-\sigma^{\mathit{fd}}_{r,\mathit{fdc}})}
\end{equation}

The expenditure price deflator for government and investment expenditures is
well-defined as the CES dual price. There is no similar expression of household
consumption. A CPI index is created using the Fisher price index. More formally,
for a price index over set $i$, the Fisher price index is equal to the
following:

\[
F^p =
\sqrt{
   \frac{\sum_i{P_{i,t} Q_{i,t-1}}} {\sum_i{P_{i,t-1} Q_{i,t-1}} } \cdot
   \frac{\sum_i{P_{i,t} Q_{i,t}}} {\sum_i{P_{i,t-1} Q_{i,t}} }
}
=  \sqrt{L^p \cdot P^p}
\]

\noindent The Fisher price index represents the geometric mean of the Laspeyres
($L^p$) and Paasche price indices ($P^p$), with the former using lagged volume
weights and the latter using current volume weights.

\[
L^p = \frac{\sum_i{P_{i,t} Q_{i,t-1}}}{\sum_i{P_{i,t-1} Q_{i,t-1}}} \qquad
P^p = \frac{\sum_i{P_{i,t} Q_{i,t}}}{\sum_i{P_{i,t-1} Q_{i,t}}}
\]

These indices represent percent change relative to the previous period and thus
the price indices are chain weighted. The price index itself is thus defined as:

\[
\mathit{PI}_t = \mathit{PI}_{t-1}F^p_t
\]

\noindent where typically the price index will be set to 1 or 100 in some base
period.

The Fisher volume index has a similar definition using different price weights:

\[
F^q =
\sqrt{
   \frac{\sum_i{P_{i,t-1} Q_{i,t}}}{\sum_i{P_{i,t-1} Q_{i,t-1}} } \cdot
   \frac{\sum_i{P_{i,t} Q_{i,t}}}{\sum_i{P_{i,t} Q_{i,t-1}} }
}
= \sqrt{L^q \cdot P^q}
\]

\noindent The Fisher volume index represents the geometric mean of the Laspeyres
($L^q$) and Paasche volume indices ($P^q$), with the former using lagged price
weights and the latter using current price weights.

\[
L^q = \frac{\sum_i{P_{i,t-1} Q_{i,t}}}{\sum_i{P_{i,t-1} Q_{i,t-1}}} \qquad
P^q = \frac{\sum_i{P_{i,t} Q_{i,t}}}{\sum_i{P_{i,t} Q_{i,t-1}}}
\]

\noindent It is easy to show that the aggregate nominal value is equal to the
product of the price and volume indices:

\[
P_t \cdot Q_t = \sum_i{P_{i,t} \cdot Q_{i,t}}
              =  F^p_t \cdot F^q_t \cdot P_{t-1} \cdot Q_{t-1}
\]

Equation~(\ref{eq:cpi}) describes the CPI using the Fisher price index where we
define the indicator $\mathit{QFD}_{\mathit{fd}, \mathit{tp}, \mathit{tp}}$ to
be:\footnote{[NEW: 4-OCT-2014] Use of the waste-inclusive consumer price, $\mathit{PA}^h$ instead of $\mathit{PA}^a$.}

\[
\mathit{QFD}_{r,\mathit{h}, \mathit{tp}, \mathit{tq}} =
\sum_i{
   \mathit{PA}^h_{r,i,\mathit{h}, \mathit{tp}}
   \mathit{XA}_{r,i,\mathit{h}, \mathit{tq}}
}
\]

\noindent In other words the indicator is the value of aggregate absorption (for
agent $\mathit{fd}$) using prices of period $\mathit{tp}$ and quantities period
$\mathit{tq}$. Equation~(\ref{eq:pce}) defines $\mathit{YFD}$ for households,
i.e. total nominal expenditure.

\begin{equation}
\label{eq:cpi}
\mathit{PFD}_{r,h,t} =
   \mathit{PFD_{r,h,t-1}}
   \sqrt{ \frac {\mathit{QFD}_{r,\mathit{h}, \mathit{t}, \mathit{t-1}}}
                 {\mathit{QFD}_{r,\mathit{h}, \mathit{t-1}, \mathit{t-1}}}
    \cdot \frac {\mathit{QFD}_{r,\mathit{h}, \mathit{t}, \mathit{t}}}
                {\mathit{QFD}_{r,\mathit{h}, \mathit{t-1}, \mathit{t}}}
   }
\end{equation}

\begin{equation}
\label{eq:pce}
\mathit{YFD_{r,h}} = \mathit{PFD}_{r,h} \mathit{XFD}_{r,h}
\end{equation}

Equation~(\ref{eq:yfd}) is an identity relating nominal expenditures to real
expenditures. What equation~(\ref{eq:yfd}) identifies will depend on macro
closure. In the standard model, it provides a definition of the volume of
consumer expenditures (where the price index is defined above), the nominal
level of government expenditures where by default the volume of government
expenditures is exogenous, and the volume of investment expenditures, where the
nominal level is determined by the investment-savings balance equation,
equation~(\ref{eq:yfdinv}) above.

\begin{equation}
\label{eq:yfd}
\mathit{YFD}_{r,fd} = \mathit{PFD}_{r,fd} \mathit{XFD}_{r,fd}
\end{equation}

\section{International trade}
\renewcommand{\theequation}{{T-}\arabic{equation}}
\setcounter{equation}{0}

\subsection{Import demand}

Similar to most CGE models, import demand uses the Armington specification that
assumes product differentiation between domestic and imported goods. A nested
CES structure first differentiates between domestic goods and aggregate imports.
A second nest differentiates imports across source regions. The GTAP database
and the standard GTAP model assume that the top level Armington nest is
agent-specific, i.e. the allocation of Armington demand between domestic goods
and aggregate imports. The \textsc{Envisage} model allows for 'national'
sourcing, i.e. that the top level Armington disaggregation is done after
aggregating Armington demand across all agents. While the former is perhaps a
more plausible assumption under certain circumstances, this formulation requires
significantly more computation. The top level sourcing is governed by
$\mathit{ArmFlag}$. If it is set to zero, national sourcing is assumed. Any
other value implies agent-specific sourcing. The second level decision nest
decomposes import demand by region of origin. The default specification assumes
this is done by a representative national agent---in common with the GTAP model
and consistent with the standard GTAP database. \textsc{Envisage} incorporates
agent-specific sourcing of imports, consistent with the multi-regional
input-output (MRIO) model. If used with the standard GTAP database, the initial
agent-specific share parameters are uniform across agents, as are the
agent-specific import tax rates. The Armington elasticities could, in principle,
be differentiated across agents, and simulations could assess the impacts of
changes to agent-specific tariffs.

[31-OCT-2020] The additive CES specification has been incorporated as an option
in the Armington system---this allows for regional and global consistency
of the energy balances as it guarantees additivity across the entire value
chain. N.B. The additive CES has not (yet) been incorporated in the MRIO
of the Armington trade system.

\subsubsection{National sourcing of aggregate imports}

This first section describes the top level Armington equations in the case of
national sourcing. Equation~(\ref{eq:xat}) adds up Armington demand (or domestic
absorption for the Armington good) across all Armington agents to measure
aggregate Armington demand, $\mathit{XAT}$. The latter is then decomposed into
demand for domestically produced goods, $\mathit{XDT}^d$,
equation~(\ref{eq:xdt}), and aggregate import demand, $\mathit{XMT}$,
equation~(\ref{eq:xmt}). The parameter $\sigma^{\mathit{mt}}$ represents the key
substitution elasticity and is often referred to as the Armington elasticity.
Each region in the model provides international trade and transport services
$\mathit{XTT}$, further described below. It is assumed that these services are
only provided using domestically produced goods. Hence, equation~(\ref{eq:xdt})
also includes the region's provision of these services, in addition to the
demand for domestic goods coming from the other agents in the economy.
To allow for the additive version of the CES, the Armington system
includes the two different versions of the composite price index, $\mathit{PAT}^c$.
Equation~(\ref{eq:pat}) determines the Armington price (of the aggregate
Armington bundle), $\mathit{PAT}$, a reflection of the zero-profit condition.

\begin{equation}
\label{eq:xat}
\mathit{XAT}_{r,i} =
   \sum_{\mathit{aa}} {
      \gamma^{\mathit{eda}}_{r,i,\mathit{aa}} \mathit{XA}_{r,i,\mathit{aa}}
   }
\end{equation}

\begin{equation}
\label{eq:xdt}
\mathit{XDT}^d_{r,i} =
   \alpha^{\mathit{dt}}_{r,i}
   \left( \frac {\mathit{PAT}^c_{r,i}} {\mathit{PDT}_{r,i}}
   \right)^{\sigma^{\mathit{mt}}_{r,\mathit{i}}}
   \mathit{XAT}_{r,i} + \mathit{XTT}_{r,i}
\end{equation}

\begin{equation}
\label{eq:xmt}
\mathit{XMT}_{r,i} =
   \alpha^{\mathit{mt}}_{r,i}
   \left( \frac {\mathit{PAT}^c_{r,i}} {\mathit{PMT}_{r,i}}
   \right)^{\sigma^{\mathit{mt}}_{r,\mathit{i}}}
   \mathit{XAT}_{r,i}
\end{equation}

\begin{equation}
\label{eq:patc}
\mathit{PAT}^c_{r,i} =
\begin{cases}
\left[
   \alpha^{\mathit{dt}}_{r,i}
   \left( \mathit{PDT}_{r,i}
   \right)^{1-\sigma^{\mathit{mt}}_{r,\mathit{i}}}
+  \alpha^{\mathit{mt}}_{r,i}
   \left( \mathit{PMT}_{r,i}
   \right)^{1-\sigma^{\mathit{mt}}_{r,\mathit{i}}}
\right]^{1/(1-\sigma^{\mathit{mt}}_{r,\mathit{i}})}
&    \textrm{if } \lnot \texttt{IFNRGACES} \\
\left[
   \alpha^{\mathit{dt}}_{r,i}
   \left( \mathit{PDT}_{r,i}
   \right)^{-\sigma^{\mathit{mt}}_{r,\mathit{i}}}
+  \alpha^{\mathit{mt}}_{r,i}
   \left( \mathit{PMT}_{r,i}
   \right)^{-\sigma^{\mathit{mt}}_{r,\mathit{i}}}
\right]^{-1/\sigma^{\mathit{mt}}_{r,\mathit{i}}}
&    \textrm{if } \texttt{IFNRGACES} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pat}
\mathit{PAT}_{r,i} =
\left[\mathit{PDT}_{r,i} \left(\mathit{XDT}^d_{r,i} - \mathit{XTT}_{r,i} \right)
+ \mathit{PMT}_{r,i}\mathit{XMT}_{r,i} \right] \bigg / \mathit{XAT}_{r,i}
\end{equation}

Agents pay $\mathit{PA}$ for Armington goods, as defined by
equation~(\ref{eq:pa}), where $\tau^a$ is the agent specific tax on Armington
consumption. The economy-wide Armington price, $\mathit{PAT}$, is allowed to
vary across end-users using a price wedge represented by
$\gamma^{\mathit{eda}}$. The emissions tax is treated as a Pigouvian tax that is
added to the after-tax Armington price. The parameter $\rho^{\mathit{Emi}}$
represents the rate of emissions per unit of consumption and
$\tau^{\mathit{Emi}}$ is the emissions tax per unit of emissions. The parameter
$\chi^{\mathit{Emi}}$ is a global shifter on the emission rates. And the
parameter $\phi^{\mathit{Emi}}$ allows for partial or full exemption of the tax
incidence. By default, $\phi^{\mathit{Emi}}$ is set to 1. Any valid value is
between 0 (full exemption) to 1 (zero exemption). For example specific
activities and/or households can be exempted from the emissions tax and for
specific fuels as well---for example natural gas.

\begin{equation}
\label{eq:pa}
\mathit{PA_{r,i,aa}} =
   \left( 1 + \tau^a_{r,i,\mathit{aa}} \right)
   \gamma^{\mathit{eda}}_{r,i,\mathit{aa}} \mathit{PAT}_{r,i}
+  \sum_{\mathit{em}} {
      \chi^{\mathit{Emi}}_{\mathit{em}}
      \rho^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
      \phi^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
      \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}}
   }
\end{equation}

\noindent This section determines $\mathit{XAT}$, $\mathit{XDT}$,
$\mathit{XMT}$, $\mathit{PAT}^c$, $\mathit{PAT}$, and $\mathit{PA}$. The variables $\mathit{XAT}$,
$\mathit{PAT}^c$,
and $\mathit{PAT}$ are specific to the national-sourcing assumption and are not
part of the model specification in the case of agent-sourcing. The other
variables are included in the agent-sourcing specification, but have an
alternative specification.

\subsubsection{Agent sourcing of aggregate imports}

In the agent-sourcing of imports, each agent has a unique preference for
domestic goods and (aggregate) imports. This specification is more
computationally intensive, but is likely to be a more plausible specification.
Equations~(\ref{eq:xd}) and~(\ref{eq:xm}) determine respectively the agents'
demand for domestic goods and the aggregate import bundle, respectively
$\mathit{XD}$ and $\mathit{XM}$. All relevant variables and parameters are
indexed by $\mathit{aa}$, which represents the set of all Armington agents.
Equation~(\ref{eq:paac}) the agent-specific composite Armington price index.
Equation~(\ref{eq:paa}) defines the agent-specific Armington price.

\begin{equation}
\label{eq:xd}
\mathit{XD}_{r,i,\mathit{aa}} =
   \alpha^{\mathit{d}}_{r,i,\mathit{aa}}
   \left( \frac {\mathit{PA}^c_{r,i,\mathit{aa}}} {\mathit{PD}_{r,i,\mathit{aa}}}
   \right)^{\sigma^{\mathit{m}}_{r,\mathit{i},\mathit{aa}}}
   \mathit{XA}_{r,i,aa}
\end{equation}

\begin{equation}
\label{eq:xm}
\mathit{XM}_{r,i,\mathit{aa}} =
   \alpha^{\mathit{m}}_{r,i,\mathit{aa}}
   \left( \frac {\mathit{PA}^c_{r,i,\mathit{aa}}} {\mathit{PM}_{r,i,\mathit{aa}}}
   \right)^{\sigma^{\mathit{m}}_{r,\mathit{i},\mathit{\mathit{aa}}}}
   \mathit{XA}_{r,i,\mathit{aa}}
\end{equation}

\begin{equation}
\label{eq:paac}
\mathit{PA}^c_{r,i,\mathit{aa}} =
\begin{cases}
\left[
   \alpha^{\mathit{d}}_{r,i,\mathit{aa}}
   \left( \mathit{PD}_{r,i,\mathit{aa}}
   \right)^{1-\sigma^{\mathit{m}}_{r,\mathit{i},\mathit{aa}}}
+  \alpha^{\mathit{m}}_{r,i,\mathit{aa}}
   \left( \mathit{PM}_{r,i,\mathit{aa}}
   \right)^{1-\sigma^{\mathit{m}}_{r,\mathit{i},\mathit{aa}}}
\right]^{1/(1-\sigma^{\mathit{m}}_{r,\mathit{i},\mathit{aa}})}
&    \textrm{if } \lnot \texttt{IFNRGACES} \\
\left[
   \alpha^{\mathit{d}}_{r,i,\mathit{aa}}
   \left( \mathit{PD}_{r,i,\mathit{aa}}
   \right)^{-\sigma^{\mathit{m}}_{r,\mathit{i},\mathit{aa}}}
+  \alpha^{\mathit{m}}_{r,i,\mathit{aa}}
   \left( \mathit{PM}_{r,i,\mathit{aa}}
   \right)^{-\sigma^{\mathit{m}}_{r,\mathit{i},\mathit{aa}}}
\right]^{-1/\sigma^{\mathit{m}}_{r,\mathit{i},\mathit{aa}}}
&    \textrm{if } \texttt{IFNRGACES} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:paa}
\mathit{PA}_{r,i,\mathit{aa}} =
\left[
   \mathit{PD}_{r,i,\mathit{aa}} \mathit{XD}_{r,i,\mathit{aa}} +
   \mathit{PM}_{r,i,\mathit{aa}} \mathit{XM}_{r,i,\mathit{aa}}
\right] \bigg / \mathit{XA}_{r,i,aa}
\end{equation}

The next two equations define the end-user, or agent-specific, sales price,
equations~(\ref{eq:pd}) and~(\ref{eq:pm}). Agents are assumed to face a common
price of domestic goods, $\mathit{PDT}$. Under the MRIO specification, agents
could face distinct import prices---the preference structure of bilateral
imports can differ across agents and import tariffs could be agent-specific.
The agents' tariff-inclusive price of imports is given by the variable
$\mathit{PM}^a$. In the standard specification, this price is uniform across
agents and is given by the variable $\mathit{PMT}$. Prices can be adjusted by
exogenous wedges (to allow for differences in quality for example) and sales
taxes differ between domestic and imported goods. The carbon tax is a Pigouvian
tax added to the tax-inclusive sales price, where the emission coefficient is
source-specific.

\begin{equation}
\label{eq:pd}
\mathit{PD}_{r,i,aa} =
   \left( 1 + \tau^{\mathit{ad}}_{r,i,\mathit{aa}} \right)
   \gamma^{\mathit{edd}}_{r,i,\mathit{aa}} \mathit{PDT}_{r,i}
+  \sum_{\mathit{em}} {
      \chi^{\mathit{Emi}}_{\mathit{em}}
      \rho^{\mathit{Emi},d}_{r,\mathit{em},i,\mathit{aa}}
      \phi^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
      \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}}
   }
\end{equation}

\begin{equation}
\label{eq:pm}
\mathit{PM}_{r,i,aa} =
   \left( 1 + \tau^{\mathit{am}}_{r,i,\mathit{aa}} \right)
   \gamma^{\mathit{edm}}_{r,i,\mathit{aa}} \mathit{PM}^a_{r,i,\mathit{aa}}
+  \sum_{\mathit{em}} {
      \chi^{\mathit{Emi}}_{\mathit{em}}
      \rho^{\mathit{Emi},m}_{r,\mathit{em},i,\mathit{aa}}
      \phi^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
      \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}}
   }
\end{equation}

The final two equations determine aggregate demand for domestic goods,
$\mathit{XDT}$, and the import bundle, $\mathit{XMT}$. These correspond to
equation~(\ref{eq:xat}) above and represent a simple aggregation of the
agent-specific demand (adjusted by the agent-specific coefficients to allow for
exogenous price relatives). Note that domestic supply of international trade and
transport margins is added to the (Armington) agents' demand for domestic goods.
The variable $\mathit{XMT}$ is not calculated for the MRIO version of the
model.\footnote{The MRIO model only operates if the top-level Armington
specification is agent-specific.}

\begin{equation}
\label{eq:xdta}
\mathit{XDT}^d_{r,i} =
   \sum_{\mathit{aa}} {
      \gamma^{\mathit{edd}}_{r,i,\mathit{aa}} \mathit{XD}_{r,i,\mathit{aa}}
   }
+  \mathit{XTT}_{r,i}
\end{equation}

\begin{equation}
\label{eq:xmta}
\mathit{XMT}_{r,i} =
   \sum_{\mathit{aa}} {
      \gamma^{\mathit{edm}}_{r,i,\mathit{aa}} \mathit{XM}_{r,i,\mathit{aa}}
   }
\end{equation}

\noindent This section determines $\mathit{XD}$, $\mathit{XM}$, $\mathit{PA}$,
$\mathit{PD}$, $\mathit{PM}$, $\mathit{XDT^d}$ and $\mathit{XMT}$. The variables
$\mathit{PA}$, $\mathit{XDT}^d$ and $\mathit{XMT}$ are common to both
specifications albeit with different expressions. The variables $\mathit{XD}$,
$\mathit{XM}$, $\mathit{PD}$ and $\mathit{PM}$ are only included with the
agent-sourcing specification. The variable $\mathit{XMT}$ is not part of the
MRIO model specification.

\subsubsection{Second level Armington nest---standard specification}

The second CES nest decomposes the aggregate demand for imports, $\mathit{XMT}$,
into demand for imports by source region, $\mathit{XW^d}$.
Equation~(\ref{eq:xwd}) describes demand for imports by region $r$ for imports
from region $s$ for good $i$.\footnote{As mentioned above, the $\mathit{XW^d}$
is substituted out and thus this expression carries the iceberg parameter in the
model implementation.} The variable $\mathit{PDM}$ represents the end-user price
of imports, i.e. it includes bilateral tariffs. The key substitution elasticity
is given by $\sigma^{\mathit{w}}$. The composite import price index, $\mathit{PMT}^c$,
is defined in
equation~(\ref{eq:pmtc}).The aggregate import price, $\mathit{PMT}$,
is defined in
equation~(\ref{eq:pmt}).

\begin{equation}
\label{eq:xwd}
\mathit{XW}^d_{s,i,r} =
   \alpha^{\mathit{w}}_{s,i,r}
   \left( \frac {\mathit{PMT}^c_{r,i}} {\mathit{PDM}_{s,i,r}}
   \right)^{\sigma^{\mathit{w}}_{r,\mathit{i}}}
   \mathit{XMT}_{r,i}
\end{equation}

\begin{equation}
\label{eq:pmtc}
\mathit{PMT}^c_{r,i} =
\begin{cases}
\left[\displaystyle
   \sum_s{
      \alpha^{\mathit{w}}_{s,i,r}
      \left( \mathit{PDM}_{s,i,r}
      \right)^{1-\sigma^{\mathit{w}}_{r,\mathit{i}}}
   }
\right]^{1/(1-\sigma^{\mathit{w}}_{r,\mathit{i}})}
&    \textrm{if } \lnot \texttt{IFNRGACES} \\
\left[\displaystyle
   \sum_s{
      \alpha^{\mathit{w}}_{s,i,r}
      \left( \mathit{PDM}_{s,i,r}
      \right)^{-\sigma^{\mathit{w}}_{r,\mathit{i}}}
   }
\right]^{-1/\sigma^{\mathit{w}}_{r,\mathit{i}})}
&    \textrm{if } \texttt{IFNRGACES} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pmt}
\mathit{PMT}_{r,i} =
\left[
   \sum_s{
      \left( \mathit{PDM}_{s,i,r}\mathit{XW}^d_{s,i,r}
      \right)
   }
\right] \bigg / \mathit{XMT}_{r,i}
\end{equation}

\subsubsection{Second level Armington nest---MRIO specification}

Under the MRIO specification, the allocation of agent-specific import demand,
$\mathit{XM}$, across source regions is also agent-specific---unlike the
standard specification where agents' import demand is summed across all agents,
and then allocated across trading partners. Equation~(\ref{eq:xwa}) represents
the agent specific allocation of $\mathit{XM}$ across trading partners,
$\mathit{XW^a}$. The relevant prices include $\mathit{PDM}^a$, which is the
tariff-inclusive price for agent $\mathit{aa}$ for commodity $i$ sourced in
region $s$, and $\mathit{PM}^a$, which represents the average tariff inclusive
price for agent $\mathit{aa}$ for commodity $i$, averaged over all source
countries. We allow for the substitution elasticity to be agent-specific, though
there is currently little empirical evidence to support this.
Equation~(\ref{eq:pma}) defines the agent-specific average price of imports
using the zero-profit condition. Equation~(\ref{eq:pdma})defines the
tariff-inclusive price of imports for agent $\mathit{aa}$ sourced in region $s$.
Total import demand, that must be reconciled with export supply, is provided in
equation~(\ref{eq:xwdMRIO}).

\begin{equation}
\label{eq:xwa}
\mathit{XW}^a_{s,i,r,\mathit{aa}} =
   \alpha^{\mathit{wa}}_{s,i,r,\mathit{aa}}
   \left( \frac {\mathit{PM}^a_{r,i,\mathit{aa}}}
      {\mathit{PDM}^a_{s,i,r,\mathit{aa}}}
   \right)^{\sigma^{\mathit{wa}}_{r,i,\mathit{aa}}}
   \mathit{XM}_{r,i,\mathit{aa}}
\end{equation}

\begin{equation}
\label{eq:pma}
\mathit{PM}^a_{r,i,\mathit{aa}} \mathit{XM}^a_{r,i,\mathit{aa}}
=  \sum_s{
      \mathit{PDM}^a_{s,i,r,\mathit{aa}} \mathit{XW}^a_{s,i,r,\mathit{aa}}
   }
\end{equation}

\begin{equation}
\label{eq:pdma}
\mathit{PDM}^a_{s,i,r,\mathit{aa}} =
   \left( 1 + \tau^\mathit{ma}_{s,i,r,\mathit{aa}} \right) \mathit{PWM}_{s,i,r}
\end{equation}

\begin{equation}
\label{eq:xwdMRIO}
\mathit{XW}^d_{s,i,r} = \sum_{\mathit{aa}} {\mathit{XW}^a_{s,i,r,\mathit{aa}}}
\end{equation}

\subsubsection{Summary}

The standard specification requires variables $\mathit{PMT}$ and $\mathit{PDM}$
that represent respectively the average tariff-inclusive price of
imports---uniform across all agents---, and the bilateral tariff-inclusive price
of imports. In addition, the variable $\mathit{XMT}$ represents aggregate import
demand, summed across all agents. These three variables are not used in the MRIO
version of the model. The MRIO version of the model uses instead
$\mathit{PM}^a$, $\mathit{PDM}^a$ and $\mathit{XW}^a$. Both models require the
variable $\mathit{XW}^d$. Note that the MRIO model significantly expands the
size of the model---even allowing for some substitution. The 10x10 model, with
no substitution has around 45,000 endogenous variables. This can be pared down
to some 26,000 variables with judicious substitution. The model with the
standard trade specification (and substitution) solves for some 13,000
variables. The agent- and source-specific import variable requires some 12,000
variables alone for the 10x10 model.

\subsection{Export supply}

Domestic supply of good $i$ is given by $\mathit{XS}$. It will be allocated
between domestic and export markets analogously to the Armington assumption on
the demand side. At the top level, the national supplier decides the optimal
allocation of total supply between the domestic market and aggregate exports. At
the second level, aggregate exports are allocated across all regions of
destination. The allocation functions are based on the CET transformation
specification. The implementation does allow for perfect transformation, in
which case the law-of-one-price holds. [31-OCT-2020] The specification
also allows for the additive form of the CET (ACET), which can be
used in particular for energy commodities to preserve the
energy balances across regions and globally.

Equation~(\ref{eq:xds}) determines the optimal supply of domestic production to
be allocated to the domestic market, $\mathit{XDT^s}$. The transformation
elasticity is given by $\omega^x$. In the case of perfect transformation, the
market price of goods sold domestically is equal to the average supply price
adjusted by an exogenous price wedge, $\gamma^{\mathit{esd}}$.
Equation~(\ref{eq:xet}) determines the optimal supply of aggregate exports,
$\mathit{XET}$.
Equation~(\ref{eq:psc}) determines the composite price index for domestic supply, $\mathit{PS}^c$.
Equation~(\ref{eq:xs}) represents the zero-profit condition and determines
$\mathit{PS}$, i.e. the aggregate price of domestic supply.

\begin{equation}
\label{eq:xds}
\begin{cases}
\displaystyle \mathit{XDT}^s_{r,i} =
   \gamma^{\mathit{d}}_{r,i}
   \left( \gamma^{\mathit{esd}}_{r,i}
   \right)^{-\omega^x_{r,i}-1}
   \left( \frac {\mathit{PDT}_{r,i}} {\mathit{PS}^c_{r,i}}
   \right)^{\omega^{\mathit{x}}_{r,\mathit{i}}}
   \mathit{XS_{r,i}}
&  \textrm{if } \omega^x_{r,i} \ne \infty \\
\displaystyle \mathit{PDT}_{r,i} =
   \gamma^{\mathit{esd}}_{r,i} \mathit{PS}_{r,i}
& \textrm{if } \omega^x_{r,i} = \infty \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:xet}
\begin{cases}
\displaystyle \mathit{XET}_{r,i} =
   \gamma^{\mathit{e}}_{r,i}
   \left( \gamma^{\mathit{ese}}_{r,i} \right)^{-\omega^x_{r,i}-1}
   \left( \frac {\mathit{PET}_{r,i}} {\mathit{PS}^c_{r,i}}
   \right)^{\omega^{\mathit{x}}_{r,\mathit{i}}}
   \mathit{XS}_{r,i}
&  \textrm{if } \omega^x_{r,i} \ne \infty \\
\displaystyle \mathit{PET}_{r,i} =
   \gamma^{\mathit{ese}}_{r,i} \mathit{PS}_{r,i}
&  \textrm{if } \omega^x_{r,i} = \infty \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:psc}
\mathit{PS}^c_{r,i} =
\begin{cases}
\left[
\gamma^{\mathit{d}}_{r,i} \left( \mathit{PDT}_{r,i} \right)^{1 + \omega^x_{r,i}} +
\gamma^{\mathit{e}}_{r,i} \left( \mathit{PET}_{r,i} \right)^{1 + \omega^x_{r,i}}
\right]^{1/(1 + \omega^x_{r,i})}
&  \textrm{if } \omega^x_{r,i} \ne \infty \textrm{ \& if } \lnot \texttt{IFNRGACES} \\
\left[
\gamma^{\mathit{d}}_{r,i} \left( \mathit{PDT}_{r,i} \right)^{\omega^x_{r,i}} +
\gamma^{\mathit{e}}_{r,i} \left( \mathit{PET}_{r,i} \right)^{\omega^x_{r,i}}
\right]^{1/\omega^x_{r,i}}
&  \textrm{if } \omega^x_{r,i} \ne \infty \textrm{ \& if } \texttt{IFNRGACES} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:xs}
\mathit{PS}_{r,i}  =
   \left[\mathit{PDT}_{r,i} \mathit{XDT}^s_{r,i}
+  \mathit{PET}_{r,i} \mathit{XET}_{r,i}\right] \bigg / \mathit{XS}_{r,i}
\end{equation}

The second level nest is represented by equation~(\ref{eq:xws}), which
determines the quantity of exports allocated to each of the destination markets
($d$), $\mathit{XW}^s$. The key transformation elasticity is given by
$\omega^w$.
Equation~(\ref{eq:petc}) determines the composite price index for
aggregate exports, $\mathit{PET}^c$.
Equation~(\ref{eq:pet}) determines the aggregate export price,
$\mathit{PET}$. Similar to the top-level CET nest, the second level nest allows or an
exogenous wedge in the bilateral prices relative to the average, or aggregate,
price.

\begin{equation}
\label{eq:xws}
\begin{cases}
\displaystyle \mathit{XW}^s_{r,i,d} =
   \gamma^{\mathit{w}}_{r,i,d}
   \left( \gamma^{\mathit{ew}}_{r,i,d}
   \right)^{-\omega^w_{r,i}-1}
   \left( \frac {\mathit{PE}_{r,i,d}} {\mathit{PET}^c_{r,i}}
   \right)^{\omega^{\mathit{w}}_{r,\mathit{i}}}
   \mathit{XET_{r,i}}
&  \textrm{if } \omega^w_{r,i} \ne \infty \\
\displaystyle \mathit{PE}_{r,i,d} =
   \gamma^{\mathit{ew}}_{r,i,d} \mathit{PET}_{r,i}
& \textrm{if } \omega^w_{r,i} = \infty \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:petc}
\mathit{PET}^c_{r,i} =
\begin{cases}
\left[ \displaystyle \sum_d{
\gamma^{\mathit{w}}_{r,i,d} \left( \mathit{PE}_{r,i,d} \right)^{1 + \omega^w_{r,i}}}
\right]^{1/(1 + \omega^w_{r,i})}
&  \textrm{if } \omega^w_{r,i} \ne \infty \textrm{ \& if } \lnot \texttt{IFNRGACES} \\
\left[ \displaystyle \sum_d{
\gamma^{\mathit{w}}_{r,i,d} \left( \mathit{PE}_{r,i,d} \right)^{\omega^w_{r,i}}}
\right]^{1/\omega^w_{r,i}}
&  \textrm{if } \omega^w_{r,i} \ne \infty \textrm{ \& if } \texttt{IFNRGACES} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pet}
\mathit{PET}_{r,i}  =
   \sum_d{ \mathit{PE}_{r,i,d} \mathit{XW}^s_{r,i,d} } \bigg / \mathit{XET}_{r,i}
\end{equation}

\subsection{Bilateral trade prices}

Each bilateral trade node is associated with four prices. $\mathit{PE}$
represents the price domestic producers in region $r$ receive for goods exported
to destination region $d$. An export tax or subsidy, $\tau^e$, is introduced
between the producer price and the border (of FOB) price, $\mathit{PWE}$,
equation~(\ref{eq:pwe}). A transportation margin represents the wedge between
the border (or FOB) price of the exporting region and the border (or CIF) price
of the importing region, $\mathit{PWM}$. The variable $\zeta^{\mathit{mg}}$
represents the per unit transportation margin that is valued at the average
price of $\mathit{PWMG}$, equation~(\ref{eq:pwm}). The CIF import price is
adjusted by the iceberg parameter, $\lambda^w$. The final price of imports for
the end-user is the border (or CIF) price plus trade protection measures of which there are
two: bilateral import tariffs, $\tau^m_{r,i,d}$, and the \emph{ad valorem} equivalent
of non tariff measures, $\tau^{\mathit{ntm}}$.\footnote{[NEW: 4-OCT-2018] NTMs
are new to the model. See introduction above in the income section (\ref{sec:income}).}
This price is represented by $\mathit{PDM}$,
equation~(\ref{eq:pdm}).\footnote{Note that in the model implementation, these
equations are typically substituted out of the model in order to reduce
its overall size.}

\begin{equation}
\label{eq:pwe}
\mathit{PWE}_{r,i,d} = \left( 1 + \tau^e_{r,i,d} \right) \mathit{PE}_{r,i,d}
\end{equation}

\begin{equation}
\label{eq:pwm}
\mathit{PWM}_{r,i,d} =
\left[
   \mathit{PWE}_{r,i,d} + \mathit{PWMG}_{r,i,d} \zeta^{\mathit{mg}}_{r,i,d}
\right] \bigg/ \left[\lambda^x_{r,i,d} \lambda^w_{r,i,d} \right]
\end{equation}

\begin{equation}
\label{eq:pdm}
\mathit{PDM}_{r,i,d} = \left( 1 + \tau^m_{r,i,d}  + \tau^{\mathit{ntm}}_{r,i,d} \right) \mathit{PWM}_{r,i,d}
\end{equation}

\subsection{Trade margins}

International trade is associated with transport margins that capture the wedge
between the price at the source port and the price at the destination port, i.e.
the CIF/FOB price wedge. Thus trade engenders a demand for services. The supply
of these services is assumed to emanate from a global supplier that chooses the
lowest cost supply subject to a CES preference function.

Equation~(\ref{eq:xwmg}) provides the demand for international trade and
transport services per bilateral node, $\mathit{XWMG}$, a simple linear
technology. The bilateral demand for trade and transport services is allocated
across margin commodities ($m$) using a similar linear technology,
equation~(\ref{eq:xmgm}). The specification allows for technological change as
rendered by the variable $\lambda^{\mathit{mg}}$. The average price of
transportation per bilateral node, $\mathit{PWMG}$, is given by
equation~(\ref{eq:pwmg}).

\begin{equation}
\label{eq:xwmg}
\mathit{XWMG}_{r,i,d} = \zeta^{\mathit{mg}}_{r,i,d} \mathit{XW}^s_{r,i,d}
\end{equation}

\begin{equation}
\label{eq:xmgm}
\mathit{XMG}^m_{m,r,i,d} =
   \alpha^{\mathit{mg}}_{m,r,i,d}
   \frac{\mathit{XWMG}_{r,i,d}} {\lambda^{\mathit{mg}}_{m,r,i,d}}
\end{equation}

\begin{equation}
\label{eq:pwmg}
\mathit{PWMG}_{r,i,d} =
   \sum_m{
      \alpha^{\mathit{mg}}_{m,r,i,d}
      \frac {\mathit{PTMG}_{m}} {\lambda^{\mathit{mg}}_{m,r,i,d}}
   }
\end{equation}

Total global demand (and therefore supply) for trade and transport margins,
$\mathit{XTMG}$, for each commodity $m$, is the sum across all potential
bilateral nodes equation~(\ref{eq:xtmg}). The global supplier allocates this
demand across potential suppliers using a CES preference function.
Equation~(\ref{eq:xtt}) determines region $r$'s supply of trade and transport
services, $\mathit{XTT}$ for commodity $m$. The global average price for trade
and transport service $m$, $\mathit{PTMG}$, is given by
equation~(\ref{eq:ptmg}).

\begin{equation}
\label{eq:xtmg}
\mathit{XTMG}_{m}  = \sum_r{ \sum_i{ \sum_d{\mathit{XMG}^m_{m,r,i,d}} } }
\end{equation}

\begin{equation}
\label{eq:xtt}
\mathit{XTT}_{r,m} = \alpha^{\mathit{tt}}_{r,m}
   \left( \frac {\mathit{PTMG}_{m}} {\mathit{PD}_{r,m}}
   \right)^{\sigma^{\mathit{mg}}_m}
   \mathit{XTMG}_{m}
\end{equation}

\begin{equation}
\label{eq:ptmg}
\mathit{PTMG}_{m} \mathit{XTMG}_{m} =
   \sum_m{
      \mathit{PD}_{r,m} \mathit{XTT}_{r,m}
   }
\end{equation}

\section{Goods market equilibrium}
\renewcommand{\theequation}{{E-}\arabic{equation}}
\setcounter{equation}{0}

There are two sets of equilibrium conditions. The domestic market for goods
produced domestically and bilateral trade. Equation~(\ref{eq:pdt}) determines
$\mathit{PD}$, the market or equilibrium price equating supply of domestically
produced goods to the demand for domestic goods. Equation~(\ref{eq:pe})
determines $\mathit{PE}$, the producer price of exported goods by region of
origin $r$ destined for region $d$. The equilibrium condition allows for iceberg
trade costs that are represented by the parameters $\lambda^x$ and $\lambda^w$.
The former relates to changes related to the exporter and the latter
relates to changes related to the importer.
The parameters are
initialized at 1. An improvement in trade, i.e. a reduction in iceberg costs, is
represented by an increase from 1. Thus a 10~percent improvement is represented
by setting $\lambda^w$ to 1.1. In model implementation, these equilibrium
conditions are substituted out of the model specification.

\begin{equation}
\label{eq:pdt}
\mathit{XDT}^d_{r,i} = \mathit{XDT}^s_{r,i}
\end{equation}

\begin{equation}
\label{eq:pe}
\mathit{XW}^d_{r,i,d} = \lambda^w_{r,i,d} \lambda^x \mathit{XW}^s_{r,i,d}
\end{equation}

\section{Factor markets}
\renewcommand{\theequation}{{F-}\arabic{equation}}
\setcounter{equation}{0}

\subsection{Labor market}

Equilibrium on the labor markets allows for labor market segmentation---rural,
equated with agricultural sectors, and urban---or full mobility across all
sectors. In the case of labor market segmentation, the model also implements a
migration function that allows for some adjustment in the respective labor
supplies depending on expected relative wage rates. The two labor market
segments are indexed by $z$, or zone. When market segmentation is assumed,
the index $z$ has two elements, \texttt{rur} and \texttt{urb}. For nationally
integrated labor markets, the index $z$ has a single element, \texttt{nsg}
(i.e. not-segmented). Note that the model allows for mixed specifications.
For example, market segmentation can be assumed for unskilled workers but
skilled workers could be fully mobile.

Within each zone (in either the segmented or non-segmented specifications),
the model allows for three wage formation mechanisms.
(1) The default is that wages clear by equating labor demand with
(fixed) labor supply. (2) The second specification implements a
reservation (or minimum) wage that puts a lower bound on market
wages. With sufficiently high demand the equilibrium wage will likely exceed the
reservation wage and the wage will be determined by equality of demand and
supply (allowing for 'natural' unemployment). If labor demand is low, the market
wage would be determined by the reservation wage and labor supply will exceed
labor demand generating unemployment. (3) The third specification
is inspired from the Monash-class of models (\cite{DixonRimmer2002}).
It allows for short-run deviations from full-employment (induced
by a shock), but long-run equilibrium between labor supply an demand.

Equation~(\ref{eq:ldz}) defines labor demand within the relevant labor market
zone.\footnote{All equations relating to labor market zones are conditioned on a
set flag represented by \texttt{lsFlag}. For segmented labor markets, the flag
will be active for \texttt{rur} and \texttt{urb}. For non-segmented labor
markets, the flag will only be active for \texttt{nsg}.}

\begin{equation}
\label{eq:ldz}
\mathit{LD}^z_{r,l,z} = \sum_{a \in z}{ \mathit{XF}_{r,l,a} }
\end{equation}

\subsubsection{Labor market closure with reservation wage specification}

This labor market closure allows for endogenous regime shifting between full
employment with the equilibrium wage determined by the equality of supply and
demand and a regime of less than full employment. A reservation (or minimum)
wage puts a floor on wages. If labor demand is low relative to supply, the
market wage will be determined by the reservation wage. In the case of high
labor demand, wages will be determined by equilibrium conditions. The two
regimes are specified using a mixed complementarity expression that takes the
following form:

\[
\left( W^e-\mathit{W}^{\mathit{res}}
\right)
\left(\mathit{UE} - \mathit{UE}^{\mathit{min}}
\right) = 0
\]

\noindent with

\[
W^e \ge \mathit{W}^{\mathit{res}} \quad \text{and} \quad
\mathit{UE} \ge \mathit{UE}^{\mathit{min}}
\]

\noindent where $W^e$ is the market wage, $\mathit{W}^{\mathit{res}}$ is the
reservation wage, $\mathit{UE}$ is the rate of unemployment and
$\mathit{UE}^{\mathit{min}}$ is a floor for the unemployment rate. For the
complementarity condition to hold either the unemployment rate is at the minimum
and the market wage is greater than the reservation wage, or, the unemployment
level is greater than the minimum level and the market wage is equal to the
reservation wage.

Figure~\ref{fig:LabMarket} provides an illustration of the two different market
closures. The vertical line labeled $L^s$ represents total labor supply, however
effective labor supply is represented by the other vertical line,
$(1-\mathit{UE}^{\mathit{min}})L^s$, and represents labor supply adjusted by the
minimal (or natural) rate of unemployment (that is exogenous). The labor demand
curves $\textrm{D}_1\textrm{D}_1$ and $\textrm{D}_2\textrm{D}_2$ represent two
different situations with the former having relatively low labor demand and the
latter relatively high labor demand. The $\textrm{D}_1\textrm{D}_1$ curve
crosses the effective labor supply curve below the reservation wage and hence
the market wage will be given by the reservation wage as indicated at point A.
The rate of unemployment is measured as the distance between total labor supply
and effective labor demand ($L^d_1$), of which some part reflects the minimum
rate of unemployment. The $\textrm{D}_2\textrm{D}_2$ curve, on the other hand,
crosses the effective labor supply curve at a wage greater than the reservation
wage, in which case the market wage is given by supply/demand equality at
point~B and with a market wage of $W^e$. Effective labor demand is $L^d_2$ and
equal to effective labor supply. As the demand curve $\textrm{D}_1\textrm{D}_1$
shifts up and to the right, the market wage will be determined by the
reservation wage until point C when the regime shift towards full employment
occurs.

\begin{figure}
\centering
\begin{tikzpicture}
   \begin{axis}[width=6in, height=4in,
      xlabel={Labor demand/supply},
      ylabel={Wage},
      xmin={149},
      xmax={250},
      ymin={0.6},
      ymax={1.65},
      % ymajorgrids,
      legend style={draw=none},
      x tick label style={/pgf/number format/.cd, scaled x ticks = false,
         set thousands separator={},fixed},
      y tick label style={/pgf/number format/.cd, scaled y ticks = false,
         set decimal separator={.},fixed,fixed zerofill,precision=1},
      xtick={150,160,...,250},
      ytick={0.6,0.7,...,1.6},
      % legend style={at={(1.03,0.5)},anchor=west,font=\footnotesize},
      % legend cell align=left
   ]
   \addplot+[blue,smooth,line width=2.0pt] coordinates {
      (150,1.2)
      (160,1.125)
      (170,1.05882352941176)
      (180,1)
      (190,0.947368421052632)
      (200,0.9)
      (210,0.857142857142857)
      (220,0.818181818181818)
      (230,0.782608695652174)
      (240,0.75)
      (250,0.72)
   };
   \addplot+[red,smooth,line width=2.0pt] coordinates {
      (150,1.56)
      (160,1.485)
      (170,1.41882352941176)
      (180,1.36)
      (190,1.30736842105263)
      (200,1.26)
      (210,1.21714285714286)
      (220,1.17818181818182)
      (230,1.14260869565217)
      (240,1.11)
      (250,1.08)
   };
   \addplot+[black,smooth,line width=2.0pt] coordinates {
      (200,0.6)
      (200,1.6)
   };
   \addplot+[black,smooth,line width=2.0pt] coordinates {
      (190,0.6)
      (190,1.6)
   };
   \addplot+[gray,densely dashed,line width=1.0pt] coordinates {
      (180,0.6)
      (180,1.0)
   };
   \addplot+[black,smooth,line width=1.0pt] coordinates {
      (149,1.0)
      (190,1.0)
   };
   \addplot+[black,smooth,line width=1.0pt] coordinates {
      (149,1.31)
      (190,1.31)
   };
   \node[color=black] at (axis cs:202,1.57) {$L^s$};
   \node[color=black] at (axis cs:180,1.57) {$(1-\mathit{UE}^{\mathit{min}})L^s$};
   %\node[fill=white,draw] at (0,0) {$y (0,0)$};
   \node[color=black] at (axis cs:152,1.33) {$W^e$};
   \node[color=black] at (axis cs:153,1.03) {$W^{\mathit{res}}$};
   \node[color=black] at (axis cs:182,0.63) {$L^d_1$};
   \node[color=black] at (axis cs:192,0.63) {$L^d_2$};
   \node[color=blue] at (axis cs:153,1.21) {$D_1$};
   \node[color=blue] at (axis cs:248,0.75) {$D_1$};
   \node[color=red] at (axis cs:153,1.57) {$D_2$};
   \node[color=red] at (axis cs:248,1.11) {$D_2$};
   %\draw[<->,gray,densely dashed] (axis cs:181,0.8) -- (199,0.8);
   \draw[<->,color=gray] (axis cs:181,0.8) -- (axis cs:199,0.8);
   \node[color=black] at (axis cs:185,0.82) {$\mathit{UE}$};
   %\node[blue] at (axis cs:181,1.03) {A};
   \node[draw,circle,color=black] at (axis cs:181,1.04) {A};
   \node[draw,circle,color=black] at (axis cs:194,1.34) {B};
   \node[draw,circle,color=black] at (axis cs:194,1.04) {C};
   \end{axis}
   \end{tikzpicture}
\caption{{Labor market closure}}
\label{fig:LabMarket}
\end{figure}

Equation~(\ref{eq:reswage}) defines the reservation wage,
$\mathit{W}^{\mathit{res}}$. It is a positive function of income growth per
capita and the CPI. It is a negative function of the unemployment rate, i.e.
if the rate of unemployment increases, this would tend to have a downward
pressure on the reservation wage. The (positive) elasticities
$\omega^{\mathit{rwg}}$ and $\omega^{\mathit{rwp}}$ reflect the sensitivity of
the reservation wage with respect to income growth and the CPI, respectively.
The (positive) elasticity $\omega^{\mathit{rwue}}$ reflects the sensitivity of
the reservation wage with respect to the rate of unemployment.\footnote{To deal
with the possibility of zero unemployment, i.e. full employment, the reservation
wage equation is formulated in terms of changes to 1 minus the unemployment
rate, i.e. the rate of employment. The elasticity in this case should be
positive, i.e. as we approach full employment, the reservation wage is likely to
increase. The respective elasticities are linked by the formula:
$\eta=-\omega\left(1-\mathit{UE}\right)/\mathit{UE}$, where $\omega$ is the
elasticity with respect to the unemployment rate and $\eta$ is the elasticity
with respect to the employment rate. Note that this relation is not constant and
depends on the rate of unemployment. For example, if the elasticity between the
reservation wage and the unemployment rate is -0.5 and the initial unemployment
rate is 10~percent, the elasticity with respect to the employment rate is 4.5
($=-(-0.5)\cdot 0.9/0.1$).} The market wage, $W^e$ is determined by
equation~(\ref{eq:ewagez}) reflecting the complementarity condition as the
expression uses the '\texttt{=g=}' relational operator of GAMS. This equation
will be paired with the complementarity condition on the unemployment level.
Equation~(\ref{eq:uez}) defines the unemployment level.

\begin{equation}
\label{eq:reswage}
\mathit{W}^{\mathit{res}}_{r,l,z,t} =
   \chi^{rw}_{r,l,z}
   \left( 1 + g^y_{r,t}
   \right)^{\omega^{\mathit{rwg}}_{r,l,z}}
   \left( {\mathit{1-UE}^z_{r,l,z,t}}
   \right)^{\omega^{\mathit{rwue}}_{r,l,z}}
   \left( \frac {\mathit{PFD}_{r,h,t}} {\mathit{PFD}_{r,h,t-1}}
   \right)^{\omega^{\mathit{rwp}}_{r,l,z}}
\end{equation}

\begin{equation}
\label{eq:ewagez}
\mathit{W}^e_{r,l,z,t} \ge
   \mathit{W}^{\mathit{res}}_{r,l,z,t}
   \perp \mathit{UE}^z_{r,l,z,t} \ge \mathit{UEMin}^z_{r,l,z,t}
\end{equation}

\subsubsection{Monash-style labor market closure}

Equation~(\ref{eq:monashUE}) defines the motion equation
for the real wage, $\mathit{RW}$, where the superscript
$b$ refers to the baseline levels.\footnote{N.B. There is
a subtle difference with the original Monash formulation. In \textsc{Envisage}, the
equation is specified for each labor type, $l$ (and potentially
for each zone). In Monash, the equation holds for aggregate labor
demand. Wages by skill and sector are given as a proportion of the
prevailing wage.} The baseline scenario is used
to calibrate real wages and full employment is assumed.
In shock scenarios, both the real wage and labor demand
may deviate from baseline values in the short-run.
The parameter $\chi^l$ determines the speed of adjustment
back to baseline employment levels. In the standard
specification, $\eta^l$ is set to zero implying that
there is no permanent deviation from the baseline
employment level.\footnote{\cite{DixonRimmer2002} argue that,
at least in the case of Australia, this parameter ranges
from 0 to 0.15 and typically set the parameter to 0.}
The residual term can be used to shift the real wage
formulation---\cite{DixonRimmer2002} use this term to
smooth out cycles in the real wage as it converges
towards its long-term path.

\begin{equation}
\label{eq:monashUE}
\left[\frac{\mathit{RW}_{r,l,z,t}}{\mathit{RW}^b_{r,l,z,t}} - 1\right]
= \left[\frac{\mathit{RW}_{r,l,z,t-1}}{\mathit{RW}^b_{r,l,z,t-1}} - 1\right] + \chi^l_{r,l,z,t}
\left[\frac{\mathit{LD}^z_{r,l,z,t}}{\mathit{LD}^{z,b}_{r,l,z}} -
\left( \frac{\mathit{RW}_{r,l,z,t-1}}{\mathit{RW}^b_{r,l,z,t-1}}\right)^{\eta^l_{r,l,z}}\right] + \varepsilon^w_{r,l,z,t}
\end{equation}

Equation~(\ref{eq:uez}) holds for all model specifications. In the case of full-employment, $\mathit{UE}^z$ is
exogenous and this equation in effect is the equilibrium equation that determines the equilibrium wage rate.
This also holds for the Monash closure for the baseline. It could also hold for the baseline for the reservation
wage closure, where trend unemployment is fixed. In this case, the shifter on the reservation wage equation, $\chi^{rw}$,
is endogenous. In policy simulations, the shifter is fixed and unemployment is endogenous.
For the Monash closure, equation~(\ref{eq:monashUE}) is normally only active for policy simulations---though
it could also be active for other closures with the residual term, $\varepsilon^w$, then endogenous.

\begin{equation}
\label{eq:uez}
\left( 1 - \mathit{UE}^z_{r,l,z,t} \right) \mathit{LS}^z_{r,l,z,t}
   = \mathit{LD}^z_{r,l,z,t}
\end{equation}

The model allows for inter-sectoral wage differentials. These are represented by
the $\pi^w$ parameters that are calibrated using base year wage differentials
and held fixed afterwards. This implies that all wages (for a particular skill
and within a zone) move proportionately but allowing for wage differentials.
Note that this assumption has potential implications for model results as any
inter-sectoral shifts in labor may imply shifts in aggregate labor productivity
(irrespective of technological change). Equation~(\ref{eq:wage}) sets the
sectoral wage equal to the equilibrium wage (by zone) adjusted by the
sector-specific wage differential.

\begin{equation}
\label{eq:wage}
\begin{array}{*{20}{l}}
\mathit{PF}_{r,l,a} = \pi^w_{r,l,a} W^e_{r,l,z} & \textrm{for } a \in z
\end{array}
\end{equation}

If the rural to urban migration module is active, it depends on the so-called
urban premium, i.e. the extent to which the urban wage exceeds the rural wage.
Equation~(\ref{eq:awagez}) defines the average wage in each of the zones, $W^a$
(by skill). Equation~(\ref{eq:urbPrem}) defines the urban premium,
$\pi^{\mathit{Urb}}$. It is the ratio of the expected urban wage to the expected
rural wage, where the actual average wage is adjusted by the probability of
employment. Migration, which will be a function of the urban premium, is
described below as part of the dynamics of the model. In the comparative static
version of the model, it is assumed that labor supply is fixed (by zone).

\begin{equation}
\label{eq:awagez}
\mathit{W}^a_{r,l,z} =
   \frac{ \sum_{a \in z} {\mathit{PF}_{r,l,a} \mathit{XF}_{r,l,a} } }
        { \sum_{a \in z} {\mathit{XF}_{r,l,a} } }
\end{equation}

\begin{equation}
\label{eq:urbPrem}
\pi^{\mathit{Urb}}_{r,l} =
   \frac { \left( 1 - \mathit{UE}^z_{r,l,\mathit{Urb}} \right)
            W^a_{r,l,\mathit{Urb}}}
         {\left( 1 - \mathit{UE}^z_{r,l,\mathit{Rur}}\right)
            W^a_{r,l,\mathit{Rur}}}
\end{equation}

Another potentially useful concept is the notion of the skill premium, i.e. the
extent to which skilled wages exceed unskilled wages.\footnote{In a dynamic
calibration scenario, assumptions regarding the evolution of the skill premium
can be used to calibrate the relative growth of skilled vs. unskilled labor or
to calibrate productivity differentials across skills.}
Equation~(\ref{eq:twage}) defines the average economy-wide wage for each skill
type, $W^t$.\footnote{In the case of non-segmented markets, $W^t_{r,l}$ should
be equal to $W^a_{r,l,\mathit{nsg}}$.} Equation~(\ref{eq:skillprem}) defines the
so-called skill premium,  $\pi^s$. It is the percentage by which the reference
wage exceeds other wages, where the reference wage is equal to a weighted
average of wages over a subset of labor skills (where the subset is indexed by
$\mathit{lr}$)---the subset is typically the set of skilled labor types.

\begin{equation}
\label{eq:twage}
W^t_{r,l} =
   \displaystyle \frac{\sum_{a}{\mathit{PF}_{r,l,a} \mathit{XF}_{r,l,a}}}
      {\sum_{a}{\mathit{XF}_{r,l,a}}}
\end{equation}

\begin{equation}
\label{eq:skillprem}
\pi^s_{r,l,t} =
   \frac {  \sum_{\mathit{lr}} {
               W^t_{r,\mathit{lr},t}\mathit{LAB}^s_{r,\mathit{lr},t}
            }
   /  \sum_{\mathit{lr}} {
         \mathit{LAB}^s_{r,\mathit{lr},t}
      } } {W^t_{r,\mathit{l},t} } - 1
\end{equation}

The final two sets of equations define the total labor supply by skill,
equation~(\ref{eq:labseq}), and the total labor supply,
equation~(\ref{eq:tlabeq}), respectively, $\mathit{L}^s$ and $\mathit{TL}^s$. In
comparative static simulations, $\mathit{LS}^z$ is fixed by zone. In dynamic
simulations, $\mathit{LS}^z$ grows at some 'natural' rate of growth, but may
also be adjusted by rural to urban migration. This is further described below.

\begin{equation}
\label{eq:labseq}
\mathit{L}^s_{r,l} = \sum_z{\mathit{LS}^z_{r,l,z}}
\end{equation}

\begin{equation}
\label{eq:tlabeq}
\mathit{TL}^s_{r} = \sum_l{\mathit{L}^s_{r,l}}
\end{equation}

\subsection{Capital market}

The model can operate in recursive dynamic mode or in comparative static mode.
Capital market closure differs in each. In the comparative static mode, there
is a single vintage and aggregate capital is allocated across activities using
a CET transformation function. The latter allows two extreme assumptions---fixed
capital per activity, i.e. no mobility, and perfect mobility and a uniform rates
of return across activities. In dynamic mode, with vintage capital, \emph{New}
capital is fully mobile across sectors. \emph{Old} capital is released on the
secondary capital market if installed capital exceeds demand, for example in
declining sectors.

\subsubsection{Comparative static closure}

A CET transformation function is used to allocate aggregate capital in the
comparative static version of the model. Equation~(\ref{eq:kscs}) describes the
supply of capital to activity $a$, $K^s$, where $\omega^k$ determines the degree
of mobility across activities.\footnote{The vintage index is for convenience
only. In the comparative static version there is only a single vintage.} With
perfect mobility, the rate of return across activities is uniform.
Equation~(\ref{eq:trcs}) determines the aggregate rate of return to capital,
$\mathit{TR}$. Equation~(\ref{eq:pkcs}) is the equilibrium condition for
capital---supply of capital to each activity is equal to demand. In the model
implementation the equilibrium condition is substituted out.

\begin{equation}
\label{eq:kscs}
\begin{cases}
\displaystyle K^s_{r,a,v} =
   \gamma^k_{r,a,v}
   \left( \frac{\mathit{PK}_{r,a,v}} {\mathit{TR}_r}
   \right)^{\omega^k_r}
   \mathit{TK}^s_r
& \textrm{if } \omega^k_{r} \ne \infty \\
\displaystyle \mathit{PK}_{r,a,v} =
   \mathit{TR}_r
& \textrm{if } \omega^k_{r} = \infty \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:trcs}
\mathit{TR}_r \mathit{TK}^s_r =
   \sum_a {\sum_v {\mathit{PK}_{r,a,v} K^s_{r,a,v} } }
\end{equation}

\begin{equation}
\label{eq:pkcs}
K^s_{r,a,v} = K^v_{r,a,v}
\end{equation}

\subsubsection{Vintage capital closure}

There are two types of capital in the vintage specification, \emph{Old}, or installed
capital, and \emph{New} capital. Initial installed capital is set at the beginning of the period
and is equal to the depreciated level of the previous period's aggregation of
both \emph{Old} and \emph{New} capital. The demand for \emph{New} capital will
depend on market conditions, substitution and other factors. A sector
is in expansion if demand for \emph{New} capital exceeds the initial
installed capital. A sector is in contraction if demand for capital in the
sector is less than its initial installed capital. This can come about, for example,
if public policies affect demand for a good---such as a carbon tax leading
to reduced demand for coal or oil. If a sector is in contraction, it will
release its \emph{Old} capital using an upward sloping supply schedule, potentially
with an infinite elasticity.

Figure~\ref{fig:kSupply} represents the two
possible regimes each under two possible capital demand schedules. The
left panel shows the case for a flat supply curve, i.e. an infinite
supply curve for \emph{Old} capital. In that case, even if capital
demand is contracting, the rate of return to \emph{Old} capital
is equated to the economy-wide rental rate, i.e. the ratio of
returns, \emph{Old} over \emph{New} is 1. The right panel shows
the case where the supply of \emph{Old} capital follows an upward
sloping schedule. If capital demand is in decline, the rate
of return to \emph{Old} capital will be less than the economy-wide
return. In the case of an expanding demand, the rate of return
to \emph{Old} capital is equal to the economy-wide return and
the supply of \emph{Old} capital is capped at the initially installed
level, i.e. $K_0$.

\input{kSupply}

Equation~(\ref{eq:kslo}) represents the mixed complementarity
condition for the supply of old capital. If demand is contracting,
the upward sloping portion of the supply schedule is determined
by the iso-elastic relation with the supply elasticity given
by $\eta^I$. At the inflection point, the supply of \emph{Old}
capital cannot exceed the amount of the initially installed \emph{Old}
given by $K^0$. The complementarity condition then translates into:
(a) all of the installed capital is needed, $K^{\mathit{lo}}=K^0$ and the ratio
of returns is equal to 1; or (b) the supply of old capital
is less than the installed capital and the ratio of returns is
less than 1. The second complementarity condition, equation~(\ref{eq:rrat}),
states that either the ratio of returns is 1 and thus supply of new
capital is positive, or the ratio is less than 1 and then the supply of new
capital is 0. Equation~(\ref{eq:kshi}) states that total supply
should meet total demand. The model allows for the possibility
of a horizontal supply schedule, in which case the ratio of returns
is equal to 1 irrespective of market conditions and supply will be
set to demand.

\begin{equation}
\label{eq:kslo}
K^{\mathit{lo}}_{r,a} \ge \mathit{K}^0_{r,a} \mathit{RR}_{r,a}^{\eta^I_{r,a}}
\perp \mathit{RR}_{r,a} \le 1
\end{equation}

\begin{equation}
\label{eq:rrat}
\mathit{RR}_{r,a} \le 1
\perp K^{\mathit{hi}}_{r,a} \ge 0
\end{equation}

\begin{equation}
\label{eq:kshi}
K^{\mathit{lo}}_{r,a} + K^{\mathit{hi}}_{r,a} = \sum_v{K^v_{r,a,v}}
\end{equation}

Equation~(\ref{eq:tr}) determines the economy-wide rate of return,
$\mathit{TR}$. Equation~(\ref{eq:pk}) determines the sector- and
vintage-specific rate of return. If the activity uses \emph{New} capital,
$\mathit{RR}$ is equal to 1 and both \emph{Old} and \emph{New} capital obtain
the rate of return $\mathit{TR}$. If the sector is in decline, it receives a
rate of return lower than the economy-wide rate of return.

\begin{equation}
\label{eq:tr}
\mathit{TK}^s_r = \sum_a {\sum_v { K^v_{r,a,v}} }
\end{equation}

\begin{equation}
\label{eq:pk}
\mathit{PK}_{r,a,v} = \mathit{RR}_{r,a} \mathit{TR}_r
\end{equation}

\subsubsection{Determination of output by vintage}

Aggregate output, $\mathit{XP}$, is determined by equilibrium conditions.
Equation~(\ref{eq:kxrat}) represents the contemporaneous capital-output ratio
for the \emph{Old} vintage, $\mathit{kxRat}$. Equation~(\ref{eq:xpvold}) determines output with \emph{Old} capital. \emph{Old} output, will be equal to the
capital output ratio applied to the supply of old
capital, $K^{\mathit{lo}}$. Equation~(\ref{eq:xpv}) ensures that the sum
of output across vintages equals aggregate output. In the vintage capital
version of the model, it essentially determines production with \emph{New}
capital. In the comparative static version, it trivially equates total
production to production produced by the only vintage that is labeled
\emph{Old}.

\begin{equation}
\label{eq:kxrat}
\mathit{kxRat}_{r,a,\mathit{Old}} =
   \frac {K^v_{r,a,\mathit{Old}}} {\mathit{XPv}_{r,a,\mathit{Old}}}
\end{equation}

\begin{equation}
\label{eq:xpvold}
\mathit{kxRat}_{r,a,\mathit{Old}} \mathit{XPv}_{r,a,\mathit{Old}} =
K^{\mathit{lo}}_{r,a}
\end{equation}

\begin{equation}
\label{eq:xpv}
\mathit{XP}_{r,a} = \sum_v{ \mathit{XPv}_{r,a,v}}
\end{equation}

Equations~(\ref{eq:xfcap}) and~(\ref{eq:pfcap}) are added for accounting
purposes as many of the various income identities are simplified with these
substitutions. Equation~(\ref{eq:pfcap}) holds in all circumstances. If an
activity is expanding the return on installed capital is equal to the return on
\emph{New} capital. If an activity is contracting, the only relevant return is
on \emph{Old} capital.

\begin{equation}
\label{eq:xfcap}
\mathit{XF}_{r,cap,a} = \sum_v{ \mathit{K}^v_{r,a,v}}
\end{equation}

\begin{equation}
\label{eq:pfcap}
\mathit{PF}_{r,cap,a} = \mathit{PK}_{r,a,\mathit{Old}}
\end{equation}

\subsection{Land market}

The supply side of the land market has two components. The first component
provides the aggregate supply of land, by land-type.\footnote{[20-Apr-2022]
The code has been modified to allow for multiple land types, for example
AEZs. The specification for land supply is identical to the previous
version except that all relevant equations and variables are now
indexed by land type, i.e., $\mathit{lnd}$. With the default GTAP
database, there is a single land-type. With GTAP's AEZ database, there
can be up to 18 land-types for each land-using activity in each region.}
The second step allocates aggregate land by type
across different activities allowing for a nested CET structure, the possibility
of perfect mobility, and the use of the adjusted CET that preserves land
additivity.

The aggregate land supply curve is allowed to have four shapes---constant
elasticity, a logistic curve with an upward asymptote, a generalized hyperbola
also with an upward asymptote, and perfectly horizontal. The aggregate land
supply curve is given by equation~(\ref{eq:tland}). The initial elasticity of
aggregate land is given by $\eta^t$.

\begin{equation}
\label{eq:tland}
\begin{cases}
   \displaystyle \mathit{TLand}_{r,\mathit{lnd}} =
      \chi^t_{r,\mathit{lnd}} \left( \frac{\mathit{PTLand}_{r,\mathit{lnd}}} {\mathit{PGDP}_r}
      \right)^{\eta^t_{r,\mathit{lnd}}}
   & \textrm{iso-elastic} \\
   \displaystyle \mathit{TLand}_{r,\mathit{lnd}} =
      \frac {\mathit{TLand}^{\mathit{Max}}_{r,\mathit{lnd}}}
            {1 + \chi^t_{r,\mathit{lnd}} e^{-\gamma^{\mathit{tl}}_{r,\mathit{lnd}}
               (\mathit{PTLand}_{r,\mathit{lnd}}/\mathit{PGDP}_r)}}
   & \textrm{logistic} \\
   \displaystyle \mathit{TLand}_{r,\mathit{lnd}} =
      {\mathit{TLand}^{\mathit{Max}}_{r,\mathit{lnd}}} {- \chi^t_{r,\mathit{lnd}}
      \left( \frac{\mathit{PTLand}_{r,\mathit{lnd}}} {\mathit{PGDP}_r}
      \right)^{-\gamma^{\mathit{tl}}_{r,\mathit{lnd}}}}
   & \textrm{hyperbola} \\
   \displaystyle \mathit{PTLand}_{r,\mathit{lnd}} = \mathit{PGDP}_{r,\mathit{lnd}}
   & \textrm{if } \eta^t_{r,\mathit{lnd}} = \infty \\
\end{cases}
\end{equation}

The iso-elastic curve by definition has a constant elasticity given by $\eta^t$.
The logistic function, in a simplified form is given by:

\[
S=\frac {\overbar{S}} {1+\chi e^{-\gamma P}}
\]

\noindent where $S$ is supply, the land maximum is given by $\overbar{S}$ and
$P$ is the real price of land. The supply elasticity is given by the following
formula:

\[
\eta = \gamma P \left( \frac {\overbar{S}-S}{\overbar{S}} \right)
\]

\noindent The $\gamma$ coefficient can be calibrated using the expression above
given initial values for $\eta$, $S$, $\overbar{S}$ and $P$. The calibration
formula is given by:

\[
\gamma = \frac{\eta} {P} \left( \frac {\overbar{S}} {\overbar{S}-S} \right)
\]

\noindent Calibration of the $\chi$ parameter is given by the following
expression and requires first calibrating the $\gamma$ parameter:

\[
\chi = e^{\gamma P} \left( \frac {\overbar{S}-S}{\overbar{S}} \right)
\]

The generalized hyperbola, using the same notation is given by:

\[
S= \overbar{S} - \chi P^{-\gamma}
\]

\noindent The supply elasticity is given by the following formula:

\[
\eta = \gamma \left( \frac {\overbar{S}-S}{{S}} \right)
\]

\noindent The $\gamma$ coefficient can be calibrated using the expression above
given initial values for $\eta$, $S$, $\overbar{S}$ and $P$. The calibration
formula is given by:

\[
\gamma = {\eta} \left( \frac {{S}} {\overbar{S}-S} \right)
\]

\noindent Calibration of the $\chi$ parameter is given by the following
expression and requires first calibrating the $\gamma$ parameter:

\[
\chi = P^\gamma \left( \overbar{S}-S \right)
\]

The user chooses the functional form by setting the global parameter named
\texttt{TASS} towards the top of a simulation file. Valid options are
\texttt{KELAS} for the iso-elastic form, \texttt{LOGIST} for the logistic
specification, \texttt{HYPERB} for the generalized hyperbola and \texttt{INFTY}
for the horizontal supply function.\footnote{These options are defined in the
\texttt{model.gms} file with a set named \texttt{landAssumptions}. The subset
named \texttt{tass} contains the user-chosen specification.}

Total land is allocated across different uses according to the relative rates of
return across uses. A nested CET structure is implemented that allows for a
degree of user control.\footnote{The implementation was first developed to mimic
the CET structure of the land allocation specification in the MAGNET model.}
Figure~\ref{fig:LandNest} provides a graphic depiction of the land allocation
specification. The number of land bundles ($\mathit{XLB}$) is under user
control, but typically there should be at least one. The first land bundle is in
the top CET nest with an intermediate land bundle ($\mathit{XLB}$). All other
land bundles are nested within the intermediate land bundle. Some possible
configurations from the literature include:

\begin{itemize}
\item{To mimic
MAGNET's specification, \texttt{v\_f}, \texttt{ocr}, \texttt{oap} are mapped
to land bundle 1, \texttt{sug}, \texttt{ctl} and \texttt{rmk} are mapped to land
bundle 2 and \texttt{ric}, \texttt{wht}, \texttt{gro} and \texttt{osd} are
mapped to land bundle 2. The MAGNET model has two intermediate bundles and only
three elasticities. In this specification, there are four intermediate bundles.
Thus the top elasticity and the elasticity for land bundle 1
(horticulture, etc.), in MAGNET, are identical (and set to $\sigma^1$ in the
MAGNET documentation, see \url{edepot.wur.nl/310764}, page 74).
The elasticity
for the intermediate land bundle and the second land bundle (pasture, etc.)
would also be identical (and set to $\sigma^2$). And the third land bundle
(cereals) would have the elasticity given by $\sigma^3$.}
\item{The original version of the GTAP-AEZ model, \citep{HerteletalChap62009}
has forestry in land bundle 1. The intermediate bundle is called
agriculture---under which there are two additional bundles: crops
and grazing. All crops are then assigned to the \emph{Crops} bundle
and all livestock activities are assigned to the \emph{Grazing} bundle.\footnote{That
version of the GTAP-AEZ model had a fixed aggregation for grazing that
included cattle (\texttt{ctl}), raw milk (\texttt{rmk}) and wool (\texttt{wol}).}
The AEZ-based land-use database removes land-use from the \texttt{oap} sector.}
\item{A different version of the GTAP-AEZ model has altered the
original nesting. It has crops in bundle 1, and a grazing plus forestry
bundle as the intermediate bundle \citep{StevensonetalPNAS2013}.}
\end{itemize}

It is possible to
mimic the GTAP standard nesting, a single level nest, by defining only one land
bundle and use the GTAP transformation elasticity for that bundle. The top level
elasticity is essentially irrelevant since in this case the intermediate land
bundle would not be used.

\begin{figure}[ht]
\center{}
\begin{forest}
for tree={
   minimum height=1cm,
   font=\tiny,
%  font=\sffamily,
   anchor=north,
   align=center,
   child anchor=north,
   s sep=1em,
   l sep=0.75cm,
},
%where n children=0{tier=word}{}
[{Total land \\ supply ($\mathit{TLand}_{\mathit{lnd}}$)}, draw, drop shadow, fill=dkBlue, rounded corners=2pt, name=TLAND
   [{Land bundle(1) \\  ($\mathit{XLB}_{\mathit{lnd},\mathit{lb1}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XLB1
   [][$\mathit{XF}_{\mathit{lnd},a} \in \mathit{XLB}_{\mathit{lnd},\mathit{lb1}}$, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
   ]
   [{Demand for intermediate \\ land bundle ($\mathit{XNLB}_{\mathit{lnd}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XNLB
      [{Land bundle(2) \\ ($\mathit{XLB}_{\mathit{lnd},\mathit{lb2}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XLB2
      [][$\mathit{XF}_{\mathit{lnd},\mathit{lnd},a} \in \mathit{XLB}_{\mathit{lnd},\mathit{lb2}}$, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
      ]
      [{Land bundle(3) \\ ($\mathit{XLB}_{\mathit{lnd},\mathit{lb3}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XLB3
      [][$\mathit{XF}_{\mathit{lnd},a} \in \mathit{XLB}_{\mathit{lnd},\mathit{lb3}}$, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
      ]
      [{Land bundle($n$) \\ ($\mathit{XLB}_{\mathit{lnd},\mathit{lbn}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=XLBN
      [][$\mathit{XF}_{\mathit{lnd},a} \in \mathit{XLB}_{\mathit{lnd},\mathit{lbn}}$, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
      ]
   ]
]
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.45cm]TLAND.south) {\scriptsize $\omega^{\mathit{t}}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.05cm]XLB1.south) {\scriptsize $\omega^{\mathit{lb1}}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.05cm]XNLB.south) {\scriptsize $\omega^{\mathit{nlb}}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.05cm]XLB2.south) {\scriptsize $\omega^{\mathit{lb2}}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.05cm]XLB3.south) {\scriptsize $\omega^{\mathit{lb3}}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.05cm]XLBN.south) {\scriptsize $\omega^{\mathit{lbn}}$};
%{\draw[white,dotted] (!1) -| coordinate(p) () ;
%\path ()--(p) node[pos=0.1,left,inner sep=1pt]{\scriptsize $\sigma^p$};}
\end{forest}
\caption{{CET nest for land allocation across activities by land-type}}
\label{fig:LandNest}
\end{figure}

The top level nest decomposes total land supply into land bundle 1 and the
intermediate land bundle. Equations~(\ref{eq:lb1}) and~(\ref{eq:nlb}) provide
the first order conditions and hold irrespective of the CET specification
used---either the standard, with \texttt{ifLandCET} set to 1, or the adjusted,
volume preserving, CET specification. Equation~(\ref{eq:ptlandn}) defines the
aggregate price index of land, $\mathit{PTLandN}$. The index expression depends
on the choice of CET specification. For the standard CET, the price index will
be identical to the average price (defined next). For the adjusted CET, the
price index will not generally be equal to the average price. Note that the
price index expressions are not incorporated in the model under the assumption
of perfect transformation, i.e. when the transformation elasticity is infinite.
The average price of aggregate land, $\mathit{PTLand}$ is given in
equation~(\ref{eq:ptland}) and holds for both versions of the CET.

\begin{equation}
\label{eq:lb1}
\begin{cases}
\displaystyle \mathit{XLB}_{r,\mathit{lnd},\mathit{lb1}} =
   \gamma^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb1}}
   \left( \frac{\mathit{PLB}_{r,\mathit{lnd},\mathit{lb1}}} {\mathit{PTLandN_{r,\mathit{lnd}}}}
   \right)^{\omega^t_{r,\mathit{lnd}}}
   \mathit{TLand_{r,\mathit{lnd}}}
& \textrm{if } \omega^t_{r,\mathit{lnd}} \ne \infty \\
\displaystyle \mathit{PLB}_{r,\mathit{lnd},\mathit{lb1}} = \mathit{PTLand_{r,\mathit{lnd}}}
& \textrm{if} \; \omega^t_{r,\mathit{lnd}} = \infty \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:nlb}
\begin{cases}
\displaystyle \mathit{XNLB}_{r,\mathit{lnd}} =
   \gamma^{\mathit{nlb}}_{r,\mathit{lnd}}
   \left( \frac{\mathit{PNLB}_{r,\mathit{lnd}}} {\mathit{PTLandN_{r,\mathit{lnd}}}}
   \right)^{\omega^t_{r,\mathit{lnd}}}
   \mathit{TLand_{r,\mathit{lnd}}}
&  \textrm{if} \; \omega^t_{r,\mathit{lnd}} \ne \infty \\
\displaystyle \mathit{PNLB}_{r,\mathit{lnd}} = \mathit{PTLand_{r,\mathit{lnd}}}
& \textrm{if} \; \omega^t_{r,\mathit{lnd}} = \infty \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:ptlandn}
\begin{cases}
\mathit{PTLandN_{r,\mathit{lnd}}} =
   \left[
      \gamma^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb1}}
      \mathit{PLB}_{r,\mathit{lnd},\mathit{lb1}}^{1+\omega^t_{r,\mathit{lnd}}}
   +  \gamma^{\mathit{nlb}}_{r,\mathit{lnd}}
      \mathit{PNLB}_{r,\mathit{lnd}}^{1+\omega^t_{r,\mathit{lnd}}}
   \right]^{{1}/{(1+\omega^t_{r,\mathit{lnd}})}}
& \textnormal{if } \mathit{ifLandCET} \\
\mathit{PTLandN_{r,\mathit{lnd}}} =
   \left[
      \gamma^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb1}}
      \mathit{PLB}_{r,\mathit{lnd},\mathit{lb1}}^{\omega^t_{r,\mathit{lnd}}}
   +  \gamma^{\mathit{nlb}}_{r,\mathit{lnd}}
      \mathit{PNLB}_{r,\mathit{lnd}}^{\omega^t_{r,\mathit{lnd}}}
   \right]^{{1}/{\omega^t_{r,\mathit{lnd}}}}
& \textnormal{if } \neg \mathit{ifLandCET} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:ptland}
\mathit{PTLand_{r,\mathit{lnd}}} \mathit{TLand_{r,\mathit{lnd}}} =
   \mathit{PLB}_{r,\mathit{lnd},\mathit{lb1}} \mathit{XLB}_{r,\mathit{lnd},\mathit{lb1}}
+  \mathit{PNLB}_{r,\mathit{lnd}}\mathit{XNLB}_{r,\mathit{lnd}}
\end{equation}

The second level nest decomposes the intermediate land bundle (if it is defined)
into a number of user determined land bundles, excluding the first land bundle.
Equation~(\ref{eq:lbn}) defines the demand for the land bundles as a share of
the intermediate land bundle.\footnote{The index $\mathit{lb}$ excludes the
first land bundle.} The price index of the intermediate land bundle is defined
in equation~(\ref{eq:pnlbn}), allowing for both CET specifications and is only
included if the transformation elasticity at this nest is finite. The average
price of the land bundle is defined in equation~(\ref{eq:pnlb}).

\begin{equation}
\label{eq:lbn}
\begin{cases}
   \displaystyle \mathit{XLB}_{r,\mathit{lnd},\mathit{lb}} =
      \gamma^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb}}
      \left( \frac{\mathit{PLB}_{r,\mathit{lnd},\mathit{lb}}} {\mathit{PNLBN_{r,\mathit{lnd}}}}
      \right)^{\omega^{\mathit{nlb}}_{r,\mathit{lnd}}}
      \mathit{XNLB_{r,\mathit{lnd}}}
   & \textrm{if } \omega^{\mathit{nlb}}_{r,\mathit{lnd}} \ne \infty \\
   \displaystyle \mathit{PLB}_{r,\mathit{lnd},\mathit{lb}} = \mathit{PNLB_{r,\mathit{lnd}}}
   & \textrm{if }  \omega^{\mathit{nlb}}_{r,\mathit{lnd}} = \infty \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pnlbn}
\begin{cases}
   \mathit{PNLBN}_{r,\mathit{lnd}} =
      \displaystyle
         \left[
            \sum_{\left\{ \mathit{lb}: \mathit{lb} \ne {\mathit{lb1}}\right\}} {
               \gamma^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb}}
               \mathit{PLB}_{r,\mathit{lnd},\mathit{lb}}^{1+\omega^{\mathit{nlb}}_{r,\mathit{lnd}}}
            }
         \right]^{{1}/{(1+\omega^{\mathit{nlb}}_{r,\mathit{lnd}})}}
      & \textrm{if} \; \mathit{ifLandCET} \\
   \mathit{PNLBN}_{r,\mathit{lnd}} =
      \displaystyle
         \left[
            \sum_{\left\{\mathit{lb}:\mathit{lb} \ne {\mathit{lb1}}\right\}} {
               \gamma^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb}}
               \mathit{PLB}_{r,\mathit{lnd},\mathit{lb}}^{\omega^{\mathit{nlb}}_{r,\mathit{lnd}}}
            }
         \right]^{{1}/{\omega^{\mathit{nlb}}_{r,\mathit{lnd}}}}
      & \textrm{if} \; \neg \mathit{ifLandCET} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pnlb}
\mathit{PNLB_{r,\mathit{lnd}}} \mathit{XNLB_{r,\mathit{lnd}}} =
   \sum_{\left\{ \mathit{lb}: \mathit{lb} \ne \mathit{lb1} \right\} }{
   \mathit{PLB}_{r,\mathit{lnd},\mathit{lb}} \mathit{XLB}_{r,\mathit{lnd},\mathit{lb}}}
\end{equation}

The bottom land nest(s) decompose each of the land bundles into the primary land
allocation to each activity $a$---each activity $a$ (that uses land) must be
mapped to one, and only one, land bundle. Equation~(\ref{eq:lands}) defines the
supply of land to activity $a$ that has been mapped to land bundle
$\mathit{lb}$. Equation~(\ref{eq:plbn}) defines the price index for the bundles
that depends on the CET specification. And equation~(\ref{eq:plb}) defines the
average price of the land bundles.

\begin{equation}
\label{eq:lands}
\begin{cases}
   \displaystyle \mathit{Land}^s_{r,\mathit{lnd},a} =
      \gamma^{t}_{r,\mathit{lnd},a}
      \left( \frac {\mathit{PF}_{r,\mathit{lnd},a}}
         {\mathit{PLBN}_{r,\mathit{lnd},\mathit{lb}}}
      \right)^{\omega^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb}}}
      \mathit{XLB}_{r,\mathit{lnd},\mathit{lb}}
   & \textrm{if } \omega^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb}} \ne \infty \\
   \displaystyle \mathit{PF}_{r,\mathit{lnd},a} = \mathit{PLB}_{r,\mathit{lnd},\mathit{lb}}
   & \textrm{if} \; \omega^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb}} = \infty \\
\end{cases} {a \in \left\{ \mathit{lb} \right\}}
\end{equation}

\begin{equation}
\label{eq:plbn}
\begin{cases}
   \mathit{PLBN}_{r,\mathit{lnd},\mathit{lb}} =
      \displaystyle \left[ \sum_{a \in \left\{ \mathit{lb} \right\} } {
         \gamma^{t}_{r,\mathit{lnd},a}
         \mathit{PF}_{r,\mathit{lnd},a}^{1+\omega^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb}}}
      } \right]^{{1}/{(1+\omega^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb}})}}
   & \textrm{if } \mathit{ifLandCET} \\
   \mathit{PLBN}_{r,\mathit{lnd},\mathit{lb}} =
      \displaystyle \left[ \sum_{a \in \left\{ \mathit{lb} \right\} } {
         \gamma^{t}_{r,\mathit{lnd},a}
         \mathit{PF}_{r,\mathit{lnd},a}^{\omega^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb}}}
      } \right]^{{1}/{\omega^{\mathit{lb}}_{r,\mathit{lnd},\mathit{lb}}}}
   & \textrm{if} \; \neg \mathit{ifLandCET} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:plb}
\mathit{PLB}_{r,\mathit{lnd},\mathit{lb}} \mathit{XLB}_{r,\mathit{lnd},\mathit{lb}} =
   \displaystyle \sum_{a \in \left\{ \mathit{lb} \right\} } {
      \mathit{PF}_{r,\mathit{lnd},a} \mathit{Land}^s_{r,\mathit{lnd},a}
   }
\end{equation}

The final equation in the land market module, equation~(\ref{eq:pland}) equates
land supply to activity $a$ to its respective demand thus determining the
equilibrium and sector-specific price for land, $\mathit{PF}_{\mathit{lnd}}$.
The equation is substituted out of the model specification.

\begin{equation}
\label{eq:pland}
\mathit{Land}^s_{r,\mathit{lnd},a} = \mathit{XF}_{r,\mathit{lnd},a}
\end{equation}

\subsection{Market for natural resources}

Natural resources are assumed to be activity-specific, for example crude oil
reserves. The supply of natural resources, $\mathit{XNRS^s}$, is governed by a
kinked iso-elastic supply curve. The model allows the supply response to differ
according to whether market conditions are leading to increased supply, the 'hi'
elasticity, versus a contracting market, the 'lo' elasticity. Ideally, we could
implement this with a regime shift using continuous functions, but discontinuous
derivatives. Instead, we add an equation to the model that determines the supply
elasticity using the sigmoid function, also known as a logistic
function.\footnote{This is used for example in the CAPRI model of global
agriculture with a focus on the EU, \cite{Britzetal2007}.} The sigmoid function
is defined by:

\[
f(x) = \frac{1}{1+e^{-x}}
\]

\noindent Equation~(\ref{eq:etanrs}) defines the applied elasticity as a
function of market conditions. The user enters the 'lo' and 'hi' elasticities in
the parameters $\eta^{\mathit{nrsx}}$. One would typically assume that the 'lo'
elasticity is higher than the 'hi' elasticity, i.e. it is harder to expand
output than to contract output. If the two are identical, the equation is
trivial. The argument in the sigmoid function reflects market growth and will be
positive for expansion and negative for contraction. The $\kappa$ parameter
captures the 'speed' of adjustment between the 'lo' and 'hi' elasticities.
The greater the value, the more rapid the transition. We have used a value of 30
with few numerical problems.\footnote{The sigmoid function is an intrinsic
function in GAMS.} Figure~\ref{fig:kinkSupply} shows the kinked elasticity and
the resulting supply curve s a function of price. It is centered at a price
of~1. The 'lo' elasticity is assumed to be 2 and the 'hi' elasticity is 0.5.
The 'kink' parameter is been set at 10 in this example.

%\clearpage

\begin{figure}[ht]
\begin{minipage}{\textwidth}
\centering
   \input{KinkSupply}
   \caption{Example of a kinked supply curve using the sigmoid function}
   \label{fig:kinkSupply}
\end{minipage}
\end{figure}

Equation~(\ref{eq:xnrss}) reflects the supply function for the natural resource.
For finite elasticities, it is an iso-elastic function, however, where the
supply elasticity is determined by market conditions as described above. It is a
function of the growth of the real price of the natural resource and the supply
curve shifts according to lagged supply.\footnote{This is somewhat different
from the previous specification where the supply shifter was constant unless
endogenous for calibration purposes.} The (finite) supply curve has two shifters
that can be used to target either the regional output price of the commodity
being produced or the global price. To target the regional price, exogenize the
output price, $\mathit{PX}$, and endogenize the regional shifter,
$\chi^{\mathit{nrs}}$. To target the global price, exogenize the average
producer price, $\mathit{PW}$,\footnote{Defined in equation~(\ref{eq:pw}).} and
endogenize the global shifter, $\chi^{w,\mathit{nrs}}$. The supply curve can
also be horizontal, in which case the supply price is fixed relative o an anchor
price, herein the GDP deflator. Equation~(\ref{eq:pnrs}) determines the
equilibrium price. The latter equation is substituted out of the model.

\begin{equation}
\label{eq:etanrs}
\eta^{\mathit{nrs}}_{r,a,t} =
   \eta^{\mathit{nrsx}}_{r,a,\mathit{lo}}
+  \frac {\eta^{\mathit{nrsx}}_{r,a,\mathit{hi}} -
      \eta^{\mathit{nrsx}}_{r,a,\mathit{lo}}}
      {1+exp\left(
         -\kappa
         \left[
            \displaystyle \frac{\mathit{XF}_{r,\mathit{nrs},a,t}}
            {\mathit{XF}_{r,\mathit{nrs},a,t-1}} - 1
         \right]
      \right)}
\end{equation}

\begin{equation}
\label{eq:xnrss}
\begin{cases}
   \displaystyle \mathit{XNRS}^s_{r,a,t} =
      \chi^{w,\mathit{nrs}}_a \chi^{\mathit{nrs}}_{r,a}
         \mathit{XNRS}^s_{r,a,t-1}
      \left( \frac {\chi^{\mathit{nrsp}}_{r,a}
         \mathit{PF}_{r,\mathit{nrs},a,t} / \mathit{PGDPMP}_{r,t}}
         {\mathit{PF}_{r,\mathit{nrs},a,t-1} / \mathit{PGDPMP}_{r,t-1}}
      \right)^{\eta^{\mathit{nrs}}_{r,a}}
   & \textrm{if } \eta^{\mathit{nrs}}_{r,a} \ne \infty \\
   \displaystyle \chi^{\mathit{nrsp}}_{r,a} \mathit{PF}_{r,\mathit{nrs},a} =
      \mathit{PGDPMP}_r
   & \textrm{if } \eta^{\mathit{nrs}}_{r,a} = \infty \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pnrs}
\mathit{XNRF}^s_{r,a} = \mathit{XF}_{r,\mathit{nrs},a}
\end{equation}

\subsection{Water market}

The market for water is somewhat similar to the land market. An aggregate supply
curve is provided---and aggregate supply is then allocated to different uses
using a nested CET structure. However, unlike land, water is in direct use in
only the irrigated crop sectors. Demand for water in other sectors is specified
using aggregate demand functions.

The aggregate water supply curve is allowed to have four shapes---constant
elasticity, a logistic curve with an upward asymptote, a generalized hyperbola
also with an upward asymptote, and perfectly horizontal. The aggregate water
supply curve is given by equation~(\ref{eq:th2o}). The initial elasticity of
aggregate water is given by $\eta^w$.

\begin{equation}
\label{eq:th2o}
\begin{cases}
   \displaystyle \mathit{TH2O}_{r} =
      \chi^{\mathit{h2o}}_{r}
      \left( \frac {\mathit{PTH2O}_{r}} {\mathit{PGDP}_r}
      \right)^{\eta^w_r}
   & \textrm{iso-elastic} \\
   \displaystyle \mathit{TH2O}_{r} =
      \frac {\mathit{TH2O}^{\mathit{Max}}_r}
         {1 + \chi^{\mathit{h2o}}_{r} e^{-\gamma^{\mathit{tw}}_{r}
            (\mathit{PTH2O}_{r}/\mathit{PGDP}_r)}}
   & \textrm{logistic} \\
   \displaystyle \mathit{TH2O}_{r} =
      {\mathit{TH2O}^{\mathit{Max}}_r}
         {- \chi^{\mathit{h2o}}_{r}
            \left( \frac{\mathit{PTH2O}_{r}} {\mathit{PGDP}_r}
            \right)^{-\gamma^{\mathit{tw}}_{r}}}
   & \textrm{hyperbola} \\
   \displaystyle \mathit{PTH2O}_{r} = \mathit{PGDP}_{r}
   & \textrm{if } \eta^w_{r} = \infty \\
\end{cases}
\end{equation}

The iso-elastic curve by definition has a constant elasticity given by $\eta^w$.
The calibration and other formulas for the logistic and hyperbola functions are
the same as the land market expressions and are not repeated here.

Water use at the sub-aggregate level is represented by a number of 'bundles',
$\mathit{H2OBnd}$. Table~\ref{tab:WatBundles} lists the bundles and their
relationships. The marketed water bundles are allocated in two CET nests. The
top nest allocates water between agriculture and non-agriculture. These bundles
are indexed by $\mathit{wb1}$. The second level nests include crops and
livestock linked to the agriculture bundle, and industrial and municipal water
use linked to the non-agriculture bundle. The second level bundles are indexed
by $\mathit{wb2}$. The second level bundles are also segmented into two
groups---$\mathit{wba}$ and $\mathit{wbi}$. The former allocates water across
different activities---for example irrigated crops---and the latter is linked to
an aggregate water demand---not explicitly linked to specific activities. The
set $\mathit{wbx}$ refers to exogenous water demand.

\begin{table}[H]
\caption{Aggregate water bundles}
\label{tab:WatBundles}
\begin{center}
\rowcolors{2}{TableOdd}{TableEven}
\rowcolors{1}{}{lightblue}
\footnotesize
\begin{tabular} {l l l l l}
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
{Name} & {Description} & {Set} & {Dependency} & {Type} \\
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
\texttt{ENV} & Environmental services & {} & $\mathit{TH2O}$ & {$\mathit{wbx}$} \\
\texttt{GRD} & Groundwater recharge & {} & $\mathit{TH2O}$ & {$\mathit{wbx}$} \\
\texttt{AGR} & All agriculture & {$\mathit{wb1}$} & $\mathit{TH2O}^m$ & {} \\
\texttt{CRP} & Crops & {$\mathit{wb2}$} & \texttt{AGR} & {$\mathit{wba}$} \\
\texttt{LVS} & Livestock & {$\mathit{wb2}$} & \texttt{AGR} & {$\mathit{wbi}$} \\
\texttt{NAG} & Not agriculture & {$\mathit{wb1}$} & $\mathit{TH2O}^m$ & {} \\
\texttt{IND} & Industrial water use & {$\mathit{wb2}$} & \texttt{NAG} & {$\mathit{wbi}$} \\
\texttt{MUN} & Municipal water use & {$\mathit{wb2}$} & \texttt{NAG} & {$\mathit{wbi}$} \\
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
\end{tabular}
\end{center}
\end{table}

At the top level water supply is allocated between marketed water and
non-marketed water. The latter is exogenous and split into two
variables---water for environmental services and water required for ground water
recharge. In equilibrium, one would assume the latter is close to zero, i.e.
ground water withdrawal closely matches ground water extraction. In the current
database, both of these exogenous water uses are initially set at zero. A policy
shock may include making these positive in a future time period---perhaps
permanently for environmental services and temporarily for ground water
recharge. Marketed water is then the difference between total water supply and
exogenous demand. Equation~(\ref{eq:th2omeq}) is the market supply equilibrium
equation equating total water supply to marketed water plus the sum of
all exogenous water demand. The variable $\mathit{H2O}^m$ represents marketed
water.

\begin{equation}
\label{eq:th2omeq}
\mathit{TH2O}_r =
   \mathit{TH2O}^m_r
      + \sum_{\mathit{wb} \in {wbx}} {\mathit{H2OBnd}_{r,\mathit{wb}}}
\end{equation}

Marketed water is allocated across the various water bundles using a nested
(adjusted) CET specification.\footnote{The adjusted CET specification preserves
quantity additivity---see Appendex~\ref{chap:CESAppendix}.}
Figure~\ref{fig:WaterNest} illustrates the nested structure.

\begin{figure}[ht]
\center{}
\begin{forest}
for tree={
   minimum height=1cm,
   font=\tiny,
%  font=\sffamily,
   anchor=north,
   align=center,
   child anchor=north,
   s sep=1em,
   l sep=0.75cm,
},
%where n children=0{tier=word}{}
[{Total marketed \\ water supply ($\mathit{TH2O}^m$)}, draw, drop shadow, fill=dkBlue, rounded corners=2pt, name=TH2OM
   [{Agriculture \\  ($\mathit{H2OBnd}_{\mathit{agr}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=AGR
      [{Crops \\  ($\mathit{H2OBnd}_{\mathit{crp}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=CRP
         [][$\mathit{H2O^s_{r,a}} \quad a \in \mathit{H2OBnd}_{\mathit{agr}}$, draw, drop shadow, fill=ltBlue, rounded corners=2pt][]
      ]
      [{Livestock \\  ($\mathit{H2OBnd}_{\mathit{lvs}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=LVS]
   ]
   [{Non-agriculture \\  ($\mathit{H2OBnd}_{\mathit{nag}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=NAG
      [{Industrial \\  ($\mathit{H2OBnd}_{\mathit{ind}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=IND
      ]
      [{Municipal \\  ($\mathit{H2OBnd}_{\mathit{mun}}$)}, draw, drop shadow, fill=mdBlue, rounded corners=2pt, name=MUN]
   ]
]
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.45cm]TH2OM.south) {\scriptsize $\omega^{\mathit{w1}}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.2cm]AGR.south) {\scriptsize $\omega^{\mathit{w2}}_{\mathit{agr}}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.05cm]CRP.south) {\scriptsize $\omega^{\mathit{w2}}_{\mathit{crp}}$};
\node[anchor=west,align=left]
  at ([yshift=-0.35cm,xshift=-0.2cm]NAG.south) {\scriptsize $\omega^{\mathit{w2}}_{\mathit{nag}}$};
%{\draw[white,dotted] (!1) -| coordinate(p) () ;
%\path ()--(p) node[pos=0.1,left,inner sep=1pt]{\scriptsize $\sigma^p$};}
\end{forest}
\caption{{CET nest for water allocation}}
\label{fig:WaterNest}
\end{figure}

The first level nest allocates aggregate marketed water to the agricultural and
non-agricultual bundles using an adjusted CET specification. The supply
expressions are given in equation~(\ref{eq:h2obnd1}) that allows for perfect
transformation. With reference to Table~\label{ref:WatBundles} the index
$\mathit{wb1}$ covers the \texttt{AGR} and \texttt{NAG} water
bundles.\footnote{The GAMS code is written in a relatively flexible way so that
the user can largely change the set definitions for all water bundles and the
relevant subsets and mappings.} If the transformation elasticity is finite,
equation~(\ref{eq:pth2on}) provides the expression for the CET aggregate price
index for $\mathit{TH2O}^m$. The aggregate water supply price is given by
equation~(\ref{eq:pth2o}).

\begin{equation}
\label{eq:h2obnd1}
\begin{cases}
   \displaystyle \mathit{H2OBnd}_{r,\mathit{wb1}} =
      \gamma^{\mathit{w1}}_{r,\mathit{wb1}}
      \left( \frac{\mathit{PH2OBnd}_{r,\mathit{wb1}}} {\mathit{PTH2O}^n_{r}}
      \right)^{\omega^{\mathit{w1}}_{r}} \mathit{TH2O}^m_{r}
   & \textrm{if } \omega^{\mathit{w1}}_{r} \ne \infty \\
   \displaystyle \mathit{PH2OBnd}_{r,\mathit{wb1}} = \mathit{PTH2O}_{r}
   & \textrm{if} \; \omega^{\mathit{w1}}_{r} = \infty \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pth2on}
\begin{array}{*{20}{l}}
   \mathit{PTH2O}^n_{r} =
      \left[ \sum_{\mathit{wb1}}{
         \gamma^{\mathit{w1}}_{r,\mathit{wb1}}
         \mathit{PH2OBnd}_{r,\mathit{wb1}}^{\omega^{\mathit{w1}}_{r}}
      }\right]^{1/\omega^{\mathit{w1}}_{r}}
   \textrm{if } \omega^{\mathit{w1}}_{r} \ne \infty
\end{array}
\end{equation}

\begin{equation}
\label{eq:pth2o}
\mathit{PTH2O}_{r} \mathit{TH2O}^m_{r} = \sum_{\mathit{wb1}}{
   \mathit{PH2OBnd}_{r,\mathit{wb1}} \mathit{H2OBnd}_{r,\mathit{wb1}}
}
\end{equation}

The next nest decomposes the \texttt{AGR} and \texttt{LVS} bundles into crops
(\texttt{CRP}) and livestock (\texttt{LVS}) on the one hand and industrial
(\texttt{IND}) and municipal (\texttt{MUN}) water demand on the other hand.
Equation~(\ref{eq:h2obnd2}) determines the supply for the second level
bundles---indexed by $\mathit{wb2}$. Each of the $\mathit{wb2}$ bundles is
mapped to one, and only one, top level bundle indexed by $\mathit{wb1}$.
Equation~(\ref{eq:ph2obndndx1}) defines the relevant aggregate price index that
is used to determine the allocation. It is only used in the case of a finite
transformation elasticity. Equation~(\ref{eq:ph2obnd1}) defines the price of the
aggregate $\mathit{wb1}$ bundles, .e. the price of the \texttt{AGR} and
\texttt{NAG} bundles.

\begin{equation}
\label{eq:h2obnd2}
\begin{cases}
   \mathit{H2OBnd}_{r,\mathit{wb2}} =
      \gamma^{\mathit{w2}}_{r,\mathit{wb2}}
      \left( \frac{\mathit{PH2OBnd}_{r,\mathit{wb2}}}
         {\mathit{PH2OBnd}^n_{r,\mathit{wb1}}}
      \right)^{\omega^{\mathit{w2}}_{r,\mathit{wb1}}}
      \mathit{H2OBnd}_{r,\mathit{wb1}}
   & \textrm{if } \omega^{\mathit{w2}}_{r,\mathit{wb1}} \ne \infty \\
   \mathit{PH2OBnd}_{r,\mathit{wb2}} = \mathit{PH2OBnd}_{r,\mathit{wb1}}
   & \textrm{if } \omega^{\mathit{w2}}_{r,\mathit{wb1}} = \infty \\
\end{cases} {\mathit{wb2} \in \mathit{wb1}}
\end{equation}

\begin{equation}
\label{eq:ph2obndndx1}
\begin{array}{*{20}{l}}
\mathit{PH2OBnd}^n_{r,\mathit{wb1}} =
   \left[ \sum_{\mathit{wb2} \in \mathit{wb1}}{
   \gamma^{\mathit{w2}}_{r,\mathit{wb2}}
   \mathit{PH2OBnd}_{r,\mathit{wb2}}^{\omega^{\mathit{w2}}_{r,\mathit{wb1}}}
   }\right]^{1/\omega^{\mathit{w2}}_{r,\mathit{wb1}}}
& \textrm{if } \omega^{\mathit{w2}}_{r,\mathit{wb1}} \ne \infty
\end{array}
\end{equation}

\begin{equation}
\label{eq:ph2obnd1}
\mathit{PH2OBnd}_{r,\mathit{wb1}} \mathit{H2OBnd}_{r,\mathit{wb1}} =
   \sum_{\mathit{wb2}\in \mathit{wb1}}{
      \mathit{PH2OBnd}_{r,\mathit{wb2}} \mathit{H2OBnd}_{r,\mathit{wb2}}
   }
\end{equation}

The second level bundles, indexed by $\mathit{wb2}$, are segmented into two
subsets. The first subset, indexed by $\mathit{wba}$, has an additional CET nest
that maps the aggregate supply to individual production activies ($a$). With the
current version of the database, the \texttt{AGR} bundle is the only bundle that
maps to water demand by production activities. The water bundles in the second
subset, indexed by $\mathit{wbi}$, are set equal to an aggregate demand for
water over a relevant subset of activities mapped to that
bundle.\footnote{This is an ad hoc treatment of water demand that generates an
equilibrium price. However, the demand for water in the relevant production
activities do not form part of the cost structure of these activities---unlike
the case for irrigated crops.}

Equation~(\ref{eq:h2os}) determines the supply of water to each activity $a$
that is mapped to the aggregate water supply indexed by $\mathit{wba}$
(currently limited to irrigated crops mapped to the \texttt{AGR}
bundle).\footnote{The same elasticity parameter, $\omega^{\mathit{w2}}$ is used
for all of the aggregate water bundles, irrespective of the nest level.}
Equation~(\ref{eq:ph2obndndxa}) defines the relevant aggregate price index that
is used to determine the allocation. It is only used in the case of a finite
transformation elasticity. Equation~(\ref{eq:ph2obnda}) defines the price of the
aggregate $\mathit{wba}$ bundle(s).

\begin{equation}
\label{eq:h2os}
\begin{cases}
   \mathit{H2O}^s_{r,\mathit{a}} =
      \gamma^{\mathit{w3}}_{r,\mathit{a}}
      \left( \frac{\mathit{PF}_{r,\mathit{wat},\mathit{a}}}
         {\mathit{PH2OBnd}^n_{r,\mathit{wba}}}
      \right)^{\omega^{\mathit{w2}}_{r,\mathit{wba}}}
      \mathit{H2OBnd}_{r,\mathit{wba}}
   & \textrm{if } \omega^{\mathit{w2}}_{r,\mathit{wba}} \ne \infty \\
   \mathit{PF}_{r,\mathit{wat},\mathit{a}} = \mathit{PH2OBnd}_{r,\mathit{wba}}
   & \textrm{if} \; \omega^{\mathit{w2}}_{r,\mathit{wba}} = \infty \\
\end{cases} {\mathit{a} \in \mathit{wba}}
\end{equation}

\begin{equation}
\label{eq:ph2obndndxa}
\begin{array}{*{20}{l}}
\mathit{PH2OBnd}^n_{r,\mathit{wba}} =
   \displaystyle \left[ \sum_{\mathit{a} \in \mathit{wba}}{
      \gamma^{\mathit{w3}}_{r,\mathit{a}}
      \left( \mathit{PF}_{r,\mathit{wat},\mathit{a}}
      \right)^{\omega^{\mathit{w2}}_{r,\mathit{wba}}}
   }\right]^{1/\omega^{\mathit{w2}}_{r,\mathit{wba}}}
& \textrm{if } \omega^{\mathit{w2}}_{r,\mathit{wba}} \ne \infty
\end{array}
\end{equation}

\begin{equation}
\label{eq:ph2obnda}
\mathit{PH2OBnd}_{r,\mathit{wba}} \mathit{H2OBnd}_{r,\mathit{wba}} =
   \sum_{\mathit{a}\in \mathit{wba}}{
      \mathit{PF}_{r,\mathit{wat},\mathit{a}} \mathit{H2O}^s_{r,\mathit{a}}
   }
\end{equation}

Equation~(\ref{eq:ph2o}) determines the equilibrium market price of water,
$\mathit{PF}_{\mathit{wat}}$, delivered to activity $a$. Water demand is
provided by equation~(\ref{eq:h2oD}). The equilibrium condition is substituted
out of the model.

\begin{equation}
\label{eq:ph2o}
\mathit{H2O}^s_{r,\mathit{a}} = \mathit{XF}_{r,\mathit{wat},\mathit{a}}
\end{equation}

For the aggregate water bundles indexed by $\mathit{wbi}$, demand is constructed
as a function of the aggregate production volume of the constituent activities
and includes a price sensitive component. Equation~(\ref{eq:h2obndiD}) defines
demand for aggregate water, $\mathit{H2OBnd}^d$. Demand is a function of a
volume index over the activities mapped to the water bundles---subject to an
elasticity given by $\eta^{h2ob}$. In addition, demand responds to the real
price of the relevant bundle. Equation~(\ref{eq:ph2obndi}) determines the
equilibrium price for the aggregate bundle. The equilibrium expression is
substituted out of the model.

\begin{equation}
\label{eq:h2obndiD}
\mathit{H2OBnd}^d_{r,\mathit{wbi}} =
   \frac {\displaystyle \alpha^{h2ob}_{r,\mathit{wbi}}}
         {\displaystyle \lambda^{h2ob}_{r,\mathit{wbi}}}
   \left(
      \frac{\mathit{PH2OBnd}^d_{r,\mathit{wbi}}} {\mathit{PGDPMP}_r}
   \right)^{-\epsilon^{h2ob}_{r,\mathit{wbi}}}
   \left[
      \frac {\displaystyle
         \sum_{a \in \mathit{wbi}}{\mathit{PX}_{r,a,0}\mathit{XP}_{r,a}}}
            {\displaystyle
         \sum_{a \in \mathit{wbi}}{\mathit{PX}_{r,a,0}\mathit{XP}_{r,a,0}}}
   \right]^{\eta^{h2ob}_{r,\mathit{wbi}}}
\end{equation}

\begin{equation}
\label{eq:ph2obndi}
\mathit{H2OBnd}_{r,\mathit{wbi}} = \mathit{H2OBnd}^d_{r,\mathit{wbi}}
\end{equation}

\subsection{Factor taxes and prices}

Producers pay the market price for factors adjusted by factor taxes.
Equation~(\ref{eq:pfp}) determines the producers purchase price of factors for
all factors of production. Equation~(\ref{eq:pkp}) is the relevant equation for
the price of capital across vintages.

\begin{equation}
\label{eq:pfp}
\mathit{PF}^p_{r,f,a} =
   \left( 1 + \tau^v_{r,f,a} \right) \mathit{PF}_{r,f,a}
\end{equation}

\begin{equation}
\label{eq:pkp}
\mathit{PK}^p_{r,a,v} =
   \left( 1 + \tau^v_{r,\mathit{cap},a} \right) \mathit{PK}_{r,a,v}
\end{equation}

\section{National accounts and model closure}
\renewcommand{\theequation}{{M-}\arabic{equation}}
\setcounter{equation}{0}

\subsection{National accounts}

Definition of the national accounts would normally be part of the
post-processing portion of a simulation, i.e. it is not necessarily part of the
core definition of a CGE model. However, when running the model in dynamics, it
is typically useful to have some of the key national accounting identities
available for targeting purposes, for example to target the growth of per capita
GDP, or a macro ratio such as the share of government or investment expenditures
relative to GDP.

Equation~(\ref{eq:gdpmp}) defines nominal GDP at market price, $\mathit{GDPMP}$.
The expression uses the indicator $\mathit{QGDP}$ that represents the value of
GDP using prices and quantities evaluated at different periods---similar to the
absorption indicator above:

\[
\begin{array}{*{20}{l}}
\displaystyle \mathit{QGDP}_{r,\mathit{tp},\mathit{tq}} =
   \sum_{\mathit{fd}} { \sum_i{
      \mathit{PA}^a_{r,i,\mathit{fd},\mathit{tp}}
      \mathit{XA}_{r,i,\mathit{fd},\mathit{tq}}
   }}
+  \sum_m {
      \mathit{PD_{r,m,\mathit{tp}}} \mathit{XTT_{r,m,\mathit{tq}}}
   } \\
\qquad + \displaystyle
   \sum_i {
      \left\{\sum_d {
         \mathit{PWE_{r,i,d,\mathit{tp}}} \mathit{XW}^s_{r,i,d,\mathit{tq}}
      }
      - \sum_s {
         \mathit{PWM_{s,i,r,\mathit{tp}}} \mathit{XW}^d_{s,i,r,\mathit{tq}}
      }
      \right\}}
\end{array}
\]

\noindent i.e. it is the sum of domestic absorption, including the exports of
international trade and transport services and the net trade balance for all
other goods and services evaluated at their respective border prices.

\begin{equation}
\label{eq:gdpmp}
\mathit{GDPMP}_{r,t} = \mathit{QGDP}_{r,\mathit{t},\mathit{t}}
\end{equation}

Equation~(\ref{eq:pgdpmp}) defines the GDP at market price deflator,
$\mathit{PGDPMP}$, which is calculated as the Fisher price index of
GDP.\footnote{When prices and quantities are evaluated at the same year,
nominal GDP can replace the relevant $\mathit{QGDP}$ indicator.}
Equation~(\ref{eq:rgdpmp}) then defines the volume of GDP at market price.

\begin{equation}
\label{eq:pgdpmp}
\mathit{PGDPMP}_{r,t} =
   \mathit{PGDPMP}_{r,t-1} \sqrt{
      \frac{\mathit{QGDP}_{r,t,t-1}}{\mathit{QGDP}_{r,t-1,t-1}} \cdot
      \frac{\mathit{QGDP}_{r,t,t}} {\mathit{QGDP}_{r,t-1,t}}
   }
\end{equation}

\begin{equation}
\label{eq:rgdpmp}
\mathit{RGDPMP}_{r} = \mathit{GDPMP}_{r} / \mathit{RGDPMP}_{r}
\end{equation}

Equation~(\ref{eq:rgdppc}) defines real per capita GDP, $\mathit{RGDPpc}$.
Equation~(\ref{eq:grgdppc}) defines the growth in real per capita GDP,
$\mathit{g^y}$. In comparative static exercises, it measures the difference in
real per capita GDP between the baseline and the shock
simulation.\footnote{The value of $n$ is always 1 in comparative static
simulations.} In dynamic simulations the equation allows for multi-year time
steps as measured by $n$. In most dynamic baseline or reference simulations, the
growth rate of real per capita GDP will be exogenous and an economy-wide
variable, for example a uniform labor productivity shifter, is endogenous and
will serve as the instrument to target GDP growth. In policy or alternative
simulations, the economy-wide factor would normally be exogenous and the growth
rate of GDP would be endogenous. Equation~(\ref{eq:klrat}) defines the average
capital labor ratio in efficiency units. Under a balanced growth scenario, this
ratio is intended to be uniform across time. It could be used to target the
growth of capital productivity independently of the growth of labor
productivity.

\begin{equation}
\label{eq:rgdppc}
\mathit{RGDPpc}_{r} = \frac{\mathit{RGDPMP}_{r}} {\mathit{Pop}_{r}}
\end{equation}

\begin{equation}
\label{eq:grgdppc}
\mathit{RGDPpc}_{r,t} = \left( 1 + g^y_{r,t} \right)^n \mathit{RGDPpc}_{r,t-n}
\end{equation}

\begin{equation}
\label{eq:klrat}
\mathit{KLRat}_r =
   \frac {\sum_a{\sum_v{\mathit{PK}_{r,a,v,0}
      \lambda^f_{r,\mathit{cap},a} \mathit{Kv_{r,a,v}} }} }
         {\sum_a{\sum_l{\mathit{PF}_{r,l,a,v,0}
      \lambda^f_{r,l,a} \mathit{XF_{r,l,a}} }} }
\end{equation}

\subsection{Closure}

\subsubsection{Government accounts}

Equation~(\ref{eq:savg}) defines nominal government savings, $\mathit{S^g}$, as
the difference between government revenues and government's current expenditures
on goods and services. In the standard model, there is only one stream
of government expenditures. Alternative versions allow for additional
streams, such as expenditures on research and development, public
investment, etc. The subset $\mathit{Gov}$ includes all final demand
expenditures linked to government accounts.\footnote{[NEW: 20-JAN-2019] In the current model
code, the subset $\mathit{Gov}$ does not exist. Instead the sum is over all $\mathit{fd}$
that equal either $\mathit{gov}$ or $\mathit{r\_d}$.}
When an emissions quota regime is put into place,
revenues from the quotas\footnote{Revenues are positive if a region is a net
seller and negative if a region is a net buyer.} accrue to the government and
eventually to households using the default closure with a lump sum tax on
households. Note that the counterpart account of the quota income appears in the
balance of payments expression, i.e. as a flow from the rest of the world.
The equation also includes net government to government transfers and the
government's income from NTM-related measures---both domestic and foreign.\footnote{[NEW: 4-OCT-2018]}
Equation~(\ref{eq:savg}) defines real government savings, $\mathit{RS^g}$. In
the standard closure, the public deficit is held fixed in real terms (in order
to preserve price homogeneity). The direct tax rate, $\kappa^h$, adjusts to the
target for the public deficit. Because there is a single household, this is
equivalent to a change in lump sum taxes.

\begin{equation}
\label{eq:savg}
\begin{array}{l l l}
\mathit{S^g_r} & = & \displaystyle
   \sum_{\mathit{gy}} {\mathit{YGOV}_{r,\mathit{gy}}} +
   \sum_{\mathit{em}} {\mathit{QuotaY}^{\mathit{Emi}}_{r,\mathit{em}}} +
   \sum_s{\chi^{\mathit{gNTM}}_{s,r} \mathit{ntmY}_s} \\
{} & + & \qquad \displaystyle \mathit{ODAIn}_r - \mathit{ODAOut}_r
   -   \sum_{\mathit{fd} \in {\mathit{Gov}}}{\mathit{YFD}_{r,\mathit{fd}}}
\end{array}
\end{equation}

\begin{equation}
\label{eq:rsavg}
\mathit{RS}^g_r = \frac{S^g_r} {\mathit{PGDPMP}_{r}}
\end{equation}

\subsubsection{Macro closure}

Equations~(\ref{eq:rfdshr}) and~(\ref{eq:nfdshr})
define respectively the real and nominal share
of aggregate domestic final demand expenditures with
respect to GDP, respectively real and nominal. These
equations are often used to calibrate the model
in the dynamic baseline. For example, real government
and research and development expenditures may
be fixed relative to real GDP in the baseline. In
shock simulations, they may be fixed at baseline
levels, and then these equations determine how the
shares change with shocks. For investment, the
baseline may target the ratio of investment relative
to GDP, with an endogenous savings rate. The savings
rate would then be exogenous in shock simulations.

\begin{equation}
\label{eq:rfdshr}
\mathit{rFDShr}_{r,\mathit{fd}}
	= \frac{\mathit{XFD}_{r,\mathit{fd}} } {\mathit{RGDPMP}_{r}}
\end{equation}

\begin{equation}
\label{eq:nfdshr}
\mathit{nFDShr}_{r,\mathit{fd}}
= \frac{\mathit{YFD}_{r,\mathit{fd}} } {\mathit{GDPMP}_{r}}
\end{equation}

\subsubsection{Capital account}

The model has four closures for the capital account. The standard closure fixes
foreign savings in real terms. Equation~(\ref{eq:savfcapFix}) determines $S^f$.
For all but one region, the residual region, foreign saving is equal to a fixed
level. The second part of the equation, guarantees that the sum across regions
is identically zero, and thus sets the level for the residual
region.\footnote{It is best if the user makes sure that the sum of exogenous
foreign savings equals 0 to avoid unintended consequences, but at least with
this formulation, a small deviation will not create any problems.}

\begin{equation}
\label{eq:savfcapFix}
\begin{cases}
   \displaystyle S^f_r=\overbar{S}^f_r
   & \textrm{if } r \ne \mathit{rres} \\
   \displaystyle \sum_r{S^f_r} \equiv 0
   & \textrm{if } r = \mathit{rres} \\
\end{cases}
\end{equation}

In addition, equation~(\ref{eq:rorgfix}) is added to the model specification in
the case of the fixed capital account closure and simply evaluates $R^g$ as a
weighted average of regional expected returns, with the weights given in
equation~(\ref{eq:phiR}).

\begin{equation}
\label{eq:rorgfix}
   R^g = \displaystyle\sum_r{\varphi^r_r R^e_r}
\end{equation}

\begin{equation}
\label{eq:phiR}
\varphi^r_r =
   \frac {\displaystyle \mathit{PFD}_{r,\mathit{inv}}
      \left(\mathit{XFD}_{r,\mathit{inv}} - \delta_r \mathit{TK}^s_r \right)}
         {\displaystyle \sum_s{ \mathit{PFD}_{s,\mathit{inv}}
            \left(\mathit{XFD}_{s,\mathit{inv}}
               - \delta_s \mathit{TK}^s_s \right)}}
\end{equation}

The second alternative fixes the capital account relative to GDP,
equation~(\ref{eq:savfcapRFix}). Note that in this case the
capital flows are deflated by the world price of savings since
the variable $S^f$ is a volume, not a value. The residual region
becomes a borrower or lender of last resort as there is nothing
that guarantees that if the ratio is fixed for all regions that
their sum will add to zero. As in the case of the first closure,
equation~(\ref{eq:rorgfix}) is part of the model specification
for this capital account closure.

\begin{equation}
\label{eq:savfcapRFix}
\begin{cases}
   \displaystyle S^f_r = \chi^{\mathit{sf}}_r \mathit{GDPMP}_r
   / \mathit{PW}^{\mathit{sav}}
   & \textrm{if } r \ne \mathit{rres} \\
   \displaystyle \sum_r{S^f_r} \equiv 0
   & \textrm{if } r = \mathit{rres} \\
\end{cases}
\end{equation}

The third alternative, inspired from the GTAP model (\cite{Hertel1997}), allows
foreign savings to adjust to relative differentials in expected rates of
return---with a specific definition of what is meant by the expected rate of
return.

We start with the definition of the expected end-of-period capital stock,
equation~(\ref{eq:kstocke}). This is simply the standard motion equation for the
capital stock based on this period's beginning-of-period capital stock and
investment level.

\begin{equation}
\label{eq:kstocke}
\mathit{TK}^e_{r,t} =
   (1-\delta_{r,t})\mathit{TK}_{r,t}+\mathit{XFD}_{r,\mathit{inv},t}
\end{equation}

Equation~(\ref{eq:ror}) defines the aggregate after-tax rate of return. The
factor $\chi^k$ converts the normalized rate of return to the non-normalized
rate of return.\footnote{In the base year, $\mathit{TR}$ is set to 1, and the
non-normalized return will be a percent rate between 0 and perhaps up to 30\%.}
Equation~(\ref{eq:rorc}) defines the net current rate of return, the rental rate
adjusted for the price of replacing capital, less the depreciation rate.
Therefore, a tariff reduction, that would lower the price of investment goods,
would reduce the replacement price of capital and increase the rate of return
(all else equal). The expected rate of return is given by
equation~(\ref{eq:roreGTAP}). Regions with relatively high investment rates,
i.e, that would lead to relatively high growth in the capital stock and thus
depress the capital rate of return, would tend to see a reduction in the
expected rate of return. The degree of adjustment is controlled by the
parameter $\epsilon^{\mathit{ror}}$.

\begin{equation}
\label{eq:ror}
R_{r,t} =
   \frac{\sum_a{\sum_v{\left( 1 - \kappa^f_{r,\mathit{cap},a} \right)
      \mathit{PK}_{r,a,v} \mathit{K}^v_{r,a,v}
   }}}
   {\mathit{PFD}_{r,\mathit{inv},t} \mathit{TK}^s_{r,t}}
\end{equation}

\begin{equation}
\label{eq:rorc}
R^c_{r,t} = \frac {R_{r,t}} {\mathit{PFD}_{r,\mathit{inv},t}} - \delta_{r,t}
\end{equation}

\begin{equation}
\label{eq:roreGTAP}
R^e_{r,t} =
   R^c_{r,t} \left[\frac{\mathit{TK}^e_{r,t}}{\mathit{TK}_{r,t}}
             \right]^{-\epsilon^{\mathit{ror}}}
\end{equation}

The level of foreign saving for each region will then be determined by
equation~(\ref{eq:savfflex}), which equates the expected regional rates of
return to the global average, $R^g$, adjusted for any risk premium that is
embedded in the base year data. Equation~(\ref{eq:rorgflex}) guarantees that
global savings equals global investment and in essence determines $R^g$. High
values for $\epsilon^{\mathit{ror}}$ lead to relatively low adjustment in
foreign savings. The default value for the GTAP model
is~10.\footnote{Users are urged to read the discussion in \cite{Hertel1997},
page 57.}

\begin{equation}
\label{eq:savfflex}
\pi^p_{r,t}R^c_{r,t} = R^g_t
\end{equation}

\begin{equation}
\label{eq:rorgflex}
\sum_r{S^f_r} \equiv 0
\end{equation}

The fourth specification is inspired by the capital allocation mechanism in the
Monash and USAGE models (\cite{DixonRimmer2002} and
\cite{DixonRimmer2005}).\footnote{See also the discussion in the freely
available Monash notes---Chapter 5, pages 317--326. The notes can be downloaded
from \url{https://www.copsmodels.com/ftp/monbook1/m1-chap5.pdf}
(accessed 28-May-2017).} The  MONASH uses a capital supply schedule that links
the growth in capital (for each region), $\mathit{grK}$, to deviations in the
region's rate of return, ${\Delta\mathit{RoR}}$, where the deviation is relative
to  an exogenous normal rate of return, $R^n$. A positive deviation leads to
growth in capital above trend, $\mathit{grTrend}$. Growth is bounded by
$\mathit{grKMin}$ at the lower end and $\mathit{grKMax}$ at the upper end.
A logistic function describes the capital growth schedule where the curvature
parameter, $\chi^k$, is calibrated at ${\Delta\mathit{RoR}}=0$ to an econometric
estimate. Figure ~\ref{fig:grKCurve} shows the shape of the logistic curve with
the growth of capital on the vertical axis and the deviation in the rate of
return on the horizontal axis. The curve crosses at the normal or trend growth
rate (4\% in the graph) when the deviation in the rate of return is equal to its
long-term average (i.e. 0\%). The maximum growth in the example is 10\% and the
minimum is -7\%.

\begin{figure}
   \centering
   \input{grKCurve}
   \caption{Capital supply as a function of deviations in the rate of return}
   \label{fig:grKCurve}
\end{figure}

We start by describing the expected rate of return. The expected rate of return
is the sum of two components. The first is the expected nominal gross return in
year $t+1$, $R$,\footnote{See equation~(\ref{eq:ror}).} relative to the unit
cost of investing in year $t$, $\mathit{PFD}_{\mathit{inv}}$. The second term
represents the capital gains on the unit of investment, i.e. the difference in
the unit cost of investing between $t$ and $t+1$ (adjusted by depreciation).
Both terms are discounted by the real rate of interest, $r$.

\[
E\left(R^e_{r,t}\right) =
   \frac {1} {1+r}
   \left[
      E\left(\frac{\mathit{R}_{r,t+1}}{\mathit{PFD}_{r,\mathit{inv},t}}\right)
      + \left(1-\delta_{r,t}\right)
         E\left(\frac{\mathit{PFD}_{r,\mathit{inv},t+1}}
            {\mathit{PFD}_{r,\mathit{inv},t}}\right)
   \right]-1
\]

\noindent With myopic expectations, the expected future values of $R$ and
$\mathit{PFD}_{\mathit{inv}}$ are the current values and the expression above
simplifies to equation~(\ref{eq:roreUSAGE}), that defines the expected rate of
return, $\mathit{R}^e$, at time $t$ for region $r$. Equation~(\ref{eq:devroreq})
defines the deviation of the expected rate of return from its 'normal' or trend
path, $\mathit{\Delta{RoR}}$, which is used to determine the desired growth rate
of the stock of capital in region $r$, where the expected rate of return is
given by $R^n$ and is an exogenous input. If the deviation is 0, the desired
growth rate of the stock of capital is the trend growth rate
(see equation~(\ref{eq:grKeq}) below. The equation allows for region-specific,
$R^d$ and a global shifter, $R^g$ that allow for deviations from the normal
trend.

\begin{equation}
\label{eq:roreUSAGE}
\mathit{R}_{r,t}^e =
   \frac{1}{1+r}
   \left[
      \frac{\mathit{R}_{r,t}}{\mathit{PFD}_{r,\mathit{inv},t}}
      +  \left(1-\delta_{r,t}\right)
   \right] - 1
\end{equation}

\begin{equation}
\label{eq:devroreq}
\mathit{\Delta{RoR}}_{r,t} =
   \mathit{R}_{r,t}^e - \mathit{R}_{r,t}^n
      - \mathit{R}_{r,t}^d - \mathit{R}_{t}^g
\end{equation}

Equation~(\ref{eq:grKeq}) defines the growth in the capital stock,
$\mathit{grK}$, using the doubly bounded logistic curve as a function of the
deviation in the real rate of return from its long-run
average.\footnote{Further discussion is available in \cite{DixonRimmer2002},
pp. 190-193. The version described herein inverts the functional form, but is
otherwise identical. The inverted function yields the following, which can be
used to initialize $\mathit{\Delta{\mathit{RoR}}}$:
\[
\mathit{\Delta{\mathit{RoR}}_{r,t}} =
   \frac{1}{\chi^k_{r,t}} \ln \left[ \left(
      \frac {\mathit{grKMax}_{r,t}-\mathit{grKTrend}_{r,t}}
         {\mathit{grKTrend}_{r,t}-\mathit{grKMin}_{r,t}}
      \right)
      \left(\frac {\mathit{grK}_{r,t}-\mathit{grKMin}_{r,t}}
         {\mathit{grKMax}_{r,t}-\mathit{grK}_{r,t}}
      \right)
   \right]
\]
} Equation~(\ref{eq:savfeqUSAGE}) defines the demand for new capital, i.e.
investment, $\mathit{XFD}_{\mathit{inv}}$, for each region $r$. With the
standard motion equation that sets end-of-period capital stock equal to the
depreciated level of the beginning-of-period capital stock plus investment and
the notional growth in the capital stock as given by $\mathit{grK}$, 'desired'
investment is equal to the beginning-of-period capital stock multiplied by the
sum of the growth rate and depreciation. It is bounded below by zero since
$\mathit{grKMin}$ is set at minus the depreciation rate. Given that we also have
equation~(\ref{eq:yfdinv}), this equation can be thought of as determining
foreign savings. Equation~(\ref{eq:rorgflexUSAGE}) ensures the global
savings/investment balance and in essence determines the
$\mathit{R}_{t}^g$.\footnote{Though $R^g$ is used for all closures it has a
different significance across closures. In the USAGE closure, one would
anticipate that in the long-run it is 0.}

\begin{equation}
\label{eq:grKeq}
\mathit{grK}_{r,t} =
   \frac {\mathit{grKMax}_{r,t} e^{\chi^k_{r,t}
      {\mathit{\Delta{\mathit{RoR}}_{r,t}}}}
         + \mathit{grKMin}_{r,t} \left[
            \displaystyle \frac {\mathit{grKMax}_{r,t}-\mathit{grKTrend}_{r,t}}
            {\mathit{grKTrend}_{r,t}-\mathit{grKMin}_{r,t}}
           \right]}
            {e^{\chi^k_{r,t} {\mathit{\Delta{\mathit{RoR}}_{r,t}}}}
   + \left[ \displaystyle \frac
         {\mathit{grKMax}_{r,t}-\mathit{grKTrend}_{r,t}}
         {\mathit{grKTrend}_{r,t}-\mathit{grKMin}_{r,t}}
     \right]}
\end{equation}

\begin{equation}
\label{eq:savfeqUSAGE}
\begin{array}{c}
K_{r,t+1} = (1-\delta_{r,t}) K_{r,t} + \mathit{XFD}_{r,\mathit{inv},t}
          = \left(1+\mathit{grK}_{r,t}\right)K_{r,t} \\
\Updownarrow \\
\mathit{XFD}_{r,\mathit{inv},t} =
   K_{r,t}\left( \mathit{grK}_{r,t} + \delta_{r,t} \right) \\
\end{array}
\end{equation}

\begin{equation}
\label{eq:rorgflexUSAGE}
\sum_r{S^f_r} \equiv 0
\end{equation}

The user provides values for $\mathit{grKMin}$, $\mathit{grKMax}$,
$\mathit{grKTrend}$, $\chi^k$ and $\mathit{R}^n$. The variables $\mathit{grK}$
and $\mathit{R}^e$ are initialized to base year data. Equation~(\ref{eq:grKeq})
can be inverted to yield the initial level for $\mathit{\Delta{\mathit{RoR}}}$.
And finally, equation~(\ref{eq:devroreq}) is used to initialize $R^d$.

The capital closure specification is governed by setting the \texttt{savfFlag}.
The valid options are:

\begin{enumerate}
   \item \texttt{capFix}. With this setting the capital account is fixed.
   \item \texttt{capRFix}. With this setting the capital account is
   fixed relative to GDP for all but a residual region, which becomes
   the lender or borrower of last resort.
   \item \texttt{capFlexGTAP}. With this setting the capital account is flexible
         and uses the GTAP specification.
   \item \texttt{capFlexUSAGE}. With this setting the capital account is
         flexible and uses an allocation mechanism similar in spirit to the
         domestic allocation mechanism used in the USAGE model.
\end{enumerate}

\subsubsection{Price anchors}

Equation~(\ref{eq:pmuv}) defines the so-called manufactures unit value index,
$\mathit{PMUV}$ and it is based on the Fisher index of export prices of selected
goods (often manufactures) over selected exporters (often high-income regions).
The $\mathit{QMUV}$ indicator is based on the following expression:

\[
\mathit{QMUV}_{\mathit{tp},\mathit{tq}} =
   \sum_{r \in {\mathit{RMUV}}} {\sum_{i \in {\mathit{IMUV}}} {\sum_d {
      \mathit{PWE}_{r,i,d,\mathit{tp}} \mathit{XW}^s_{r,i,d,\mathit{tq}}
   } } }
\]

\noindent and represents the an export indicator using time dependent prices and
quantities.

\begin{equation}
\label{eq:pmuv}
\mathit{PMUV}_t = \mathit{PMUV}_{t-1} \sqrt{
   \frac{\mathit{QMUV}_{\mathit{t},\mathit{t-1}}}
      {\mathit{QMUV}_{\mathit{t-1},\mathit{t-1}}} \cdot
   \frac{\mathit{QMUV}_{\mathit{t},\mathit{t}}}
      {\mathit{QMUV}_{\mathit{t-1},\mathit{t}}}
}
\end{equation}

The model has a flexible formula for calculating various versions of
a consumer price index (CPI). The user can choose the subset of
consumer items to be included in any consumption bundle---for
example food, energy, other. The CPIs are indexed by 'CPINDX', which
define specific consumer bundles. Like most other indices in the model,
the CPI indices are derived from a Fisher ideal price expression that
is based on the following formula:

\[
\mathit{QCPI}_{\mathit{tp},\mathit{tq}, \mathit{ndx}} =
   \sum_{k \in \{ndx\} } {
      \mathit{PC}_{r,k,h,\mathit{tp}} \mathit{XC}_{r,k,h,\mathit{tq}
   } }
\]

\noindent Equation~(\ref{eq:cpindx}) defines the various versions
of the CPI.

\begin{equation}
\label{eq:cpindx}
\mathit{CPI}_{r,h,\mathit{ndx},t} = \mathit{CPI}_{r,h,\mathit{ndx},t-1} \sqrt{
   \frac{\mathit{QCPI}_{\mathit{t},\mathit{t-1}, \mathit{ndx}}}
      {\mathit{QCPI}_{\mathit{t-1},\mathit{t-1}, \mathit{ndx}}} \cdot
   \frac{\mathit{QCPI}_{\mathit{t},\mathit{t}, \mathit{ndx}}}
      {\mathit{QCPI}_{\mathit{t-1},\mathit{t}, \mathit{ndx}}}
}
\end{equation}

In a similar vein, the model has a factor price index---one
per region---that can be used to target the real exchange rate.
The regional factor price index is based on the following
formula:

\[
\mathit{QFACT}_{\mathit{tp},\mathit{tq}} =
   \sum_{f } {\sum_a {
      \mathit{PF}_{r,f,a,\mathit{tp}} \mathit{XF}_{r,f,a,\mathit{tq}}
   } }
\]

Equation~(\ref{eq:pfact}) defines the regional factor price index.
It is the Fisher price index of regional factor prices aggregated over
all factors and activities.\footnote{We have done some limited testing
with fixing the real exchange rate---using the factor price index
as a measure of the real exchange rate. If the real exchange rate
is fixed, then the capital account must adjust. In this case,
the set \texttt{fixER} must be set to \texttt{'YES'} for the region
with the fixed exchange rate (under the \texttt{'capFix'} capital
account closure). In this case the region will be excluded from
the capital account closure equation and the capital account
adjustments will be assumed by the residual region. This closure
should be used with the appropriate caution.}

\begin{equation}
\label{eq:pfact}
\mathit{PFACT}_{r,t} = \mathit{PFACT}_{r,t-1} \sqrt{
   \frac{\mathit{QFACT}_{\mathit{t},\mathit{t-1}}}
      {\mathit{QFACT}_{\mathit{t-1},\mathit{t-1}}} \cdot
   \frac{\mathit{QFACT}_{\mathit{t},\mathit{t}}}
      {\mathit{QFACT}_{\mathit{t-1},\mathit{t}}}
}
\end{equation}

Foreign savings flows, $\mathit{S^f}$, are determined in real terms
and are evaluated at the price $\mathit{PW^{\mathit{sav}}}$, that is set equal
to $\mathit{PMUV}$, equation~(\ref{eq:pwsav}). The model requires at least one
price to be fixed and treated as the num\'eraire. Equation~(\ref{eq:pnum})
defines the num\'eraire, $\mathit{PNUM}$. Herein it is set equal to a world GDP
price deflator, but it could easily be set to $\mathit{PMUV}$.
The left-out equation, as discussed above, is one of the
investment/savings balance equations. A variable called
$\mathit{Walras}$ has been added to the investment/savings
balance equation for a single region. It should evaluate to zero.

\begin{equation}
\label{eq:pwgdp}
\mathit{PWGDP}_t = \frac{\sum_r{\mathit{GDPMP}_t} } {\sum_r{\mathit{RGDPMP}_t}}
\end{equation}

\begin{equation}
\label{eq:pwsav}
\mathit{PW^{\mathit{sav}}} = \mathit{PMUV}
\end{equation}

\begin{equation}
\label{eq:pnum}
\mathit{PNUM} = \mathit{PWGDP}
\end{equation}

In summary, the standard macro closure has household savings determined by the
ELES demand system, government savings are fixed (in real terms) with the direct
household tax schedule endogenous, and foreign savings are fixed (with the real
exchange rate adjusting to \emph{ex ante} changes in the trade balance.
Investment is savings determined. The model num\'eraire is the export price
index of high-income manufactured exports.

\subsection{Targeting prices}

It is often the case, particularly in developing a baseline, that it is
desirable (or required) to target price trends for key commodities, for example
crude oil. The first step is to define what is meant by a 'world' price. The
current version of the model defines the 'world' price to be the average
producer price---defined using a Fisher price index. The key reason is that
typically the commodities to be targeted have a sector-specific resource base
that can be adjusted to target an exogenous price.\footnote{With a diagonal
make matrix, targeting the producer price and the commodity price would be
identical.} Equation~(\ref{eq:pw}) defines the world price for activity $a$.
It is based on the following indicator:

\[
\mathit{QX}_{a,\mathit{tp},\mathit{tq}}
   = \sum_r{\mathit{PX}_{r,a,\mathit{tp}} \mathit{XP}_{r,a,\mathit{tq}}}
\]

\begin{equation}
\label{eq:pw}
\mathit{PW}_{a,t} = \mathit{PX}_{a,t-1} \sqrt{
   \frac {\mathit{QX}_{a,\mathit{t},   \mathit{t-1}}}
         {\mathit{QX}_{a,\mathit{t-1}, \mathit{t-1}}} \cdot
   \frac {\mathit{QX}_{a,\mathit{t},   \mathit{t}}}
         {\mathit{QX}_{a,\mathit{t-1}, \mathit{t}}} }
\end{equation}

To target a price, the variable $\mathit{PW}$ needs to exogenized and a
counterpart needs to be endogenized. The most logical choice is to endogenize
the shifter on the natural resource supply curve, $\chi^{w,\mathit{nrs}}_a$.

\subsection{Regional and global welfare}

[NEW 20-Jan-2019] This section will be revised in the future.

\subsubsection{Equivalent variation}

Equivalent variation is defined to be the level of income needed to attain
utility level $u$ at base year prices. The formulation depends on the
specific utility function---and in many cases will need to be
derived using a solver given implicit functional forms. For the CDE
utility function, equivalent variation, $\mathit{EV}$, is defined implicitly
by the following expression:

\begin{equation}
\label{eq:EVCDE}
\sum_k{\alpha^h_{r,k,h} b^h_{r,k,h} u_{r,h}^{e^h_{r,k,h} b^h_{r,k,h}} {\left(
      \frac{\mathit{PC}_{r,k,h,0}} {\mathit{EV}_{r,h}/\mathit{Pop}_r}
    \right)}^{b^h_{r,k,h}}} = 1
\end{equation}

For the AIDADS class of utility functions, which includes the LES
and Cobb-Douglas, the expression for equivalent variation is provided
by the following:

\begin{equation}
\label{eq:EVAIDADS}
\ln\left(\frac{\mathit{EV}_{r,h}}{\mathit{Pop}_r} -
\sum_k{\mathit{PC}_{r,k,h,0}\gamma_{r,k,h}}\right) =
1 + ln\left(A^{\mathit{ad}}_{r,h}\right)
+ u_{r,h} + \sum_k{\mu^c_{r,k,h} \ln\left(\frac{\mathit{PC}_{r,k,h,0}}{\mu^c_{r,k,h}} \right)}
\end{equation}

\noindent Evaluation of $\mathit{EV}$ is incorporated in the model code
and is a model output.

Utility can also be derived from other final demand expenditures.
These all rely on some form of a CES expenditure function, for
which the expenditure function is relatively straightforward.
Equation~(\ref{eq:EVF}) defines the equivalent variation for each of the
other final demand expenditure components---the real value
of current expenditures, times the initial aggregate price.
Equation~(\ref{eq:EVS}) defines the expenditure function
linked to domestic savings. In the absence of capital flows, it will
be equal to the expenditure function of investment.
The GTAP model (\cite{McDougall2003} and \cite{CorongetalJGEA2017})
defines total equivalent variation as the sum
of equivalent variation of households, public expenditures and
savings. In the GREEN Model (\cite{Burniauxetal1992}),
total equivalent variation is
equated to private and public expenditures in each year. These
are discounted to the base year to evaluate the net discounted
change in equivalent variation and used as one metric to
summarize the net impacts of a policy change. In GREEN, savings (or investment)
are not included in the definition of welfare,
as the welfare from savings are derived in future
periods (as increments to private or public consumption). This
does not take into consideration the utility derived from savings
in periods beyond the model's time horizon.

\begin{equation}
\label{eq:EVF}
\mathit{EVF}_{r,\mathit{fdc}} = \mathit{PFD}_{r,\mathit{fdc},0}
\frac{\mathit{YFD}_{r,\mathit{fdc},t}}{\mathit{PFD}_{r,\mathit{fdc},t}}
\end{equation}

\begin{equation}
\label{eq:EVS}
\mathit{EVS}_{r} = \mathit{PSAVE}_{r,0}
\frac{\sum_h{\mathit{S^h_{r,h,t}}} + S^g_{r,t}}{\mathit{PSAVE}_{r,t}}
\end{equation}

The price of savings formula is derived from an adaptation
of the price of savings from the GTAP model (\cite{DvdMJGEA2018}).
In the absence of capital flows, the price of savings is equal
to the price of investment. Equation~(\ref{eq:psave}) adjusts
the definition to take into account foreign savings.

\begin{equation}
\label{eq:psave}
\mathit{PSAVE}_{r,t} = \chi^s_t
\frac{\mathit{PSAVE}_{r,t-1}} {\mathit{PFD}_{r,\mathit{inv},t-1}}
\mathit{PFD}_{r,\mathit{inv},t}
\end{equation}

\noindent The adjustment factor $\chi^s$ is updated each period
and is given by the following expression:

\[
\chi^s_t = \frac
{\sum_r{\varphi^i_{r,t}
\frac{\mathit{PFD}_{r,\mathit{inv},t}}
     {\mathit{PFD}_{r,\mathit{inv},t-1}}}}
{\sum_r{\varphi^s_{r,t}
\frac{\mathit{PSAVE}_{r,t}}
     {\mathit{PSAVE}_{r,t-1}}}}
\]

\noindent where $\varphi^i$ represents the regional share in global net
investment:

\[
\varphi^i_{r,t} = \frac
{\mathit{PFD}_{r,\mathit{inv},t-1}
\left(\mathit{XFD}_{r,\mathit{inv},t-1} - \delta_{r,t-1} \mathit{KStock}_{r,t-1}\right)}
{\sum_s{\mathit{PFD}_{s,\mathit{inv},t-1}
\left(\mathit{XFD}_{s,\mathit{inv},t-1} - \delta_{s,t-1} \mathit{KStock}_{s,t-1}\right)}}
\]

\noindent and $\varphi^s$ represents the regional share in global
savings:

\[
\varphi^s_{r,t} = \frac
{
\sum_h{S^h_{r,h,t-1}} - S^g_{r,t}}
{\sum_s{\left(\sum_h{S^h_{s,h,t-1}} - S^g_{s,t}\right)}}
\]

\subsubsection{Global welfare function}

The model includes an objective function, which for most simulations
is redundant as the model is intended to be square with a unique
solution. In principle, it would be possible to run the model
with more variables than equations and to use an optimizing package
to maximize an objective, with all model equations acting as constraints.
In the current version, the social welfare function is a CES
aggregate of per capita real income, as measured by equivalent variation,
that is population weighted and with welfare weights---currently initialized
at the value of 1. For a value of $\epsilon^w=0$ the social welfare function
is simply the average global level of real income. The objective function
in any given time period is set to the level of the social welfare function.
The model also calculates a two additional global social welfare functions:
(1) one that takes into account the utility derived from public expenditures,
equation (\ref{eq:swt}); and (2) one consistent with the GTAP definition
of welfare that includes private and public expenditures and domestic savings,
equation (\ref{eq:swt2}).

\begin{equation}
\label{eq:sw}
\mathit{SW} = \sum_{r}{ \frac{\varphi_r \mathit{Pop}_r}{1-\epsilon^w}
\left(\frac{\sum_h{\mathit{EV}_{r,h}}} {\mathit{Pop}_r} \right) }^{1-\epsilon^w} \bigg /
\sum_{r}{\mathit{Pop}_r}
\end{equation}

\begin{equation}
\label{eq:swt}
\mathit{SWT} = \sum_{r}{ \frac{\varphi_r \mathit{Pop}_r}{1-\epsilon^w}
\left(\frac{\sum_h{\mathit{EV}_{r,h}}+\mathit{EVF}_{r,gov}}{\mathit{Pop}_r} \right) }^{1-\epsilon^w} \bigg /
\sum_{r}{\mathit{Pop}_r}
\end{equation}

\begin{equation}
\label{eq:swt2}
\mathit{SWT2} = \sum_{r}{ \frac{\varphi_r \mathit{Pop}_r}{1-\epsilon^w}
\left(\frac{\sum_h{\mathit{EV}_{r,h}}+\mathit{EVF}_{r,gov}
+\mathit{EVS}_r}{\mathit{Pop}_r} \right) }^{1-\epsilon^w} \bigg /
\sum_{r}{\mathit{Pop}_r}
\end{equation}

\section{Emissions}
\renewcommand{\theequation}{{E-}\arabic{equation}}
\setcounter{equation}{0}

\subsection{Emissions}

The model incorporates a number of greenhouse gas (GHG) emissions and
non-greenhouse gas emissions, indexed by
$\mathit{em}$.

The standard database includes the following greenhouse
gas emissions: carbon dioxide ($\textrm{CO}_2$), methane
($\textrm{CH}_4$), nitrous oxide ($\textrm{N}_2\textrm{O}$) and an aggregate
emissions bundle of fluorinated gases (F-gases). The input data for carbon is in
millions of metric tons of $\textrm{CO}_2$ and the data for the other GHGs are
both in physical units (metric tons) as well as in
CO2-equivalent.\footnote{The conversion from tons to CO2-equivalent uses the
standard global warming potential (gwp) coefficients defined by the
Intergovernmental Panel on Climate Change (IPCC).} The model allows for
conversion between $\textrm{CO}_2e$ and {C$e$}, i.e. carbon equivalent,
depending on the needs of the user.\footnote{The \texttt{ifCEQ} flag determines
the units. If set to 1, the model will use C$e$, else $\textrm{CO}_2e$. The main
impact will be on the level of any endogenously determined carbon tax. The
factor (44/12) is used to convert from C$e$ to $\textrm{CO}_2e$ in volume terms.
The inverse ratio is used to convert prices and taxes.}

The non-greenhouse gases are described in Table~\ref{tab:nghg}.\footnote{With the release of V10 of the GTAP Data Base, the non-GHG emission database has been
recompiled, \cite{Chepeliev2020}. There are some differences with the
previous version, \cite{Chepeliev2018}. The key source database, EDGAR,
has combined the previous 2 NMVOC emissions into a single pollutant.}
These emissions have no corresponding 'carbon equivalent'
component, though they can impact on climate and are an input to many
climate models, for example MAGICC.\footnote{\cite{MAGICC6Pt12011}}. They
can also have an impact on morbidity and mortality---see for example
\cite{ChepelievvdMGEA20} and \cite{OECDNGHG2016}.

\begin{table}[H]
\caption{Non-greenhouse gas emissions}
\label{tab:nghg}
\begin{center}
\small
\rowcolors{2}{TableOdd}{TableEven}
\rowcolors{1}{}{lightblue}
\begin{tabular}{p{2.0cm} p{10.0cm}}
\toprule
{\normalsize \textbf{\emph{Gas}}} & {\normalsize \textbf{\emph{Description}}} \\
\midrule
   BC     & Black carbon \\
   CO     & Carbon monoxide \\
   $\textrm{NH}_3$    & Ammonia \\
   NMVOC   & Non-methane volatile organic compounds \\
   $\textrm{NO}_{\textrm{x}}$    & Nitrogen oxides \\
   OC     & Organic carbon \\
   PM10   & Particulate matter 10 \\
   PM2.5  & Particulate matter 2.5 \\
   $\textrm{SO}_2$    & Sulfur dioxide \\
\bottomrule
\end{tabular}
\end{center}
\end{table}

Emissions are generated
by three sources: 1) direct consumption of a commodity; 2) factor-based
emissions (e.g. capital, i.e. herds, in the livestock sectors); and 3) output or
processed based emissions (e.g. methane from landfills). The bulk of carbon emissions are generated by the combustion of fossil
fuels---coal, oil (crude and refined) and natural gas, but
the greenhouse gas bundle $\mathit{XGHG}$ does
include process-based carbon emissions, see equation~(\ref{eq:xghg}. Other emissions
can be a combination of all three sources of emissions. Equation~(\ref{eq:emii})
reflects the consumption based emissions over all Armington agents
($\mathit{aa}$) and for all commodities ($i$). Emissions are based on the
consumption level multiplied by the rate of emission per unit of consumption
($\rho^{\mathit{Emi}}$). The specification allows for both national- and
agent-specific sourcing of imports. In the case of the latter, the relevant
volume of consumption is $\mathit{XA}$. In the case of the latter, the relevant
consumption volumes are $\mathit{XD}$ and $\mathit{XM}$ and the emission rates
are allowed to vary across bundles.\footnote{The $\textrm{CO}_2$ emissions
database distinguishes between domestic and import emissions, however the
non-$\textrm{CO}_2$ database does not and the emission rates are assumed to be
identical.} Equation~(\ref{eq:emifact}) reflects the factor based emissions for
labor, capital, land and natural resources. Finally, equation~(\ref{eq:emixp})
represents the processed based emissions.\footnote{There is a master set,
$\mathit{is}$, that represents all of the labels of the SAM---including one for
the total that is represented by the subset $\mathit{tot}$.}

\begin{equation}
\label{eq:emii}
\mathit{Emi}_{r,\mathit{em},i,\mathit{aa}} = \left\{
\begin{array}{*{20}{l}}
   \displaystyle \chi^{\mathit{Emi}}_{\mathit{em}}
      \rho^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
      \mathit{XA}_{r,i,\mathit{aa}}
   & \textrm{if } \mathit{ArmFlag} = 0 \\
   \displaystyle \chi^{\mathit{Emi}}_{\mathit{em}}
      \rho^{\mathit{Emi,d}}_{r,\mathit{em},i,\mathit{aa}}
      \mathit{XD}_{r,i,\mathit{aa}}
   +  \chi^{\mathit{Emi}}_{\mathit{em}}
      \rho^{\mathit{Emi,m}}_{r,\mathit{em},i,\mathit{aa}}
      \mathit{XM}_{r,i,\mathit{aa}}
   & \textrm{if } \mathit{ArmFlag} \ne 0 \\
\end{array}
\right.
\end{equation}

\begin{equation}
\label{eq:emifact}
\mathit{Emi}_{r,\mathit{em},f,\mathit{a}} =
   \chi^{\mathit{Emi}}_{\mathit{em}}
   \rho^{\mathit{Emi}}_{r,\mathit{em},\mathit{f},\mathit{a}}
   \mathit{XF}_{r,f,\mathit{a}}
\end{equation}

\begin{equation}
\label{eq:emixp}
\mathit{Emi}_{r,\mathit{em},\mathit{tot},\mathit{a}} =
   \chi^{\mathit{Emi}}_{\mathit{em}}
   \rho^{\mathit{Emi}}_{r,\mathit{em},\mathit{tot},\mathit{a}}
   \mathit{XP}_{r,\mathit{a}}
\end{equation}

[11-AUG-2025] Equation~(\ref{eq:emitot}) is the aggregate level of emissions for region $r$.
It is the sum across all potential sources of emissions represented by the
indices $\mathit{is}$ and $\mathit{aa}$. The equation allows for a region
specific level of emissions from exogenous sources---that could be used for
example to introduce forest-based emissions.
[15-Apr-2021] The formula also includes non-combustion based process
emissions.
Equation~(\ref{eq:emigbl}) defines
the global level of emissions, the sum of total regional emisssions, and also
allows for an exogenous level of emissions that is not region-specific.

\begin{equation}
\label{eq:emitot}
\mathit{EmiTot}_{r,\mathit{em}} =
   \displaystyle \sum_{\mathit{is}} {\sum_{\mathit{aa}} {
      \mathit{Emi}_{r,\mathit{em},\mathit{is},\mathit{aa}}
   }}
   + \sum_a{\mathit{prEmi}_{r,\mathit{em},a}}
   + \mathit{EmiOth}_{r,\mathit{em}}
\end{equation}

\begin{equation}
\label{eq:emigbl}
\mathit{EmiGbl}_{\mathit{em}} =
   \displaystyle \sum_{\mathit{r}} {
      \mathit{EmiTot}_{r,\mathit{em}}
   }
   + \mathit{EmiOthGbl}_{\mathit{em}}
\end{equation}

Equation~(\ref{eq:emiAct}) represents the total emissions of type $\mathit{emq}$
generated by production of activity $a$. The first term is
the sum of emissions across all 'input' types, which
includes commodities ($i$), production factors ($f$) and output
($\mathit{tot}$).The second term represents the activity-based
process emissions.
Equation~(\ref{eq:emiInt}) defines the emissions intensity
per unit of output, i.e., total activity-based emissions
divided by output. The unit are in tons per dollar of activity (in base
year prices). Equation~(\ref{eq:emiTotETS}) defines the total level of
emissions for the ETS agents for region $r$. The first term represents
emissions related to activities, and the second term represents
emissions related to final demand agents that are mapped to the ETS regime.

\begin{equation}
\label{eq:emiAct}
\mathit{EmiAct}_{r,\mathit{emq},a} =
   \displaystyle \sum_{\mathit{is}} {\sum_{\mathit{em} \in \mathit{emq}}
        {\mathit{Emi}_{r,\mathit{em},\mathit{is},a}}
   }
   +\displaystyle  \sum_{\mathit{em} \in \mathit{emq}}
           {\mathit{prEmi}_{r,\mathit{em},a}}
\end{equation}

\begin{equation}
\label{eq:emiInt}
\mathit{EmiInt}_{r,\mathit{emq},a} =
   \displaystyle \frac{\mathit{EmiAct}_{r,\mathit{emq},a}}{\mathit{EmiAct}_{r,a}}
\end{equation}

\begin{equation}
\label{eq:emiTotETS}
\mathit{EmiETS}_{r,\mathit{emq},\mathit{aets}} =
  \sum_{a \in \{aets\}}{\mathit{EmiAct}_{r,\mathit{emq},a}}
  + \sum_{\mathit{em} \in \mathit{emq}} {\sum_{\mathit{fd} \in \{aets\}}
    {\sum_{\mathit{is}}{\mathit{Emi}_{r,\mathit{em},\mathit{is},\mathit{fd}}}}}
\end{equation}


\subsection{Emission price regimes}

[17-MAR-2020] The emission price regimes have been completely revised
in the current version of the model. The revisions were necessitated
to incorporate coalitions with multiple regimes, such
as the European Emission Trading System (ETS). Emission coalitions
can now work with multiple regions covering different activities.
Examples are provided in the User Guide. One significant change
is that the emission tax variable is now agent-specific. This was
possible in the old specification as well by using the participation
flag, $\phi^{\mathit{Emi}}$.

\subsubsection{Exogenous emission taxes}
The simplest option is to set an emissions tax exogenously and all the required
equations have already been described. If the model is
being solved in terms of $\textrm{CO}_2$, a tax of \$x/$\textrm{TCO}_2$ is
implemented as:\footnote{The parameter $\phi^{\mathit{Emi}}$ can be used
to control the incidence of the tax, or the user can limit its application
by subsetting $\mathit{aa}$.}

\medskip
\texttt{emiTax.fx(r,"co2",aa,t) = cscale*x ;}
\medskip

\subsubsection{Emission caps}

An emissions cap requires two additional equations---one that calculates the
carbon tax for all regions within a coalition of regions (that may be as small
as one region), specified over a subset of agents denoted by $\mathit{aets}$
and over a superset of emissions, denoted by $\mathit{emq}$.

The set $\mathit{emq}$ is composed of one or more emissions and the mapping
\texttt{mapEM} maps from the model's individual emissions to
$\mathit{emq}$.\footnote{Aggregation of emissions in this context
assumes that they are somehow defined as 'equivalent'. All GHGs
in the model are specified in terms of global warming potential (GWP).
The GWP factor converts the relevant emissions in physical units,
for example millions of tons, into their GWP equivalent, normally
denoted as CO2eq, as GWP is measured by the effect
of the emissions on temperature relative to carbon dioxide emissions.}
For example, taxes on carbon emissions alone could be setup by
creating a set item \texttt{CO2} in $\mathit{emq}$ and the relevant
mapping is \texttt{mapEQ("CO2","CO2") = yes}. To target all GHG, the
setup could be to create a set item \texttt{CO2Eq} and
the relevant mapping is:

\begin{verbatim}
      mapEQ("CO2Eq", "CO2") = yes ;
      mapEQ("CO2Eq", "CH4") = yes ;
      mapEQ("CO2Eq", "N2O") = yes ;
      mapEQ("CO2Eq", "FGAS") = yes ;
\end{verbatim}

The tax specific to coalition $\mathit{rq}$ for agents
mapped to $\mathit{aets}$ for the emission combination $\mathit{emq}$ will be generated by the emissions
constraint relationship given in equation~(\ref{eq:emiregtax}).
The coalition $\mathit{rq}$ is
a subset of $\mathit{ra}$ that represents a user-defined set of aggregate
regions that can be used by the model (and the output routines). It normally
includes all of the separate regions of the model---so that each modeled region
can be its own coalition---plus a number of additional aggregate regions to
which the individual regions are mapped. Coalitions are then setup by
defining the subset $\mathit{ra}$ to which the regional mappings will already
have been specified.
On the left-hand side is the (exogenous) cap, that is defined for each
active pair $\mathit{rq}$ and $\mathit{aets}$. A world cap, for example,
would map each region to a world coalition (for example 'WLD') and
include all agents (for example 'ALL'). On the right-hand side
is the level of emissions for each active $\mathit{rq}$ and $\mathit{aets}$
pair summed over all possible sources of emissions---also
including process emissions (15-Apr-2021).
The emissions cap equation implicitly determines the
coalition-wide emissions tax, $\tau^{\mathit{EmiQ}}_{\mathit{rq},\mathit{em},\mathit{aets}}$.

Equation~(\ref{eq:emitax}) maps the coalition-wide tax to the
emissions tax of each individual region that is part of the $\mathit{rq}$
coalition and for each agent $\mathit{aa}$ mapped to the
aggregation of agents denoted by $\mathit{aets}$. In the absence of quotas, the emission tax revenues
collected in each region fully accrue to the regional government.\footnote{01-SEP-2025. The
$\mathit{aets}$ map is now coalition specific.}

\begin{equation}
\label{eq:emiregtax}
\mathit{Emi}^{\mathit{Cap}}_{\mathit{rq},\mathit{emq},\mathit{aets}}
\ge
\sum_{r \in \{ \mathit{rq}\}}
{\left[
\sum_{\mathit{em} \in \{\mathit{emq}\}}
\left( \sum_{\mathit{aa} \in \{\mathit{aets}\}}
\sum_{\mathit{is}} {\mathit{Emi}_{r,\mathit{em},\mathit{is},\mathit{aa}}}
 +
\sum_{\mathit{a} \in \{\mathit{aets}\}}{\mathit{prEmi}_{r,\mathit{em},a}}
\right)
\right]}
\end{equation}

\begin{equation}
\label{eq:emitax}
\tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}} =
   \tau^{\mathit{EmiQ}}_{\mathit{rq},\mathit{emq},\mathit{aets}}
\qquad \textrm{if } r \in \{ \mathit{rq} \} \textrm{, } \mathit{em} \in \{ \mathit{emq} \} \textrm{ and } \mathit{aa} \in \{ \mathit{aets} \}\\
\end{equation}

The following code snippet shows one way how to implement the
European ETS regime.  The set of agents is divided into two: (a) those that
participate in the ETS---mostly large energy intensive sectors such as power
and metals---though in the example, transport services are included; and (b)
all other sectors and final demand agents. There is trading among the ETS
sectors, so a European-wide coalition is defined (\texttt{'EUR'}). The trading
regime is setup and there will be a coalition-wide tax that will be uniform
across ETS sectors and across countries/regions within the coalition.
Outside of the ETS sectors, each country in Europe has an
emissions cap on non-ETS activities.
The example assumes no trading and thus the carbon tax for the non-ETS sectors
will diverge across countries within Europe.

\begin{lstlisting}[language=GAMS, caption={Example of ETS regime}]
*  Define modeled regions
set r / "DEU" "Germany",  "FRA" "FRANCE",     "ITA" "Italy",
        "XEU" "Other EU", "XOE" "Other OECD", "ROW" "Rest of the World" / ;
*  Define potential coalitions
set ra / "EUR", "NEU", "WLD", "DEU", "FRA", "ITA", "XEU" / ;
*  Map the coalitions
set mapr(ra,r) / "EUR".("DEU", "FRA", "ITA", "XEU"),
                 "NEU".("XOE", "ROW"),
                 "FRA"."FRA", "DEU"."DEU",
                 "ITA"."ITA", "XEU"."XEU" / ;
mapr("WLD",r) = yes ;
*  Define model agents
set aa / "AGR" "Agriculture",              "NMN" "Energy intensive manufacturing",
         "XMN" "Other manufacturing",      "TRP" "Transport services",
         "XSV" "Other goods and services", "HHD" "Households",
         "GOV" "Government",               "INV" "Investment" / ;
*  Define aets regimes
set aets / "ETS" "ETS agents", "NONETS" "Non-ETS agents", "ALL" "All agents" / ;
* Map agents to aets regimes
set mapets(ra, aets, aa) / "EUR"."ETS".("NMN", "TRP") / ;
mapets("EUR","NONETS",aa)$(not mapets("EUR","ETS",aa)) = yes ;
mapets("EUR","ALL",aa) = yes ;
*  Define emission aggregation
set emq / "CO2" / ;
set mapEM("CO2","CO2") = yes ;

*  Setup the "ETS" as a EU-wide trading regime
rq("EUR") = yes ;

*  Set the CAP flags for the coalition and the regions in the coalition
ifEmiCap("EUR","CO2","ETS") = yes ;
ifEmiRCap(r,"CO2",aa)$(mapr("EUR",r) and mapets("EUR","ETS",aa)) = yes ;

*  Set the exogenous cap (calculated elsewhere)
emiCap.fx("EUR","CO2","ETS",tsim) = EmiCurETS(tsim) ;
*  Endogenize the taxes: coalition and the regions in the coalition
emiCTAX.lo("EUR","CO2","ETS",tsim) = 0 ;
emiCTAX.up("EUR","CO2","ETS",tsim) = +inf ;
emiTax.lo(r,"CO2",aa,tsim)$(mapr("EUR",r) and mapets("EUR","ETS",aa)) = -inf ;
emiTax.up(r,"CO2",aa,tsim)$(mapr("EUR",r) and mapets("EUR","ETS",aa)) = +inf ;

*  Setup the cap constraints for each region/country for the non-ETS sectors
*  Assume no trading
*  Activate 'rq' for each country/region in "EUR"
loop((r,ra)$(mapr("EUR",r) and sameas(r,ra)),
   rq(ra) = yes ;
) ;
*  Initialize the cap flags
loop((r,ra)$(sameas(r,ra) and mapr("EUR",r)),
   ifEmiCap(ra,"CO2","NONETS")$mapr("EUR",r)  = yes ;
   ifEmiRCap(r,"CO2",aa)$(mapr("EUR",r) and mapets("EUR","NonETS",aa)) = yes ;
) ;
*  Set the exogenous cap (calculated elsewhere)
loop((r,ra)$(sameas(r,ra) and mapr("EUR",r)),
   emiCap.fx(ra,"CO2","NONETS",tsim)$mapr("EUR",r) = EmiCurNETS(r,tsim) ;
) ;
*  Endogenize the relevant taxes
loop(mapr("EUR",r),
   emiCTax.lo(rq,"CO2","NONETS",tsim)$sameas(rq,r)  =    0 ;
   emiCTax.up(rq,"CO2","NONETS",tsim)$sameas(rq,r)  =  inf ;
   emiTax.lo(r,"CO2",aa,tsim)$(mapets("NONETS",aa)) = -inf ;
   emiTax.up(r,"CO2",aa,tsim)$(mapets("NONETS",aa)) = +inf ;
) ;
\end{lstlisting}

The implementation of caps is somewhat more complex in order to allow for
comparability across policy simulations. For example, one may wish to compare
the cost of the ETS regime with the optimal regime, i.e. where there is a
single carbon tax that is uniform across all agents and all countries within
the coalition. In the case of the latter, one could establish a target---say
a 40~percent decline in coalition emissions by the year 2030 relative to 2005 levels.
The model could be used to assess the required uniform carbon tax to reach
that target in optimal fashion. A subsequent policy introduces the ETS with
its agent segmentation and trading only across the ETS sectors. If the ETS cap
is binding, one can only guess what the non-ETS caps would need to be to
achieve the same target as in the optimal case. The model allows for an adjustment
factor on the non-ETS caps so that the total decline in emissions across
policy regimes are identical.

For all trade regimes with a hard cap, equation~(\ref{eq:emiregtax}) continues
to hold. For trade regimes with a 'soft' cap, i.e. where we allow for adjustments
to achieve some emission target, we add the uniform adjustment target.
Equation~(\ref{eq:emiregtax}) is then written as:

\begin{equation}
\label{eq:emiregtaxbis}
\chi^{\mathit{Cap}}_{\mathit{rqt},\mathit{emq},\mathit{aetstgt}}
\mathit{Emi}^{\mathit{Cap}}_{\mathit{rq},\mathit{emq},\mathit{aets}}
\ge
\sum_{r \in \{ \mathit{rq}\}}
{\left[
\sum_{\mathit{em} \in \{\mathit{emq}\}}
\left( \sum_{\mathit{aa} \in \{\mathit{aets}\}}
\sum_{\mathit{is}} {\mathit{Emi}_{r,\mathit{em},\mathit{is},\mathit{aa}}}
 +
\sum_{\mathit{a} \in \{\mathit{aets}\}}{\mathit{prEmi}_{r,\mathit{em},a}}
\right)
\right]}
\end{equation}

\noindent where the index $\mathit{rqt}$ targets the regions that are part of the overall target region
and $\mathit{aetstgt}$ targets the appropriate sector. The adjustment factor will be determined
by equation~(\ref{eq:emiregtgt}) that defines the overall cap for the coalition region.

\begin{equation}
\label{eq:emiregtgt}
\mathit{Emi}^{\mathit{Cap}}_{\mathit{rqt},\mathit{emq},\mathit{aetstgt}}
=
\sum_{r \in \{ \mathit{rq}\}}
{\left[
\sum_{\mathit{em} \in \{\mathit{emq}\}}
\left( \sum_{\mathit{aa} \in \{\mathit{aetstgt}\}}
\sum_{\mathit{is}} {\mathit{Emi}_{r,\mathit{em},\mathit{is},\mathit{aa}}}
 +
\sum_{\mathit{a} \in \{\mathit{aetstgt}\}}{\mathit{prEmi}_{r,\mathit{em},a}}
\right)
\right]}
\end{equation}

The following code snippet shows how to extend the example above to include
an overall cap on EU emissions. In this case, the cap on the non-ETS emissions
is a 'soft' cap and the adjustment factor is endogenous and will adjust
uniformly the emissions cap on non-ETS agents to achieve a given
overall target on EU emissions.

\begin{lstlisting}[language=GAMS, caption={Example of ETS regime with a hard overall cap}]
*  Target total EU emissions
*  Set the overall cap (detemined elsewhere)
emiCap.fx("EUR","CO2","ALL",tsim) = emiRed0(tsim) ;
*  Set the flag for activating the target equation
ifRQCap("EUR","CO2","ALL") = yes ;
*  Endogenize the adjustment factor
chiCap.lo("EUR","CO2","ALL",tsim) = -inf ;
chiCap.up("EUR","CO2","ALL",tsim) = +inf ;
*  Initialize the country/region specific flags
loop((r,ra)$(mapr("EUR",r) and sameas(r,ra)),
   ifXCAP(ra,"CO2","NONETS") = no ;
   maprq("EUR",ra) = yes ;
) ;
\end{lstlisting}

Emissions trading is setup by specifying coalitions and allowing for a uniform
carbon price across the regions in the coalition (over a set of agents, potentially all).
In the default specification all
carbon tax revenues accrue to the source region of emissions. One could
instead allocate initial emission quotas across regions in a coalition.\footnote{This implies
that in the default specification the implicit quotas are exactly the
actual level of emissions.} The sum of
the quotas within a coalition must add up to the emissions cap for the
coalition. Equation~(\ref{eq:emiquotaY}) determines the value of emissions trade
for each region within a coalition. It is equal to the level of the
coalition-wide emission tax times the difference between the quota allocation
and actual emissions. If the difference is positive, the value of trade will be
positive. It is assumed that the value of the trading rights goes directly to
the government (with the counterbalancing account in the omitted balance of
payments constraint), see equation~(\ref{eq:savg}).

\begin{equation}
\label{eq:emiquotaY}
\mathit{EmiQY}_{r,\mathit{emq},\mathit{aets}} =
   \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aets}} \left(
      \mathit{EmiQ}_{r,\mathit{emq},\mathit{aets}} - \mathit{EmiTot}_{r,\mathit{emq},\mathit{aets}}
   \right)
\end{equation}

The code snippet below shows
how to set up a cap and trade regime at the global level. It is assumed that
developing countries are allocated quotas equivalent to their emission level
from the previous period. The residual quotas, for developed countries, are
allocated based on their share of emissions of the previous period. Note that in
lines 26-31 where the quotas are set for the regions in the high-income
coalition the quotas for the developing regions is subtracted from the overall
cap using the lagged value of emissions and not the variable \texttt{emiQuota}.
This is because the order of the loop over \texttt{ra} is undetermined and it is
possible the quotas for the developed regions will be set before the quotas
for the developing regions.

\begin{lstlisting}[language=GAMS, caption={Example of a cap and trade regime}]
loop((ra,em,aets)$(sameas(ra,"WLD") and sameas(em,"CO2") and sameas(aets,"ALL")),
*  Set up the global trading regime covering all regions and all agents
   rq(ra)               = yes ;
   ifEmiCap(ra,em,aets) = 1 ;
   ifEmiRCap(r,em,aa)$(mapr(ra,r) and mapets(aets,aa)) = yes ;
*  Cap is a reduction of 20% wrt to previous period's emissions
   emiCap.fx(ra,em,aets,tsim) = 0.8*sum((r,aa,is)$(mapr(ra,r) and mapets(aets,aa)),
      emi.l(r,em,is,aa,tsim-1)*emi0(r,em,is,aa)) ;

   emiCTax.lo(ra, em, aets, tsim) = -inf ;
   emiCTax.up(ra, em, aets, tsim) = +inf ;
   emiTax.lo(r, em, aa, tsim)     = -inf ;
   emiTax.up(r, em, aa, tsim)     = +inf ;

*  Setup the quota
   ifEmiRQuota(r,em,aets)$mapr(ra,r) = yes ;
   loop(ra,
      if(sameas(ra, "lmy"),
*        Quotas for developing countries is that same as prior emissions
         emiQuota.fx(r,em,aets,tsim)$mapr(ra,r)
            = sum((aa,is)$mapets(aets,aa), emi.l(r,em,is,aa,tsim-1)*emi0(r,em,is,aa) ;
      elseif(sameas(ra,"hic")),
*        Quotas for developed countries is residual
*           apportioned according to prior emission shares
         emiQuota.fx(r,em,aets,tsim)$mapr(ra,r)
            = (emiCap.l("WLD", em, aets, tsim)
            -  sum(rp$mapr("lmy",rp),sum((aa,is)$mapets(aets,aa),
                  emi.l(rp,em,is,aa,tsim-1)*emi0(rp,em,is,aa)))
            * sum((aa,is)$mapets(aets,aa), emi.l(r,em,is,aa,tsim-1)*emi0(r,em,is,aa)
            / sum(rp$mapr(ra,rp), sum((aa,is)$mapets(aets,aa),
               emi.l(rp,em,is,aa,tsim-1)*emi0(rp,em,is,aa)) ;
      ) ;
   ) ;
   emiQuotaY.lo(r, em, aets, tsim) = -inf ;
   emiQuotaY.up(r, em, aets, tsim) = +inf ;
) ;
\end{lstlisting}

\section{Special modules}
\renewcommand{\theequation}{{Z-}\arabic{equation}}
\setcounter{equation}{0}
\label{sec:SpcMod}

This section describes some additional modules that have been
implemented for specific scenarios, though not needed for
standard simulations.

\subsection{Targeted production subsidies}

The idea behind this simulation is to promote certain activities
by introducing a subsidy to production. The target is a level
of total subsidies relative to GDP, for example 1~percent, and
the model determines a subsidy level consistent with this target.
For this, we first introduce a production subsidy, $\tau^s$, which
is uniform over a set of targeted activities, $\mathit{at}$, which
is a subset of $a$. This requires changing all equations that
depend on the production tax, to take into account the subsidy.
Equation~(\ref{eq:pp}) includes the new subsidy, which is assumed
to be positive. The coefficient $\varphi^s$ takes the value
1 for the subset $\mathit{at}$, i.e. all targeted sectors, and
the value 0 for all other sectors.\footnote{In the model
code, the subsidy rate is conditioned by the subset \texttt{asubs}
that represents the subset of targeted activities.}
The second equation that needs modification is the government
revenue equation, (\ref{eq:ygovptx}).

\begin{equation}
\label{eq:ppp}
\tag{\ref{eq:pp}}
\mathit{PP}_{r,a,i} =
   \left( 1 + \tau^p_{r,a,i} - \varphi^s_{a} \tau^s_{r} \right) \mathit{P}_{r,a,i}
\end{equation}

\begin{equation}
\label{eq:ygovptxp}
\tag{\ref{eq:ygovptx}}
\mathit{YGOV}_{r,ptx} =
   \sum_a{
      \left[
         \sum_i{
            \left( \tau^p_{r,a,i} - \varphi^s_{a} \tau^s_{r} \right) \mathit{P}_{r,a,i} \mathit{X_{r,a,i}}
         }
      +  \sum_v{
            \tau^\mathit{uc}_{r,a,v} \mathit{UC_{r,a,v}} \mathit{XPv_{r,a,v}}
         }
      \right]
   }
\end{equation}

Beyond the modifications to the equations that include the
production tax, we introduce two new equations.
The first, equation~(\ref{eq:pSubsY}), calculates the total
value of the cost of the subsidy in the targeted sectors, $\mathit{PSubsY}$.
Equation~(\ref{eq:pSubsYShrGDP}) defines the share of the total
cost of the subsidy relative to (nominal) GDP. In the policy
scenario, the share can be fixed, for example 1~percent. In this
case, the subsidy rate, $\tau^s_{r}$, is endogenous and is
evaluated to line
up with the subsidy cost as a share of GDP. If this is part of the
baseline, the calibrated subsidy rate becomes exogenous in
subsequent scenarios.

\begin{equation}
\label{eq:pSubsY}
\mathit{PSubsY}_r =
\sum_{\mathit{at}}
{\sum_i{\tau^s_{r} P_{r,i,\mathit{at}} X_{r,i,\mathit{at}} } }
\end{equation}

\begin{equation}
\label{eq:pSubsYShrGDP}
\mathit{PSubsYShrGDP}_r = \frac{\mathit{PSubsY}_r}{\mathit{GDPMP}_r}
\end{equation}

\subsection{Sector-specific emission rights}

Certain carbon price policy scenarios allow for full or partial
compensation of the sector-specific costs of carbon pricing, i.e.,
sectors may be given an allocation of carbon permits, which
they are free to use and/or sell on carbon markets. The allocation
permits can either be exogenous, e.g. some percentage of past
or baseline emissions, or endogenous, e.g. a share of actual
emissions. Equation~(\ref{eq:emiRebate}) determines the revenues generated by
by the permit allocation. It is equal to the carbon price level
times the amount of the allocation. If the allocation
is exogenous, the relevant variable is $\mathit{emiRebateX}$ and normally
$\chi^{\mathit{rbt}}$ would be set to 1. If the allocation is based on
actual emissions, the relevant variable is $\mathit{Emi}$, where
$\chi^{\mathit{rbt}}$ is the (exogenous) share of actual emissions.
The allocation rebate is assumed to shift the aggregate output price
in each activity as provided in a revised equation~(\ref{eq:pxwrebate}).
All activities, therefore, perceive the marginal cost of carbon
pricing, but can be partially or fully compensated for these costs
with a lump sum payment. The allocation rights reduce the emission revenues
accruing to the government and thus a change to equation~(\ref{eq:ygovctxp}).

\begin{equation}
\label{eq:emiRebate}
\mathit{EmiRebate}_{r,a} =
\begin{cases} \displaystyle
\sum_{\mathit{em}}{\sum_i{\tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{a}}  \chi^{\mathit{rbt}}_{r,\mathit{em},i,a} \mathit{emiRebateX}_{r,\mathit{em},i,a}}} & \textrm{if } \mathit{emiRebateFlag}_{r,a} = \texttt{Exogenous} \\
\displaystyle
\sum_{\mathit{em}}{\sum_i{\tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{a}}  \chi^{\mathit{rbt}}_{r,\mathit{em},i,a} \mathit{Emi}_{r,\mathit{em},i,a}}} & \textrm{if } \mathit{emiRebateFlag}_{r,a} = \texttt{Endogenous} \\
\end{cases}
\end{equation}

\begin{equation}
\label{eq:pxwrebate}
\tag{\ref{eq:px}}
\mathit{PX}_{r,a} \mathit{XP}_{r,a} =
   \sum_v {
      \mathit{PXv}_{r,a,v} \mathit{XPv}_{r,a,v}
   }
   - \mathit{EmiRebate}_{r,a}
\end{equation}

\begin{equation}
\label{eq:ygovctxp}
\tag{\ref{eq:ygovctx}}
\mathit{YGOV}_{r,ctx} =
\left\{
   \begin{array}{*{20}{l}}
      \displaystyle \sum_{\mathit{em}} { \sum_{i} {\sum_{\mathit{aa}} {
         \chi^{\mathit{Emi}}_{\mathit{em}}
         \rho^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
         \phi^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
            \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}} \mathit{XA}_{r,i,aa}
      }}} \\
      \qquad \displaystyle
      - \sum_a{\mathit{EmiRebate}_{r,a}}

      & \textrm{if } \mathit{ArmFlag} = 0 \\
      \displaystyle \sum_{\mathit{em}} { \sum_{i} {\sum_{\mathit{aa}} {
         \chi^{\mathit{Emi}}_{\mathit{em}}
         \rho^{\mathit{Emi,d}}_{r,\mathit{em},i,\mathit{aa}}
         \phi^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
         \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}}
            \mathit{XD}_{r,i,aa} }}} \\
      \qquad \displaystyle
      +  {\chi^{\mathit{Emi}}_{\mathit{em}}
            \rho^{\mathit{Emi,m}}_{r,\mathit{em},i,\mathit{aa}}
            \phi^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
            \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}}\mathit{XM}_{r,i,aa}
         } \\
      \qquad \displaystyle
      - \sum_a{\mathit{EmiRebate}_{r,a}}
      & \textrm{if } \mathit{ArmFlag} \ne 0 \\
\end{array}
\right.
\end{equation}

Listing~\ref{lst:EmiRebate} shows how to implement
the emission rights for both an endogenous and
and exogenous rebate. In the case of the former
the rights are set to 80\% of actual emissions.
In the case of the latter, emission rights are
set to 80\% of baseline emissions (which could
potentially exceed actual emissions).
The allocation rights are limited to all
regions mapped to \texttt{EUR} and sectors
eligible for the rebate as determined by the \texttt{etsRebate}
mapping, and starting in year 2021.
The rebate flag (\texttt{emiRebateFlag}) is set to
\texttt{YES} in both cases.
In the case of an endogenous emission right level,
the exogenous rebate flag (\texttt{EmiRebateExog}) is set to \texttt{NO}.
The rebate variable, $emiRebate$, is made endogenous in both cases.

\begin{lstlisting}[language=GAMS,
	caption={Implementing emission rights}, label=lst:EmiRebate]
loop(tsim$(years(tsim) ge 2021),

*  Implement the rebates

   if(1,
      loop((r,a)$(mapr("EUR",r) and etsRebate(a)),
         emiRebateFlag(r,a,tsim) = yes ;
         emiRebateExog(r,a,t)    = no ;
         chiRebate(r,"CO2",i,a,tsim)  = 0.8 ;
         emiRebate.lo(r,a,tsim) = -inf ;
         emiRebate.up(r,a,tsim) = +inf ;
      ) ;
   else
      loop((r,a)$(mapr("EUR",r) and etsRebate(a)),
         emiRebateFlag(r,a,tsim) = yes ;
         emiRebateExog(r,a,t)    = yes ;
         chiRebate(r,"CO2",i,a,tsim)  = 1 ;
         emiRebateX(r,"CO2",i,a,tsim) = 0.8*emibau0(r,i,a)*emibau(r,i,a,tsim) ;
         emiRebate.lo(r,a,tsim) = -inf ;
         emiRebate.up(r,a,tsim) = +inf ;
      ) ;
   ) ;
) ;

\end{lstlisting}

%\needspace{17\baselineskip}

\subsection{Well-head based carbon taxes}

An alternative to end-user carbon taxes, i.e. imposing the tax
at the point of combustion, is to impose the tax at the point
of extraction---the coal mine, the oil or gas well. We implement this
by evaluating the standard end-user based carbon tax, but then
rebate the collected revenues to the producing countries based
on their production share of global extraction.

Equation~(\ref{eq:xpshr}) defines the share of output for
activity $a$ in region $r$ as a share of global production.\footnote{Output
is evaluated at base year prices.} This equation can be used in the
standard model.
Equation~(\ref{eq:emitaxrefff}) is similar to the carbon tax revenue equation, (\ref{eq:ygovctx}), though the revenues from consumption
are mapped to the fossil fuel source. Coal and gas are mapped
respectively to the coal and gas extractive industries. In the case
of oil, all carbon revenues linked to oil and refined oil combustion
are mapped back to the oil extraction industry.\footnote{N.B. Most of
oil will be combusted in the form of refined oil.}
Equation~(\ref{eq:ctaxRecycle}) determines the rebated revenues to
the source producers. It is equal to the global amount of collected
carbon tax revenues, which is allocated to the producers using
their share of global extraction, less the revenues collected from
domestic carbon tax revenues. Summing the recycled revenues
over all regions should sum to zero. Equations~(\ref{eq:emitaxrefff})
and~(\ref{eq:ctaxRecycle}) are only active if the flag \texttt{ifCO2Tax}
is activated. The carbon revenue rebate is only active if the
\texttt{ifRecycle} flag is active. The recycled revenues accrue
to government accounts, but with the default closure these revenues
are rebated back to the representative household.
Equation~(\ref{eq:savgp}) reprises the government closure equation
and includes the recycled revenues, subject to the \texttt{ifRecycle}
flag being activated.

\begin{equation}
\label{eq:xpshr}
\varphi^p_{r,a} = \frac{\mathit{PX}_{r,a,0} \mathit{XP}_{r,a}}
{\displaystyle \sum_s{\mathit{PX}_{s,a,0} \mathit{XP}_{s,a}}}
\end{equation}

\begin{equation}
\label{eq:emitaxrefff}
%\tag{\ref{eq:ygovctx}}
\mathit{EmiTaxRevFF}_{r,\mathit{affl}} =
\left\{
   \begin{array}{*{20}{l}}
      \displaystyle \sum_{\mathit{em}=\textmd{CO}_2} { \sum_{i \in {\mathit{affl}}} {\sum_{\mathit{aa}} {
         \chi^{\mathit{Emi}}_{\mathit{em}}
         \rho^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
         \phi^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
            \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}} \mathit{XA}_{r,i,aa}
      }}}
      \\ \qquad \qquad \qquad \qquad \textrm{if } \mathit{ArmFlag} = 0 \\ \\
      \displaystyle \sum_{\mathit{em}=\textmd{CO}_2} { \sum_{i \in {\mathit{affl}}} {\sum_{\mathit{aa}} {
         \chi^{\mathit{Emi}}_{\mathit{em}}
         \rho^{\mathit{Emi,d}}_{r,\mathit{em},i,\mathit{aa}}
         \phi^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
         \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}}
            \mathit{XD}_{r,i,aa} }}} \\
      \qquad \displaystyle
      +  {\chi^{\mathit{Emi}}_{\mathit{em}}
            \rho^{\mathit{Emi,m}}_{r,\mathit{em},i,\mathit{aa}}
            \phi^{\mathit{Emi}}_{r,\mathit{em},i,\mathit{aa}}
            \tau^{\mathit{Emi}}_{r,\mathit{em},\mathit{aa}}\mathit{XM}_{r,i,aa}
         }
      \\ \qquad \qquad \qquad \qquad \textrm{if } \mathit{ArmFlag} \ne 0 \\
\end{array}
\right.
\end{equation}

\begin{equation}
\label{eq:ctaxRecycle}
\mathit{cTaxRecycle}_r = \sum_{\mathit{affl}} {\varphi^p_{r,\mathit{affl}}\sum_s{\mathit{EmiTaxRevFF}_{r,\mathit{affl}}}}
- \mathit{YGOV}_{r,ctx}
\end{equation}

\begin{equation}
\label{eq:savgp}
\tag{\ref{eq:savg}}
\begin{array}{l l l}
\mathit{S^g_r} & = & \displaystyle
   \sum_{\mathit{gy}} {\mathit{YGOV}_{r,\mathit{gy}}} +
   \sum_{\mathit{em}} {\mathit{QuotaY}^{\mathit{Emi}}_{r,\mathit{em}}} +
   \mathit{cTaxRecycle}_r +
   \sum_s{\chi^{\mathit{gNTM}}_{s,r} \mathit{ntmY}_s} \\
{} & + & \qquad \displaystyle \mathit{ODAIn}_r - \mathit{ODAOut}_r
   -   \sum_{\mathit{fd} \in {\mathit{Gov}}}{\mathit{YFD}_{r,\mathit{fd}}}
\end{array}
\end{equation}

\subsection{Controlling preferences in the power bundle}

[17-Mar-2020] Two modifications have been added to the power bundle.
The first is an exogenous preference shifter, $\lambda^{\mathit{pow}}$. This is typically
adjusted in the baseline or reference scenario to shift preferences
to one or more power bundles, for example the renewable bundle.

The second provides a more direct control over preferences using
so-called \emph{phantom taxes}.\footnote{\cite{DixonetalGEA2019} use
phantom taxes to adjust capital allocation in a modified and dynamic
version of the GTAP model.}
The implementation is fairly straightforward. The price of
each power bundle is adjusted by a price wedge, i.e. the
phantom tax, $\tau^{\mathit{fpb}}$. The power bundles are
split into two sets, those whose level is under control, i.e. fixed,
and all others. The first set is defined over $\mathit{IPHPB}$.
By default, the set is empty and the phantom taxes are all set
to zero. When under direct control, demand for the relevant bundles in
the set $\mathit{IPHPB}$ is fixed, i.e. exogenous, and
equation~(\ref{eq:XPBbis}) is used to determine the phantom tax
for each fixed bundle. Equation~(\ref{eq:PHTaxY}) determines total
revenues generated by the phantom taxes. When phantom taxes
are implemented, total revenues are exogenized and set to 0, i.e.
the net fiscal implication of the phantom taxes is neutralized. In
essence, this equation determines the variable $\chi^{\mathit{fpb}}$, which
is the uniform phantom tax shifter on all of the non-controlled
power bundles. Equation~(\ref{eq:xPHTax}) sets the actual
phantom tax to the uniform shifter for all non-controlled power bundles.

To implement phantom taxes, the user must specify the set $\mathit{IPHPB}$
(set \texttt{iphpb} in the GAMS code) and initialize the
\texttt{phTaxpbFlag} flag to '\texttt{yes}' (for each region being targeted). The relevant phantom taxes need to be endogenized as well
as the variable $\chi^{\mathit{fpb}}$ (\texttt{chiphpb} in the GAMS code).
Demand for the relevant power bundles needs to be exogenized. Finally,
the phantom tax revenues need to be exogenized and set to 0. An example is
provided in the user guide.

\begin{equation}
\label{eq:XPBbis}
\mathit{XPB}_{r,\mathit{pb},\mathit{ely}} = \alpha^{\mathit{pb}}_{r,\mathit{pb},\mathit{ely}}
\left(
\frac {\mathit{PPOWN}_{r,\mathit{ely}}} {\left(1+\tau^{\mathit{fpb}}_{r,\mathit{pb},\mathit{ely}}\right)\lambda^{\mathit{pow}}_{r,\mathit{pb},\mathit{ely}}\mathit{PPB}_{r,\mathit{pb},\mathit{ely}}}
\right)^{\sigma^{\mathit{pow}}_{r,\mathit{ely}}}
\mathit{XPOW}_{r,\mathit{ely}}
\end{equation}

\begin{equation}
\label{eq:PPOWNDXbis}
\mathit{PPOWN}_{r,\mathit{ely}} =
\left[\sum_{\mathit{pb}} {
\alpha^{\mathit{pb}}_{r,\mathit{pb},\mathit{ely}}\left(
{ \left(1+\tau^{\mathit{fpb}}_{r,\mathit{pb},\mathit{ely}}\right) \lambda^{\mathit{pow}}_{r,\mathit{pb},\mathit{ely}} \mathit{PPB}_{r,\mathit{pb},\mathit{ely}}}
\right)^{-\sigma^{\mathit{pow}}_{r,\mathit{ely}}}}
\right]^{-1/\sigma^{\mathit{pow}}_{r,\mathit{ely}}}
\end{equation}

\begin{equation}
\label{eq:PPOWbis}
\mathit{PPOW}_{r,\mathit{ely}} \mathit{XPOW}_{r,\mathit{ely}}=\sum_{\mathit{pb}}{
\left(1+\tau^{\mathit{fpb}}_{r,\mathit{pb},\mathit{ely}}\right) \mathit{PPB}_{r,\mathit{pb},\mathit{ely}} \mathit{XPB}_{r,\mathit{pb},\mathit{ely}}}
\end{equation}

\begin{equation}
\label{eq:PHTaxY}
\mathit{PHTaxY}_{r} = \sum_{\mathit{pb}}{\sum_{\mathit{ely}}{
\tau^{\mathit{fpb}}_{r,\mathit{pb},\mathit{ely}} \mathit{PPB}_{r,\mathit{pb},\mathit{ely}} \mathit{XPB}_{r,\mathit{pb},\mathit{ely}}}}
\end{equation}

\begin{equation}
\label{eq:xPHTax}
\tau^{\mathit{fpb}}_{r,\mathit{pb},\mathit{ely}} = \chi^{\mathit{fpb}}_{r} \qquad \mathit{pb} \notin {\mathit{IPHPB}}
\end{equation}

\subsection{Controlling consumer demand preferences}

[17-Mar-2020] Similar to the power bundle, phantom taxes have
been added to control consumer preferences. The control is
done at the $i$ commodity level, not the $k$ commodity level.
It has been setup to work with the standard consumer demand
module, not the demand module that includes waste.
Equation~(\ref{eq:pahbis}) determines the final consumer
price of goods and incorporates the so-called phantom
tax, $\tau^{\mathit{fhh}}$.\footnote{The module would have to
be re-configured somewhat to allow for household specific shifters.
The current code assumes that there is a single representative
household per region.} Equation~(\ref{eq:PHHTaxY}) determines the
revenues generated by the phantom taxes.
The final equation, equation~(\ref{eq:xPHHTax}) determines the
uniform shifter, $\chi^{\mathit{fhh}}$, for the phantom
tax on the non-targeted commodities. Note that it is formulated
somewhat differently from the power bundle phantom taxes.
There are two sets of phantom taxes, $\tau^{fhh}$ and $\tau^{\mathit{fhh}}_0$.
Equation~(\ref{eq:xPHHTax}) sets the phantom tax to $\tau^{fhh}_0$
for the targeted commodities, the latter determined by fixing
demand for the relevant commodity. For the non-targeted commodities,
$\tau^{fhh}_0$ is fixed (by default to -0.01) and the uniform
shifter, $\chi^{\mathit{fhh}}$, is a multiplicative factor with respect to
$\tau^{\mathit{fhh}}_0$. It is determined by exogenizing total revenues from
the phantom taxes, typically set to 0.

Implementation requires setting a regional flag, \texttt{phhTaxFlag} to \texttt{'yes'}.
A flag for the targeted commodities, \texttt{iphh}, also needs to be set to \texttt{'yes'}.
The phantom tax, \texttt{phhTax}, needs to be endogenized for \emph{all} commodities.\footnote{Conditional
on initial consumer demand being greater than zero.}
The uniform shifter, \texttt{chiPhh}, needs to be endogenized.
The target(s) for demand, \texttt{xa(r,i,h)}, needs to be exogenized and the corresponding
other phantom tax, \texttt{phhTax0}, needs to be
endogenous (which is the case by default). The same phantom tax needs to be exogenous
for the non-targeted commodities and initialized, for example -0.01. Revenues
from the phantom taxes need to be exogenized (which determines the uniform shifter)
and normally set to 0.
An example is provided in the user guide.

\begin{equation}
\label{eq:pahbis}
\mathit{PA}^{h}_{r,i,h} =
\mathit{PA}_{r,i,h} \left(1 + \tau^{fhh}_{r,i}\right)
\end{equation}

\begin{equation}
\label{eq:PHHTaxY}
\mathit{PHHTaxY}_{r} = \sum_{\mathit{i}}{\sum_{\mathit{h}}{
\tau^{\mathit{fhh}}_{r,i} \mathit{PA}_{r,i,h} \mathit{XA}_{r,i,h}}}
\end{equation}

\begin{equation}
\label{eq:xPHHTax}
\tau^{fhh}_{r,i} =
\begin{cases}
\tau^{fhh}_{r,i,0} & \textrm{if } i \in {\mathit{IPHHH}_{r,i}} \\
\chi^{\mathit{fhh}} \tau^{fhh}_{r,i,0} & \textrm{if } i \notin {\mathit{IPHHH}_{r,i}} \\
\end{cases}
\end{equation}

\subsection{Nutrition}

The GTAP nutrition database has a number of indicators derived from
the FAO's Food Balance Sheet database (\cite{Chepeliev2022}). Table~\ref{tab:FBS_IND}
summarizes the core indicators, which will be indexed by $\mathit{sua}$, or
supply utilization account.
Another key index ($u$) is the use category. This is composed of all
of the production activities, final demand use and a \emph{loss} category.
The database also tracks the source of supply, which is the
union of the set of all regions ($s$) and the domestic
economy using the label '\texttt{LCL}'. The union will be
designated $\mathit{srcr}$. The nutrition accounts
are given by the model parameter $\mathit{NUTR}$, which
has five dimensions: (1) region ($r$); (2) commodity ($i$);
(3) use category ($u$); (4) supply utilization account ($\mathit{sua}$);
and (5) source region ($\mathit{srcr}$).\footnote{The ordering of
the indices is somewhat different in the input database.}

\begin{table}[H]
\caption{Supply utilization accounts in the nutrition database}
\label{tab:FBS_IND}
\begin{center}
\rowcolors{2}{TableOdd}{TableEven}
\rowcolors{1}{}{lightblue}
\begin{tabular}{l l}
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
\textbf{Element} & \textbf{Description} \\
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
\texttt{FEED\_KT}  & Feed demand in kilotons \\
\texttt{SEED\_KT}  & Seed demand in kilotons \\
\texttt{FOOD\_KT}  & Food demand in kilotons \\
\texttt{OTHU\_KT}  & Other uses in kilotons \\
\texttt{LOSS\_KT}  & Losses in kilotons \\
\texttt{FOOD\_TC}  & Food demand in total calories \\
\texttt{FATS\_KT}  & Fats in kilotons \\
\texttt{PROT\_KT}  & Proteins in kilotons \\
\texttt{CARB\_KT}  & Carbohydrates in kilotons \\
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
\end{tabular}
\end{center}
\end{table}

The nutrition accounts are currently updated after a solve
statement as there is currently no interaction between nutrition
and the model equations.\footnote{If one wanted to constrain
caloric intake, for example, an equation would be need to be added
to the model
that measures calories endogenously.} Equations~(\ref{eq:nutrd}) and~(\ref{eq:nutrm})
describe the update formulas for respectively domestically
sourced products and imported products.
Demand for all \emph{sua} accounts that are domestically sourced are assumed
to change at the same rate as domestic demand for the relevant commodity.
Import demand, by source, similarly changes at the rate of total import
demand with an adjustment by source determined by the change in the
bilateral trade flow. These two equations hold for all uses---production
activities and final demand.

\begin{equation}
\label{eq:nutrd}
\mathit{NUTR}_{r,i,u,\mathit{sua},\mathit{lcl},t} =
\mathit{NUTR}_{r,i,u,\mathit{sua},\mathit{lcl},t-1}\frac{\mathit{XD}_{r,i,aa,t}}{\mathit{XD}_{r,i,aa,t-1}} \qquad \textnormal{for } u = \mathit{aa}
\end{equation}

\begin{equation}
\label{eq:nutrm}
\begin{array}{l c l}
\mathit{NUTR}_{d,i,u,\mathit{sua},s,t}  & = &
\mathit{NUTR}_{d,i,u,\mathit{sua},s,t-1} \\
{} & {\times} & \left[\displaystyle \frac{\mathit{XM}_{d,i,aa,t}}{\mathit{XM}_{d,i,aa,t-1}}
+\left(
\frac{\mathit{XW}_{s,i,d,t}}{\mathit{XW}_{s,i,d,t-1}}
- \sum_{r}{s^m_{r,i,d}\frac{\mathit{XW}_{r,i,d,t}}{\mathit{XW}_{r,i,d,t-1}}}
\right)\right]
\qquad \textnormal{for } u = \mathit{aa} \\
\end{array}
\end{equation}

The updating of the loss accounts use aggregate indicators.
Equations~(\ref{eq:nutrlossd}) and~(\ref{eq:nutrlossm})
describe the updating of the \emph{loss} accounts.
In the case of domestically sourced losses, they change
at the same rate as total domestic demand for domestic
production. In the case of imported losses by source, the rate
of change is identified with the change in the bilateral flow.

\begin{equation}
\label{eq:nutrlossd}
\mathit{NUTR}_{r,i,\mathit{lss},\mathit{loss\_kt},\mathit{lcl},t} =
\mathit{NUTR}_{r,i,\mathit{lss},\mathit{loss\_kt},\mathit{lcl},t-1}
\displaystyle \frac{\mathit{XDT}_{r,i,t}}{\mathit{XD}_{r,i,t-1}}
\end{equation}

\begin{equation}
\label{eq:nutrlossm}
\mathit{NUTR}_{d,i,\mathit{lss},\mathit{loss\_kt},s,t} =
\mathit{NUTR}_{d,i,\mathit{lss},\mathit{loss\_kt},s,t-1}
\displaystyle \frac{\mathit{XW}_{s,i,d,t}}{\mathit{XW}_{s,i,d,t-1}}
\end{equation}

The aggregation facility will aggregate the nutrition accounts
along the standard aggregation dimensions: (1) commodity
(2) region of destination ; and (3) source region of imports.
The nutrition indicators are also output in
per capita and daily terms (with a transformation of the labels).
In the case of food-based calories, the indicator is also
multiplied by 1000.

[N.B. We need to resolve the issue of discrepancies between
the FAO data and the SAM. For example, the SAM may indicate
no consumption, but the FAO has positive consumption. For the
moment, we assume that the rate of change is zero, i.e.,
we hold fixed the FAO levels.]

\subsection{Factor taxes and subsidies and fiscal closure}
\label{sec:ctaxrecycle}

In the default model, factor taxes and subsidies are exogenous
and represented by the tax $\tau^v$. The default closure
fixes the net government fiscal position, i.e. government
savings, and the adjusting fiscal instrument is $\kappa^h$,
i.e. net fiscal transfers between households and the government or lump sum taxation. In some policy scenarios it would be useful
to assess the use of alternative fiscal instruments, for
example in the case of carbon re-cycling. For this
purpose, the factor tax has been converted to a GAMS macro
that takes the following form:

\[
\tau^{\mathit{vm}}_{r,f,a} = \left[\chi^f_r \varphi^m_{r,f,a} + (1 - \varphi^m_{r,f,a})\right] \tau^v_{r,f,a}
+ \alpha^f_r \varphi^a_{r,f,a}
\]

\noindent where the default specification sets $\chi^f_r$ and
$\alpha^f$ to zero, i.e. the factor tax is simply equal
to the exogenous tax, $\tau^v$, which is initially calibrated
to the GTAP database. The user can choose to \emph{endogenize}
factor taxes using a multiplicative scalar, $\chi^f$, i.e.
all taxes adjust in the same proportion, or an additive
scalar, $\alpha^f$, i.e. all taxes adjust in the same
percentage point amount. Closure can be defined over
specific factors (for example labor only), and/or specific
sectors. For example, to change from the default closure to
an additive factor tax on labor the user needs to
exogenize $\kappa^h$, endogenize $\alpha^f$ and
set $\varphi^a_{r,l,a}$ to 1. In the code, this appears as:

\begin{lstlisting}[language=GAMS,
	caption={Labor tax closure}, label=lst:LabClosure]

*  Apply labor tax closure to all countries in "EUR"
*  and across all activities

   loop(mapr("EUR",r),
      kappah.fx(r,tsim) = kappah.l(r,tsim-1) ;
      alphaFtax.lo(r,tsim) = -inf ;
      alphaFtax.up(r,tsim) = +inf ;
      ifAfTaxFlag(r,l,a) = 1 ;
   ) ;

\end{lstlisting}

To apply the closure to all factors, use the index
$f$. To apply the closure to capital, use the
index $\mathit{cap}$.

The model includes an equation that measures the
difference between carbon tax revenues and the subsidies paid to
factors from these revenues. In the standard closure the
gap is maximal, as the carbon tax revenues are re-cycled
directly to households. The equation below measures the gap.
The second term on the right-hand side is the level of the revenues
from the subsidies measured as the difference between the endogenous
(net) tax on factors and the original tax. The sum is over all
activities $a$ and factors $f$ that are the target of the subsidies
in region $r$ as defined by the set $\mathit{FS}$.\footnote{In the
model code, this is identified with the parameter \texttt{ifAFTaxFlag}, see
above.} The first term is some share of the carbon tax revenues, by
default, $\alpha^y$ is one. The two revenue streams are summed, rather
than subtracted, as the second term would normally be a negative number.
In the standard closure, $\mathit{CTAXGap}$ is endogenous and is
equal to the carbon tax revenues, as the factor subsidies are zero.
In the re-cycling closures, $\mathit{CTAXGap}$ is exogenous and typically
set to zero. This equation is then used to determine the endogenous
factor tax shifter, $\alpha^f$, in the case of an additive shifter. It is
possible to target a share of total tax revenues by setting the
parameter $\alpha^y$ to a value different from 1.

\[
\mathit{CTAXGap}_{r} = \alpha^y_{r} \mathit{YGov}_{r,\mathit{ctx}}
+ \sum_a{\sum_{f \in \mathit{FS}_r}{ \left(\tau^{\mathit{vm}}_{r,f,a} - \tau^{\mathit{v}}_{r,f,a}\right)
\mathit{PF}_{r,f,a} \mathit{XF}_{r,f,a}}}
\]

Listing~\ref{lst:LabClosure2} shows how to implement carbon revenue recycling. It is
similar to the listing above, but the fiscal closure is different. In the listing
above, direct taxes are exogenized (for example to the baseline level) and total changes
in fiscal revenues are used to subsidize labor. If \emph{ex post} revenues increase beyond
those generated by the carbon taxes, these are used to add additional subsidies to labor use.
In the listing below, the direct tax rate is still endogenous and is the main fiscal target, and
carbon tax revenues are matched one-for-one with the subsidies to labor, assuming full
recycling.

\begin{lstlisting}[language=GAMS,
	caption={Carbon tax recycling to lower tax on labor}, label=lst:LabClosure2]

*  Apply labor tax closure to all countries in "EUR"
*  and across all activities

   loop(mapr("EUR",r),
      ctaxgap.fx(r,tsim)   = 0 ;
      alphaFtax.lo(r,tsim) = -inf ;
      alphaFtax.up(r,tsim) = +inf ;
      ifAfTaxFlag(r,l,a)   = 1 ;
   ) ;

\end{lstlisting}


\subsubsection{Targeting labor subsidies}

One potential policy simulation is to assess different
closures that have (roughly) the same fiscal impact. For
example, one may want to compare a policy scenario that
targets subsidies for renewable technologies with using
those subsidies to lower the cost of labor.
The model includes one new equation that targets a
labor subsidy amount using the same mechanism described above.\footnote{Note
that the difference between $\tau^{\mathit{vm}}$ and $\tau^{\mathit{v}}$ can be used more broadly post-simulation to
calculate the net cost of a policy in terms of the impacts on
factor taxes.}

\[
\mathit{LSubsY}_r
= \sum_a{\sum_l {
\left[\tau^{\mathit{vm}}_{r,l,a} - \tau^{\mathit{v}}_{r,l,a}
\right] \mathit{PF}_{r,l,a} \mathit{XF}_{r,l,a}
}}
\]

A first policy scenario is run that calculates some
level of subsidy, for example to renewable technologies.
That amount is then saved and is used as input to the
alternative scenario where the tax on labor is
endogenous to target the exogenous level of the
aggregate subsidies using the same mechanism as described above
though the default fiscal closure still holds, i.e.
the additive labor tax factor, $\alpha^f$, is used to target
the (exogenous) variable $\mathit{LSubsY}_r$.\footnote{The
labor subsidy cost equation is only active when the flag
\texttt{lTaxFlag} is set to \texttt{yes}.}

\subsection{Specific tariffs}

Tariffs in the standard model are assumed to be
\emph{ad valorem} and calibrated to the GTAP database.
The code allows for specific tariffs, which are
calculated on a volume basis, for example per ton of apples.
Specific tariffs have been used in practice to tax the
carbon content of imports---the latter of which is calculated
outside of the model and typically has the units
of tons of \COT{} per dollar (or millions of dollars) of
imports.

Two equations in the standard model are modified to
deal with specific tariffs---the tariff inclusive (bilateral) price
of imports and revenues generated by import taxes.\footnote{For the moment specific tariffs apply only for the default trade
specification and not for the MRIO version of the model.}

\begin{equation}
\label{eq:pdmbis}
\mathit{PDM}_{r,i,d} = \left( 1 + \tau^m_{r,i,d}  + \tau^{\mathit{ntm}}_{r,i,d} \right) \mathit{PWM}_{r,i,d}
+ \tau^{\mathit{st}}_{s,i,r}
\end{equation}

\begin{equation}
\label{eq:ygovmtxbis}
\mathit{YGOV}_{r,mtx} =
   \sum_\mathit{s} {\sum_i{\left(
      \tau^m_{s,i,r} \mathit{PWM}_{s,i,r}
      + \tau^{\mathit{st}}_{s,i,r} \right)
         \lambda^w_{s,i,r} \lambda^x_{s,i,r} \mathit{XW}^d_{s,i,r}
   }}
\end{equation}

At the moment, the specific tariff is implemented as a GAMS
macro and is always assumed to be exogenous. In the case of taxing
of the carbon content of imports, the macro has been set
equal to:

\[
\rho^x_{s,i} \tau^{\mathit{cx}}_{s,i,d}
\]

\noindent where $\rho^x$ is the quantity of carbon embedded
in imports from source region $s$ (measured in tons of \COT{}
per dollar of imports) and $\tau^{\mathit{cx}}$ is dollars
per ton of \COT{} and exogenous.\footnote{In some applications,
for example border tax adjustments, the tax on embedded emissions
should be equal to the domestic carbon tax, which could be
endogenous. In this case an additional equation would be necessary.
It turns out that a small set of model iterations can achieve the
desired result without an explicit equation.} Note that
the tax would typically only be applied to export from regions outside a carbon constrained coalition. Also note that even if
the specific tariff is uniform per unit of carbon per source region, it will not necessarily have the same level per average unit across countries
within a coalition for the same commodity. One country may
largely be importing from a less carbon intensive country compared
to another. For other uses of the specific tariff, users
may need to redefine the macro, or make a clever use of
the underlying instruments.

\subsection{Revenue neutral inter-regional transfers}

This section describes policy scenarios that involve a coalition
of regions where the net gains/losses are unevenly distributed.
Inter-regional transfers, that sum to zero, are introduced such that the net/gains
losses (in percent terms) are equalized across the regions in the coalition. Equation~(\ref{eq:interReg}) determines the ratio
of equivalent variation, $\mathit{EV}$, for each country $r$ in a coalition $C$
relative to baseline $\mathit{EV}$ and compares this
with the coalition-wide average. In the default model, $\beta^{\mathit{EV}}$
is endogenous and typically would differ from 1, i.e. the net gains/losses across regions in the coalition are not necessarily uniform.
If $\beta^{\mathit{EV}}$ is exogenously set to 1, this equation
will determine for each region with the exception of a residual region
the level of transfers that equalizes the net gains/losses (in
percent terms). Equation~(\ref{eq:interRegres}) imposes the neutrality
of gross transfers, and \emph{de facto} determines net transfers for
the residual region. The listing below shows one implementation
for a European coalition. The variable $\beta^{\mathit{EV}}$ is fixed at 1,
the \texttt{evRatioFlag} is set to \texttt{yes} for all regions
in the coalition except for the residual region, Germany in this case. The transfers
are endogenized for all regions in the coalition and equation~(\ref{eq:interRegres})
is activated.

\begin{equation}
\label{eq:interReg}
\frac {\displaystyle  \sum_h{\mathit{EV}_{r,h}}} {\displaystyle \sum_h{\mathit{EV}^b_{r,h}}}
= \beta^{\mathit{EV}}_r
\frac {\displaystyle \sum_{s \in \{C\}} {\sum_h{\mathit{EV}_{s,h}}}} {\displaystyle \sum_{s \in \{C\}} {\sum_h{\mathit{EV}^b_{s,h}}}} \qquad \forall r \in \{C\}
\end{equation}

\begin{equation}
\label{eq:interRegres}
\sum_{r \in \{C\}}{\mathit{ITRNSF}_r} \equiv 0
\end{equation}

\begin{lstlisting}[language=GAMS,
	caption={Neutral inter-regional transfers}, label=lst:TrClosure]

*  Setup inter-regional transfers to equalize the
*  'pain' from the European carbon tax. Assume that
*  'the left-out region is Germany

   evRatioFlag(r,"EUR")$(mapr("EUR",r) and not sameas(r,"DEU")) = yes ;
   betaEV.fx(r,tsim) = 1 ;
   itransfers.lo(r,tsim)$mapr("EUR",r) = -inf ;
   itransfers.up(r,tsim)$mapr("EUR",r) = +inf ;
   iTransferFlag("EUR") = yes ;

\end{lstlisting}

\subsection{Border tax adjustment}

The following describes how border tax
adjustments are implemented in \textsc{Envisage}.

\subsubsection{Data and methodology}

To provide an accounting of \COT{} emissions embodied in bilateral trade, we follow an approach outlined in
\cite{PetersJEcolEcon2008} and applied to the GTAP-based \textsc{Envisage} Model.\footnote{This section benefited from significant inputs
from Maksym Chepeliev, including the development of the original code.}
Country-specific \COT{} emissions per unit of output by sector are used to estimate emissions associated with bilateral trade
flows. This method assumes that in a given sector and country, the same production technology is used to produce domestic and
exported commodities. This allows to decompose emissions from domestic output into components associated with the domestic demand and exports. \COT{} emissions associated with fossil-fuel combustion and embodied in trade flows from region $s$ to region $d$ ($\mathit{Emi}^m$) for each commodity $i$ are estimated as:

\[
\mathit{Emi}^m_{i,sd} = {\rho^I_{i,s}} {E_{i,sd}}
\]

\noindent where $\rho^I$ is a vector of region-specific \COT{} (direct and indirect) emissions per unit of output across sectors
and $E$ represents the level of bilateral trade between $s$ and $d$ for commodity $i$. The total emission
rate $\rho^I$ is calculated from ${\left(\rho^D_{s}\right)'}{\left[I-A_s\right]^{-1}}$, where $\rho^D$ is
the rate of direct emissions to produce commodity $i$ in region $s$, $I$ is the identity matrix and $A$ is the technological matrix, which represents the industry requirements of domestically produced products in region $s$.
Value flows are estimated using producer prices. The parameter $\rho^I$ is an estimate of the emission rate encompassing the entire domestic value chain.
For instance, \COT{} emitted by a coal power plant to produce electricity,
which was further used to produce iron and steel, would be embodied into the exports of iron and steel.

These parameters are related to model variables in the following way. The rate of direct emissions (per unit of
output) is based on:

\[
\rho^D_{r,j} = 1000 \times \frac{\sum_i \mathit{Emi}_{r,\mathit{em},i,\mathit{j}}} {\mathit{XS}_j}
\]

\noindent Note that these formulas are based on a diagonal make matrix where activity $a$ maps directly to output $j$.
For the power version of the model, all electric activities are collapsed into a single activity for the
purposes of these calculations (i.e. emissions are added across all power activities). Also note
that $\mathit{XS}$ includes the value of production taxes. The scale factor 1000 converts the
rate of direct emissions from metric ton per unit of output, to kg per unit of output.\footnote{The
calculations in the code adjust for any differences in input scale so that emissions revert back
to million tons and output to million dollars.}

The matrix of (domestic input use) technical coefficients ($A$) is calculated as:

\[
A_{r,i,j} = \frac{\mathit{PDT}_{r,i,0} \mathit{XD}_{r,i,\mathit{j}} }{\mathit{XS}_j}
\]

\noindent where again the coded formulas take into account non-diagonality and scaling issues.

There are three so-called scope levels for emissions.
Scope~1 refers to the direct emissions for each
region and sector $j$, i.e. $\rho^1 = \rho^D$, measured
in kg per unit of output.\footnote{The embodied emission factors
($\rho^{\mathit{es}}$) are represented by the
parameter \texttt{EMIXSC} defined over
regions ($r$), commodity ($i$), scope ($\mathit{es}$) and
time ($t$).}
Scope~3 emissions refer to both the direct and
indirect emissions, i.e. $\rho^3 = \rho^I_s = \left(\rho^D_s\right)'\left[I-A\right]^{-1}$.
Scope~2 emissions are an intermediate level of
emissions that include the direct emissions and
indirect emissions linked to the use of electricity.
Hence we have:

\[
\rho^2_{r,i} = \rho^1_{r,i}
+ \rho^{\mathit{ely}}_{r} \frac{\mathit{XA}_{r,\mathit{ely},i}}{\mathit{XS}_{r,i}}
\]

\noindent where the second term measures the use of
electricity per unit of output multiplied by the
average level of emissions per unit of domestic electricity
produced:

\[
\rho^{\mathit{ely}}_{r}
= 1000 \times \frac{\sum_j{\sum_{a \in {\mathit{elya}}}{\mathit{EMI}_{r,\mathit{CO2},j,a}}}}
{\mathit{XS}_{\mathit{r,ely}}}
\]

%EMIX(r,i,t,"Scope2")$output(r,i,t) = EMIX(r,i,t,"Scope1")
%         + 1000*sum((j,elyc),sum(a$mapac(a,elyc),emireg(r,j,a,t)))
%         /(sum(js,sum(elyc,nrgbal(r,elyc,js,t)))-sum((s,elyc),nrgbal(r,s,elyc,t)))
%         * sum(elyc,sum(a$mapac(a,i),nrgbal(r,elyc,a,t)))/ output(r,i,t);

%EMITRD(s,i,d,t,es)$sum(r,xw0(s,i,r)*pe0(r,i,r)*xw(s,i,r,t))
%            = (1/1000)*EMIX(s,i,t,es)
%            *  (xw0(s,i,d)*pe0(s,i,d)*xw(s,i,d,t)
%            +   %xtt0(s,i)*xtt(s,i,t)*xw0(s,i,d)*pe0(s,i,d)*xw(s,i,d,t)
%            /     sum(r,xw0(s,i,r)*pe0(r,i,r)*xw(s,i,r,t)))/inscale ;


The program also calculates a parameter that represents the level of emissions embedded in bilateral
trade, named '\texttt{EMITRD}', with levels in million metric tons.
It is not currently used in the model.

\[
\mathit{EMITRD}_{s,i,d,\mathit{es}} =
\frac{\rho^{\mathit{es}}_{s,i}}{1000}
\left[
\mathit{XW}_{s,i,d} + \mathit{XTT}_{s,i}
\frac{\mathit{XW}_{s,i,d}}
{\displaystyle \sum_{r'} \mathit{XW}_{s,i,r'}}
\right]
\]

\subsubsection{Calculating the carbon embedded in trade}

[01-SEP-2025] The calculations for the embodied
emissions are calculated after each time period
in a post-simulation routine contained in the file
\texttt{EmiIntOutput.gms}, which is included in
\texttt{runsim.gms}.\footnote{Earlier
versions calculated the embodied emissions
using a separate program and only intended
to calculate the indicators for the baseline
scenario.} The matrix inverse is calculated
using a solver (the default is CNS), using
a single equation (\texttt{A\_Inveq}), which
is defined towards the bottom of \texttt{model.gms}.
When implementing a border tax adjustment, users
are free to use a linear combination
of the baseline indicator and the lagged value
from the current simulation. This allows
for capturing structural changes in the exporting
country if the latter is implementing mitigation
policies.

\subsubsection{Border tax adjustment based on exporter's carbon content}

The border tax adjustment is implemented as
an excise tax on imports ($\tau^\mathit{mx}$).
Thus equations~(\ref{eq:pdm}) and equations~(\ref{eq:pdma})  become respectively:

\begin{equation}
\label{eq:pdmx}
\mathit{PDM}_{s,i,d} = \left( 1 + \tau^m_{s,i,d}  + \tau^{\mathit{ntm}}_{s,i,d} \right) \mathit{PWM}_{s,i,d}
+ \tau^\mathit{mx}_{s,i,d}
\end{equation}

\begin{equation}
\label{eq:pdmax}
\mathit{PDM}^a_{s,i,d,\mathit{aa}} =
   \left( 1 + \tau^\mathit{ma}_{s,i,d,\mathit{aa}} \right) \mathit{PWM}_{s,i,d} + \tau^\mathit{mx}_{s,i,d}
\end{equation}

\noindent where the former is used for the standard Armington model and the latter
for the MRIO version of bilateral trade. The BTA tax, i.e. the excise
tax is composed of two components---the
level of \COT{} emissions\footnote{Converted back to tons.} per dollar imported $\rho^\mathit{I}$ and
the imposed carbon tax, $\tau^{\mathit{EmiX}}$.\footnote{The current implementation only holds for \COT{}
taxes.} The first term represents
a linear combination of the embodied emissions
from the baseline and the (lagged) embodied
emissions from the current simulation.
If the parameter $\varphi^{\mathit{BTAlag}}$
is set to 1, only the current (lagged) indicator
will be used, if it is set to 0, only
the baseline indicator will be used. The
flag is designed to be coalition specific.
The choice of scope ($\mathit{es}$) and
which imports to tax ($i$) are
also coalition specific and user-designated
governed by the set mapping \texttt{mapScope}.

\begin{equation}
\label{eq:taumx}
\tau^\mathit{mx}_{s,i,d,t} =
\left[(1-\varphi^{\mathit{BTAlag}}_{\mathit{R}}) \rho^{\mathit{es},\mathit{BaU}}_{s,i,t}
+ \varphi^{\mathit{BTAlag}}_{\mathit{R}}
\rho^{\mathit{es}}_{s,i,t-1}
\right]
\tau^{\mathit{EmiX}}_{\mathit{rq},s,i,d,t}
\qquad \textnormal{for } d \in \{\mathit{R}\},
(i,\mathit{es}) \in \{\texttt{mapScope}(R,i,\mathit{es})\}
\end{equation}

Finally, we need an equation that links
$\tau^{\mathit{EmiX}}$ to the actual
carbon tax, potentially
adjusted for the level of effort
by the exporter---thus we have:

\begin{equation}
\label{eq:tauEmix}
\tau^{\mathit{EmiX}}_{\mathit{R},s,i,d,t} =
\chi^{\mathit{BTA},\mathit{imp}}_{\mathit{R},s,i,d}
\frac{\displaystyle \sum_{a \in \{i\}}{\tau^{\mathit{Emi}}_{d,\mathit{CO2},a}}}
{\displaystyle\sum_{a \in \{i\}}{1}}
- \chi^{\mathit{BTA},\mathit{exp}}_{\mathit{R},s,i,d}
\frac{\displaystyle\sum_{a \in \{i\}}{\tau^{\mathit{Emi}}_{s,\mathit{CO2},a}}}
{\displaystyle\sum_{a \in \{i\}}{1}}
% \tau^{\mathit{Emi}}_{R,\mathit{co2},\mathit{all}}
\end{equation}

\noindent which holds for all exporters
to the coalition region $R$.\footnote{This
equation is governed by the flag \texttt{ifBTA(ra,s,i,d)}.
Thus it is set to 1 for all regions $s$ exporting
to region $d$ that are part of coalition $\mathit{ra}$.} The user is allowed to
determine the \emph{gauge} ($\chi^{\mathit{BTA},\mathit{imp}}$) for the power
of the carbon price of the importer ($d$ in
coalition $R$) as well as the
gauge for the power of the carbon
price implemented in the exporting
region ($s$). The formula takes into
account the mapping of the tax from
activities ($a$) to commodities ($i$).

An example is provided in the following listing.

\begin{lstlisting}[language=GAMS,
	caption={Border tax adjustment based on the
	carbon content of the exporter}, label=lst:BTA2]

*  Introduce CBAM

if(tsim.val ge 2021,
*  BTA on non-WEU imports into WEU, excluding refined oil
   ifBTA("WEU",s,i,d)$(mapra("WEU",d) and not sameas(s,"WEU") and not sameas(i,"P_C-c")) = yes ;

*  Tax only ETS sectors
   BTAGauge("WEU",s,i,d,"imp",tsim) = 0 ;
   BTAGauge("WEU",s,i,d,"imp",tsim)$sum(a$(mapets("WEU","ETS",a) and mapmak(a,i)),1) = 1 ;
*  Do not take into account emission price of exporters
   BTAGauge("WEU",s,i,d,"exp",tsim) = 0 ;
   emiTaxX.lo("WEU",s,i,d,tsim)$ifBTA("WEU",s,i,d) = 0 ;
   emiTaxX.up("WEU",s,i,d,tsim)$ifBTA("WEU",s,i,d) = +INF ;
) ;

\end{lstlisting}

\chapter{Model dynamics}
\renewcommand{\theequation}{{G-}\arabic{equation}}
\setcounter{equation}{0}

The model as defined above represents the fully static version.\footnote{In the
model implementation, all of the equations listed till now are part of the
\texttt{core} model---save for those that are substituted out.} The factor
stocks and technology are largely exogenous. This section describes the
additional equations needed for the standard dynamics.

\section{Labor supply}

Labor is assumed to grow at some 'natural' rate for each skill level and by zone
(in the case of segmented labor markets). At the moment, the natural rate of
growth is equated to some measure of the growth in the relevant population and
is assumed to be uniform for all skills and zones. The relevant population
growth is defined by the following expression:

\[
\mathit{TLAB_{r,t}} =
   \frac {\displaystyle \sum_{p}{\phi^l_{r,p,t} \mathit{Pop^t_{r,p,t}} } }
   {\displaystyle \sum_{p}{\phi^l_{r,p,t-n} \mathit{Pop^t_{r,p,t-n}} } }
   \mathit{TLAB_{r,t-n}}
\]

\noindent where $\phi^l$ is the relevant labor force participation rate.
Population growth by cohort is assumed to be exogenous and is typically taken
from a population scenario such as the UN or from those developed by the IAMC
community known as the shared socio-economic pathways, or SSPs.

In the case of labor market segmentation with rural to urban migration, the
level of migration is defined by equation~(\ref{eq:migr}). This simple migration
equation is similar in spirit to the so-called Harris-Todaro model of
migration.\footnote{See \cite{HarrisTodaro1970}.} Migration is a function of the
expected urban wage relative to the expected rural wage, where $\omega^m$
represents the migration elasticity.\footnote{There are more complex
specifications of the migration function. See for example \cite{Burniaux1987}
and \cite{BDvdM1991}.} Labor supply in each zone is equal to some exogenous
component based on the 'natural' growth rate adjusted by migration,
equation~(\ref{eq:ls}). The growth rate $g^{\mathit{lz}}$ is typically exogenous
and for the moment uniform across skills and zones. The parameter $\delta^m$ is
equal to -1 in the case of the rural zone and is equal to 1 for the urban zone.
The parameter $\mu^m$ is a multiplier for migration that accounts for migration
occurring between periods in a multi-year time step. The level of the multiplier
is given in equation~(\ref{eq:migrMult}). It is equal to 1 for single-year time
steps. It is approximately equal to $n$ for time steps of $n$ years.
Equation~(\ref{eq:glab}) calculates implicitly the growth rate of labor by skill
at the economy-wide level.

\begin{equation}
\label{eq:migr}
\mathit{MIGR}_{r,l} =
   \chi^m_{r,l} \left( \pi^{\mathit{Urb}}_{r,l} \right)^{\omega^m_{r,l}}
\end{equation}

\begin{equation}
\label{eq:ls}
\mathit{L^s_{r,l,z,t}} =
   \left( 1 + g^{\mathit{lz}}_{r,l,z,t} \right)^n \mathit{L}^s_{r,l,z,t-n}
   + \delta^m \mu^m_{r,l,z,t}\mathit{MIGR}_{r,l,t}
\end{equation}

\begin{equation}
\label{eq:migrMult}
\mu^m_{r,l,z,t} =
   \frac { \left( 1 + g^{\mathit{lz}}_{r,l,z,t} \right)^n
      \left( \frac{\pi^{\mathit{Urb}}_{r,l,t-n}}{\pi^{\mathit{Urb}}_{r,l,t}}
      \right)^{\omega^m_{r,l}} - 1
   }
   { \left( 1 + g^{\mathit{lz}}_{r,l,z,t} \right)
     \left( \frac{\pi^{\mathit{Urb}}_{r,l,t-n}}{\pi^{\mathit{Urb}}_{r,l,t}}
     \right)^{\omega^m_{r,l}/n} - 1
   }
\end{equation}

\begin{equation}
\label{eq:glab}
\mathit{LAB}^s_{r,l,t} =
   \left( 1 + g^l_{r,l,t} \right)^n \mathit{LAB}^s_{r,l,t-n}
\end{equation}

\section{Capital supply}

The total capital stock, $K^s$ evolves according to the standard capital accumulation
formula, equation~(\ref{eq:kstock1}).
Since both terms on the right-hand side are lagged, with a single year time step
the supply of capital is in effect exogenous.
Annex~{\ref{sec:kstock}} explains how the
equation is implemented for multi-year time
steps. In this case, the equation depends
on the contemporaneous level of investment and
the capital stock is therefore no longer
pre-determined.

\begin{equation}
\label{eq:kstock1}
K^s_{r,t} = \left(1- \delta_t \right) K^s_{r,t-1} + \mathit{XFD}_{r,\mathit{Inv},t-1}
\end{equation}

Equation~(\ref{eq:tks}) defines the
normalized capital stock. It is a fixed scalar of the non-normalized level where
the scaling factor is initialized using base year data,
i.e. $\chi^k_r = \mathit{TK^s}_{r,0}/K^s_{r,0}$.
The normalized capital stock is equal to aggregate
capital remuneration in the base year, i.e. it
is the level of the capital stock with the
price of aggregate capital set to 1.

\begin{equation}
\label{eq:tks}
\mathit{TK^s_{r,t}} = \chi^k_r \mathit{K^s_{r,t}}
\end{equation}

\section{Climate module}
\label{sec:climModule}

[31-Oct-2020: This module is being
tested and undergoing further development.
For the moment, this module is ignoring
all emissions other than carbon.]
The climate module is composed of three components:

\begin{enumerate}
\item Emissions are released in the atmosphere. These
emissions lead to changes in their concentration in
the atmosphere (and potentially other earth systems
such as soils, oceans, etc.). Carbon emissions are
treated differently from the other emissions as the
carbon cycle involves a complex set of relations across
different earth systems.
\item Atmospheric concentration of gases leads to
variegated impacts on radiative forcing.
\item In turn radiative forcing affects temperature
and this is captured by an energy balance model (EBM)
that reflects the energy fluxes between different earth
systems.
\end{enumerate}

\input{ClimateModule.tex}

\section{Climate-induced economic impacts}

[30-Apr-2023: NEW] The climate impacts module
incorporates a number of channels for the impacts---mostly
negative but potentially positive---of rising temperatures on economic potential.
The current channels include:

\begin{itemize}
\item {Total factor productivity in each activity}
\item {Labor productivity by skill and activity}
\item {Health-related impacts to labor productivity}
\item {Household energy demand}
\item {Land supply}
\item {Tourism revenues}
\item {Capital stock}
\end{itemize}

\noindent Each is specified using a generic quadratic function:

\[
I_{r,\mathit{agt}} = \left[1 + \chi^d_{r,\mathit{agt}}
\left(\beta^0_{r,\mathit{agt}} +  \beta^1_{r,\mathit{agt}} \left(T_{r,t} - T_{r,0}\right)
+  \beta^2_{r,\mathit{agt}} \left(T_{r,t} - T_{r,0}\right)^2  \right)
\right]
\]

\noindent where $\mathit{agt}$ refers to a specific agent with
potentially an additional qualifier, for example labor in a
particular activity. The shifter $\chi^d$ is an
adjustment factor that relies on expenditures on
adaptation that can dampen the effects of temperature
change and is described further below. The equation
allows for the temperature change, $T$, to be
region specific, though it will often be equated to
the change in global mean surface temperature.
The intercept term is normally calibrated to 0 so
that the indicator takes the value of 1 in the reference year.
The indicator, $I$, is then applied as
an adjustment factor in the main model, for example labor
productivity. The specific channels and their indicators are
provided in equations~(\ref{eq:dam_tfp})--(\ref{eq:dam_cap}).
These equations cover respectively, impacts to total factor
productivity (\texttt{tfp}) by activity,
labor productivity by activity and labor-type (\texttt{lab}),
health-related labor productivity also by activity
and labor-type (\texttt{hht}), household energy demand (\texttt{nrg}),
land supply by type of land (\texttt{lnd}),
(export) tourism revenues (\texttt{tou}), and
the aggregate capital stock (\texttt{cap}).

\begin{equation}
\label{eq:dam_tfp}
\mathit{IDAM}^{\mathit{tfp}}_{r,a} =
\left[1 + \chi^{d,\mathit{tfp}}_{r,\mathit{a}}
\left(
\beta^{d,\mathit{tfp},0}_{r,\mathit{a}} +  \beta^{d,\mathit{tfp},1}_{r,\mathit{a}}
\left(T_{r,t} - T_{r,0}\right) +
\beta^{d,\mathit{tfp},2}_{r,\mathit{a}}
\left(T_{r,t} - T_{r,0}\right)^2
\right)
\right]
\end{equation}

\begin{equation}
\label{eq:dam_lab}
\mathit{IDAM}^{\mathit{lab}}_{r,l,a} =
\left[1 + \chi^{d,\mathit{lab}}_{r,l,\mathit{a}}
\left(
\beta^{d,\mathit{lab},0}_{r,l,\mathit{a}} +  \beta^{d,\mathit{lab},1}_{r,l,\mathit{a}}
\left(T_{r,t} - T_{r,0}\right) +
\beta^{d,\mathit{lab},2}_{r,l,\mathit{a}}
\left(T_{r,t} - T_{r,0}\right)^2
\right)
\right]
\end{equation}

\begin{equation}
\label{eq:dam_hht}
\mathit{IDAM}^{\mathit{hht}}_{r,l,a} =
\left[1 + \chi^{d,\mathit{hht}}_{r,l,\mathit{a}}
\left(
\beta^{d,\mathit{hht},0}_{r,l,\mathit{a}} +  \beta^{d,\mathit{hht},1}_{r,l,\mathit{a}}
\left(T_{r,t} - T_{r,0}\right) +
\beta^{d,\mathit{hht},2}_{r,l,\mathit{a}}
\left(T_{r,t} - T_{r,0}\right)^2
\right)
\right]
\end{equation}

\begin{equation}
\label{eq:dam_nrg}
\mathit{IDAM}^{\mathit{nrg}}_{r,k,h} =
\left[1 + \chi^{d,\mathit{nrg}}_{r,k,h}
\left(
\beta^{d,\mathit{nrg},0}_{r,k,h} +  \beta^{d,\mathit{nrg},1}_{r,k,h}
\left(T_{r,t} - T_{r,0}\right) +
\beta^{d,\mathit{nrg},2}_{r,k,h}
\left(T_{r,t} - T_{r,0}\right)^2
\right)
\right]
\end{equation}

\begin{equation}
\label{eq:dam_lnd}
\mathit{IDAM}^{\mathit{lnd}}_{r,\mathit{lnd}} =
\left[1 + \chi^{d,\mathit{lnd}}_{r,\mathit{lnd}}
\left(
\beta^{d,\mathit{lnd},0}_{r,\mathit{lnd}} +  \beta^{d,\mathit{lnd},1}_{r,\mathit{lnd}}
\left(T_{r,t} - T_{r,0}\right) +
\beta^{d,\mathit{lnd},2}_{r,\mathit{lnd}}
\left(T_{r,t} - T_{r,0}\right)^2
\right)
\right]
\end{equation}

\begin{equation}
\label{eq:dam_tou}
\mathit{IDAM}^{\mathit{tou}}_{r,i} =
\left[1 + \chi^{d,\mathit{tou}}_{ri}
\left(
\beta^{d,\mathit{tou},0}_{r,i} +  \beta^{d,\mathit{tou},1}_{r,i}
\left(T_{r,t} - T_{r,0}\right) +
\beta^{d,\mathit{tou},2}_{r,i}
\left(T_{r,t} - T_{r,0}\right)^2
\right)
\right]
\end{equation}

\begin{equation}
\label{eq:dam_cap}
\mathit{IDAM}^{\mathit{cap}}_{r} =
\left[1 + \chi^{d,\mathit{cap}}_{r}
\left(
\beta^{d,\mathit{cap},0}_{r} +  \beta^{d,\mathit{cap},1}_{r}
\left(T_{r,t} - T_{r,0}\right) +
\beta^{d,\mathit{cap},2}_{r}
\left(T_{r,t} - T_{r,0}\right)^2
\right)
\right]
\end{equation}

\section{Adaptation expenditures}

The shifters in the impact functions can be adjusted through
expenditures on adaptation measures. Each channel is associated
with its own adaptation expenditure with its own cost structure. However,
the impact adjustment factor is impacted by aggregate adaptation
expenditure, i.e., the expenditures are not
'agent' specific, accept to the extent the shifter
on the adjustment equation is 'agent' specific. The generic adaptation
shifter function has the following form:

\[
\chi^{d,\mathit{tgt}}_{r,a}
= \chi^{a,\mathit{tgt}}_{r,\mathit{agt}} \left(
\mathit{XFD}_{r,\mathit{tgt}}
\right)^{-\rho^{a,\mathit{tgt}}_{r}}
\]

\noindent where $\chi^{a,\mathit{tgt}}$ is the 'agent'-specific
shifter for the targeted impact channel ('tgt') and
$\mathit{XFD}$ is the aggregate amount of adaptation expenditures
for the targeted channel. The cost structure for the adaptation
expenditures must be specified---similarly to the cost
structure of government and investment expenditures, i.e.,
with top-level budget shares and second-level sourcing
shares and respective substitution elasticities. The
standard model takes care of implementing the demand for
goods and services once the cost structure is known and
the level of aggregate expenditure is specified.\footnote{In the
current version of the damages/adaptation module there
are seven additional final demand agents designated
by \texttt{adptfp}, \texttt{adplab}, \texttt{adphht}, \texttt{adpnrg},
\texttt{adplnd}, \texttt{adptou} and \texttt{adpcap}, representing
respectively adaptation expenditures on
adjusting total factor productivity, labor productivity,
health-related labor productivity, energy demand,
land supply, tourism revenues and capital supply.}
The full set of adaptation adjustment factors is
given by equations equations~(\ref{eq:dam_shft_tfp})--(\ref{eq:dam_shft_cap}).

\begin{equation}
\label{eq:dam_shft_tfp}
\chi^{d,\mathit{tfp}}_{r,a}
= \chi^{a,\mathit{tfp}}_{r,a} \left(
\mathit{XFD}_{r,\mathit{tfp}}
\right)^{-\rho^{a,\mathit{tfp}}_{r}}
\end{equation}

\begin{equation}
\label{eq:dam_shft_lab}
\chi^{d,\mathit{lab}}_{r,l,a}
= \chi^{a,\mathit{lab}}_{r,l,a} \left(
\mathit{XFD}_{r,\mathit{lab}}
\right)^{-\rho^{a,\mathit{lab}}_{r}}
\end{equation}

\begin{equation}
\label{eq:dam_shft_hht}
\chi^{d,\mathit{hht}}_{r,l,a}
= \chi^{a,\mathit{hht}}_{r,l,a} \left(
\mathit{XFD}_{r,\mathit{hht}}
\right)^{-\rho^{a,\mathit{hht}}_{r}}
\end{equation}

\begin{equation}
\label{eq:dam_shft_nrg}
\chi^{d,\mathit{nrg}}_{r,k,h}
= \chi^{a,\mathit{nrg}}_{r,k,h} \left(
\mathit{XFD}_{r,\mathit{nrg}}
\right)^{-\rho^{a,\mathit{nrg}}_{r}}
\end{equation}

\begin{equation}
\label{eq:dam_shft_lnd}
\chi^{d,\mathit{lnd}}_{r,\mathit{lnd}}
= \chi^{a,\mathit{lnd}}_{r,\mathit{lnd}} \left(
\mathit{XFD}_{r,\mathit{lnd}}
\right)^{-\rho^{a,\mathit{lnd}}_{r}}
\end{equation}

\begin{equation}
\label{eq:dam_shft_tou}
\chi^{d,\mathit{tou}}_{r,i}
= \chi^{a,\mathit{tou}}_{r,i} \left(
\mathit{XFD}_{r,\mathit{tou}}
\right)^{-\rho^{a,\mathit{tou}}_{r}}
\end{equation}

\begin{equation}
\label{eq:dam_shft_cap}
\chi^{d,\mathit{cap}}_{r}
= \chi^{a,\mathit{cap}}_{r} \left(
\mathit{XFD}_{r,\mathit{cap}}
\right)^{-\rho^{a,\mathit{cap}}_{r}}
\end{equation}

The source of funding for the adaptation expenditures
is from one of three sources: households, government and
investment. The user specifies the sourcing shares for
each of the adaptation expenditure categories.
Equation~(\ref{eq:yfdexadp}) describes the allocation mechanism.
$\mathit{YFD}_{r,\mathit{adp}}$ represents the nominal
value of the aggregate expenditure spent on adaptation
measure $\mathit{adp}$.\footnote{With
$\mathit{XFD}$ exogenous, the revenue will be measured
by equation~(\ref{eq:yfd}).} The coefficient
$\chi^{\mathit{adp}}_{r,\mathit{fd},\mathit{adp}}$ represents the allocation shares. For each
expenditure category $\mathit{adp}$, the shares must sum to 1
over the $\mathit{fd}$ agents.\footnote{We may want to generalize
the allocation mechanism to allow activities to
spend resources on adaptation.}

\begin{equation}
\label{eq:yfdexadp}
\mathit{YFD}^{\mathit{adp}}_{r,\mathit{fd}}
= \sum_{\mathit{adp}}{\chi^{\mathit{adp}}_{r,\mathit{fd},\mathit{adp}}
\mathit{YFD}_{r,\mathit{adp}}}
\end{equation}

\noindent The expenditures are subtracted from the relevant
accounting identities for the agents. In the case of households
the expenditures will be subtracted from disposable income,
equation~(\ref{eq:yc}). In the case of the government,
the expenditures will be subtracted from the government
fiscal balance expresion, equation~(\ref{eq:savg}). In the
case of investment, the expenditures will be subtracted from
the investment/savings balance, equation~(\ref{eq:yfdinv}).


\section{Resource depletion}

[17-MAR-2020---still needs editing.] This section describes the potential supply of resources
for the coal, oil and gas extraction sectors. Oil and
gas are treated alike with two sets of reserves, proven
and unproven (or yet-to-discover). In the case of coal, the
model assumes that all reserves are proven.
The model is based on two key parameters: the rate of extraction from proven reserves, $\rho^x$,
and the rate of discovery of new reserves, $\xi$, also called the conversion rate. Potential supply in any given time period is a fraction of proven reserves:

\[
\mathit{XF}^{\mathit{Pot}}_t = \rho^x_t \mathit{Res}_t
\]

Reserves at the beginning of a period are equal to the previous period's
reserves, less actual extraction, plus new discoveries:

\[
\mathit{Res}_t = \mathit{Res}_{t-1} - \mathit{XF}_{t-1} + \xi_{t-1} \mathit{YTD}_{t-1}
\]

\noindent where $\mathit{YTD}$ represents the level of the yet-to-discover reserves and $\xi$ is the
conversion rate. If $\rho^x$ and $\xi$ are invariant over time, one can trace out
the time profiles for proven and yet-to-discover reserves under the assumption that
producers are on their reserve profile. Figure~\ref{fig:deplProf}
provides two potential profiles. In the left panel, production (measured as a given share of proven reserves, $R$) is in decline as production out of
proven reserves exceeds new discoveries. The right panel
shows a strong increase in production, followed by a peak
and decline.

\begin{figure}[ht]
	\centering
	\subfloat[][\scriptsize{$\rho$=6.25\%, $\xi$=6\%, $R_0$=1446, $\mathit{YTD}_0$=2087}]{
		\begin{tikzpicture}[scale=0.8]
		\begin{axis}[axis x line=bottom, axis y line=left,
		xtick={0,5,...,40}, ytick={0,500,...,2500}, xmax=42, ymin=0, ymax=2600, ylabel=$\mathit{Reserves}$,
		y tick label style={/pgf/number format/.cd,fixed,fixed zerofill,precision=0,/tikz/.cd}]
		\addplot[Orchid,very thick,mark=none,domain=0:37,samples=200]
		{1446*(1-0.0625)^(\x) + 0.0263*2087*(((1-0.0625)^(\x)-(1-0.0263)^(\x))/(0.0263-0.0625))} node[above] {$R$};
		\addplot[DodgerBlue2,very thick,mark=none,domain=0:37,samples=200]
		{2087*(1-0.0263)^(\x)} node[above] {$\mathit{YTD}$};
		\end{axis}
		\end{tikzpicture}
	} \qquad
	\subfloat[][\scriptsize{$\rho$=6\%, $\xi$=8.61\%, $R_0$=1172, $\mathit{YTD}_0$=4184}]{
		\begin{tikzpicture}[scale=0.8]
		\begin{axis}[axis x line=bottom, axis y line=left,
		xtick={0,5,...,40}, ytick={0,500,...,4500}, xmax=42, ymin=0, ymax=4600, ylabel=$\mathit{Reserves}$,
		y tick label style={/pgf/number format/.cd,fixed,fixed zerofill,precision=0,/tikz/.cd}]
		\addplot[Orchid,very thick,mark=none,domain=0:37,samples=200]
		{1172*(1-0.06)^(\x) + 0.0861*4184*(((1-0.06)^(\x)-(1-0.0861)^(\x))/(0.0861-0.06))} node[above] {$R$};
		\addplot[DodgerBlue2,very thick,mark=none,domain=0:37,samples=200]
		{4184*(1-0.0861)^(\x)} node[above] {$\mathit{YTD}$};
		\end{axis}
		\end{tikzpicture}
	} \\
	\caption{Resource profiles}
	\label{fig:deplProf}
\end{figure}

Following the assumptions from the GREEN model\footnote{\cite{Burniauxetal1992} and \cite{GREENDvdM1994}.}
\textsc{Envisage} assumes that the rate of extraction for oil and gas is
exogenous, i.e. invariant to market conditions, but that
the discovery rate is affected by market conditions.
The discovery rate will be a function of the deviation of
the market price from a given pre-determined price trend,
where the market price is the output price for individual supplies. The elasticity is allowed to differ depending on
market conditions. This kink in the discovery rate elasticity
is implemented using the sigmoid function. In addition,
we allow suppliers to be off their potential supply
curve, i.e. they can supply less than their maximum given
the exogenous extraction rate.

The key price relation that determines the elasticity
of discovery is given by equation~(\ref{eq:pRatio}).
The exogenous trend, $\mathit{PTrend}$, is indexed at 1 in the
reference year. If output prices track the trend
exactly, the $\mathit{PRatio}$ variable will always have the value of 1.
If production prices exceed the exogenous trend, the
price ratio will be above 1, i.e. market conditions
are buoyant, and vice versa if the ratio falls below 1.
Equation~(\ref{eq:omegar}) defines the elasticity according
to the price regime. As the variable $\mathit{PRatio}$ rises,
the denominator tends towards 1 and at the limit, the
active elasticity is the high elasticity. The limit of
the denominator as prices decline is $1+e^\kappa$, which for
suitably large $\kappa$ implies that the ratio  is zero and the
active elasticity is the low elasticity.

The conversion rate, $\xi$, responds to the price signal, $\mathit{PRatio}$,
where the elasticity can differ depending on market conditions. The
curve is anchored to the reference conversion rate, $\xi^{\mathit{Ref}}$.
The shifter, $\chi^d_{r,a,t}$, can be used to calibrate the
conversion rate, to an exogenous price scenario for example.
Note that the conversion rate is bounded on both ends with user
supplied lower and upper bounds. Figure~\ref{fig:convRate}
provides an illustration of the elasticity and conversion rate
curves. Note that the elasticity curve is almost virtually kinked
at the price reference point, i.e. where $\mathit{PRatio}$ is equal to 1.
On either side, the elasticity quickly moves to either the 'low' elasticity (0.3
in the figure), or the 'high' elasticity (1.2 in the figure).
The conversion rate curve has three inflection points. With very low prices the
conversion rate is bound below at 4\% and at very high prices it is bound
above at 10\%. The third inflection point is where $\mathit{PRatio}$
equals 1. The figure clearly shows the difference in the elasticity around
this inflection point, with a steeper curve when prices are increasing.

\begin{equation}
\label{eq:pRatio}
\mathit{PRatio}_{r,a,t} = \left[ \frac{\mathit{PX}_{r,a,t}/\mathit{PGDP}_{r,t}} {\mathit{PX}_{r,a,t-1}/\mathit{PGDP}_{r,t-1}} \right] \bigg / \mathit{PTrend}_{r,a,t}
\end{equation}

\begin{equation}
\label{eq:omegar}
\omega^r_{r,a,t} = \omega^{\mathit{rLo}}_{r,a,t}
+ \left(\omega^{\mathit{rHi}}_{r,a,t} - \omega^{\mathit{rLo}}_{r,a,t}\right)
/ \left[1 + \exp\left(-\kappa(\mathit{PRatio}_{r,a,t}-1) \right)\right]
\end{equation}

\begin{equation}
\label{eq:convRate}
\xi_{r,a,t} = \chi^d_{r,a,t} \xi^{\mathit{Ref}}_{r,a} \left( \mathit{PRatio}_{r,a,t} \right) ^{\omega^r_t }
\end{equation}


\begin{figure}[ht]
	\centering
	\begin{tikzpicture}

%  \pgfplotsset{
%      scale only axis,
%  }

  \begin{axis}[
    axis y line*=left,
    xlabel=$\mathit{PRatio}$,
    ylabel=$\omega^r$,
    xtick={0,0.5,...,2.0},
    yticklabel style = {font=\scriptsize},
    xticklabel style = {font=\scriptsize},
    x tick label style={/pgf/number format/.cd,fixed,fixed zerofill,precision=1,/tikz/.cd},
    ytick={0.0,0.1,...,1.3}, xmax=2.1, ymin=0, ymax=1.35,
    y tick label style={/pgf/number format/.cd,fixed,fixed zerofill,precision=1,/tikz/.cd}]
  ]
	\addplot[Orchid,very thick,mark=none,domain=0.1:2.0,samples=200]
	{0.3 + (1.2 - 0.3)/(1 + exp(-30*((\x)-1)))} node[above] {$\omega^r$};
		\addplot[lightgray,mark=none]
		coordinates{(1,0.0) (1,1.3)} ;

    \end{axis}

    \begin{axis}[
      axis y line*=right,
      axis x line=none,
      ylabel={Conversion rate, \%},
      yticklabel style = {font=\scriptsize},
      ytick={0,1,...,13}, ymin=0, ymax=13.5,
          y tick label style={/pgf/number format/.cd,fixed,fixed zerofill,precision=0,/tikz/.cd}],
    ]

 	\addplot[DodgerBlue2,very thick,mark=none,domain=0.1:2.0,samples=200]
 	{100*min(max(0.04,0.05*(\x)^(0.3 + (1.2 - 0.3)/(1 + exp(-30*((\x)-1))))),0.1)} node[below, yshift=-0.1cm] {$\xi$};
		\addplot[lightgray,mark=none]
		coordinates{(0,5) (2,5)} ;
  \end{axis}

\end{tikzpicture}
	\caption{Conversion rate curves}
	\label{fig:convRate}
\end{figure}

The extraction rate of coal is assumed to be price
sensitive and uses the same elasticity, $\omega^r$, to drive
the extraction rate. In the case of oil and gas, the
extraction rate is allowed to vary with a constant
elasticity functional form, though generally the
elasticity will be zero. Equation~(\ref{eq:xRate})
defines the extraction rate, $\rho^x$, for coal, oil and gas reserves.
For coal, the elasticity is potentially kinked and thus
there will be an inflection point for the extraction curve.
For oil and gas, the extraction elasticity is given by $\omega^e$.

\begin{equation}
\label{eq:xRate}
\rho^x_{r,a,t} =
\begin{cases}
\chi^x_{r,a,t} \rho^x_{r,a,t-1} \left( \mathit{PRatio}_{r,a,t} \right)^{\omega^r_{r,a,t}} & \textrm{if } a \in \{'Coal'\} \\
\chi^x_{r,a,t} \rho^x_{r,a,t-1} \left( \mathit{PRatio}_{r,a,t} \right)_{r,a,t}^{\omega^e_{r,a,t}} & \textrm{if } a \notin \{'Coal'\}
\end{cases}
\end{equation}

Equation~(\ref{eq:Res}) determines the actual reserve
level. It is equal to the previous period's reserve less
less actual extraction, $\mathit{Extr}$, plus the addition
of converted unproven reserves. Equation~(\ref{eq:ResP})
is the level of reserves that correspond to being on the
reserve profile, i.e. where the actual extraction is
equal to the extraction rate times the level of (lagged) reserves.
If market conditions warrant it, producers may wish to be
off their reserve profile and keep the resource underground. In
this case, actual production may be less than potential production.
Equation~(\ref{eq:resGap}) determines the gap between
actual reserves and reserves along the resource profile,
which is always a positive number.
Potential supply, equation~(\ref{eq:xfPot}) is equal to the normal level of
extraction from the reserve profile, plus what might
be available from the reserve gap, for regions that
are not forced to be on their depletion profile.

\begin{equation}
\label{eq:Res}
\mathit{Res}_{r,a,t} = \mathit{Res}_{r,a,t-1} - \mathit{Extr}_{r,a,t-1} + \xi_{r,a,t-1} \mathit{YTD}_{r,a,t-1}
\end{equation}

\begin{equation}
\label{eq:ResP}
\mathit{Res}^p_{r,a,t} = \left(1 - \rho^x_{r,a,t-1} \right) \mathit{Res}^p_{r,a,t-1} + \xi_{r,a,t-1} \mathit{YTD}_{r,a,t-1}
\end{equation}

\begin{equation}
\label{eq:resGap}
\mathit{ResGap}_{r,a,t} \ge \mathit{Res}_{r,a,t} - \mathit{Res}^p_{r,a,t}
\end{equation}

\begin{equation}
\label{eq:xfPot}
\mathit{XF}^{\mathit{Pot}}_{r,a,t} = \rho^x_t \mathit{Res}^p_{r,a,t} + \mathit{ResGap}_{r,a,t}
\end{equation}

Equation~(\ref{eq:YTD}) is the motion equation for yet-to-discover
reserves---simply previous unproven reserves less those converted
to proven.

\begin{equation}
\label{eq:YTD}
\mathit{YTD}_{r,a,t} = \left( 1 - \xi_{r,a,t-1} \right) \mathit{YTD}_{r,a,t-1}
\end{equation}

\subsection{Linking depletion variables to natural resource supply}

The standard supply equation for natural resources
is modified for coal, oil and gas reserves when
the depletion module is on. Instead of determining
$\mathit{XF}^s$ as in the standard specification, it
determines, $\mathit{XF}^{\mathit{Not}}$, i.e. the notional
supply of the natural resource. So we have two variables,
the notional supply that comes from the standard natural resource
supply curve, and the potential supply, $\mathit{XF}^{\mathit{Pot}}$,
which comes from the depletion module.
Equation~(\ref{eq:xfGap}) determines the gap between notional
and potential supply. The gap variable is bounded below by zero, in
other words if potential supply is greater than notional supply,
the gap variable is set to 0.
If notional supply exceeds potential supply, producers would
like to supply more, but are constrained to the potential supply and
in this case, actual supply is equal to potential supply. On the
other hand, if notional supply is below potential supply, producers
would prefer to sell less than their potential and will
supply the notional amount. The gap between the actual and
potential supply is then kept in the ground. These
conditions are captured in equation~(\ref{eq:xfsdepl}). If
the gap is zero, actual supply is equal to notional supply
and below potential. If the gap is positive, actual supply is
equal to potential supply.
The level of extraction will track the actual supply of natural
resources.

\begin{equation}
\label{eq:xfGap}
\mathit{XF}^{\mathit{Gap}}_{r,a,t} \ge \mathit{XF}^{\mathit{Not}}_{r,a,t} - \mathit{XF}^{\mathit{Pot}}_{r,a,t}
\end{equation}

\begin{equation}
\label{eq:xfsdepl}
\mathit{XF}^{\mathit{s}}_{r,a,t} = \mathit{XF}^{\mathit{Not}}_{r,a,t} - \mathit{XF}^{\mathit{Gap}}_{r,a,t}
\end{equation}

\begin{equation}
\label{eq:extr}
\mathit{Extr}_{r,a,t} = \mathit{Extr}_{r,a,t-1} \left(\frac{\mathit{XF}_{r,\mathit{nrs},a,t}}{\mathit{XF}_{\mathit{nrs},a,t-1}}\right)
\end{equation}

\section{Knowledge module}

[NEW 20-JAN-2019] The model includes a knowledge
module that operates somewhat similarly to investment
and the capital stock. Each year there is aggregate expenditure
on research and development (R\&D), that is captured
by the variable $\mathit{XFD}_{\mathit{r\_d}}$. This
expenditure flow increases knowledge, though knowledge
also depreciates each year. The main difference
with the usual capital/investment dynamic,
is that the impact
of R\&D expenditures happens with a distributed lag.\footnote{This
formulation is inspired by \cite{SmeetsKristkova2016}.}
The latter is governed by a \emph{Gamma} distribution
function, the parameters and length of which
are region specific.\footnote{Additional details
and example distribution functions are provided
in Annex~\ref{sec:knowledge}.}

Equation~(\ref{eq:kn}) describes the motion equation for knowledge.
The variable $\mathit{KN}$ represents
the stock of knowledge. It is equal to the previous
period's knowledge stock---adjusted by depreciation, $\delta^k$---,
plus the distributed lag of current
and previous expenditures on R\&D, where $\gamma^k$
represents the lag coefficients.\footnote{If
$\gamma^k_0=0$ and $\gamma^k_{1}=1$, the equation
would have the same assumption as the standard
capital accumulation equation.}
Annex~\ref{sec:knowledge} describes how the
model implements the knowledge module. Implementation
requires taking into account two features. (1) It is implemented
using the variable time step that is a central
part of the model. Because of the distributed
lags, this also requires that the R\&D expenditures
be evaluated each \emph{year}, independently of
the time step. (2) The first years of the simulation require
a backward projection of the R\&D expenditures,
i.e. prior to the initial year. If $N$ is 50
for example, it requires projecting R\&D
expenditures back some 50 years.

\begin{equation}
\label{eq:kn}
\mathit{KN}_{r,t} = \left(1-\delta^k_r \right) \mathit{KN}_{r,t-1}
+ \sum_{i=0}^N{\gamma^k_{r,i} \mathit{XFD}_{r,\mathit{r\_d},t-i}}
\end{equation}

\noindent where
\[
\gamma^k_{i} = \chi \left(i + 1 \right)^{\delta/(1-\delta)}\lambda^i
\]

In its default mode, the user inputs R\&D expenditures as
a (percent) share of reference year GDP. The default closure
fixes the (real) GDP share of R\&D expenditures at the reference
year level. The model specification assumes that R\&D expenditures
are paid for from government revenues.

The knowledge module is designed to impact on labor
productivity growth. Equation~(\ref{eq:pik}) describes the relation
between the endogenous component of labor productivity
in sector $a$, $\pi^k$, relative to the growth rate of the stock
of knowledge. The elasticity is given by $\epsilon^r$ and
is allowed to be sector specific. The shifter, $\gamma^r$, is initialized
at 1.

\begin{equation}
\label{eq:pik}
\pi^k_{r,a,t} = \gamma^r_{r,a,t} \epsilon^r_{r,a,t}
\left(\frac{\mathit{KN}_{r,t}}{\mathit{KN}_{r,t-1}} - 1\right)
\end{equation}

\section{Technology shifts}

By default, changes in technology are largely exogenous, for example autonomous
energy efficiency improvement (AEEI) and improvements in international trade and
transport services. The one exception is labor productivity.
Equation~(\ref{eq:lambdal}) describes the growth in labor productivity. In the
base year, $\lambda^f$ is initialized to 1, and is set to grow at a rate of
$\gamma^l$ each year. If $\alpha^{\mathit{gl}}$ is set to 0 and
$\beta^{\mathit{gl}}$ is set to 1, then labor productivity grows at a uniform
rate across all activities. There are multiple strategies to put values on these
parameters. These may include setting $\beta^{\mathit{gl}}$ to 0 for a subset of
activities and initializing $\alpha^{\mathit{gl}}$ to some exogenous level based
on external studies---for example setting $\alpha^{\mathit{gl}}$ to 2~percent in
the agricultural sectors. The remaining sectors could be segmented into two
subsets---one with high productivity, e.g. set $\alpha^{\mathit{gl}}$ to
2~percent, and one with low productivity, e.g. set $\alpha^{\mathit{gl}}$ to 0,
with $\beta^{\mathit{gl}}$ set to 1 in both cases.

Two other factors can influence sector-specific labor productivity. The first is
a skill-specific shifter, $\chi^{\mathit{gl}}$, that introduces biased technical change across skill
types. In typical simulations, this factor is initialized at 0 and there is
no difference in labor productivity growth across skills. One alternative
strategy is to have some (exogenous) assumption on the skill premium, for example
no change in the skill premium. It is then possible to endogenize skill-biased
technical change to see how much this parameter must change to maintain the
exogenous assumption on the skill premium. The second factor is the
knowledge-induced endogenous technical change, $\pi^k$. This formulation
is described in the knowledge module, see for example equation~(\ref{eq:pik}).

In the baseline or reference
scenario, $\gamma^l$ will be calibrated to target a given level of per capita
GDP growth and subject to the assumptions made on $\alpha^{\mathit{gl}}$ and
$\beta^{\mathit{gl}}$. In subsequent scenarios, $\lambda^f$ will be exogenous
having been calibrated in the reference scenario, subject to any changes
in the two other factors: $\chi^{\mathit{gl}}$ and $\pi^k$.

\begin{equation}
\label{eq:lambdal}
\lambda^f_{r,l,a,t} =
   \left( 1 + \chi^{\mathit{gl}}_{r,l,t} + \pi^k_{r,a,t} + \alpha^{\mathit{gl}}_{r,l,a,t}
+  \beta^{\mathit{gl}}_{r,l,a,t} \gamma^l_{r,t} \right)^n \lambda^f_{r,l,a,t-n}
\end{equation}

Because \emph{Old} capital is malleable, the cost structure of \emph{Old} capital is
adjusted between periods in such a way that the aggregate inputs of the previous period (i.e.
summed over vintages) can produce aggregate output. There is no such adjustment of the
cost structure of \emph{New} capital. In generic terms, for any nest in the production structure
we have inputs $X_{i,v,t}$ at price $P_{i,v,t}$ to form the bundle $V_{v,t}$ at price $R_{v,t}$,
with technological shifters given by $\lambda_{i,v,t}$. The basic re-calibration formula is:

\[
\alpha_{i,\mathit{Old},t+1} =
\lambda_{i,\mathit{Old},t}^{\left(1-\sigma_{\mathit{Old}}\right)}
\frac{\displaystyle \sum_v{X_{i,v,t}}} {\displaystyle \sum_v{V_{v,t}}}
\left[
\frac{\displaystyle {\sum_v{P_{i,v,t} X_{i,v,t}}} \biggl / {\sum_v{X_{i,v,t}}}} {\displaystyle {\sum_v{R_{v,t} V_{v,t}}} \biggl / {\sum_v{V_{v,t}}}}
\right]^{\sigma_{\mathit{Old}}}
\]

\noindent where $\sigma$ is the relevant substitution elasticity for \emph{Old} capital. The formula remains the same for the normalized version of the CES
function.

\section{Servitization}

[Added 13-FEB-2022] Code has been introduced to allow for
the 'servitization' of the economy, essentially defined as the change
in the production structure that rotates towards services
demand away from manufactured demand. The implementation
is based on the description from \cite{ChateauetalSupplyJGEA2020}.

Let $k$ represent the 'services' inputs, $m$ represent the
manufactured inputs, and $c$ represent the union of the two.\footnote{In
\cite{ChateauetalSupplyJGEA2020} $k$ represents all non-transport services,
(though it is unclear how 'ELY' and 'CNS' are treated.
It is also not clear what is included in the manufactured inputs, e.g. energy?).}
The basic idea is to raise the
share of services inputs each year by a growth factor, for example
1\%, and to adjust downwards the the share of manufactured
inputs. A cap is introduced on the share, for example 60\%.\footnote{In
\cite{ChateauetalSupplyJGEA2020} the 1\% and 60\% assumptions
apply to the manufacturing activities. The relevant
numbers in the services sectors are 0.2\% and 75\%.}
In \textsc{Envisage}, this is done in a cost-neutral fashion,
i.e. using the 'twist' methodology---further described in the next section
and in Appendix~\ref{chap:CESAppendix}.

The initial share of services in activity $a$
with respect to all relevant inputs, i.e. $c$, is given by the
following formula. Note that the denominator does not quite have the
same value as the $\mathit{ND1}$ bundle, as it excludes some inputs
such as transport services.

\[
s^t_{a,t0} = \displaystyle \frac{\sum_k{\mathit{PA}_{k,a,t0}\mathit{XA}_{k,a,t0}}}
{\sum_c{\mathit{PA}_{c,a,t0}\mathit{XA}_{c,a,t0}}}
\]

The following expression provides the desired growth in the share of
services in production, where $\mathit{gs}$ is the user-provided growth
rate. The share is capped at $\mathit{smax}^t$.
\[
s^t_{a,t} = min\left[s^t_{a,t-n} \left(1 + \mathit{gs}_{a} \right)^n, \mathit{smax}^t_{a,t}\right]
\]

Equations~(\ref{eq:ios}) and~(\ref{eq:iom}) represent the update formulas for
the input-output technology parameters that thus incorporate
the servitization assumption.

\begin{equation}
\label{eq:ios}
\lambda^{\mathit{io}}_{k,a,t} = \lambda^{\mathit{io}}_{k,a,t-1}
\left(\frac{s^t_{a,t-1}}{s^t_{a,t}}
\right)^{1/(1-\sigma^{\mathit{nd1}}_{a})}
\end{equation}

\begin{equation}
\label{eq:iom}
\lambda^{\mathit{io}}_{m,a,t} = \lambda^{\mathit{io}}_{m,a,t-1}
\left(\frac{1 - s^t_{a,t-1}}{1 - s^t_{a,t}}
\right)^{1/(1-\sigma^{\mathit{nd1}}_{a})}
\end{equation}

It is pretty straightforward to show that the so-called 'twist' variable
takes the following form in this case:

\[
\mathit{tw}_{a,t} = \frac{s^t_{a,t} - s^t_{a,t-1}}{s^t_{a,t-1}\left(1 - s^t_{a,t}\right)}
\]

\section{Preference shifters}

\subsection{Armington twists}

In the standard version of the model, the Armington preference parameters---both
top and second levels---are held fixed at their base year calibrated levels.
Thus changes in import shares are linked only to changes in relative prices.
Historically, we have observed large changes in import shares without a
concomitant change in relative prices. \cite{DixonRimmer2002} have developed a
specification for the MONASH (and USAGE) model that 'twists' the relevant share
parameters. The 'twist' targets a percentage change in the ratio of imports to
domestic demand, which at unchanged component prices, is cost-neutral. The
mechanics of the twist methodology is described in
Appendix \ref{chap:CESAppendix}.

For the \textsc{Envisage} model, we have incorporated three versions of the
twist---for the dual nested sourcing decision. The first two deal with the
top-level Armington decision---purchases of domestic goods and the aggregate
import bundle. Since we have two possible specifications---agent-based sourcing
or national sourcing, we provide two twist specifications. The third is for the
second level nest that sources aggregate imports by region of origin.

\subsubsection{National sourcing}

The equations for national sourcing of domestic purchases and aggregate imports
are provided in equations~(\ref{eq:xdt}) and~(\ref{eq:xmt}), with the domestic
and import share parameters given respectively by $\alpha^{\mathit{dt}}$ and
$\alpha^{\mathit{mt}}$. Equation~(\ref{eq:twt1}) provides the 'twisted' domestic
and imported share parameters where $\mathit{tw}^{\mathit{t1}}$ is the level of
the desired twist, i.e. the percent change in the ratio of imports to domestic
purchases at unchanged prices. The twist has no impact on the share parameters
if it is set to its default value of 0. The twist updating uses the (lagged)
value share of imports in the top-level Armington bundle.\footnote{In the MONASH
and USAGE models, the twist parameters are calculated contemporaneously, i.e.
they are part of the model equations. In \textsc{Envisage}, the twists are
applied between periods. This should have only minimal impact on model results.}
Note that the formulas apply the twist factor directly to the share coefficients
themselves and we drop the $\lambda$ factor, i.e. preference change variable,
from the formulas as these can be substituted out (refer to
Appendix \ref{chap:CESAppendix}).

\begin{equation}
\label{eq:twt1}
\begin{array}{c c l}
   \alpha^{\mathit{dt}}_{r,i,t} & = &
      \alpha^{\mathit{dt}}_{r,i,t-1}
      \frac {\displaystyle 1} {\displaystyle 1+s^{\mathit{t1}}_{r,i,t-1}
         \mathit{tw}^{\mathit{t1}}_{r,i,t}} \\
   \alpha^{\mathit{mt}}_{r,i,t} & = &
      \alpha^{\mathit{mt}}_{r,i,t-1}
      \frac{\displaystyle 1+\mathit{tw}^{\mathit{t1}}_{r,i,t}}
         {\displaystyle 1+s^{\mathit{t1}}_{r,i,t-1}
            \mathit{tw}^{\mathit{t1}}_{r,i,t}} \\
\end{array}
\end{equation}

\noindent where

\[
s^{\mathit{t1}}_{r,i,t-1} = \frac{\mathit{PMT}_{r,i,t-1}\mathit{XMT}_{r,i,t-1}}
   {\mathit{PAT}_{r,i,t-1}\mathit{XAT}_{r,i,t-1}}
\]

\subsubsection{Agent sourcing}

The expressions for agent-based sourcing of domestic goods and aggregate imports
are nearly identical with the inclusion of the index for the Armington agent,
$\mathit{aa}$. The share parameters are part of equations~(\ref{eq:xd})
and~(\ref{eq:xm}). Equation~(\ref{eq:tw1}) provides the relevant formulas for
the 'twisted' shares using the appropriate import share level. Note that the
twists are allowed to be agent-specific, though in practice, there is probably
little evidence to differentiate across agents.

\begin{equation}
\label{eq:tw1}
\begin{array}{c c l}
\alpha^{\mathit{d}}_{r,i,\mathit{aa},t} & = &
   \alpha^{\mathit{d}}_{r,i,\mathit{aa},t-1}
   \frac{\displaystyle 1}{\displaystyle 1+s^{\mathit{1}}_{r,i,\mathit{aa},t-1}
      \mathit{tw}^{\mathit{1}}_{r,i,\mathit{aa},t}} \\
\alpha^{\mathit{m}}_{r,i,\mathit{aa},t} & = &
   \alpha^{\mathit{m}}_{r,i,\mathit{aa},t-1}
   \frac{\displaystyle 1+\mathit{tw}^{\mathit{1}}_{r,i,\mathit{aa},t}}
   {\displaystyle 1+s^{\mathit{1}}_{r,i,\mathit{aa},t-1}
      \mathit{tw}^{\mathit{1}}_{r,i,\mathit{aa},t}} \\
\end{array}
\end{equation}

\noindent where

\[
s^{\mathit{1}}_{r,i,\mathit{aa},t-1} =
   \frac{\mathit{PM}_{r,i,\mathit{aa},t-1}\mathit{XM}_{r,i,\mathit{aa},t-1}}
   {\mathit{PA}_{r,i,\mathit{aa},t-1}\mathit{XA}_{r,i,\mathit{aa},t-1}}
\]

\subsubsection{Second level Armington twists}

The second level of the Armington nest allocates aggregate imports across source
regions (see equation~(\ref{eq:xwd})). With the sole exception of a 2-region
model, the standard twist does not apply and we thus apply the twist to a target
set of source countries, i.e. we segment the source regions
into~2.\footnote{The targeted regions can include only a single region.} The
targeted regions will see their share increase (by the same twist), and the
non-targeted regions will see their share decline.

\begin{equation}
\label{eq:tw2}
\begin{array}{c c l l}
\alpha^{\mathit{w}}_{s,i,r,t} & = &
   \alpha^{\mathit{w}}_{s,i,r,t-1}
   \frac{\displaystyle 1}{\displaystyle 1+s^{\mathit{2}}_{i,r,t-1}
      \mathit{tw}^{\mathit{2}}_{r,i,t}}
&  \textrm{if } s \notin {\mathit{rtwtgt}(s,r)}\\
\alpha^{\mathit{w}}_{s,i,r,t} & = &
   \alpha^{\mathit{w}}_{s,i,r,t-1}
   \frac{\displaystyle 1+\mathit{tw}^{\mathit{2}}_{r,i,t}}
      {\displaystyle 1+s^{\mathit{2}}_{i,r,t-1} \mathit{tw}^{\mathit{2}}_{r,i,t}}
&  \textrm{if } s \in {\mathit{rtwtgt}(s,r)} \\
\end{array}
\end{equation}

\noindent where
\[
s^{\mathit{2}}_{i,r,t-1} =
   \frac{\sum_{s \in {\mathit{rtwtgt}(s,r)}}
      {\mathit{PDM}_{s,i,r,t-1}\mathit{XW}_{s,i,r,t-1}}}
      {\sum_{s}{\mathit{PDM}_{s,i,r,t-1}\mathit{XW}_{s,i,r,t-1}}}
\]

\subsection{Introducing cost curves}

Changes in costs in the normal functioning of the model depend on changes in
input prices and the standard assumptions regarding technology change. This
section explains how to introduce an acceleration in cost reduction coming from
some exogenous phenomenon such as learning by doing. The basic idea is to start
from an initial price, say $P_0$, and to reduce costs over time, albeit with a
lower limit given by $\mathit{PMIN}$. There also exists a target price for year
$T$, given by $P_T$, that must be greater than $\mathit{PMIN}$. Let $\alpha$
represent the ratio of the final price, $P_T$, relative to the base year price,
$P_0$, i.e.:

\[
P_T=\alpha P_0
\]

\noindent and let $\gamma$ represent the ratio of the minimum price,
$\mathit{PMIN}$, relative to the initial price, i.e.:

\[
\mathit{PMIN}=\gamma P_0
\]

\noindent where $\alpha > \gamma$. Two functional forms are introduced to
represent the cost curve---the hyperbola and the logistic functions. The
hyperbola takes the following form:

\[
P_t = \mathit{PMIN} + \chi t^{-\beta}
\]

\noindent The logistic function takes the form:

\[
P_t = \frac{\mathit{PMIN}} {1+\chi e^{-\beta t}}
\]

Calibration of the parameters for the hyperbola function involve the following
expressions:

\[
\begin{array}{c c}
\beta = \displaystyle \frac{\ln\left(\displaystyle
   \frac{\alpha-\gamma}{1-\gamma}\right)}
      {\ln\left(\displaystyle \frac{t_0}{T}\right)}
&  \qquad \chi = P_0\left(1-\gamma\right) \\
\end{array}
\]

\noindent where we define $t_0$ to start with 1.\footnote{If the first year is
2011, $t$ is then defined as $t-2010$. If 	the final year is 2050, then $T$ is
equal to $2050 - (2011-1)=40$.} In the case of the logistic function, the
calibration formulas are:

\[
\begin{array}{c c}
\beta = \displaystyle - \frac{1}{T} \ln \left( \displaystyle
   \frac{\alpha-\gamma}{\alpha\left(1-\gamma\right)}\right)
&  \qquad \chi = \gamma-1 \\
\end{array}
\]

\noindent where we define $t_0$ to start with 0.\footnote{If the first year is
2011, $t$ is then defined as $t-2011$. If 	the final year is 2050, then $T$ is
equal to $2050 - 2011=39$.} Figure~\ref{fig:costCurve} depicts the shapes of the
two cost curves for the same initial and end points and price limit. From the
shape of the curves it is clear that costs drop sharply in the initial years
using the hyperbola specification. The drop is more gradual (and constant in
percentage terms) for the logistic function.

\begin{figure}
   \centering
   \input{CostCurve}
   \caption{Examples of cost curves}
   \label{fig:costCurve}
\end{figure}

The adjustment to the cost curve is made on total factor productivity (TFP) for
the relevant activity. The aggregate cost is given by the following formula:

\[
P_t = \frac{1}{\lambda_t} F(P_{i,t})
\]

\noindent where $F$ is the cost function and depends on the prices of the
various inputs given by $P_i$. In most cases, the cost function will be the dual
price expression of the CES function.\footnote{In 	most cases $\lambda$ is
initialized at 1 and is held constant. Technology is introduced as
labor-augmenting technical change and with an exogenous improvement in
energy efficiency.} TFP is assumed to behave according to the following
expression:

\[
\lambda_t = \left(1+\pi_t\right)^n \lambda_{t-n}
\]

Assuming that input prices are invariant, the growth in TFP must be equal to the
following expression:

\[
\pi_t = \left( \frac{P_{t-n}}{P_t} \right)^{1/n} -1
\]

We can introduce the formulas for the two cost curves to derive expressions for
$\pi$. For the hyperbola, we have:

\[
\pi_t =
   \left( \frac{\mathit{PMIN}+\chi(t-n)^{-\beta}}
      {\mathit{PMIN}+\chi t^{-\beta}} \right)^{1/n} -1
\Longleftrightarrow
   \left( \frac{\gamma + (1-\gamma)(t-n)^{-\beta}}
      {\gamma + (1-\gamma) t^{-\beta}} \right)^{1/n} -1
\]

\noindent For the logistic function, the expression for $\pi$ is given by:

\[
\pi_t =
   \left( \frac{e^{\beta t} + \chi}{e^{\beta t} + \chi e^{\beta n}}
   \right)^{1/n} -1
\]

Both changes in preferences and introduction of the cost curves can be
implemented to change the share of any technology in a demand bundle. The latter
operates directly on the preference shares of the buyer. The former operates on
the perceived cost of the technology. These are formulated independently of the
actual cost changes that arise from the endogenous changes in input prices.

\subsubsection{Alternative cost curves}

One alternative for the hyperbolic cost curve is to calibrate the curve through
three data points: the reference year and two future years---respectively $t_0$,
$t_1$ and $t_2$. The curve can be defined by:

\[
P_t = P_{t_0} + \chi \left(t-t_0\right)^{-\beta}
\]

\noindent The exponent can be calibrated using the following formula:

\[
\beta = \ln \left( \frac{P_{t_1}-P_{t_0}}{P_{t_2}-P_{t_0}} \right) /
\ln \left( \frac{t_2 - t_0}{t_1 -  t_0} \right)
\]

\noindent The slope coefficient can be calibrated using:

\[
\chi = \left(P_{t_1} - P_{t_0}\right) \left(t_1-t_0\right)^{\beta}
\]

\subsection{Electrification preferences}

Each agent in the economy has demand for an aggregate
energy bundle. The parameters are calibrated to the
base year data---and in many instances, most agents
have relatively low shares for electricity demand. It might
thus prove desirable to autonomously increase electrification
to a user's targeted share. The formulas below
are introduced assuming constant prices and ignoring
the re-calibration of \emph{'Old'} share parameters
that is part of a dynamic simulation. The relevant
preference parameters are equal to the ratio
of the target share in year $t$ relative to the
actual base year share. The target share can be some
multiple of the base year share, or any other assumption
desired by the user. Note that it is up to the user to
make sure that the targeted share is within a normal
range.

Calibrated preference parameters between electric and
non-electric bundles in production.

\[
\alpha^{\mathit{ely}}_{\mathit{r,a,v,t}}
= \frac{s^{\mathit{ely}}_{r,a,t}}{s^{\mathit{ely}}_{r,a,t_0}}
\]

\[
\alpha^{\mathit{nely}}_{\mathit{r,a,v}}
= \frac{1-s^{\mathit{ely}}_{r,a,t}}{1-s^{\mathit{ely}}_{r,a,t_0}}
\]

\noindent Calibrated preference parameters between electric and
non-electric bundles in consumption.

\[
 \alpha^{\mathit{cely}}_{\mathit{r,k,h,t}}
= \frac{s^{\mathit{cely}}_{r,h,t}}{s^{\mathit{cely}}_{r,h,t_0}}
\]

\[
\alpha^{\mathit{cnely}}_{\mathit{r,k,h,t}}
= \frac{1-s^{\mathit{cely}}_{r,k,h,t}}{1-s^{\mathit{cely}}_{r,k,h,t_0}}
\]

If the user provides a target share for some future year, say $T$\footnote{$T$ is often the final year of a simulation.}, the intermediate shares can be adjusted using several different
smoothing assumptions, for example geometric or arithmetic growth.

\[
s^{\mathit{ely}}_{r,a,t} =
\begin{cases}
s^{\mathit{ely}}_{r,a,t_0}
\left[\frac{s^{\mathit{ely}}_{r,a,T}}{s^{\mathit{ely}}_{r,a,t_0}}
\right]^{(t-t_0)/(T-t_0)} & \textrm{if } t < T \textrm{ and geometric growth} \\
s^{\mathit{ely}}_{r,a,t_0} +
\left[{s^{\mathit{ely}}_{r,a,T}}-{s^{\mathit{ely}}_{r,a,t_0}}
\right]
\displaystyle \frac{t-t_0}{T-t_0} & \textrm{if } t < T \textrm{ and arithetic growth} \\
s^{\mathit{ely}}_{r,a,T} & \textrm{if } t \ge T
\end{cases}
\]

\section{Implementation}

The \texttt{core} model includes all of the equations from
Chapter~3.\footnote{With the exception of the GDP per capita growth equation as
this requires a different MCP formulation.} There are two versions of the
dynamic model. The reference simulation, that targets GDP growth, is defined as
the \texttt{core} model plus the GDP growth equation (\ref{eq:grgdppc}),
migration (\ref{eq:migr}), labor supply by skill and zone (\ref{eq:ls}), total
labor supply by skill (\ref{eq:glab}), investment growth factor
(\ref{eq:invgfact}), non-normalized capital stock (\ref{eq:kst}), normalized
capital stock (\ref{eq:tks}), and labor productivity (\ref{eq:lambdal}). This
model is called \texttt{coreBaU} and it essentially calibrates the economy-wide
labor productivity factor. All other dynamic simulations assume that labor
productivity is exogenous i.e. per capita GDP growth is endogenous. This model
is called \texttt{coreDyn} and includes the \texttt{core} model plus the GDP
growth equation (\ref{eq:grgdppc}), migration (\ref{eq:migr}), labor supply by
skill and zone (\ref{eq:ls}), total labor supply by skill (\ref{eq:glab}),
investment growth factor (\ref{eq:invgfact}), non-normalized capital stock
(\ref{eq:kst}), and normalized capital stock (\ref{eq:tks}).

\section{Diagnostics}

There are a number of post-simulation diagnostics available with the model. Most
are relatively straightforward and need no additional explanation, for example
the GDP deflator at market price---these are taken directly from the model
solution file and aggregated where appropriate.

\subsection{Sectoral investment}

Sectoral investment can be backed out by the capital accumulation motion
equation:

\[
I_{a,t} = K_{a,t+1} - (1-\delta)K_{a,t}
\]

\section{Exogenous variables}

In this section, we summarize the standard list of
exogenous variables in the model. These are partitioned
into sub-groups depending on their role in the model
specification.

\subsection{Factors of production}

Population and labor force growth are typically exogenous. The latter
may be defined over rural and urban if using the migration module. In
this case, the growth of labor is exogenous, but the growth per zone
may be influenced by endogenous rural to urban migration. The capital
stock is exogenous in the comparative static version of the model
and is in principle pre-determined in the dynamic model with annual
step sizes. In the case of multi-year step size, current investment
will influence the current stock level (see equation~(\ref{eq:kst})).
Natural resources are supplied with an upward sloping supply curve
with two, normally fixed, shifters. The first shifter is a regional
shifter. The second is a global shifter. The latter has been used to
target a trend for world prices (e.g. oil or gas). In this case
the world price for the relevant sector is fixed to the desired
trend level and the global resource supply shifter is endogenous. This
would typically be implemented only in a baseline. The land
and water asymptotes are used-entered, as is the demand for
exogenous water bundles.

\begin{table}[H]
	\caption{Exogenous factor variables}
	\label{tab:exogFact}
	\begin{center}
		\rowcolors{2}{TableOdd}{TableEven}
		\rowcolors{1}{}{lightblue}
		\begin{tabular}{l l p{8.0cm}}
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
			\textbf{Variable} & \textbf{GAMS} & \textbf{Description} \\
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
{$\mathit{Pop}^t$} & {\texttt{pop}} & {Population} \\
{$g^{\mathit{lz}}$} & {\texttt{glabz}} & {Growth of labor by zone} \\
{$\chi^{rw}$} & {\texttt{chirw}} & {Reservation wage shifter} \\
{$K^s$} & {\texttt{kstock}} & {Capital stock (endogenous in dynamic version)} \\
{$\mathit{TK}^s$} & {\texttt{tkaps}} & {Normalized capital stock (endogenous in dynamic version)} \\
{$\chi^{w,\mathit{nrs}}$} & {\texttt{wchinrs}} & {Global natural resource supply shifter} \\
{$\chi^{\mathit{nrs}}$} & {\texttt{chinrs}} & {Region specific natural resource supply shifter} \\
{$\mathit{PW}$} & {\texttt{pw}} & {World price by activity} \\
{$\mathit{TLand}^{\mathit{Max}}$} & {\texttt{landmax}} & {Land maximum} \\
{$\mathit{TH2O}^{\mathit{Max}}$} & {\texttt{h2oMax}} & {Water maximum} \\
{$\mathit{H2OBnd}_{\mathit{wbx}}$} & {\texttt{h2obnd}} & {Exogenous water bundle demand} \\
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
		\end{tabular}
	\end{center}
\end{table}

\subsection{Macro closure}

There are three different closure rules---all with default
assumptions. The savings-investment closure fixes the household
savings rate, $\mathit{aps}$, adjusted by the shift parameter $\chi^s$.
The former is always fixed. The latter can be endogenous to achieve
a given target---for example the investment to GDP ratio. The latter
is endogenous under the default closure rule but may be over-ridden.
Typically, in the baseline, one will target some level of
the investment to GDP ratio and allow the private savings rate adjust.\footnote{The targeted investment variable is \texttt{rinvshr} in the
GAMS code.} In a similar vein, the wage premium, normally the skilled
wage relative to unskilled wages, is endogenous. One could target
the wage premium, i.e. make it exogenous. The endogenous variable
could be the relative growth of skilled and unskilled labor in levels
or the relative growth in labor productivity. The default public
closure is that government expenditures are fixed relative to GDP
in real terms (in the baseline) and real government savings are
fixed. The direct tax rate, $\kappa^h$, on household income, is
the swing variable that ensures the fiscal target. The default balance
of payment closure fixes net foreign saving. The real exchange rate
is endogenous. Two additional closures are available. One fixes
the share of foreign savings relative to GDP---similar in
many ways to the default closure. The third allows for some
endogeneity in foreign savings, in which case the deviation
of expected capital returns is equalized across all regions.

\begin{table}[H]
	\caption{Exogenous macro closure variables}
	\label{tab:exogClosure}
	\begin{center}
		\rowcolors{2}{TableOdd}{TableEven}
		\rowcolors{1}{}{lightblue}
		\begin{tabular}{l l p{8.0cm}}
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
			\textbf{Variable} & \textbf{GAMS} & \textbf{Description} \\
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
{$\mathit{aps}$} & {\texttt{aps}} & {Average savings propensity (not for ELES)} \\
{$\chi^s$} & {\texttt{chiaps}} & {Private savings shifter (depends on investment/savings closure)} \\
{$\pi^s$} & {\texttt{wprem}} & {Wage premium} \\
{$\mathit{RS}^g$} & {\texttt{rsg}} & {Real public savings (depends on fiscal closure)} \\
{$\mathit{YFD}_{\mathit{gov}}$} & {\texttt{xfd(gov)}} & {Government expenditures} \\
{$S^f$} & {\texttt{savf}} & {Foreign saving (depends on BoP closure)} \\
{$\chi^{\mathit{sf}}$} & {\texttt{savRat}} & {Foreign saving as share of GDP (depends on BoP closure)} \\
{$\mathit{PNUM}$} & {\texttt{pnum}} & {Model numeraire} \\
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
		\end{tabular}
	\end{center}
\end{table}

\subsection{Tax rates}

In the default specification all tax rates are exogenous. The actual
tax rate used could depend on model specification choices, for
example, a national versus agent-based representation of
the second level Armington specification.

\begin{table}[H]
	\caption{Exogenous tax rate}
	\label{tab:exogTax}
	\begin{center}
		\rowcolors{2}{TableOdd}{TableEven}
		\rowcolors{1}{}{lightblue}
		\begin{tabular}{l l p{8.0cm}}
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
			\textbf{Variable} & \textbf{GAMS} & \textbf{Description} \\
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
{$\tau^p$} & {\texttt{ptax}} & {Production tax} \\
{$\tau^{\mathit{uc}}$} & {\texttt{uctax}} & {Unit cost tax} \\
{$\tau^v$} & {\texttt{pftax}} & {Tax on factor use} \\
{$\kappa^f$} & {\texttt{kappaf}} & {Factor income tax by source activity and factor} \\
{$\tau^a$} & {\texttt{patax}} & {Tax on Armington consumption (depends on ArmFlag)} \\
{$\tau^{\mathit{ad}}$} & {\texttt{pdtax}} & {Tax on domestic sales of domestic goods (depends on ArmFlag)} \\
{$\tau^{\mathit{am}}$} & {\texttt{pmtax}} & {Tax on domestic sales of imported goods (depends on ArmFlag)} \\
{$\tau^e$} & {\texttt{etax}} & {Bilateral export tax} \\
{$\tau^m_{s,i,r} $} & {\texttt{mtax}} & {Bilateral import tariff} \\
{$\tau^\mathit{ma}$} & {\texttt{mtaxa}} & {Import tariff for MRIO version of model} \\
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
		\end{tabular}
	\end{center}
\end{table}

\subsection{Technology variables}

In most cases all of the technology variables are exogenous, though
not necessarily fixed at base year levels---for example, the
international trade margins or energy efficiency. The model
calibrates labor-biased technological change (the $\lambda^f$ parameter
for labor) in the baseline to target GDP growth. In this case, $g^y$, i.e.
per capita output growth, is exogenous, and $\gamma^l$ is endogenous.
An equation in the model evaluates $\lambda^f$ for labor based
on the exogenous GDP growth target. In all subsequent simulations the
labor productivity variable is fixed and GDP growth is endogenous.

\begin{table}[H]
	\caption{Exogenous technology variables}
	\label{tab:exogTech}
	\begin{center}
		\rowcolors{2}{TableOdd}{TableEven}
		\rowcolors{1}{}{lightblue}
		\begin{tabular}{l l p{8.0cm}}
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
			\textbf{Variable} & \textbf{GAMS} & \textbf{Description} \\
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
{$\zeta^{\mathit{mg}}$} & {\texttt{tmarg}} & {Bilateral trade margins} \\
{$A^{\mathit{xpv}}$} & {\texttt{axghg}} & {Uniform shifter in production bundle} \\
{$\lambda^{\mathit{xp}}$} & {\texttt{lambdaxp}} & {Output shifter in production bundle} \\
{$\lambda^{\mathit{ghg}}$} & {\texttt{lambdaghg}} & {GHG shifter in production bundle} \\
{$\lambda^f$} & {\texttt{lambdaf}} & {Productivity parameter for primary factors} \\
{$\lambda^k$} & {\texttt{lambdak}} & {Capital efficiency shifter} \\
{$\lambda^{h2ob}$} & {\texttt{lambdah2obnd}} & {Water efficiency shifter in water bundle use} \\
{$\lambda^{\mathit{io}}$} & {\texttt{lambdaio}} & {Efficiency shifter in intermediate demand} \\
{$\lambda^{\mathit{e}}$} & {\texttt{lambdae}} & {lambdae} \\
{$\lambda^{\mathit{ce}}$} & {\texttt{lambdace}} & {lambdace} \\
{$g^y$} & {\texttt{grrgdppc}} & {Growth rate of real per capita GDP} \\
{$\gamma^l$} & {\texttt{gl}} & {Economywide labor productivity parameter} \\
\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
		\end{tabular}
	\end{center}
\end{table}

\subsection{Preference variables}

Preference variables are all fixed, but may depend on which
utility function is implemented. They could also be adjusted
between solution periods to target some trend growth, for
example the food budget, as incomes change.

\begin{table}[H]
	\caption{Exogenous preferences variables}
	\label{tab:exogPref}
	\begin{center}
		\rowcolors{2}{TableOdd}{TableEven}
		\rowcolors{1}{}{lightblue}
		\begin{tabular}{l l p{8.0cm}}
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
			\textbf{Variable} & \textbf{GAMS} & \textbf{Description} \\
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
{$e^h$} & {\texttt{eh}} & {CDE expansion parameter} \\
{$b^h$} & {\texttt{bh}} & {CDE substitution parameter} \\
{$\alpha^h$} & {\texttt{alphah}} & {CDE shift parameter} \\
{$\gamma$} & {\texttt{gamma}} & {AIDADS/E/LES marginal propensity to consume parameter} \\
{$\mu^c$} & {\texttt{muc}} & {AIDADS/E/LES Subsistence minima} \\
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
		\end{tabular}
	\end{center}
\end{table}

\subsection{Emission variables}

The default specification for emissions is that they are endogenous
and the emissions tax is exogenous (and in most cases set to zero\footnote{The exceptions could include the price on carbon emissions
in the European Union's Emission Trading Scheme, or an interpretation
of the Nationally Determined Commitments (NDCs) that are part of
the Paris Agreeement}). One could target a trend in global
emissions for any particular gas or pollutant and allow a global
shifter---attached to the emission equations---be endogenous ($\chi^{\mathit{Emi}}$). The model also allows for non-model
based emissions, either at a regional (e.g. deforestation) or
global level. The emission regime variables are described
in the emissions section.

\begin{table}[H]
	\caption{Emission variables}
	\label{tab:exogEmi}
	\begin{center}
		\rowcolors{2}{TableOdd}{TableEven}
		\rowcolors{1}{}{lightblue}
		\begin{tabular}{l l p{8.0cm}}
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
			\textbf{Variable} & \textbf{GAMS} & \textbf{Description} \\
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
{$\chi^{\mathit{Emi}}$} & {\texttt{chiEmi}} & {Global shifter in emissions} \\
{$\mathit{EmiOth}$} & {\texttt{emiOth}} & {Other non-modeled emissions (by region)} \\
{$\mathit{EmiOthGbl}$} & {\texttt{emiOthGbl}} & {Other non-modeled global emissions} \\
{$\tau^{\mathit{Emi}}$} & {\texttt{emitax}} & {Emission tax} \\
{$\mathit{Emi}^{\mathit{Cap}}$} & {\texttt{emiCap}} & {Emission cap} \\
{$\mathit{EmiQ}$} & {\texttt{emiQuota}} & {Emission quota} \\
{$\mathit{EmiQY}$} & {\texttt{emiQuotaY}} & {Emission quota revenues} \\
{$\tau^{\mathit{EmiQ}}$} & {\texttt{emiRegTax}} & {Regional emission tax} \\
{$\chi^{\mathit{Cap}}$} & {\texttt{chiCap}} & {Emissions cap shifter} \\
			\arrayrulecolor{TableBorder}\specialrule{1pt}{0pt}{0pt}
		\end{tabular}
	\end{center}
\end{table}

\appendix
\chapter{The CES and CET functions}
\label{chap:CESAppendix}
\renewcommand{\theequation}{{A-}\arabic{equation}}
\setcounter{equation}{0}

This appendix describes in full detail the two functional forms most widely used
in CGE models-the constant-elasticity-of-substitution (CES) and
constant-elasticity-of-transformation (CET) functions.

\input{../../../Word/Latex/CESCET.tex}

\chapter{The demand systems}
\label{chap:DemandAppendix}
\renewcommand{\theequation}{{B-}\arabic{equation}}
\setcounter{equation}{0}

This appendix describes in full detail the consumer demand systems available in
the \textsc{Envisage} Model. The first section derives the main relations for
the extended linear expenditure system (ELES). The second section describes the
constant differences in elasticity (CDE) demand system.

\section{The extended linear expenditure system (ELES)}
\input{../../../Word/Latex/ELES.tex}

\section{An Implicitly Direct Additive Demand System (AIDADS)}
\input{../../../Word/Latex/AIDADS.tex}

\section{Constant differences in elasticity (CDE) demand system}
\input{../../../Word/Latex/CDE.tex}

\chapter{Analytics of dynamics}
\label{chap:AppDyn}
\renewcommand{\theequation}{{C-}\arabic{equation}}
\setcounter{equation}{0}
\input{Dynamics}

\chapter{Analytical SAM and GTAP correspondence}
\input{accounting}

\chapter{Dimensions of the GTAP database, release 11}
\label{chap:GTAPDim}
\renewcommand{\theequation}{{D-}\arabic{equation}}
\setcounter{equation}{0}
\input{GTAPDimV11.tex}

\chapter{User Guide}

\input{UserGuide}

%\bibliographystyle{plainnat}
%\bibliographystyle{jpe}
\bibliographystyle{../../../Word/Latex/JGEA/JGEA}
\bibliography{../../../Bib/vdMRef}

\end{document}
